(this["webpackJsonp@project/client"]=this["webpackJsonp@project/client"]||[]).push([[0],{232:function(e,t){},234:function(e,t){},249:function(e,t){},251:function(e,t){},278:function(e,t,n){"use strict";n.r(t);n(215);var a=n(145),r=n(10),i=n(24),o=n(26),c=n(8),s=n(3),u=n(22),l=n(4),d=n.n(l),b=n(0),f=n.n(b),h=n(18),v=n(93),p=n(330),g=n(193),j=n(363);function O(e){var t=Object(b.useState)([0,0]),n=Object(s.a)(t,2),a=n[0],r=n[1];return Object(b.useLayoutEffect)((function(){function t(){e&&r([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",t),t(),function(){return window.removeEventListener("resize",t)}}),[e]),a}var m=n(94),k=n(13),y=n(12),x=n(17),S=function(){function e(t){Object(k.a)(this,e),this.keyBindSet=void 0,this.keyBindSet=t}return Object(y.a)(e,[{key:"bindCopy",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=this.keyBindSet.copySubtitle.keys;if(!r)return function(){};var i=this.copyHandler(e,t,n);return Object(x.a)(r,{capture:a},i),function(){return x.a.unbind(r,i)}}},{key:"copyHandler",value:function(e,t,n){return function(a){if(!t()){var r=n();r&&e(a,r)}}}},{key:"bindAnkiExport",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.ankiExport.keys;if(!a)return function(){};var r=this.ankiExportHandler(e,t);return Object(x.a)(a,{capture:n},r),function(){return x.a.unbind(a,r)}}},{key:"ankiExportHandler",value:function(e,t){return function(n){t()||e(n)}}},{key:"bindUpdateLastCard",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.updateLastCard.keys;if(!a)return function(){};var r=this.updateLastCardHandler(e,t);return Object(x.a)(a,{capture:n},r),function(){return x.a.unbind(a,r)}}},{key:"updateLastCardHandler",value:function(e,t){return function(n){t()||e(n)}}},{key:"bindSeekToSubtitle",value:function(e,t,n,a){var r=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=function(i,o){if(!t()){var c=a();if(c&&0!==c.length){var s=r._adjacentSubtitle(o,n(),c);null!==s&&s.start>=0&&s.end>=0&&e(i,s)}}},c=this.keyBindSet.seekToPreviousSubtitle.keys,s=this.keyBindSet.seekToNextSubtitle.keys,u=function(e){return o(e,!1)},l=function(e){return o(e,!0)};return c&&Object(x.a)(c,{capture:i},u),s&&Object(x.a)(s,{capture:i},l),function(){c&&x.a.unbind(c,u),s&&x.a.unbind(s,l)}}},{key:"bindSeekToBeginningOfCurrentSubtitle",value:function(e,t,n,a){var r=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this.keyBindSet.seekToBeginningOfCurrentSubtitle.keys;if(!o)return function(){};var c=function(i){if(!t()){var o=a();if(o&&0!==o.length){var c=r._currentSubtitle(n(),o);void 0!==c&&c.start>=0&&c.end>=0&&e(i,c)}}};return Object(x.a)(o,{capture:i},c),function(){return x.a.unbind(o,c)}}},{key:"_currentSubtitle",value:function(e,t){for(var n,a=e,r=Number.MAX_SAFE_INTEGER,i=0;i<t.length;++i){var o=t[i];if(!(o.start<0||o.end<0)){var c=a-o.start;a>=o.start&&a<o.end&&c<r&&(n=o,r=c)}}return n}},{key:"bindSeekBackwardOrForward",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=function(n,a){t()||e(n,a)},r=this.keyBindSet.seekBackward.keys,i=this.keyBindSet.seekForward.keys,o=function(e){return a(e,!1)},c=function(e){return a(e,!0)};return r&&Object(x.a)(r,{capture:n},o),i&&Object(x.a)(i,{capture:n},c),function(){r&&x.a.unbind(r,o),i&&x.a.unbind(i,c)}}},{key:"bindOffsetToSubtitle",value:function(e,t,n,a){var r=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=function(i,o){if(!t()){var c=a();if(c&&0!==c.length){var s=n(),u=r._adjacentSubtitle(o,s,c);if(null!==u){var l=u.originalStart;e(i,s-l)}}}},c=this.keyBindSet.adjustOffsetToPreviousSubtitle.keys,s=this.keyBindSet.adjustOffsetToNextSubtitle.keys,u=function(e){return o(e,!1)},l=function(e){return o(e,!0)};return c&&Object(x.a)(c,{capture:i},u),s&&Object(x.a)(s,{capture:i},l),function(){c&&x.a.unbind(c,u),s&&x.a.unbind(s,l)}}},{key:"_adjacentSubtitle",value:function(e,t,n){for(var a=t,r=-1,i=Number.MAX_SAFE_INTEGER,o=0;o<n.length;++o){var c=n[o],s=e?c.start-a:a-c.start;i<=s||(e&&a<c.start?(i=s,r=o):!e&&a>c.start&&(i=s,r=a<c.end?Math.max(0,o-1):o))}return-1!==r?n[r]:null}},{key:"bindAdjustOffset",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=function(a,r){if(!t()){var i=n();if(i&&0!==i.length){var o=i[0].start-i[0].originalStart;e(a,o+(r?100:-100))}}},i=this.keyBindSet.decreaseOffset.keys,o=this.keyBindSet.increaseOffset.keys,c=function(e){return r(e,!1)},s=function(e){return r(e,!0)};return Object(x.a)(i,{capture:a},c),Object(x.a)(o,{capture:a},s),function(){x.a.unbind(i,c),x.a.unbind(o,s)}}},{key:"bindToggleSubtitles",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.toggleSubtitles.keys;if(!a)return function(){};var r=function(n){t()||e(n)};return Object(x.a)(a,{capture:n},r),function(){x.a.unbind(a,r)}}},{key:"bindToggleSubtitleTrackInVideo",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=[this.keyBindSet.toggleVideoSubtitleTrack1.keys,this.keyBindSet.toggleVideoSubtitleTrack2.keys].filter((function(e){return e}));if(0===a.length)return function(){};for(var r=function(n,a){t()||e(n,a)},i=[],o=function(e){var t=function(t){return r(t,e)};i.push(t),Object(x.a)(a[e],{capture:n},t)},c=0;c<a.length;++c)o(c);return function(){for(var e=0;e<a.length;++e){var t=i[e];x.a.unbind(a[e],t)}}}},{key:"bindToggleSubtitleTrackInList",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=[this.keyBindSet.toggleAsbplayerSubtitleTrack1.keys,this.keyBindSet.toggleAsbplayerSubtitleTrack2.keys].filter((function(e){return e}));if(0===a.length)return function(){};for(var r=function(n,a){t()||e(n,a)},i=[],o=function(e){var t=function(t){return r(t,e)};i.push(t),Object(x.a)(a[e],{capture:n},t)},c=0;c<9;++c)o(c);return function(){for(var e=0;e<9;++e){var t=i[e];x.a.unbind(a[e],t)}}}},{key:"bindPlay",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.togglePlay.keys;if(!a)return function(){};var r=function(n){t()||e(n)};return Object(x.a)(a,{capture:n},r),function(){x.a.unbind(a,r)}}},{key:"bindAutoPause",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.toggleAutoPause.keys;if(!a)return function(){};var r=function(n){t()||e(n)};return Object(x.a)(a,{capture:n},r),function(){x.a.unbind(a,r)}}},{key:"bindCondensedPlayback",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.toggleCondensedPlayback.keys;if(!a)return function(){};var r=function(n){t()||e(n)};return Object(x.a)(a,{capture:n},r),function(){x.a.unbind(a,r)}}}]),e}(),C=function(){function e(){Object(k.a)(this,e)}return Object(y.a)(e,null,[{key:"encode",value:function(){var e=Object(c.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(c.a)(d.a.mark((function e(a,r){var i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(i=new FileReader).onload=function(){var e=Object(c.a)(d.a.mark((function e(t){var i,o,c,s,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,i=new AudioContext,null!==t.target){e.next=5;break}return r(new Error("Could not obtain buffer to encode")),e.abrupt("return");case 5:return e.next=7,i.decodeAudioData(t.target.result);case 7:for(o=e.sent,c=[],s=0;s<o.numberOfChannels;++s)c.push(o.getChannelData(s));(u=n()).postMessage({command:"encode",audioBuffer:{channels:c,numberOfChannels:o.numberOfChannels,length:o.length,sampleRate:o.sampleRate}}),u.onmessage=function(e){a(new Blob(e.data.buffer,{type:"audio/mp3"})),u.terminate()},u.onerror=function(e){var t,n=null!==(t=null===e||void 0===e?void 0:e.error)&&void 0!==t?t:new Error("MP3 encoding failed: "+(null===e||void 0===e?void 0:e.message));r(n),u.terminate()},e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),r(e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t){return e.apply(this,arguments)}}(),i.readAsArrayBuffer(t);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function w(){return new Worker(n.p+"static/js/mp3-encoder.d9a88fab.worker.js")}var T=n(83),F=n.n(T);function P(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=Math.floor(e/1e3);t=n?Math.round(e/1e3%60*10)/10:a%60;var r=Math.floor(a/60)%60,i=Math.floor(a/3600);return i>0?i+"h"+String(r).padStart(2,"0")+"m"+String(t).padStart(2,"0")+"s":r+"m"+String(t).padStart(2,"0")+"s"}function E(e,t,n,a){for(var r=t,i=t;i>=0&&!I(e,r=i,t,n,a,!1);--i);for(var o=r,c=t;c<=e.length-1&&!I(e,o=c,t,n,a,!0);++c);return e.slice(r,o+1)}function M(e,t,n){var a=[e],r=e.start-e.originalStart;if(e.end<t){var i=Math.min(t,e.end+n);a.push({text:"",start:e.end,end:i,originalStart:e.end-r,originalEnd:i-r,track:e.track})}if(e.start>0){var o=Math.max(0,e.start-n);a.unshift({text:"",start:o,end:e.start,originalStart:o-r,originalEnd:e.start-r,track:e.track})}return a}function I(e,t,n,a,r,i){var o;return o=i?t+1<e.length?e[t+1]:null:t-1>=0?e[t-1]:null,Math.abs(n-t)>=a&&(null===o||Math.abs(o.start-e[n].start)>=r)}function R(e,t){var n=window.URL.createObjectURL(e),a=document.createElement("a");document.body.appendChild(a),a.style.display="none",a.href=n,a.download=F()(t),a.click(),URL.revokeObjectURL(n),a.remove()}var B,A,N,_=function(){return new w},D=function(){function e(t,n,a,r,i){Object(k.a)(this,e),this._name=void 0,this.start=void 0,this.end=void 0,this._base64=void 0,this._extension=void 0,this.cachedBlob=void 0,this._name=t+"_"+Math.floor(n)+"_"+Math.floor(a),this.start=n,this.end=a,this._base64=r,this._extension=i}return Object(y.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return this._extension}},{key:"base64",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._base64);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t,n,a=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return t=e.sent,(n=new Audio).src=URL.createObjectURL(t),n.preload="none",n.load(),e.next=9,n.play();case 9:return e.abrupt("return",new Promise((function(e,t){setTimeout((function(){n.pause();var t=n.src;n.src="",URL.revokeObjectURL(t),e(void 0)}),a.end-a.start+1e3)})));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_blob",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cachedBlob){e.next=6;break}return e.next=3,fetch("data:audio/"+this.extension+";base64,"+this._base64);case 3:return e.next=5,e.sent.blob();case 5:this.cachedBlob=e.sent;case 6:return e.abrupt("return",this.cachedBlob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"slice",value:function(e,t){return this}},{key:"isSliceable",value:function(){return!1}}]),e}(),L=function(){function e(t,n,a,r){Object(k.a)(this,e),this.file=void 0,this._name=void 0,this.start=void 0,this.end=void 0,this.trackId=void 0,this._extension=void 0,this.recorderMimeType=void 0,this._blob=void 0;var i=e._recorderConfiguration(),o=Object(s.a)(i,2),c=o[0],u=o[1];this.recorderMimeType=c,this.file=t,this._name=t.name+"_"+n+"_"+a,this.start=n,this.end=a,this.trackId=r,this._extension=u}return Object(y.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return this._extension}},{key:"base64",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(c.a)(d.a.mark((function e(n,a){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new FileReader,e.t0=r,e.next=4,t.blob();case 4:e.t1=e.sent,e.t0.readAsDataURL.call(e.t0,e.t1),r.onloadend=function(){var e=r.result,t=e.substring(e.indexOf(",")+1);n(t)};case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=5;break}return e.next=3,this._clipAudio();case 3:return this._blob=e.sent,e.abrupt("return");case 5:return e.next=7,this._audioElement(this._blob,!1);case 7:return(t=e.sent).currentTime=0,e.next=11,t.play();case 11:return e.next=13,this._stopAudio(t);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=4;break}return e.next=3,this._clipAudio();case 3:this._blob=e.sent;case 4:return e.abrupt("return",this._blob);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_clipAudio",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(c.a)(d.a.mark((function e(n,a){var i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._audioElement(t.file,!0);case 2:(i=e.sent).oncanplay=function(){var e=Object(c.a)(d.a.mark((function e(o){var c,s,u,l,b;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i.play(),c=t._captureStream(i),s=new MediaRecorder(c,{mimeType:t.recorderMimeType}),u=[],s.ondataavailable=function(e){u.push(e.data)},s.onstop=function(e){n(new Blob(u,{type:t.recorderMimeType}))},s.start(),e.next=10,t._stopAudio(i);case 10:s.stop(),l=Object(r.a)(c.getAudioTracks());try{for(l.s();!(b=l.n()).done;)b.value.stop()}catch(o){l.e(o)}finally{l.f()}e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),a(e.t0);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t){return e.apply(this,arguments)}}();case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_audioElement",value:function(e,t){var n=this,a=new Audio;return a.src=URL.createObjectURL(e),new Promise((function(e,i){a.onloadedmetadata=function(i){if(t&&n.trackId&&a.audioTracks&&a.audioTracks.length>0){var o,c=Object(r.a)(a.audioTracks);try{for(c.s();!(o=c.n()).done;){var s=o.value;s.enabled=n.trackId===s.id}}catch(u){c.e(u)}finally{c.f()}}a.currentTime=n.start/1e3,e(a)}}))}},{key:"_captureStream",value:function(e){var t;if("function"===typeof e.captureStream&&(t=e.captureStream()),"function"===typeof e.mozCaptureStream&&(t=e.mozCaptureStream()),void 0===t)throw new Error("Unable to capture stream from audio");var n,a=new MediaStream,i=Object(r.a)(t.getVideoTracks());try{for(i.s();!(n=i.n()).done;){n.value.stop()}}catch(u){i.e(u)}finally{i.f()}var o,c=Object(r.a)(t.getAudioTracks());try{for(c.s();!(o=c.n()).done;){var s=o.value;s.enabled&&a.addTrack(s)}}catch(u){c.e(u)}finally{c.f()}return a}},{key:"_stopAudio",value:function(){var e=Object(c.a)(d.a.mark((function e(t){var n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){setTimeout((function(){t.pause();var n=t.src;t.src="",URL.revokeObjectURL(n),e(void 0)}),n.end-n.start+100)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"slice",value:function(t,n){return new e(this.file,t,n,this.trackId)}},{key:"isSliceable",value:function(){return!0}}],[{key:"_recorderConfiguration",value:function(){var e={"audio/ogg;codecs=opus":"ogg","audio/webm;codecs=opus":"webm"};return Object.keys(e).filter(MediaRecorder.isTypeSupported).map((function(t){return[t,e[t]]}))[0]}}]),e}(),W=function(){function e(t,n){Object(k.a)(this,e),this.data=void 0,this.workerFactory=void 0,this._blob=void 0,this.data=t,this.workerFactory=n}return Object(y.a)(e,[{key:"name",get:function(){return this.data.name}},{key:"extension",get:function(){return"mp3"}},{key:"base64",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(c.a)(d.a.mark((function e(n,a){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new FileReader,e.t0=r,e.next=5,t.blob();case 5:e.t1=e.sent,e.t0.readAsDataURL.call(e.t0,e.t1),r.onloadend=function(){var e=r.result,t=e.substring(e.indexOf(",")+1);n(t)},e.next=13;break;case 10:e.prev=10,e.t2=e.catch(0),a(e.t2);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.play();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=9;break}return e.t0=C,e.next=4,this.data.blob();case 4:return e.t1=e.sent,e.t2=this.workerFactory,e.next=8,e.t0.encode.call(e.t0,e.t1,e.t2);case 8:this._blob=e.sent;case 9:return e.abrupt("return",this._blob);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"slice",value:function(t,n){return new e(this.data.slice(t,n),this.workerFactory)}},{key:"isSliceable",value:function(){return this.data.isSliceable()}}]),e}(),U=function(){function e(t){Object(k.a)(this,e),this.data=void 0,this.data=t}return Object(y.a)(e,[{key:"name",get:function(){return this.data.name+"."+this.data.extension}},{key:"play",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.play();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"base64",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.base64();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:R(e.sent,this.name);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toMp3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_;return this.data instanceof W||"mp3"===this.data.extension?this:new e(new W(this.data,t))}},{key:"slice",value:function(t,n){return new e(this.data.slice(t,n))}},{key:"isSliceable",value:function(){return this.data.isSliceable()}}],[{key:"fromBase64",value:function(t,n,a,r,i){return new e(new D(t.substring(0,t.lastIndexOf(".")),n,a,r,i))}},{key:"fromFile",value:function(t,n,a,r){return new e(new L(t,n,a,r))}}]),e}(),H=function(){function e(){Object(k.a)(this,e)}return Object(y.a)(e,[{key:"resize",value:function(e,t,n,a){return new Promise((function(r,i){var o=n<=0?1:n/e.width,c=a<=0?1:a/e.height,s=Math.min(1,Math.min(o,c));if(s<1){var u=e.width*s,l=e.height*s;createImageBitmap(e,{resizeWidth:u,resizeHeight:l}).then((function(n){e.width=u,e.height=l,t.drawImage(n,0,0),r(e)})).catch((function(e){return i(e)}))}else r(e)}))}}]),e}(),z=function(){function e(t,n,a){Object(k.a)(this,e),this._name=void 0,this._base64=void 0,this._extension=void 0,this.cachedBlob=void 0,this._name=t,this._base64=n,this._extension=a}return Object(y.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return this._extension}},{key:"base64",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._base64);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_blob",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cachedBlob){e.next=6;break}return e.next=3,fetch(this._dataUrl());case 3:return e.next=5,e.sent.blob();case 5:this.cachedBlob=e.sent;case 6:return e.abrupt("return",this.cachedBlob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._dataUrl());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_dataUrl",value:function(){return"data:image/"+this.extension+";base64,"+this._base64}}]),e}(),q=function(){function e(t,n,a,r){Object(k.a)(this,e),this.file=void 0,this.timestamp=void 0,this.maxWidth=void 0,this.maxHeight=void 0,this._name=void 0,this.file=t,this._name=t.name+"_"+Math.floor(n)+".jpeg",this.timestamp=n,this.maxWidth=a,this.maxHeight=r}return Object(y.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return"jpeg"}},{key:"base64",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(c.a)(d.a.mark((function e(n,a){var r,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._canvas();case 2:r=e.sent,i=r.toDataURL("image/jpeg"),n(i.substring(i.indexOf(",")+1));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(c.a)(d.a.mark((function e(n,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._canvas();case 2:e.sent.toBlob((function(e){null===e?a(new Error("Could not obtain blob")):n(e)}),"image/jpeg");case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canvas();case 2:return t=e.sent,e.abrupt("return",t.toDataURL());case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_canvas",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(c.a)(d.a.mark((function e(n,a){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(r=t._videoElement(t.file)).oncanplay=function(){var e=Object(c.a)(d.a.mark((function e(a){var i,o,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=document.createElement("canvas")).width=r.videoWidth,i.height=r.videoHeight,(o=i.getContext("2d")).drawImage(r,0,0,i.width,i.height),!(t.maxWidth>0||t.maxHeight>0)){e.next=12;break}return c=new H,e.next=9,c.resize(i,o,t.maxWidth,t.maxHeight);case 9:n(i),e.next=13;break;case 12:n(i);case 13:URL.revokeObjectURL(r.src);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_videoElement",value:function(e){var t=document.createElement("video");return t.src=URL.createObjectURL(e),t.preload="none",t.currentTime=this.timestamp/1e3,t.load(),t}}]),e}(),V=function(){function e(t){Object(k.a)(this,e),this.data=void 0,this.data=t}return Object(y.a)(e,[{key:"name",get:function(){return this.data.name}},{key:"extension",get:function(){return this.data.extension}},{key:"base64",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.base64();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.dataUrl();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pngBlob",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(c.a)(d.a.mark((function e(n,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=createImageBitmap,e.next=4,t.blob();case 4:e.t1=e.sent,(0,e.t0)(e.t1).then((function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toBlob((function(e){e?n(e):a("Failed to convert to PNG")}),"image/png")})),e.next=11;break;case 8:e.prev=8,e.t2=e.catch(0),a(e.t2);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:R(e.sent,this.data.name);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"fromBase64",value:function(t,n,a,r){var i=t.substring(0,t.lastIndexOf("."))+"_"+Math.floor(n)+"."+r;return new e(new z(i,a,r))}},{key:"fromFile",value:function(t,n,a,r){return new e(new q(t,n,a,r))}}]),e}(),K=function(){function e(){Object(k.a)(this,e)}return Object(y.a)(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=Object(c.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"POST",body:JSON.stringify(n)});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}]),e}(),G=['"',"*","_","\\",":"],X=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new K;Object(k.a)(this,e),this.settingsProvider=void 0,this.fetcher=void 0,this.settingsProvider=t,this.fetcher=n}return Object(y.a)(e,[{key:"deckNames",value:function(){var e=Object(c.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("deckNames",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelNames",value:function(){var e=Object(c.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("modelNames",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelFieldNames",value:function(){var e=Object(c.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("modelFieldNames",{modelName:t},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findNotesWithWord",value:function(){var e=Object(c.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("findNotes",{query:this.settingsProvider.wordField+":"+this._escapeQuery(t)},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findNotesWithWordGui",value:function(){var e=Object(c.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("guiBrowse",{query:this.settingsProvider.wordField+":"+this._escapeQuery(t)},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_escapeQuery",value:function(e){for(var t="",n=0;n<e.length;++n){var a=e[n];G.includes(a)?t+="\\".concat(a):t+=a}return'"'.concat(t,'"')}},{key:"requestPermission",value:function(){var e=Object(c.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("requestPermission",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"export",value:function(){var e=Object(c.a)(d.a.mark((function e(t,n,a,r,i,o,c,s,u,l,b){var f,h,v,p,g,j,O,m,k,y,x,S,C,w,T,F;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f={},this._appendField(f,this.settingsProvider.sentenceField,t,!0),this._appendField(f,this.settingsProvider.definitionField,n,!0),this._appendField(f,this.settingsProvider.wordField,i,!1),this._appendField(f,this.settingsProvider.sourceField,o,!1),this._appendField(f,this.settingsProvider.urlField,c,!1),s)for(h=0,v=Object.keys(s);h<v.length;h++)p=v[h],this._appendField(f,this.settingsProvider.customAnkiFields[p],s[p],!0);if(g={note:{deckName:this.settingsProvider.deck,modelName:this.settingsProvider.noteType,tags:u,options:{allowDuplicate:!1,duplicateScope:"deck",duplicateScopeOptions:{deckName:this.settingsProvider.deck,checkChildren:!1}}}},j="gui"===l,O="updateLast"===l,!this.settingsProvider.audioField||!a){e.next=31;break}if(m=this._sanitizeFileName(a.name),!j&&!O){e.next=25;break}return e.t0=this,e.t1=m,e.next=17,a.base64();case 17:return e.t2=e.sent,e.t3=b,e.next=21,e.t0._storeMediaFile.call(e.t0,e.t1,e.t2,e.t3);case 21:k=e.sent.result,this._appendField(f,this.settingsProvider.audioField,"[sound:".concat(k,"]"),!1),e.next=31;break;case 25:return e.t4=m,e.next=28,a.base64();case 28:e.t5=e.sent,e.t6=[this.settingsProvider.audioField],g.note.audio={filename:e.t4,data:e.t5,fields:e.t6};case 31:if(!this.settingsProvider.imageField||!r){e.next=52;break}if(y=this._sanitizeFileName(r.name),!j&&!O){e.next=46;break}return e.t7=this,e.t8=y,e.next=38,r.base64();case 38:return e.t9=e.sent,e.t10=b,e.next=42,e.t7._storeMediaFile.call(e.t7,e.t8,e.t9,e.t10);case 42:x=e.sent.result,this._appendField(f,this.settingsProvider.imageField,'<div><img src="'.concat(x,'"></div>'),!1),e.next=52;break;case 46:return e.t11=y,e.next=49,r.base64();case 49:e.t12=e.sent,e.t13=[this.settingsProvider.imageField],g.note.picture={filename:e.t11,data:e.t12,fields:e.t13};case 52:g.note.fields=f,e.t14=l,e.next="gui"===e.t14?56:"updateLast"===e.t14?59:"default"===e.t14?80:83;break;case 56:return e.next=58,this._executeAction("guiAddCards",g,b);case 58:return e.abrupt("return",e.sent.result);case 59:return e.next=61,this._executeAction("findNotes",{query:"added:1"},b);case 61:if(0!==(S=e.sent.result.sort()).length){e.next=64;break}throw new Error("Could not find note to update");case 64:return C=S[S.length-1],g.note.id=C,e.next=68,this._executeAction("notesInfo",{notes:[C]});case 68:if(!((w=e.sent).result.length>0&&w.result[0].noteId===C)){e.next=79;break}return T=w.result[0],e.next=73,this._executeAction("updateNoteFields",g,b);case 73:if(this.settingsProvider.wordField&&T.fields){e.next=75;break}return e.abrupt("return",T.noteId);case 75:if((F=T.fields[this.settingsProvider.wordField])&&F.value){e.next=78;break}return e.abrupt("return",T.noteId);case 78:return e.abrupt("return",F.value);case 79:throw new Error("Could not update last card because the card info could not be fetched");case 80:return e.next=82,this._executeAction("addNote",g,b);case 82:return e.abrupt("return",e.sent.result);case 83:throw new Error("Unknown export mode: "+l);case 84:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r,i,o,c,s,u,l,d){return e.apply(this,arguments)}}()},{key:"_appendField",value:function(e,t,n,a){if(t&&n){var r=a?n.split("\n").join("<br>"):n,i=e[t];i&&(r=i+"<br>"+r),e[t]=r}}},{key:"_sanitizeFileName",value:function(e){return F()(e,{replacement:"_"})}},{key:"_storeMediaFile",value:function(){var e=Object(c.a)(d.a.mark((function e(t,n,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAction("storeMediaFile",{filename:t,data:n},a));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"_executeAction",value:function(){var e=Object(c.a)(d.a.mark((function e(t,n,a){var r,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={action:t,version:6},n&&(r.params=n),e.next=4,this.fetcher.fetch(a||this.settingsProvider.ankiConnectUrl,r);case 4:if(!(i=e.sent).error){e.next=7;break}throw new Error(i.error);case 7:return e.abrupt("return",i);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()}]),e}();!function(e){e[e.none=0]="none",e[e.showAnkiDialog=1]="showAnkiDialog",e[e.updateLastCard=2]="updateLastCard"}(B||(B={})),function(e){e[e.atStart=1]="atStart",e[e.atEnd=2]="atEnd"}(A||(A={})),function(e){e[e.normal=1]="normal",e[e.condensed=2]="condensed",e[e.autoPause=3]="autoPause"}(N||(N={}));var J=n(108),Y=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Object(k.a)(this,e),this.tree=void 0,this.gapsTree=void 0,this.options=void 0,this.tree=new J.a,this.options=n,n.returnLastShown||n.returnNextToShow){var a;this.gapsTree=new J.a,t.length>0&&t[0].start>0&&this.gapsTree.insert([0,t[0].start-1],t[0]);var i,o=Object(r.a)(t);try{for(o.s();!(i=o.n()).done;){var c=i.value;this.tree.insert([c.start,c.end],c),void 0!==a&&a.end<c.start&&this.gapsTree.insert([a.end+1,c.start-1],a),a=c}}catch(d){o.e(d)}finally{o.f()}}else{var s,u=Object(r.a)(t);try{for(u.s();!(s=u.n()).done;){var l=s.value;this.tree.insert([l.start,l.end],l)}}catch(d){u.e(d)}finally{u.f()}}}return Object(y.a)(e,[{key:"subtitlesAt",value:function(e){var t,n,a,i,o=[e,e],c=this.tree.search(o);if(0===c.length){if(void 0!==this.gapsTree){var s=[];if(t=this.gapsTree.search(o,(function(e,t){return s.push(t),e})),t.length>0&&this.options.returnNextToShow){var u=s[0].high+1;n=this.tree.search([u,u])}}}else if(void 0!==this.options.showingCheckRadiusMs){var l,d=Object(r.a)(c);try{for(d.s();!(l=d.n()).done;){var b=l.value;if(void 0===i&&b.end<e+this.options.showingCheckRadiusMs&&(i=b),void 0===a&&e-this.options.showingCheckRadiusMs<b.start&&(a=b),void 0!==a&&void 0!==i)break}}catch(f){d.e(f)}finally{d.f()}}return{showing:c,lastShown:t,nextToShow:n,startedShowing:a,willStopShowing:i}}}],[{key:"empty",value:function(){return e.emptySubtitleCollection}}]),e}();Y.emptySubtitleCollection=new Y([]);var Z=n(367),Q=n(6),$=n(366),ee=n(279),te=n(1),ne=Object(p.a)({root:{display:"flex",justifyContent:"center",position:"fixed",top:80,width:"100%",pointerEvents:"none",zIndex:2e3}});function ae(e){var t=ne();return Object(b.useEffect)((function(){if(e.open){var t=setTimeout(e.onClose,e.autoHideDuration);return function(){return clearTimeout(t)}}}),[e.open,e.autoHideDuration,e.onClose]),Object(te.jsx)("div",{className:t.root,children:Object(te.jsx)(ee.a,{in:e.open,children:Object(te.jsx)($.a,{severity:e.severity,children:e.children})})})}var re=n(5),ie=n(334),oe=["tags","onTagsChange"];function ce(e){var t=e.tags,n=e.onTagsChange,a=Object(re.a)(e,oe),i=Object(b.useState)(""),c=Object(s.a)(i,2),u=c[0],l=c[1];Object(b.useEffect)((function(){t.join(", ")!==u&&l(t.join(", "))}),[u,t]);var d=Object(b.useCallback)((function(e){var t=e.target.value;u.length>t.length&&u.includes(t)&&t.endsWith(",")&&(t=t.substring(0,t.length-1));var a=function(e){var t,n=e.split(" ").join("").split(","),a=[],i=Object(r.a)(n);try{for(i.s();!(t=i.n()).done;){var o=t.value;a.push(o.trim())}}catch(c){i.e(c)}finally{i.f()}return a}(t);l(a.join(", ")),n(a)}),[u,n]);return Object(te.jsx)(ie.a,Object(o.a)(Object(o.a)({},a),{},{value:u,onChange:d}))}var se=n(290),ue=n(339),le=n(340),de=n(338),be=Object(se.a)((function(e){return{image:function(e){return{width:e.width,height:e.height,backgroundSize:"contain"}}}}));function fe(e){var t,n=e.open,a=e.image,r=e.onClose,i=Object(b.useState)(),o=Object(s.a)(i,2),u=o[0],l=o[1],f=Object(b.useState)(0),h=Object(s.a)(f,2),v=h[0],p=h[1],g=Object(b.useState)(0),j=Object(s.a)(g,2),O=j[0],m=j[1],k=function(){var e=Object(b.useState)([0,0]),t=Object(s.a)(e,2),n=t[0],a=t[1];return Object(b.useLayoutEffect)((function(){function e(){a([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),n}(),y=Object(s.a)(k,2),x=y[0],S=y[1];t=v>0&&O>0?Math.min(1,Math.min(x/(2*v),S/(2*O))):1;var C=be({width:v*t,height:O*t});return Object(b.useEffect)((function(){function e(){return e=Object(c.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,a.dataUrl();case 4:t=e.sent,(n=new Image).onload=function(){p(n.width),m(n.height),l(t)},n.src=t;case 8:case"end":return e.stop()}}),e)}))),e.apply(this,arguments)}l(void 0),function(){e.apply(this,arguments)}()}),[a]),a&&u?Object(te.jsx)(de.a,{open:n,onClose:r,maxWidth:"lg",children:Object(te.jsx)(ue.a,{children:Object(te.jsx)(le.a,{className:C.image,image:u,title:a.name,style:{width:v*t,height:O*t}})})}):null}var he=n(7),ve=n(346),pe=n(89),ge=n.n(pe),je=n(345),Oe=n(343),me=n(153),ke=n.n(me),ye=n(152),xe=n.n(ye),Se=n(344),Ce=n(280),we=n(341),Te=n(95),Fe=n(155),Pe=n.n(Fe),Ee=n(154),Me=n.n(Ee),Ie=n(88),Re=n.n(Ie),Be=n(371),Ae=n(342),Ne=n(369),_e=n(52),De=n(156),Le=n.n(De),We=n(157),Ue=n.n(We);function He(e){var t=e.subtitle,n=e.availableWidth,a=e.scale;if(void 0===t.textImage)return null;var r=a*n/t.textImage.screen.width*t.textImage.image.width;return Object(te.jsx)("div",{style:{maxWidth:r},children:Object(te.jsx)("img",{style:{width:"100%"},alt:"subtitle",src:t.textImage.dataUrl})})}var ze=Object(p.a)((function(e){return{root:{"& .MuiTextField-root":{marginBottom:e.spacing(1)}},title:{flexGrow:1},mediaField:{cursor:"pointer","& input":{cursor:"pointer"}},rangeSelectSlider:{"& .MuiSlider-markLabel":{transform:"translateX(-3%)"}}}}));function qe(e,t){var n={};return e.subtitles.filter((function(e){return""!==e.text.trim()||void 0!==e.textImage})).map((function(e){return e.start in n?null:(n[e.start]=!0,{value:e.start,label:"".concat(e.text.trim().substring(0,Math.min(e.text.length,3)),"...")})})).filter((function(e){return null!==e})).filter((function(e){return e.value>=t[0]&&e.value<=t[1]}))}function Ve(e){return P(e,!0)}function Ke(e,t){return e.start>=t[0]&&e.start<=t[1]||e.end>=t[0]&&e.end<=t[1]||t[0]>=e.start&&t[0]<=e.end||t[1]>=e.start&&t[1]<=e.end}function Ge(e){var t=e.children,n=e.open,a=e.value;return Object(te.jsx)(Ne.a,{open:n,enterTouchDelay:0,placement:"top",title:a,children:t})}var Xe=Object(p.a)((function(e){return{root:{marginBottom:e.spacing(1),padding:e.spacing(1),backgroundColor:e.palette.action.disabledBackground}}}));function Je(e){var t=e.selectedSubtitles,n=e.width,a=Xe();return 0===t.length||n<=0?null:Object(te.jsx)(Te.a,{elevation:0,className:a.root,children:t.map((function(e,t){return Object(te.jsx)(He,{availableWidth:n,subtitle:e,scale:1},t)}))})}var Ye=Object(he.a)({root:{transform:"translateY(-8px)"}})(we.a);function Ze(e){var t=e.open,n=e.disabled,a=e.text,i=e.onProceed,o=e.onRewind,u=e.onCancel,l=e.onViewImage,f=e.onOpenSettings,h=e.onRerecord,v=e.audioClip,p=e.image,g=e.source,j=e.url,O=e.sliderContext,m=e.customFields,k=e.settingsProvider,y=e.anki,x=e.definition,S=e.word,C=e.customFieldValues,w=e.timestampInterval,T=e.timestampBoundaryInterval,F=e.initialTimestampInterval,P=e.lastAppliedTimestampIntervalToText,M=e.lastAppliedTimestampIntervalToAudio,I=e.stateRef,R=ze(),B=Object(b.useState)(""),A=Object(s.a)(B,2),N=A[0],_=A[1],D=Object(b.useState)(""),L=Object(s.a)(D,2),W=L[0],U=L[1],H=Object(b.useState)(""),z=Object(s.a)(H,2),q=z[0],V=z[1],K=Object(b.useState)(),G=Object(s.a)(K,2),X=G[0],J=G[1],Y=Object(b.useState)(null!==g&&void 0!==g?g:""),Z=Object(s.a)(Y,2),Q=Z[0],$=Z[1],ee=Object(b.useState)(k.tags),ne=Object(s.a)(ee,2),ae=ne[0],re=ne[1],oe=Object(b.useState)(null!==j&&void 0!==j?j:""),se=Object(s.a)(oe,2),ue=se[0],le=se[1],be=Object(b.useState)([]),fe=Object(s.a)(be,2),he=fe[0],pe=fe[1],me=Object(b.useState)(0),ye=Object(s.a)(me,2),Te=ye[0],Fe=ye[1],Ee=Object(b.useState)({}),Ie=Object(s.a)(Ee,2),De=Ie[0],We=Ie[1],He=Object(b.useState)(),Xe=Object(s.a)(He,2),Ze=Xe[0],Qe=Xe[1],$e=Object(b.useState)([]),et=Object(s.a)($e,2),tt=et[0],nt=et[1],at=Object(b.useState)(),rt=Object(s.a)(at,2),it=rt[0],ot=rt[1],ct=Object(b.useState)(),st=Object(s.a)(ct,2),ut=st[0],lt=st[1],dt=Object(b.useState)(),bt=Object(s.a)(dt,2),ft=bt[0],ht=bt[1],vt=Object(b.useState)(),pt=Object(s.a)(vt,2),gt=pt[0],jt=pt[1],Ot=Object(b.useState)(),mt=Object(s.a)(Ot,2),kt=mt[0],yt=mt[1],xt=Object(b.useState)(),St=Object(s.a)(xt,2),Ct=St[0],wt=St[1],Tt=Object(b.useState)(0),Ft=Object(s.a)(Tt,2),Pt=Ft[0],Et=Ft[1],Mt=Object(b.useState)(),It=Object(s.a)(Mt,2),Rt=It[0],Bt=It[1],At=Object(b.useCallback)((function(e){var t;Et(null!==(t=null===e||void 0===e?void 0:e.getBoundingClientRect().width)&&void 0!==t?t:0)}),[]);I&&(I.current={text:W,sliderContext:O,definition:N,word:q,source:Q,url:ue,customFieldValues:De,initialTimestampInterval:it,timestampBoundaryInterval:ft,lastAppliedTimestampIntervalToText:kt,lastAppliedTimestampIntervalToAudio:Ct,timestampInterval:Ze});var Nt=Object(b.useCallback)((function(e){return O.subtitles.filter((function(t){return Ke(t,e)})).filter((function(e){return""!==e.text.trim()})).map((function(e){return e.text})).join("\n")}),[O]);Object(b.useEffect)((function(){U(null!==a&&void 0!==a?a:""),_(null!==x&&void 0!==x?x:""),V(null!==S&&void 0!==S?S:""),$(null!==g&&void 0!==g?g:""),le(null!==j&&void 0!==j?j:""),pe([]),We(null!==C&&void 0!==C?C:{})}),[a,g,x,S,C,j]),Object(b.useEffect)((function(){re(k.tags)}),[k.tags]),Object(b.useEffect)((function(){var e=w||O&&[O.subtitleStart,O.subtitleEnd]||void 0,t=O&&function(e){var t=e.subtitles.findIndex((function(t){return t.start===e.subtitleStart}));t=-1===t?e.subtitles.length/2:t;var n,a=E(e.subtitles,t,1,5e3),i=null,o=null,c=Object(r.a)(a);try{for(c.s();!(n=c.n()).done;){var s=n.value;(null===i||s.start<i)&&(i=s.start),(null===o||s.end>o)&&(o=s.end)}}catch(u){c.e(u)}finally{c.f()}return null!==i&&null!==o&&[i,o]}(O)||void 0,n=O&&qe(O,t)||void 0,i=void 0===O||void 0===e?[]:O.subtitles.filter((function(t){return Ke(t,e)}));U(null!==a&&void 0!==a?a:i.filter((function(e){return""!==e.text.trim()})).map((function(e){return e.text})).join("\n")),Qe(e),nt(i),ot(F||e),yt(P||e),wt(M||e),ht(null!==T&&void 0!==T?T:t),lt(t),jt(n)}),[O,F,w,T,P,M]),Object(b.useEffect)((function(){if(v){var e=v;k.preferMp3&&(e=e.toMp3()),Ct&&(e=e.slice(Math.max(0,Math.round(Ct[0])-k.audioPaddingStart),Math.round(Ct[1])+k.audioPaddingEnd)),Bt(e)}else Bt(void 0)}),[v,k.preferMp3,Ct,k.audioPaddingStart,k.audioPaddingEnd]),Object(b.useEffect)((function(){Fe(Date.now())}),[q]),Object(b.useEffect)((function(){if(q&&k.wordField){var e=q.trim();if(""!==e&&e!==X){var t=setTimeout(Object(c.a)(d.a.mark((function t(){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=pe,t.next=4,y.findNotesWithWord(e);case 4:t.t1=t.sent,(0,t.t0)(t.t1),J(e),t.next=12;break;case 9:t.prev=9,t.t2=t.catch(0),console.error(t.t2);case 12:case"end":return t.stop()}}),t,null,[[0,9]])}))),500);return function(){return clearTimeout(t)}}}}),[q,Te,X,y,k.wordField]);var _t,Dt=Object(b.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),Rt.play()}),[Rt]),Lt=Object(b.useCallback)((function(e,t){var n={};Object.assign(n,De),n[e]=t,We(n)}),[De]);_t=q&&q.trim()===X&&k.wordField?he.length>0?"Found ".concat(he.length,' notes with word "').concat(q,'" in field "').concat(k.wordField,'"'):'No notes found with word "'.concat(q.trim(),'" in field "').concat(k.wordField,'"'):"";var Wt=Object(b.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),l(p)}),[p,l]),Ut=Object(b.useCallback)((function(){if(void 0!==Ze){var e=Nt(Ze);U(e),yt(Ze)}}),[Nt,Ze]),Ht=Object(b.useCallback)((function(e,t){var n=t;Qe(n);var a=O.subtitles.filter((function(e){return Ke(e,n)}));if(nt(a),void 0!==kt){var r=Nt(kt);if(W.trim()===r.trim()){var i=Nt(n);U(i),yt(n)}}void 0===h&&!0===(null===Rt||void 0===Rt?void 0:Rt.isSliceable())&&wt(n)}),[O,W,kt,Nt]),zt=Object(b.useCallback)((function(e){h?(e.stopPropagation(),h()):wt(Ze)}),[h,Ze]),qt=Object(b.useCallback)((function(){if(ut){var e=void 0===O||void 0===it?[]:O.subtitles.filter((function(e){return Ke(e,it)}));nt(e),Qe(it),ht(ut),jt(O&&qe(O,ut))}}),[it,ut,O]),Vt=Object(b.useCallback)((function(){if(ft&&Ze){var e=[(ft[0]+Ze[0])/2,(ft[1]+Ze[1])/2];ht(e),jt(O&&qe(O,e))}}),[ft,Ze,O]),Kt=Object(b.useCallback)((function(){if(ft&&Ze){var e=[Math.max(0,2*ft[0]-Ze[0]),2*ft[1]-Ze[1]];ht(e),jt(O&&qe(O,e))}}),[ft,Ze,O]),Gt=Object(b.useCallback)(function(){var e=Object(c.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),p){e.next=3;break}return e.abrupt("return");case 3:return e.t0=navigator.clipboard,e.t1=ClipboardItem,e.next=7,p.pngBlob();case 7:e.t2=e.sent,e.t3={"image/png":e.t2},e.t4=new e.t1(e.t3),e.t5=[e.t4],e.t0.write.call(e.t0,e.t5);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[p]),Xt=!O||0===O.subtitles.filter((function(e){return""!==e.text.trim()})).length,Jt=void 0;return void 0!==h&&(Jt=Object(te.jsx)(Ne.a,{title:"Apply Selection (rerecord)",children:Object(te.jsx)("span",{children:Object(te.jsx)(Ce.a,{disabled:!Ze||!Ct||Ze[0]===Ct[0]&&Ze[1]===Ct[1],onClick:zt,edge:"end",children:Object(te.jsx)(xe.a,{})})})})),Object(te.jsxs)(de.a,{open:t,disableEnforceFocus:!0,fullWidth:!0,maxWidth:"sm",onClose:u,children:[Object(te.jsxs)(Ae.a,{children:[Object(te.jsx)(_e.a,{variant:"h6",className:R.title,children:"Anki Export"}),f&&Object(te.jsx)(Ce.a,{edge:"end",onClick:function(){return f()},children:Object(te.jsx)(Re.a,{})})]}),Object(te.jsx)(Oe.a,{ref:At,children:Object(te.jsxs)("form",{className:R.root,children:[O&&Ze&&Object(te.jsx)(Je,{selectedSubtitles:tt.filter((function(e){return void 0!==e.textImage})),width:Pt}),Object(te.jsx)(ie.a,{variant:"filled",color:"secondary",multiline:!0,fullWidth:!0,maxRows:8,label:"Sentence",value:W,onChange:function(e){return U(e.target.value)},InputProps:{endAdornment:Ze&&Object(te.jsx)(Ye,{position:"end",children:Object(te.jsx)(Ne.a,{title:"Apply Selection",children:Object(te.jsx)("span",{children:Object(te.jsx)(Ce.a,{disabled:!Ze||!kt||Ze[0]===kt[0]&&Ze[1]===kt[1]||Xt,onClick:Ut,edge:"end",children:Object(te.jsx)(ke.a,{})})})})})}}),Object(te.jsx)(ie.a,{variant:"filled",color:"secondary",multiline:!0,fullWidth:!0,rows:8,label:"Definition",value:N,onChange:function(e){return _(e.target.value)}}),Object(te.jsx)(ie.a,{variant:"filled",color:"secondary",fullWidth:!0,label:"Word",value:q,onChange:function(e){return V(e.target.value)},helperText:_t,InputProps:{endAdornment:Object(te.jsx)(we.a,{position:"end",children:Object(te.jsx)(Ne.a,{title:"Search in Anki",children:Object(te.jsx)("span",{children:Object(te.jsx)(Ce.a,{disabled:n||!k.wordField||!q||""===q.trim(),onClick:function(){return y.findNotesWithWordGui(q.trim())},edge:"end",children:Object(te.jsx)(Me.a,{})})})})})}}),Object.keys(m).map((function(e){return Object(te.jsx)(ie.a,{variant:"filled",color:"secondary",fullWidth:!0,multiline:!0,maxRows:8,label:e,value:De[e]||"",onChange:function(t){return Lt(e,t.target.value)}},e)})),Rt&&Object(te.jsx)("div",{className:R.mediaField,onClick:Dt,children:Object(te.jsx)(ie.a,{variant:"filled",color:"secondary",fullWidth:!0,value:Rt.name,label:"Audio",helperText:void 0===h&&!Rt.isSliceable()&&"Audio clip cannot be updated because it is pre-recorded",InputProps:{endAdornment:Jt&&Ze&&Object(te.jsx)(we.a,{position:"end",children:Jt})}})}),p&&Object(te.jsx)("div",{className:R.mediaField,onClick:Wt,children:Object(te.jsx)(ie.a,{variant:"filled",color:"secondary",fullWidth:!0,value:p.name,label:"Image",InputProps:{endAdornment:Object(te.jsx)(we.a,{position:"end",children:Object(te.jsx)(Ne.a,{title:"Copy to Clipboard",children:Object(te.jsx)("span",{children:Object(te.jsx)(Ce.a,{onClick:Gt,edge:"end",children:Object(te.jsx)(ge.a,{})})})})})}})}),Object(te.jsx)(ie.a,{variant:"filled",color:"secondary",fullWidth:!0,label:"Source",value:Q,onChange:function(e){return $(e.target.value)}}),j&&Object(te.jsx)(ie.a,{variant:"filled",color:"secondary",fullWidth:!0,label:"URL",value:ue,onChange:function(e){return le(e.target.value)}}),k.tags.length>0&&Object(te.jsx)(ce,{variant:"filled",label:"Tags",helperText:"Comma-separated list of strings",fullWidth:!0,color:"secondary",tags:ae,onTagsChange:function(e){return re(e)}}),Ze&&ft&&gt&&Object(te.jsxs)(Se.a,{container:!0,direction:"row",children:[Object(te.jsx)(Se.a,{item:!0,style:{flexGrow:1},children:Object(te.jsx)(Be.a,{ValueLabelComponent:Ge,value:Ze,valueLabelFormat:Ve,onChange:Ht,min:ft[0],max:ft[1],marks:gt,step:1,valueLabelDisplay:"auto",className:R.rangeSelectSlider,color:"secondary"})}),Object(te.jsx)(Se.a,{item:!0,children:Object(te.jsx)(Ne.a,{title:"Reset",children:Object(te.jsx)("span",{children:Object(te.jsx)(Ce.a,{edge:"end",style:{marginTop:-8},onClick:qt,children:Object(te.jsx)(Pe.a,{})})})})}),Object(te.jsx)(Se.a,{item:!0,children:Object(te.jsx)(Ne.a,{title:"Zoom In",children:Object(te.jsx)("span",{children:Object(te.jsx)(Ce.a,{edge:"end",style:{marginTop:-8},onClick:Vt,children:Object(te.jsx)(Le.a,{})})})})}),Object(te.jsx)(Se.a,{item:!0,children:Object(te.jsx)(Ne.a,{title:"Zoom Out",children:Object(te.jsx)("span",{children:Object(te.jsx)(Ce.a,{edge:"end",style:{marginTop:-8},onClick:Kt,children:Object(te.jsx)(Ue.a,{})})})})})]})]})}),Object(te.jsxs)(je.a,{children:[Object(te.jsx)(ve.a,{disabled:n,onClick:function(){return u()},children:"Cancel"}),O&&Object(te.jsx)(ve.a,{disabled:n,onClick:function(){return o()},children:"Rewind"}),Object(te.jsx)(ve.a,{disabled:n,onClick:function(){return i(W,N,Rt,p,q,null!==Q&&void 0!==Q?Q:"",null!==ue&&void 0!==ue?ue:"",De,ae,"gui")},children:"Open in Anki"}),Object(te.jsx)(ve.a,{disabled:n,onClick:function(){return i(W,N,Rt,p,q,null!==Q&&void 0!==Q?Q:"",null!==ue&&void 0!==ue?ue:"",De,ae,"updateLast")},children:"Update Last Card"}),Object(te.jsx)(ve.a,{disabled:n,onClick:function(){return i(W,N,Rt,p,q,null!==Q&&void 0!==Q?Q:"",null!==ue&&void 0!==ue?ue:"",De,ae,"default")},children:"Export"})]})]})}var Qe=n(364),$e=n(196),et=n.p+"static/media/background-colored.cbc50e45.png",tt=Object(se.a)((function(e){return{root:function(e){var t=e.dragging;return{position:"absolute",height:e.appBarHidden?"100%":"calc(100% - 64px)",width:"100%",zIndex:101,pointerEvents:t?"auto":"none"}},transparentBackground:function(e){return{"&::before":{content:"' '",position:"absolute",height:e.appBarHidden?"100vh":"calc(100vh - 64px)",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",backgroundSize:"300px 300px",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundImage:"url(".concat(et,")"),backgroundBlendMode:"overlay",background:"rgba(0, 0, 0, .3)",filter:"drop-shadow(10px 10px 10px rgb(0, 0, 0, .4))"},width:"100%",height:"100%"}}}}));function nt(e){var t=e.dragging,n=e.appBarHidden,a=e.loading,r=tt({dragging:t,appBarHidden:n});return Object(te.jsx)("div",{className:r.root,children:Object(te.jsx)($e.a,{in:t||a,children:Object(te.jsx)("div",{className:r.transparentBackground})})})}var at=n(365),rt=n(109),it=n(110),ot=n(161),ct=n(162),st=RegExp("</?([^>]*)>","ig"),ut=RegExp(/\\[nN]/,"ig"),lt=document.createElement("div"),dt=document.createElement("canvas"),bt=function(){function e(){Object(k.a)(this,e),this.xmlParser=void 0}return Object(y.a)(e,[{key:"subtitles",value:function(){var e=Object(c.a)(d.a.mark((function e(t){var n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e,t){return n._subtitles(e,t)})));case 2:return e.abrupt("return",e.sent.flatMap((function(e){return e})).sort((function(e,t){return e.start-t.start})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_subtitles",value:function(){var e=Object(c.a)(d.a.mark((function e(t,n){var a,i,o,s,u,l,b,f,h,v,p,g=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.name.endsWith(".srt")){e.next=7;break}return e.t0=rt.a,e.next=4,t.text();case 4:return e.t1=e.sent,a=(0,e.t0)(e.t1),e.abrupt("return",a.filter((function(e){return"cue"===e.type})).map((function(e){var t=e.data;return{start:t.start,end:t.end,text:t.text.replace(st,""),track:n}})));case 7:if(!t.name.endsWith(".vtt")&&!t.name.endsWith(".nfvtt")){e.next=9;break}return e.abrupt("return",new Promise(function(){var e=Object(c.a)(d.a.mark((function e(a,i){var o,c,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.name.endsWith(".nfvtt"),c=new it.WebVTT.Parser(window,it.WebVTT.StringDecoder()),s=[],c.oncue=function(e){if(o){e.text=e.text.replace(st,"");var t,n=e.text.split("\n"),a=[],i=Object(r.a)(n);try{for(i.s();!(t=i.n()).done;){var c=t.value;a.push(g._fixRTL(c))}}catch(u){i.e(u)}finally{i.f()}e.text=a.join("\n")}s.push(e)},c.onflush=function(){return a(s.map((function(e){return{start:Math.floor(1e3*e.startTime),end:Math.floor(1e3*e.endTime),text:e.text,track:n}})))},e.t0=c,e.next=8,t.text();case 8:e.t1=e.sent,e.t0.parse.call(e.t0,e.t1),c.flush();case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 9:if(!t.name.endsWith(".ass")){e.next=17;break}return e.t2=at.a,e.next=13,t.text();case 13:return e.t3=e.sent,e.t4={},i=(0,e.t2)(e.t3,e.t4),e.abrupt("return",i.dialogues.map((function(e){return{start:Math.round(1e3*e.start),end:Math.round(1e3*e.end),text:e.slices.flatMap((function(e){return e.fragments.map((function(e){return e.text}))})).join("").replace(ut,"\n"),track:n}})));case 17:if(!t.name.endsWith(".ytxml")){e.next=37;break}return e.next=20,t.text();case 20:if(o=e.sent,s=this._xmlParser().parse(o),0!==Object.keys(s).length){e.next=24;break}return e.abrupt("return",[]);case 24:u=s.transcript.text,l=[],b=0,f=u.length;case 27:if(!(b<f)){e.next=36;break}if("#text"in(h=u[b])&&"@_dur"in h&&"@_start"in h){e.next=31;break}return e.abrupt("continue",33);case 31:v=parseFloat(h["@_start"]),l.push({start:Math.floor(1e3*v),end:Math.floor(1e3*(v+parseFloat(h["@_dur"]))),text:this._decodeHTML(String(h["#text"]).replace(st,"")),track:n});case 33:b++,e.next=27;break;case 36:return e.abrupt("return",l);case 37:if(!t.name.endsWith(".sup")){e.next=42;break}return p=[],e.next=41,t.stream().pipeThrough(Object(ct.parseDisplaySets)()).pipeTo(this._displaySetsToSubtitles(p,n));case 41:return e.abrupt("return",p);case 42:throw new Error("Unsupported subtitle file format");case 43:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_displaySetsToSubtitles",value:function(e,t){var n,a;return new WritableStream({write:function(r,i){if(r.objectDefinitionSegments.length>0)void 0===a&&(a=r);else if(void 0!==a){var o,c=a.presentationCompositionSegment.width,s=a.presentationCompositionSegment.height;n=void 0===n||n.length<s*c*4?new Uint8ClampedArray(c*s*4):n;var u=a.imageData(n);dt.width=u.width,dt.height=u.height,dt.getContext("2d").putImageData(u,0,0),e.push({start:null!==(o=a.objectDefinitionSegments[0].header.presentationTimestamp/90)&&void 0!==o?o:0,end:r.endDefinitionSegment.header.presentationTimestamp/90,text:"",textImage:{dataUrl:dt.toDataURL("image/png"),image:{width:u.width,height:u.height},screen:{width:a.presentationCompositionSegment.width,height:a.presentationCompositionSegment.height}},track:t}),a=void 0}}})}},{key:"_fixRTL",value:function(e){var t=e.indexOf("&lrm;"),n=e.indexOf("&rlm;"),a="";return t>-1?(a=e.substring(0,t)+"\u202a"+e.substring(t+5)+"\u202c",this._fixRTL(a)):n>-1?(a=e.substring(0,n)+"\u202b"+e.substring(n+5)+"\u202c",this._fixRTL(a)):e}},{key:"_decodeHTML",value:function(e){return lt.innerHTML=e,0===lt.childNodes.length?"":lt.childNodes[0].nodeValue}},{key:"_xmlParser",value:function(){return void 0===this.xmlParser&&(this.xmlParser=new ot.XMLParser({ignoreAttributes:!1})),this.xmlParser}},{key:"subtitlesToSrt",value:function(e){var t=e.map((function(e){return{type:"cue",data:{start:e.start,end:e.end,text:e.text}}}));return Object(rt.b)(t,{format:"SRT"})}},{key:"filesToSrt",value:function(){var e=Object(c.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this.subtitles(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.subtitlesToSrt.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ft=n(347),ht=n(165),vt=n.n(ht),pt=n(164),gt=n.n(pt),jt=n(166),Ot=n.n(jt),mt=n(163),kt=n.n(mt),yt=n(167),xt=n.n(yt),St=n(337),Ct=n(288),wt=n(335),Tt=["show"],Ft=Object(p.a)((function(e){return{title:{flexGrow:1},leftButton:{marginRight:e.spacing(1)},appBar:{transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{width:function(e){var t=e.drawerWidth;return"calc(100% - ".concat(t,"px)")},transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:function(e){return e.drawerWidth}},copyHistoryButton:{transform:"scaleX(1)",width:48,padding:12,transition:e.transitions.create(["transform","padding","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},copyHistoryButtonShift:{transform:"scaleX(0)",width:0,padding:5,transition:e.transitions.create(["transform","padding","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},hide:{display:"none"}}})),Pt=Object(p.a)((function(e){return{tooltip:function(e){return{display:e.show?"block":"none"}}}}));function Et(e){var t=e.show,n=Object(re.a)(e,Tt),a=Pt({show:t});return Object(te.jsx)(Ne.a,Object(o.a)({classes:a},n))}function Mt(e){var t,n=e.drawerWidth,a=e.drawerOpen,r=e.hidden,i=e.title,o=e.subtitleFiles,c=e.onOpenSettings,l=e.onOpenCopyHistory,d=e.onFileSelector,f=e.onDownloadSubtitleFilesAsSrt,h=Ft({drawerWidth:n}),v=Object(b.useState)(!1),p=Object(s.a)(v,2),g=p[0],j=p[1],O=Object(b.useState)(),m=Object(s.a)(O,2),k=m[0],y=m[1],x=void 0!==o&&void 0!==o.find((function(e){return!e.name.endsWith(".sup")})),S=Object(b.useCallback)((function(e){x?(y(e.currentTarget),j(!0)):d()}),[d,x]),C=Object(b.useCallback)((function(){j(!1)}),[]),w=Object(b.useCallback)((function(){j(!1),d()}),[d]),T=Object(b.useCallback)((function(){j(!1),f()}),[f]);return Object(te.jsxs)(te.Fragment,{children:[x&&Object(te.jsx)(wt.a,{open:g,anchorEl:k,onClose:C,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:Object(te.jsxs)(St.a,{children:[Object(te.jsx)(Ct.a,{button:!0,onClick:w,children:"Open Files"}),Object(te.jsx)(Ct.a,{button:!0,onClick:T,children:"Download Subtitles as SRT"})]})}),Object(te.jsx)(ft.a,{position:"static",elevation:0,className:Object(Q.a)(h.appBar,(t={},Object(u.a)(t,h.appBarShift,a),Object(u.a)(t,h.hide,r),t)),children:Object(te.jsxs)(Ae.a,{children:[Object(te.jsx)(Ne.a,{disableFocusListener:x,disableHoverListener:x,disableTouchListener:x,title:"Open Files",children:Object(te.jsx)(Ce.a,{edge:"start",color:"inherit",className:h.leftButton,onClick:S,children:Object(te.jsx)(kt.a,{})})}),Object(te.jsx)(_e.a,{variant:"h6",className:h.title,children:i}),Object(te.jsx)(Ne.a,{title:"Donate",children:Object(te.jsx)(Ce.a,{edge:"end",color:"inherit",component:"a",href:"https://github.com/killergerbah/asbplayer#supporters",target:"_blank",rel:"noreferrer",children:Object(te.jsx)(gt.a,{})})}),Object(te.jsx)(Ne.a,{title:"Submit Issue",children:Object(te.jsx)(Ce.a,{edge:"end",color:"inherit",component:"a",href:"https://github.com/killergerbah/asbplayer/issues",target:"_blank",rel:"noreferrer",children:Object(te.jsx)(vt.a,{})})}),Object(te.jsx)(Ne.a,{title:"Help",children:Object(te.jsx)(Ce.a,{edge:"end",color:"inherit",component:"a",href:"https://github.com/killergerbah/asbplayer#usage",target:"_blank",rel:"noreferrer",children:Object(te.jsx)(Ot.a,{})})}),Object(te.jsx)(Ne.a,{title:"Settings",children:Object(te.jsx)(Ce.a,{edge:"end",color:"inherit",onClick:c,children:Object(te.jsx)(Re.a,{})})}),Object(te.jsx)(Et,{title:"Mining History",show:!a,children:Object(te.jsx)(Ce.a,{edge:"end",color:"inherit","aria-label":"menu",className:Object(Q.a)(h.copyHistoryButton,Object(u.a)({},h.copyHistoryButtonShift,a)),onClick:l,children:Object(te.jsx)(xt.a,{})})})]})})]})}function It(e){var t=e.subtitleColor,n=e.subtitleSize,a=e.subtitleOutlineThickness,r=e.subtitleOutlineColor,i=e.subtitleBackgroundOpacity,o=e.subtitleBackgroundColor,c=e.subtitleFontFamily,s={color:t,fontSize:Number(n)};if(a>0){var u=a,l=r;s.textShadow="0 0 ".concat(u,"px ").concat(l,", 0 0 ").concat(u,"px ").concat(l,", 0 0 ").concat(u,"px ").concat(l,", 0 0 ").concat(u,"px ").concat(l)}if(i>0){var d=i,b=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}}(o),f=b.r,h=b.g,v=b.b;s.backgroundColor="rgba(".concat(f,", ").concat(h,", ").concat(v,", ").concat(d,")")}return c&&c.length>0&&(s.fontFamily=c),s}function Rt(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e<0)return Rt(0,t);var a=(e=Math.round(e))%1e3,r=(e=(e-a)/1e3)%60,i=(e=(e-r)/60)%60;if(t>=36e5){var o=(e-i)/60;return n?Bt(o)+":"+Bt(i)+":"+Bt(r)+"."+Bt(a,3):Bt(o)+":"+Bt(i)+":"+Bt(r)}return n?Bt(i)+":"+Bt(r)+"."+Bt(a,3):Bt(i)+":"+Bt(r)}function Bt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(e).padStart(t,"0")}var At=n(349),Nt=n(351),_t=n(370),Dt=n(171),Lt=n.n(Dt),Wt=n(350),Ut=n(348),Ht=n(170),zt=n.n(Ht),qt=n(169),Vt=n.n(qt),Kt=n(168),Gt=n.n(Kt),Xt=Object(p.a)((function(e){return{drawer:{width:function(e){return e.drawerWidth},flexShrink:0},drawerPaper:{width:function(e){return e.drawerWidth}},drawerHeader:Object(o.a)(Object(o.a)({display:"flex",alignItems:"center",position:"static",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-start"}),listContainer:{position:"relative",height:"100%",overflowY:"auto",overflowX:"hidden"},listItem:{"&:hover":{backgroundColor:e.palette.action.hover}},listItemGutters:{paddingLeft:5,paddingRight:5},listItemIconRoot:{minWidth:20},emptyState:{display:"flex",justifyContent:"center",flexDirection:"column",textAlign:"center",height:"100%",padding:15},text:{flexGrow:1},emptyText:{flexGrow:1,color:e.palette.text.secondary},timestamp:{paddingRight:15,paddingLeft:15,color:e.palette.text.secondary}}}));function Jt(e){var t=e.open,n=e.anchorEl,a=e.onClose,r=e.onSelect,i=e.onClipAudio,o=e.onDownloadImage,c=e.onDelete,s=e.item,u=Object(b.useCallback)((function(){navigator.clipboard.writeText(s.text),a()}),[s,a]),l=Object(b.useCallback)((function(){r(s),a()}),[s,r,a]),d=Object(b.useCallback)((function(){i(s),a()}),[s,i,a]),f=Object(b.useCallback)((function(){o(s),a()}),[s,o,a]),h=Object(b.useCallback)((function(){c(s),a()}),[s,c,a]);return s?Object(te.jsx)(wt.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:a,anchorOrigin:{vertical:"center",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"right"},children:Object(te.jsxs)(St.a,{children:[Object(te.jsx)(Ct.a,{button:!0,onClick:u,children:Object(te.jsx)(Ut.a,{primaryTypographyProps:{variant:"body2"},primary:"Copy"})}),Object(te.jsx)(Ct.a,{button:!0,onClick:l,children:Object(te.jsx)(Ut.a,{primaryTypographyProps:{variant:"body2"},primary:"Jump To"})}),(s.videoFile||s.audioFile||s.audio)&&Object(te.jsx)(Ct.a,{button:!0,onClick:d,children:Object(te.jsx)(Ut.a,{primaryTypographyProps:{variant:"body2"},primary:"Download Audio"})}),(s.videoFile||s.image)&&Object(te.jsx)(Ct.a,{button:!0,onClick:f,children:Object(te.jsx)(Ut.a,{primaryTypographyProps:{variant:"body2"},primary:"Download Image"})}),Object(te.jsx)(Ct.a,{button:!0,onClick:h,children:Object(te.jsx)(Ut.a,{primaryTypographyProps:{variant:"body2"},primary:"Delete"})})]})}):null}function Yt(e){var t,n=e.onDelete,a=Xt(e),i=Object(b.useCallback)((function(e){e&&e.scrollIntoView()}),[]),o=Object(b.useState)(),c=Object(s.a)(o,2),u=c[0],l=c[1],d=Object(b.useState)(!1),h=Object(s.a)(d,2),v=h[0],p=h[1],g=Object(b.useState)(),j=Object(s.a)(g,2),O=j[0],m=j[1],k=Object(b.useCallback)((function(e,t){l(t),p(!0),m(e.currentTarget)}),[]),y=Object(b.useCallback)((function(){l(void 0),p(!1),m(void 0)}),[]),x=Object(b.useCallback)((function(e){n(e)}),[n]);return e.items.length>0?function(){var n,o,c=[],s=null,u=0,l={},d={},b=Object(r.a)(e.items);try{var f=function(){var t=o.value;if(null===s||s!==t.name){t.name in l?l[t.name]++:l[t.name]=0;var r=t.name+"-"+l[t.name];d[r]=[],s=t.name,n=r,c.push(Object(te.jsxs)(Ct.a,{children:[Object(te.jsx)(_e.a,{color:"textSecondary",children:t.name}),Object(te.jsx)(At.a,{children:Object(te.jsx)(Ne.a,{title:"Download as SRT",children:Object(te.jsx)(Ce.a,{onClick:function(){return e.onDownloadSectionAsSrt(t.name,d[r])},edge:"end",children:Object(te.jsx)(Gt.a,{})})})})]},r))}d[n].push(t);var b=u===e.items.length-1?i:null;c.push(Object(te.jsxs)(Ct.a,{ref:b,className:a.listItem,classes:{gutters:a.listItemGutters},children:[Object(te.jsx)(Wt.a,{classes:{root:a.listItemIconRoot},children:Object(te.jsx)(Ne.a,{title:"Export to Anki",children:Object(te.jsx)(Ce.a,{onClick:function(){return e.onAnki(t)},children:Object(te.jsx)(Vt.a,{fontSize:"small"})})})}),Object(te.jsx)(Wt.a,{classes:{root:a.listItemIconRoot},children:Object(te.jsx)(Ce.a,{onClick:function(e){return k(e,t)},children:Object(te.jsx)(zt.a,{fontSize:"small"})})}),Object(te.jsx)(Ut.a,{primary:Object(te.jsxs)(Se.a,{wrap:"nowrap",container:!0,children:[Object(te.jsx)(Se.a,{item:!0,className:""===t.text?a.emptyText:a.text,children:""===t.text?"No text":t.text}),Object(te.jsx)(Se.a,{item:!0,className:a.timestamp,children:Rt(t.start,t.start,!1)})]})})]},t.id)),++u};for(b.s();!(o=b.n()).done;)f()}catch(h){b.e(h)}finally{b.f()}t=Object(te.jsx)("div",{className:a.listContainer,children:Object(te.jsx)(St.a,{children:c})})}():t=Object(te.jsxs)("div",{className:a.emptyState,children:[Object(te.jsx)(_e.a,{variant:"h6",children:"Mining history is empty."}),Object(te.jsx)(_e.a,{variant:"caption",children:"See the help for keyboard shortcuts."})]}),Object(te.jsxs)(f.a.Fragment,{children:[Object(te.jsxs)(_t.a,{variant:"persistent",anchor:"right",open:e.open,className:a.drawer,classes:{paper:a.drawerPaper},children:[Object(te.jsx)("div",{className:a.drawerHeader,children:Object(te.jsx)(Ce.a,{onClick:e.onClose,children:Object(te.jsx)(Lt.a,{})})}),Object(te.jsx)(Nt.a,{}),t]}),Object(te.jsx)(Jt,{open:e.open&&v,anchorEl:O,item:u,onClose:y,onSelect:e.onSelect,onClipAudio:e.onClipAudio,onDownloadImage:e.onDownloadImage,onDelete:x})]})}var Zt=n(172),Qt=n.n(Zt),$t=n(352),en=Object(se.a)((function(e){return{background:function(e){return{position:"absolute",height:e.appBarHidden?"100vh":"calc(100vh - 64px)",width:"100%",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center"}},browseLink:{cursor:"pointer"}}}));function tn(e){var t=e.extension,n=e.latestExtensionVersion,a=e.extensionUrl,r=e.loading,i=e.dragging,o=e.appBarHidden,u=e.onFileSelector,l=en({appBarHidden:o}),h=Object(b.useState)(),v=Object(s.a)(h,2),p=v[0],g=v[1];Object(b.useEffect)((function(){function e(){return(e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g(t.version);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t]);var j=p&&Qt()(n,p),O=!p;return Object(te.jsx)(f.a.Fragment,{children:Object(te.jsx)($e.a,{in:!r&&!i,timeout:500,children:Object(te.jsx)("div",{className:l.background,children:Object(te.jsxs)(_e.a,{variant:"h6",children:["Drag and drop subtitle and media files, or"," ",Object(te.jsx)($t.a,{target:"#",className:l.browseLink,onClick:u,color:"secondary",component:"label",children:"browse"}),".",Object(te.jsx)("br",{}),O&&Object(te.jsxs)("span",{children:["Install the"," ",Object(te.jsx)($t.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:a,children:"Chrome extension"})," ","to sync subtitles with streaming video."]}),j&&Object(te.jsxs)("span",{children:["An extension"," ",Object(te.jsx)($t.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:a,children:"update"})," ","is available."]})]})})})})}var nn=function(){function e(t){Object(k.a)(this,e),this.channel=void 0,this.onMessage=void 0,this.channel=new BroadcastChannel(t);var n=this;this.channel.onmessage=function(e){var t;null===(t=n.onMessage)||void 0===t||t.call(n,e)}}return Object(y.a)(e,[{key:"postMessage",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage(e)}},{key:"close",value:function(){var e;null===(e=this.channel)||void 0===e||e.close(),this.channel=void 0}}]),e}(),an=function(){function e(t,n,a){var r=this;Object(k.a)(this,e),this.tabId=void 0,this.src=void 0,this.extension=void 0,this.listener=void 0,this.unsubscribeFromExtension=void 0,this.onMessage=void 0,this.tabId=t,this.src=n,this.listener=function(e){var a;e.tabId===t&&e.src===n&&(null===(a=r.onMessage)||void 0===a||a.call(r,{data:e.data}))},this.unsubscribeFromExtension=a.subscribe(this.listener),this.extension=a}return Object(y.a)(e,[{key:"postMessage",value:function(e){this.extension.sendMessage(e,this.tabId,this.src)}},{key:"close",value:function(){this.unsubscribeFromExtension()}}]),e}(),rn=function(){function e(){Object(k.a)(this,e),this.accumulated=void 0,this.started=void 0,this.startTime=void 0,this.accumulated=0,this.started=!1}return Object(y.a)(e,[{key:"time",value:function(e){return this.started?Math.min(e,this.accumulated+Date.now()-this.startTime):Math.min(e,this.accumulated)}},{key:"stop",value:function(){this.started&&(this.started=!1,this.accumulated+=Date.now()-this.startTime)}},{key:"start",value:function(){this.startTime=Date.now(),this.started=!0}},{key:"setTime",value:function(e){this.started?(this.startTime=Date.now(),this.accumulated=e):this.accumulated=e}},{key:"progress",value:function(e){return 0===e?0:Math.min(1,this.time(e)/e)}}]),e}(),on=n(175),cn=n.n(on),sn=n(176),un=n.n(sn),ln=n(182),dn=n.n(ln),bn=n(173),fn=n.n(bn),hn=n(281),vn=n(185),pn=n.n(vn),gn=n(187),jn=n.n(gn),On=n(174),mn=n.n(On),kn=n(186),yn=n.n(kn),xn=n(177),Sn=n.n(xn),Cn=n(178),wn=n.n(Cn),Tn=n(183),Fn=n.n(Tn),Pn=n(184),En=n.n(Pn),Mn=n(181),In=n.n(Mn),Rn=n(111),Bn=n.n(Rn),An=n(179),Nn=n.n(An),_n=n(180),Dn=n.n(_n),Ln=Object(p.a)((function(e){return{container:{position:"absolute",left:"50%",width:"50%",bottom:0,pointerEvents:"none",color:"#fff"},buttonContainer:{flexDirection:"row"},timeDisplay:{color:"#fff",display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",cursor:"default",fontSize:20,marginLeft:10},offsetInput:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",fontSize:20,marginLeft:10,width:100,color:"#fff",pointerEvents:"auto"},volumeInputContainerShown:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:5,pointerEvents:"auto"},volumeInputContainerHidden:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:0,pointerEvents:"auto"},volumeInputHidden:{transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),width:0,pointerEvents:"auto"},volumeInputShown:{transition:e.transitions.create("width",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),width:100,pointerEvents:"auto"},volumeInputThumbHidden:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),opacity:0,pointerEvents:"auto"},volumeInputThumbShown:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),opacity:1,pointerEvents:"auto"},subContainer:{background:"linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, .4) 40%, rgba(0, 0, 0, 0.7))",position:"relative",left:"-100%",width:"200%",zIndex:10},button:{pointerEvents:"auto"},inactiveButton:{color:"rgba(72, 72, 72, 0.7)",pointerEvents:"auto"},inactiveTopButton:{color:"rgba(255, 255, 255, 0.5)",pointerEvents:"auto"},progress:{margin:5},topButton:{pointerEvents:"auto",color:"#fff"},gridContainer:{pointerEvents:"auto",padding:2}}})),Wn=Object(p.a)((function(e){return{root:{height:10},container:{height:10,pointerEvents:"auto",display:"flex",justifyContent:"center",flexDirection:"column",position:"absolute",width:"calc(100% - 20px)",marginLeft:10},mouseEventListener:{zIndex:1,height:10,cursor:"pointer",pointerEvents:"auto",position:"absolute",width:"100%"},fillContainer:{background:"rgba(30,30,30,0.7)",width:"100%",height:5,position:"relative"},fillContainerThick:{transition:e.transitions.create("height",{easing:e.transitions.easing.easeInOut,duration:50}),height:8},fill:{background:"linear-gradient(to left, #ff1f62, #49007a)",height:"100%"},handleContainer:{position:"absolute",display:"flex",justifyContent:"center",flexDirection:"column",height:"100%",bottom:0},handle:{borderRadius:"50%",width:16,height:16,opacity:0,left:-8,background:"white",position:"absolute"},handleOn:{opacity:1,transition:e.transitions.create("opacity",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.shortest})}}})),Un=Object(he.a)((function(e){return{root:{color:"white",verticalAlign:"middle"},thumb:{backgroundColor:"white",color:"white","&:focus":{boxShadow:"inherit"},"&:hover, &$active":{boxShadow:"0px 0px 0px 8px rgba(255, 255, 255, 0.1)"}},active:{color:"white"}}}))(Be.a);function Hn(e){var t=Math.floor(e/1e3),n=Math.floor(t/60),a=t%60;return String(n)+":"+String(a).padStart(2,"0")}function zn(e){var t=e.onSeek,n=e.value,a=Wn(),r=Object(b.useState)(!1),i=Object(s.a)(r,2),o=i[0],c=i[1],u=Object(b.useRef)(null),l=Object(b.useCallback)((function(e){var n=e.currentTarget.getBoundingClientRect(),a=n.right-n.left-20,r=Math.min(1,Math.max(0,(e.pageX-n.left-10)/a));t(r)}),[t]),d=Object(b.useCallback)((function(){return c(!0)}),[]),f=Object(b.useCallback)((function(){return c(!1)}),[]),h=u.current?function(e){var t=e.getBoundingClientRect();return t.right-t.left}(u.current)*n/100:0,v={width:h},p={marginLeft:h},g=o?a.fillContainer+" "+a.fillContainerThick:a.fillContainer,j=o?a.handle+" "+a.handleOn:a.handle;return Object(te.jsxs)("div",{className:a.root,children:[Object(te.jsx)("div",{ref:u,className:a.container,children:Object(te.jsxs)("div",{className:g,children:[Object(te.jsx)("div",{className:a.fill,style:v}),Object(te.jsx)("div",{className:a.handleContainer,children:Object(te.jsx)("div",{className:j,style:p})})]})}),Object(te.jsx)("div",{className:a.mouseEventListener,onClick:l,onMouseOver:d,onMouseOut:f})]})}function qn(e){var t=e.open,n=e.anchorEl,a=e.audioTracks,r=e.selectedAudioTrack,i=e.onAudioTrackSelected,o=e.onClose;if(!a||0===a.length)return null;var c=a.map((function(e){return Object(te.jsxs)(Ct.a,{selected:e.id===r,button:!0,onClick:function(){return i(e.id)},children:[e.language," ",e.label]},e.id)}));return Object(te.jsx)("div",{children:Object(te.jsx)(wt.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:o,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(te.jsx)(St.a,{children:c})})})}function Vn(e){var t=e.open,n=e.anchorEl,a=e.onClose,r=e.tabs,i=e.selectedTab,o=e.onTabSelected;if(!r||0===r.length)return null;var c=r.map((function(e){return Object(te.jsxs)(Ct.a,{selected:i&&e.id===i.id&&e.src===i.src,button:!0,onClick:function(){return o(e)},children:[e.id," ",e.title," ",e.src]},e.id)}));return Object(te.jsx)("div",{children:Object(te.jsx)(wt.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:a,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(te.jsx)(St.a,{children:c})})})}function Kn(e){var t=e.open,n=e.anchorEl,a=e.onUnload,r=e.onClose,i=e.file;return Object(te.jsx)("div",{children:Object(te.jsx)(wt.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:r,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(te.jsx)(St.a,{children:Object(te.jsxs)(Ct.a,{button:!0,onClick:function(e){return a()},children:["Unload ",i]})})})})}function Gn(e){var t=e.open,n=e.anchorEl,a=e.selectedPlayMode,r=e.onPlayMode,i=e.onClose;return Object(te.jsx)("div",{children:Object(te.jsx)(wt.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:i,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(te.jsxs)(St.a,{children:[Object(te.jsx)(Ct.a,{selected:a===N.normal,button:!0,onClick:function(e){return r(N.normal)},children:"Normal"}),Object(te.jsx)(Ct.a,{selected:a===N.condensed,button:!0,onClick:function(e){return r(N.condensed)},children:"Condensed"}),Object(te.jsx)(Ct.a,{selected:a===N.autoPause,button:!0,onClick:function(e){return r(N.autoPause)},children:"Auto-pause"})]})})})}function Xn(e){var t=e.clock,n=e.playing,a=e.length,r=e.offsetEnabled,i=e.displayLength,o=e.offset,c=e.onAudioTrackSelected,u=e.onSeek,l=e.mousePositionRef,d=e.onShow,h=e.onPause,v=e.onPlay,p=e.onTabSelected,g=e.onUnloadAudio,j=e.onUnloadVideo,O=e.onOffsetChange,m=e.onVolumeChange,k=e.disableKeyEvents,y=e.playbackPreferences,x=e.closeEnabled,S=e.onClose,C=e.volumeEnabled,w=e.playMode,T=e.playModeEnabled,F=e.onPlayMode,P=e.subtitlesEnabled,E=e.subtitlesToggle,M=e.onSubtitlesToggle,I=e.videoFile,R=e.audioFile,B=e.audioTracks,A=e.selectedAudioTrack,N=e.tabs,_=e.selectedTab,D=e.popOutEnabled,L=e.popOut,W=e.onPopOutToggle,U=e.fullscreenEnabled,H=e.fullscreen,z=e.onFullscreenToggle,q=e.hideSubtitlePlayerToggleEnabled,V=e.subtitlePlayerHidden,K=e.onHideSubtitlePlayerToggle,G=e.showOnMouseMovement,X=e.theaterModeToggleEnabled,J=e.theaterModeEnabled,Y=e.onTheaterModeToggle,Z=Ln(),Q=Object(b.useState)(!0),$=Object(s.a)(Q,2),ee=$[0],ne=$[1],ae=Object(b.useState)(!1),re=Object(s.a)(ae,2),ie=re[0],oe=re[1],ce=Object(b.useState)(),se=Object(s.a)(ce,2),ue=se[0],le=se[1],de=Object(b.useState)(!1),be=Object(s.a)(de,2),fe=be[0],he=be[1],ve=Object(b.useState)(),pe=Object(s.a)(ve,2),ge=pe[0],je=pe[1],Oe=Object(b.useState)(!1),me=Object(s.a)(Oe,2),ke=me[0],ye=me[1],xe=Object(b.useState)(),we=Object(s.a)(xe,2),Te=we[0],Fe=we[1],Pe=Object(b.useState)(!1),Ee=Object(s.a)(Pe,2),Me=Ee[0],Ie=Ee[1],Re=Object(b.useState)(),Be=Object(s.a)(Re,2),Ae=Be[0],Ne=Be[1],_e=Object(b.useState)(!1),De=Object(s.a)(_e,2),Le=De[0],We=De[1],Ue=Object(b.useState)(),He=Object(s.a)(Ue,2),ze=He[0],qe=He[1],Ve=Object(b.useState)(!1),Ke=Object(s.a)(Ve,2),Ge=Ke[0],Xe=Ke[1],Je=Object(b.useState)(100),Ye=Object(s.a)(Je,2),Ze=Ye[0],Qe=Ye[1],et=Object(b.useState)(100),tt=Object(s.a)(et,2),nt=tt[0],at=tt[1],rt=Object(b.useRef)({x:0,y:0}),it=Object(b.useRef)(Date.now()),ot=Object(b.useRef)(Date.now()),ct=Object(b.useRef)(!0),st=Object(b.useRef)(!1),ut=Object(b.useRef)(),lt=Object(b.useRef)(null),dt=Object(b.useRef)(null),bt=Object(b.useState)(),ft=Object(s.a)(bt,2)[1],ht=Object(b.useCallback)((function(){return ft({})}),[]),vt=Object(b.useCallback)((function(e){u(e)}),[u]);function pt(){st.current=!0}function gt(){st.current=!1}Object(b.useEffect)((function(){var e=Number(y.volume);Qe(e),m(e/100),e>0&&at(e)}),[y,m]),Object(b.useEffect)((function(){var e=setInterval((function(){var e,t;G?e=Date.now()-it.current<2e3||Math.pow(l.current.x-rt.current.x,2)+Math.pow(l.current.y-rt.current.y,2)>100:e=null!==(t=lt.current&&l.current.y>lt.current.offsetTop-20||dt.current&&l.current.y<dt.current.offsetHeight+20)&&void 0!==t&&t;(e=e||st.current||ut.current===document.activeElement||Date.now()-ot.current<2e3)&&!ct.current?(it.current=Date.now(),ne(e)):!e&&ct.current&&ne(e),ct.current=e,rt.current.x=l.current.x,rt.current.y=l.current.y}),100);return function(){return clearInterval(e)}}),[l,G]),Object(b.useEffect)((function(){return null===d||void 0===d?void 0:d(ee)}),[d,ee]),Object(b.useEffect)((function(){if(!k)return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)};function e(e){if("Enter"===e.key&&ut.current===document.activeElement){var t=Number(ut.current.value);if(Number.isNaN(t))return;O(1e3*t),ut.current.blur()}}}),[O,k]);var jt=Object(b.useCallback)((function(e){var t,n=e.target;n.setSelectionRange(0,(null===(t=n.value)||void 0===t?void 0:t.length)||0)}),[]);Object(b.useEffect)((function(){var e=setInterval((function(){ht()}),100);return function(){return clearInterval(e)}}),[ht]),Object(b.useEffect)((function(){if(ut.current)if(0===o)ut.current.value="";else{var e=o/1e3,t=e>=0?"+"+e.toFixed(2):String(e.toFixed(2));ut.current.value=t,ot.current=Date.now()}}),[o]);var Ot=Object(b.useCallback)((function(){le(void 0),oe(!1)}),[]),mt=Object(b.useCallback)((function(e){le(e.currentTarget),oe(!0)}),[]),kt=Object(b.useCallback)((function(e){c(e),le(void 0),oe(!1)}),[c]),yt=Object(b.useCallback)((function(){je(void 0),he(!1)}),[]),xt=Object(b.useCallback)((function(e){je(e.currentTarget),he(!0)}),[]),St=Object(b.useCallback)((function(e){null===p||void 0===p||p(e),je(void 0),he(!1)}),[p]),Ct=Object(b.useCallback)((function(){Fe(void 0),ye(!1)}),[]),wt=Object(b.useCallback)((function(e){Fe(e.currentTarget),ye(!0)}),[]),Tt=Object(b.useCallback)((function(){null===g||void 0===g||g(),ye(!1)}),[g]),Ft=Object(b.useCallback)((function(){Ne(void 0),Ie(!1)}),[]),Pt=Object(b.useCallback)((function(e){Ne(e.currentTarget),Ie(!0)}),[]),Et=Object(b.useCallback)((function(){null===j||void 0===j||j(),Ie(!1)}),[j]),Mt=Object(b.useCallback)((function(){qe(void 0),We(!1)}),[]),It=Object(b.useCallback)((function(e){qe(e.currentTarget),We(!0)}),[]),Rt=Object(b.useCallback)((function(e){null===F||void 0===F||F(e),qe(void 0),We(!1)}),[F]),Bt=Object(b.useCallback)((function(){return Xe(!1)}),[]),At=Object(b.useCallback)((function(){return Xe(!0)}),[]),Nt=Object(b.useCallback)((function(e,t){"number"===typeof t&&(Qe(t),m(t/100))}),[m]),_t=Object(b.useCallback)((function(e,t){"number"===typeof t&&(t>0&&at(t),y.volume=t)}),[y]),Dt=Object(b.useCallback)((function(){Qe((function(e){var t=e>0?0:nt;return m(t/100),t}))}),[m,nt]),Lt=t.progress(a);return Object(te.jsxs)(f.a.Fragment,{children:[Object(te.jsx)($e.a,{in:ee,timeout:200,children:Object(te.jsxs)(Se.a,{container:!0,style:{position:"absolute",top:0},children:[Object(te.jsx)(Se.a,{item:!0,style:{flexGrow:1},children:x&&Object(te.jsx)(Ce.a,{ref:dt,color:"inherit",className:Z.topButton,onClick:S,onMouseOver:pt,onMouseOut:gt,children:Object(te.jsx)(fn.a,{})})}),Object(te.jsxs)(Se.a,{item:!0,children:[X&&Object(te.jsx)(Ce.a,{color:"inherit",className:J?Z.topButton:Z.inactiveTopButton,onClick:Y,onMouseOver:pt,onMouseOut:gt,children:Object(te.jsx)(mn.a,{})}),q&&Object(te.jsx)(Ce.a,{color:"inherit",className:Z.topButton,onClick:K,onMouseOver:pt,onMouseOut:gt,children:V?Object(te.jsx)(cn.a,{}):Object(te.jsx)(un.a,{})})]})]})}),Object(te.jsxs)("div",{ref:lt,className:Z.container,onMouseOver:pt,onMouseOut:gt,children:[Object(te.jsx)($e.a,{in:ee,timeout:200,children:Object(te.jsxs)("div",{className:Z.subContainer,children:[Object(te.jsx)(zn,{onSeek:vt,value:100*Lt}),Object(te.jsxs)(Se.a,{container:!0,className:Z.gridContainer,direction:"row",children:[Object(te.jsx)(Se.a,{item:!0,children:Object(te.jsx)(Ce.a,{color:"inherit",onClick:function(){return n?h():v()},children:n?Object(te.jsx)(Sn.a,{className:Z.button}):Object(te.jsx)(wn.a,{className:Z.button})})}),C&&Object(te.jsxs)(Se.a,{item:!0,onMouseOver:At,onMouseOut:Bt,className:Ge?Z.volumeInputContainerShown:Z.volumeInputContainerHidden,children:[Object(te.jsx)(Ce.a,{color:"inherit",onClick:Dt,children:0===Ze?Object(te.jsx)(Nn.a,{}):Object(te.jsx)(Dn.a,{})}),Object(te.jsx)(Un,{onChange:Nt,onChangeCommitted:_t,value:Ze,defaultValue:100,classes:{root:Ge?Z.volumeInputShown:Z.volumeInputHidden,thumb:Ge?Z.volumeInputThumbShown:Z.volumeInputThumbHidden}})]}),Object(te.jsx)(Se.a,{item:!0,children:Object(te.jsxs)("div",{className:Z.timeDisplay,children:[Hn(Lt*a)," / ",Hn(i||a)]})}),r&&Object(te.jsx)(Se.a,{item:!0,children:Object(te.jsx)(hn.a,{inputRef:ut,disableUnderline:!0,className:Z.offsetInput,placeholder:"\xb1"+Number(0).toFixed(2),onClick:jt})}),Object(te.jsx)(Se.a,{item:!0,style:{flexGrow:1}}),E&&Object(te.jsx)(Se.a,{item:!0,children:Object(te.jsx)(Ce.a,{color:"inherit",onClick:M,children:Object(te.jsx)(In.a,{className:P?Z.button:Z.inactiveButton})})}),I&&Object(te.jsx)(Se.a,{item:!0,children:Object(te.jsx)(Ce.a,{color:"inherit",onClick:Pt,children:Object(te.jsx)(Bn.a,{className:Z.button})})}),R&&Object(te.jsx)(Se.a,{item:!0,children:Object(te.jsx)(Ce.a,{color:"inherit",onClick:wt,children:Object(te.jsx)(dn.a,{className:Z.button})})}),B&&B.length>1&&Object(te.jsx)(Se.a,{item:!0,children:Object(te.jsx)(Ce.a,{color:"inherit",onClick:mt,children:Object(te.jsx)(Fn.a,{className:Z.button})})}),N&&N.length>0&&Object(te.jsx)(Se.a,{item:!0,children:Object(te.jsx)(Ce.a,{color:"inherit",onClick:xt,children:Object(te.jsx)(Bn.a,{className:_?Z.button:Z.inactiveButton})})}),T&&Object(te.jsx)(Se.a,{item:!0,children:Object(te.jsx)(Ce.a,{color:"inherit",onClick:It,children:Object(te.jsx)(En.a,{className:T?Z.button:Z.inactiveButton})})}),D&&Object(te.jsx)(Se.a,{item:!0,children:Object(te.jsx)(Ce.a,{color:"inherit",onClick:W,children:Object(te.jsx)(pn.a,{className:Z.button,style:L?{transform:"rotateX(180deg)"}:{}})})}),U&&Object(te.jsx)(Se.a,{item:!0,children:Object(te.jsx)(Ce.a,{color:"inherit",onClick:z,children:H?Object(te.jsx)(yn.a,{className:Z.button}):Object(te.jsx)(jn.a,{className:Z.button})})})]})]})}),Object(te.jsx)(Vn,{open:fe&&ee,anchorEl:ge,tabs:N,selectedTab:_,onClose:yt,onTabSelected:St}),Object(te.jsx)(qn,{open:ie&&ee,anchorEl:ue,audioTracks:B,selectedAudioTrack:A,onClose:Ot,onAudioTrackSelected:kt}),Object(te.jsx)(Kn,{open:ke,anchorEl:Te,file:R,onClose:Ct,onUnload:Tt}),Object(te.jsx)(Kn,{open:Me,anchorEl:Ae,file:I,onClose:Ft,onUnload:Et}),Object(te.jsx)(Gn,{open:Le&&ee,anchorEl:ze,selectedPlayMode:w,onClose:Mt,onPlayMode:Rt})]})]})}var Jn=function(){function e(t){Object(k.a)(this,e),this.ref=void 0,this.readyResolves=void 0,this.ref=t,this.readyResolves=[]}return Object(y.a)(e,[{key:"seek",value:function(){var e=Object(c.a)(d.a.mark((function e(t){var n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){n.ref.current?(n.ref.current.currentTime=t,n._onMediaCanPlay((function(){return e(void 0)}))):e(void 0)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onReady",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.ref.current?t._onMediaCanPlay((function(){return e(void 0)})):e(void 0)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_onMediaCanPlay",value:function(e){var t,n=this;4!==(null===(t=this.ref.current)||void 0===t?void 0:t.readyState)?(this.ref.current&&!this.ref.current.oncanplay&&(this.ref.current.oncanplay=function(e){var t,a=Object(r.a)(n.readyResolves);try{for(a.s();!(t=a.n()).done;){(0,t.value)()}}catch(i){a.e(i)}finally{a.f()}n.readyResolves.length=0,n.ref.current&&(n.ref.current.oncanplay=null)}),this.readyResolves.push(e)):e()}},{key:"play",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.play()}},{key:"pause",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.pause()}}]),e}(),Yn=n(356),Zn=n(357),Qn=n(354),$n=n(355),ea=n(353),ta=["index","selected","subtitleRef","onClickSubtitle","onCopySubtitle","compressed","disabled","subtitle","copyButtonEnabled"],na=Object(p.a)((function(e){return{container:{height:function(e){return e.appBarHidden?"100vh":"calc(100vh - 64px)"},position:"relative",overflowX:"hidden",backgroundColor:e.palette.background.default,width:function(e){var t=e.compressed,n=e.windowWidth;return t?Math.max(350,.25*n):"100%"}},table:{backgroundColor:e.palette.background.default,marginBottom:75},noSubtitles:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center"}}})),aa=Object(p.a)((function(e){return{subtitleRow:{"&:hover":{backgroundColor:e.palette.action.hover}},subtitle:{fontSize:20,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere",whiteSpace:"pre-wrap"},compressedSubtitle:{fontSize:16,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere",whiteSpace:"pre-wrap"},disabledSubtitle:{color:"transparent",backgroundColor:e.palette.action.disabledBackground,borderRadius:5},timestamp:{fontSize:14,color:"#aaaaaa",textAlign:"right",paddingRight:15,paddingLeft:5},copyButton:{textAlign:"right",padding:0}}})),ra=f.a.memo((function(e){var t=e.index,n=e.selected,a=e.subtitleRef,r=e.onClickSubtitle,i=e.onCopySubtitle,c=e.compressed,u=e.disabled,l=e.subtitle,d=e.copyButtonEnabled,f=Object(re.a)(e,ta),h=aa(),v=Object(b.useRef)(null),p=Object(b.useState)(!1),g=Object(s.a)(p,2),j=g[0],O=g[1],m=c?h.compressedSubtitle:h.subtitle,k=u?h.disabledSubtitle:"";if(l.start<0||l.end<0)return null;var y=l.textImage?Object(te.jsx)(He,{availableWidth:window.screen.availWidth/2,subtitle:l,scale:1}):Object(te.jsx)("span",{ref:v,className:k,children:l.text});return Object(te.jsxs)(ea.a,Object(o.a)(Object(o.a)({onClick:function(){return!j&&r(t)},onMouseUp:function(){var e,t,n,a=document.getSelection(),r="Range"===(null===a||void 0===a?void 0:a.type)&&(null===(e=v.current)||void 0===e?void 0:e.isSameNode(null!==(t=null===(n=a.anchorNode)||void 0===n?void 0:n.parentNode)&&void 0!==t?t:null));O(null!==r&&void 0!==r&&r)},ref:a,className:h.subtitleRow,selected:n},f),{},{children:[Object(te.jsx)(Qn.a,{className:m,children:y}),d&&Object(te.jsx)(Qn.a,{className:h.copyButton,children:Object(te.jsx)(Ce.a,{onClick:function(e){return i(e,t)},children:Object(te.jsx)(ge.a,{fontSize:c?"small":"medium"})})}),Object(te.jsx)(Qn.a,{className:h.timestamp,children:l.displayTime})]}))}));function ia(e){var t=e.clock,n=e.onSeek,a=e.onCopy,o=e.onOffsetChange,c=e.onToggleSubtitleTrack,u=e.onStartedShowing,l=e.onWillStopShowing,d=e.playing,f=e.subtitles,h=e.subtitleCollection,v=e.length,p=e.jumpToSubtitle,g=e.compressed,j=e.copyButtonEnabled,m=e.loading,k=e.drawerOpen,y=e.appBarHidden,x=e.displayHelp,S=e.disableKeyEvents,C=e.lastJumpToTopTimestamp,w=e.hidden,T=e.disabledSubtitleTracks,F=e.settingsProvider,P=e.keyBinder,M=Object(b.useRef)();M.current=d;var I=Object(b.useRef)(t);I.current=t,Object(b.useRef)().current=f;var R=Object(b.useMemo)((function(){return f?Array(f.length).fill(void 0).map((function(e){return Object(b.createRef)()})):[]}),[f]),A=Object(b.useRef)(Y.empty());A.current=null!==h&&void 0!==h?h:Y.empty();var N=Object(b.useRef)([]);N.current=R;var _=Object(b.useRef)();_.current=S;var D=Object(b.useState)({}),L=Object(s.a)(D,2),W=L[0],U=L[1],H=Object(b.useRef)({}),z=Object(b.useRef)(0);z.current=v;var q=Object(b.useRef)(!1);q.current=w;var V=Object(b.useRef)(0),K=Object(b.useRef)(),G=Object(b.useRef)();Object(b.useRef)().current=k;var X=O(!0),J=Object(s.a)(X,1)[0],Z=na({compressed:g,windowWidth:J,appBarHidden:y}),Q=Object(b.useRef)(),$=Object(b.useRef)();$.current=u;var ee=Object(b.useRef)(),ne=Object(b.useRef)();ne.current=l,Object(b.useEffect)((function(){return K.current=requestAnimationFrame((function e(){var t,n,a,i=N.current,o={},c=I.current.time(z.current),s=A.current.subtitlesAt(c),u=0===s.showing.length?null!==(t=s.lastShown)&&void 0!==t?t:[]:s.showing,l=Object(r.a)(u);try{for(l.s();!(a=l.n()).done;){var d=a.value;o[d.index]=!0,(void 0===n||d.index<n)&&(n=d.index)}}catch(p){l.e(p)}finally{l.f()}if(!function(e,t){for(var n in e)if(!(n in t))return!1;for(var a in t)if(!(a in e))return!1;return!0}(o,H.current)&&(H.current=o,U(o),void 0!==n)){var b=i[n],f=!q.current&&Date.now()-V.current>5e3;null!==b&&void 0!==b&&b.current&&f&&b.current.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}if(Q.current!==s.startedShowing){var h;if(void 0!==s.startedShowing)null===(h=$.current)||void 0===h||h.call($);Q.current=s.startedShowing}if(ee.current!==s.willStopShowing){var v;if(void 0!==s.willStopShowing)null===(v=ne.current)||void 0===v||v.call(ne);ee.current=s.willStopShowing}K.current=requestAnimationFrame(e)})),function(){void 0!==K.current&&cancelAnimationFrame(K.current)}}),[]);var ae=Object(b.useCallback)((function(){var e,t=H.current;if(t){var n=Object.keys(t);if(0!==n.length){var a=R[Number(n[0])];null===a||void 0===a||null===(e=a.current)||void 0===e||e.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}}),[R]);Object(b.useEffect)((function(){if(!w)return document.addEventListener("visibilitychange",e),function(){return document.removeEventListener("visibilitychange",e)};function e(){"visible"===document.visibilityState&&ae()}}),[w,W,R,ae]),Object(b.useEffect)((function(){w||ae()}),[w,ae]),Object(b.useEffect)((function(){var e;if(!q.current){var t=N.current;if(t&&0!==t.length){var n=t[0];null===n||void 0===n||null===(e=n.current)||void 0===e||e.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}}),[C]),Object(b.useEffect)((function(){var e=P.bindAdjustOffset((function(e,t){e.preventDefault(),e.stopPropagation(),o(t)}),(function(){return S}),(function(){return f}));return function(){return e()}}),[P,o,S,f]),Object(b.useEffect)((function(){var e=P.bindOffsetToSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),o(t)}),(function(){return S}),(function(){return t.time(v)}),(function(){return f}));return function(){return e()}}),[P,o,S,t,f,v]),Object(b.useEffect)((function(){var e=P.bindSeekToSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),n(t.start,!1)}),(function(){return S}),(function(){return t.time(v)}),(function(){return f}));return function(){return e()}}),[P,n,f,S,t,v]),Object(b.useEffect)((function(){var e=P.bindSeekToBeginningOfCurrentSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),n(t.start,!1)}),(function(){return S}),(function(){return t.time(v)}),(function(){return f}));return function(){return e()}}),[P,n,f,S,t,v]),Object(b.useEffect)((function(){var e=P.bindSeekBackwardOrForward((function(e,a){e.stopPropagation(),e.preventDefault(),n(a?Math.min(v,t.time(v)+1e4):Math.max(0,t.time(v)-1e4),!1)}),(function(){return S}));return function(){return e()}}),[P,t,v,S,n]),Object(b.useEffect)((function(){function e(){V.current=Date.now()}var t=G.current;return null===t||void 0===t||t.addEventListener("wheel",e),function(){return null===t||void 0===t?void 0:t.removeEventListener("wheel",e)}}),[G,V]),Object(b.useEffect)((function(){if(!w&&p&&f){var e,t,n,a=-1,i=0,o=Object(r.a)(f);try{for(o.s();!(e=o.n()).done;){var c=e.value;if(c.originalStart===p.originalStart&&c.text===p.text){a=i;break}++i}}catch(s){o.e(s)}finally{o.f()}if(-1!==a)null===(t=R[a])||void 0===t||null===(n=t.current)||void 0===n||n.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}),[w,p,f,R]);var re=Object(b.useCallback)((function(e){return H.current&&f?E(f,e,F.surroundingSubtitlesCountRadius,F.surroundingSubtitlesTimeRadius):[]}),[f,F.surroundingSubtitlesCountRadius,F.surroundingSubtitlesTimeRadius]),ie=Object(b.useCallback)((function(){if(!H.current)return[];var e=Math.min.apply(Math,Object(i.a)(Object.keys(H.current).map((function(e){return Number(e)}))));return re(e)}),[re]),oe=Object(b.useCallback)((function(){var e=Object.keys(H.current).map((function(e){return Number(e)}));if(f&&e&&0!==e.length){var t=Math.min.apply(Math,Object(i.a)(e));return f[t]}}),[f]);Object(b.useEffect)((function(){var e=P.bindCopy((function(e,t){e.preventDefault(),e.stopPropagation(),a(t,ie(),B.none,!1)}),(function(){var e;return null!==(e=_.current)&&void 0!==e&&e}),(function(){return oe()}));return function(){return e()}}),[P,oe,ie,a]),Object(b.useEffect)((function(){var e=P.bindToggleSubtitleTrackInList((function(e,t){e.preventDefault(),e.stopPropagation(),c(t)}),(function(){return S}));return function(){return e()}}),[P,S,c]),Object(b.useEffect)((function(){var e=P.bindAnkiExport((function(e){e.preventDefault(),e.stopPropagation();var t=Object.keys(H.current).map((function(e){return Number(e)}));if(f&&t&&t.length>0){var n=Math.min.apply(Math,Object(i.a)(t));a(f[n],re(n),B.showAnkiDialog,!0)}}),(function(){return!f||0===f.length||S}));return function(){return e()}}),[P,a,S,f,re]),Object(b.useEffect)((function(){var e=P.bindUpdateLastCard((function(e){e.preventDefault(),e.stopPropagation();var t=Object.keys(H.current).map((function(e){return Number(e)}));if(f&&t&&t.length>0){var n=Math.min.apply(Math,Object(i.a)(t));a(f[n],re(n),B.updateLastCard,!0)}}),(function(){return!f||0===f.length||S}));return function(){return e()}}),[P,a,S,f,re]);var ce=Object(b.useCallback)((function(e){if(f){var t=H.current||{};n(f[e].start,!M.current&&e in t)}}),[f,n]),se=Object(b.useCallback)((function(e,t){e.preventDefault(),e.stopPropagation(),f&&a(f[t],re(t),B.none,!1)}),[f,re,a]),ue=null;return f&&0!==f.length?ue=Object(te.jsx)($n.a,{className:Z.table,children:Object(te.jsx)(Yn.a,{children:Object(te.jsx)(Zn.a,{children:f.map((function(e,t){var n=t in W;return Object(te.jsx)(ra,{index:t,compressed:g,selected:n,copyButtonEnabled:j,disabled:T[e.track],subtitle:f[t],subtitleRef:R[t],onClickSubtitle:ce,onCopySubtitle:se},t)}))})})}):!m&&x?ue=!m&&x&&Object(te.jsx)("div",{className:Z.noSubtitles,children:Object(te.jsx)(_e.a,{variant:"h6",children:x})}):f&&0===f.length&&(ue=Object(te.jsx)("div",{className:Z.noSubtitles,children:Object(te.jsx)(_e.a,{variant:"h6",children:"No subtitles"})})),Object(te.jsx)(Te.a,{square:!0,elevation:0,ref:G,className:Z.container,children:ue})}var oa=function(){function e(t){Object(k.a)(this,e),this.protocol=void 0,this.time=void 0,this.isReady=void 0,this.readyCallbacks=void 0,this.playCallbacks=void 0,this.pauseCallbacks=void 0,this.audioTrackSelectedCallbacks=void 0,this.currentTimeCallbacks=void 0,this.exitCallbacks=void 0,this.offsetCallbacks=void 0,this.popOutToggleCallbacks=void 0,this.copyCallbacks=void 0,this.playModeCallbacks=void 0,this.hideSubtitlePlayerToggleCallbacks=void 0,this.appBarToggleCallbacks=void 0,this.ankiDialogRequestCallbacks=void 0,this.toggleSubtitleTrackInListCallbacks=void 0,this.readyState=void 0,this.oncanplay=null,this.audioTracks=void 0,this.selectedAudioTrack=void 0,this.duration=void 0,this.protocol=t,this.time=0,this.duration=0,this.isReady=!1,this.readyState=0,this.selectedAudioTrack=void 0,this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[],this.playModeCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.toggleSubtitleTrackInListCallbacks=[];var n=this;this.protocol.onMessage=function(e){switch(e.data.command){case"ready":var t=e.data;n.duration=t.duration,n.isReady=!0,n.audioTracks=t.audioTracks,n.selectedAudioTrack=t.selectedAudioTrack,n.readyState=4,n.time=t.currentTime;var a,i=Object(r.a)(n.readyCallbacks);try{for(i.s();!(a=i.n()).done;){(0,a.value)(t.paused)}}catch(G){i.e(G)}finally{i.f()}break;case"readyState":var o,c=e.data;if(n.readyState=c.value,4===n.readyState)null===(o=n.oncanplay)||void 0===o||o.call(n,new Event("canplay"));break;case"play":var s,u=e.data,l=Object(r.a)(n.playCallbacks);try{for(l.s();!(s=l.n()).done;){(0,s.value)(u.echo)}}catch(G){l.e(G)}finally{l.f()}break;case"pause":var d,b=e.data,f=Object(r.a)(n.pauseCallbacks);try{for(f.s();!(d=f.n()).done;){(0,d.value)(b.echo)}}catch(G){f.e(G)}finally{f.f()}break;case"audioTrackSelected":var h,v=e.data,p=Object(r.a)(n.audioTrackSelectedCallbacks);try{for(p.s();!(h=p.n()).done;){var g=h.value;n.selectedAudioTrack=v.id,g(v.id)}}catch(G){p.e(G)}finally{p.f()}break;case"currentTime":var j,O=e.data,m=Object(r.a)(n.currentTimeCallbacks);try{for(m.s();!(j=m.n()).done;){(0,j.value)(O.value,O.echo)}}catch(G){m.e(G)}finally{m.f()}break;case"exit":var k,y=Object(r.a)(n.exitCallbacks);try{for(y.s();!(k=y.n()).done;){(0,k.value)()}}catch(G){y.e(G)}finally{y.f()}break;case"offset":var x,S=e.data,C=Object(r.a)(n.offsetCallbacks);try{for(C.s();!(x=C.n()).done;){(0,x.value)(S.value)}}catch(G){C.e(G)}finally{C.f()}break;case"popOutToggle":var w,T=Object(r.a)(n.popOutToggleCallbacks);try{for(T.s();!(w=T.n()).done;){(0,w.value)()}}catch(G){T.e(G)}finally{T.f()}break;case"copy":var F,P=Object(r.a)(n.copyCallbacks);try{for(P.s();!(F=P.n()).done;){var E,M,I=F.value,R=e.data;I(R.subtitle,R.surroundingSubtitles,R.audio,R.image,R.url,null!==(E=R.postMineAction)&&void 0!==E?E:B.none,!0,null!==(M=R.preventDuplicate)&&void 0!==M&&M,R.id)}}catch(G){P.e(G)}finally{P.f()}break;case"playMode":var A,N=Object(r.a)(n.playModeCallbacks);try{for(N.s();!(A=N.n()).done;){(0,A.value)(e.data.playMode)}}catch(G){N.e(G)}finally{N.f()}break;case"hideSubtitlePlayerToggle":var _,D=Object(r.a)(n.hideSubtitlePlayerToggleCallbacks);try{for(D.s();!(_=D.n()).done;){(0,_.value)()}}catch(G){D.e(G)}finally{D.f()}break;case"appBarToggle":var L,W=Object(r.a)(n.appBarToggleCallbacks);try{for(W.s();!(L=W.n()).done;){(0,L.value)()}}catch(G){W.e(G)}finally{W.f()}break;case"sync":case"syncv2":case"playbackRate":break;case"ankiDialogRequest":var U,H=e.data,z=Object(r.a)(n.ankiDialogRequestCallbacks);try{for(z.s();!(U=z.n()).done;){(0,U.value)(H.forwardToVideo)}}catch(G){z.e(G)}finally{z.f()}break;case"toggleSubtitleTrackInList":var q,V=e.data,K=Object(r.a)(n.toggleSubtitleTrackInListCallbacks);try{for(K.s();!(q=K.n()).done;){(0,q.value)(V.track)}}catch(G){K.e(G)}finally{K.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(y.a)(e,[{key:"currentTime",get:function(){return this.time},set:function(e){this.time=e,this.readyState=3;var t={command:"currentTime",value:this.time};this.protocol.postMessage(t)}},{key:"onReady",value:function(e){this.isReady&&e(!1),this.readyCallbacks.push(e)}},{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onExit",value:function(e){this.exitCallbacks.push(e)}},{key:"onOffset",value:function(e){this.offsetCallbacks.push(e)}},{key:"onPopOutToggle",value:function(e){this.popOutToggleCallbacks.push(e)}},{key:"onCopy",value:function(e){this.copyCallbacks.push(e)}},{key:"onPlayMode",value:function(e){this.playModeCallbacks.push(e)}},{key:"onHideSubtitlePlayerToggle",value:function(e){this.hideSubtitlePlayerToggleCallbacks.push(e)}},{key:"onAppBarToggle",value:function(e){this.appBarToggleCallbacks.push(e)}},{key:"onAnkiDialogRequest",value:function(e){this.ankiDialogRequestCallbacks.push(e)}},{key:"onToggleSubtitleTrackInList",value:function(e){this.toggleSubtitleTrackInListCallbacks.push(e)}},{key:"ready",value:function(e){var t={command:"ready",duration:e};this.protocol.postMessage(t)}},{key:"init",value:function(){this.protocol.postMessage({command:"init"})}},{key:"play",value:function(){return this.protocol.postMessage({command:"play"}),new Promise((function(e,t){return e()}))}},{key:"pause",value:function(){this.protocol.postMessage({command:"pause"})}},{key:"audioTrackSelected",value:function(e){var t={command:"audioTrackSelected",id:e};this.protocol.postMessage(t)}},{key:"subtitles",value:function(e,t){this.protocol.postMessage({command:"subtitles",value:e,name:t.length>0?t[0]:null,names:t})}},{key:"offset",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t={command:"offset",value:e};this.protocol.postMessage(t)}))},{key:"subtitleSettings",value:function(e){var t={command:"subtitleSettings",value:e};this.protocol.postMessage(t)}},{key:"playMode",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t={command:"playMode",playMode:e};this.protocol.postMessage(t)}))},{key:"hideSubtitlePlayerToggle",value:function(e){var t={command:"hideSubtitlePlayerToggle",value:e};this.protocol.postMessage(t)}},{key:"appBarToggle",value:function(e){var t={command:"appBarToggle",value:e};this.protocol.postMessage(t)}},{key:"ankiDialogRequest",value:function(){this.protocol.postMessage({command:"ankiDialogRequest"})}},{key:"finishedAnkiDialogRequest",value:function(e){var t={command:"finishedAnkiDialogRequest",resume:e};this.protocol.postMessage(t)}},{key:"ankiSettings",value:function(e){var t={command:"ankiSettings",value:e};this.protocol.postMessage(t)}},{key:"miscSettings",value:function(e){var t={command:"miscSettings",value:e};this.protocol.postMessage(t)}},{key:"close",value:function(){this.protocol.postMessage({command:"close"}),this.protocol.close(),this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[],this.playModeCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.toggleSubtitleTrackInListCallbacks=[]}}]),e}(),ca=n(188),sa=n.n(ca),ua=Object(p.a)({root:function(e){return{height:e.appBarHidden?"100vh":"calc(100vh - 64px)",position:"relative",overflowX:"hidden"}},container:{width:"100%",height:"100%"},videoFrame:{width:"100%",height:"100%",border:0,display:"block"}});function la(e,t,n,a){var r;r=n&&n.length>0?a?n[n.length-1].end:n[n.length-1].originalEnd:0;var i=e.current&&e.current.duration?1e3*e.current.duration:0,o=t.current&&t.current.duration?1e3*t.current.duration:0;return Math.max(o,Math.max(r,i))}function da(e){var t,n=e.sources,a=n.subtitleFiles,r=n.audioFile,i=n.audioFileUrl,u=n.videoFile,l=n.videoFileUrl,f=e.subtitleReader,h=e.settingsProvider,v=e.playbackPreferences,p=e.keyBinder,g=e.extension,j=e.videoFrameRef,O=e.videoChannelRef,m=e.drawerOpen,k=e.appBarHidden,y=e.videoPopOut,x=e.tab,S=e.availableTabs,C=e.ankiDialogRequestToVideo,w=e.ankiDialogRequested,T=e.ankiDialogFinishedRequest,F=e.onError,P=e.onUnloadAudio,E=e.onUnloadVideo,I=e.onCopy,R=e.onLoaded,_=e.onTabSelected,D=e.onAnkiDialogRequest,L=e.onAppBarToggle,W=e.onVideoPopOut,U=e.onPlayModeChangedViaBind,H=e.disableKeyEvents,z=e.jumpToSubtitle,q=e.rewindSubtitle,V=Object(b.useState)(N.normal),K=Object(s.a)(V,2),G=K[0],X=K[1],J=Object(b.useRef)();J.current=G;var Q=Object(b.useState)(),$=Object(s.a)(Q,2),ee=$[0],ne=$[1],ae=Object(b.useMemo)((function(){return new Y(null!==ee&&void 0!==ee?ee:[],{returnLastShown:!0,returnNextToShow:G===N.condensed,showingCheckRadiusMs:100})}),[ee,G]),re=Object(b.useRef)();re.current=ee;var ie=ee&&ee.length>0&&Boolean(l||i),oe=Object(b.useState)(!1),ce=Object(s.a)(oe,2),se=ce[0],ue=ce[1],le=Object(b.useState)(!1),de=Object(s.a)(le,2),be=de[0],fe=de[1],he=Object(b.useState)(0),ve=Object(s.a)(he,2),pe=ve[0],ge=ve[1],je=Object(b.useState)(0),Oe=Object(s.a)(je,2),me=Oe[0],ke=Oe[1],ye=Object(b.useRef)();ye.current=be;var xe=Object(b.useState)(),Ce=Object(s.a)(xe,2)[1],we=Object(b.useState)(),Te=Object(s.a)(we,2),Fe=Te[0],Pe=Te[1],Ee=Object(b.useState)(),Me=Object(s.a)(Ee,2),Ie=Me[0],Re=Me[1],Be=Object(b.useState)(),Ae=Object(s.a)(Be,2),Ne=Ae[0],_e=Ae[1],De=Object(b.useState)(!1),Le=Object(s.a)(De,2)[1],We=Object(b.useState)(!1),Ue=Object(s.a)(We,2),He=Ue[0],ze=Ue[1],qe=Object(b.useRef)();qe.current=He;var Ve=Object(b.useState)({}),Ke=Object(s.a)(Ve,2),Ge=Ke[0],Xe=Ke[1],Je=Object(b.useCallback)((function(){return Ce({})}),[]),Ye=Object(b.useRef)({x:0,y:0}),Ze=Object(b.useRef)(null),Qe=Object(b.useRef)(),$e=Object(b.useMemo)((function(){return new Jn(i?Ze:l||x?Qe:{current:null})}),[i,l,x]),et=Object(b.useMemo)((function(){return new rn}),[]),tt=ua({appBarHidden:k}),nt=Object(b.useRef)(0);nt.current=la(Ze,Qe,ee,!0);var at=Object(b.useCallback)(function(){var e=Object(c.a)(d.a.mark((function e(t,n,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.setTime(t),Je(),!a){e.next=5;break}return e.next=5,$e.seek(t/1e3);case 5:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),[Je,$e]),rt=Object(b.useCallback)((function(e,t){ke(e),ne((function(n){if(n){var r=n.length>0?n[n.length-1].end+e:0,i=n.map((function(t,n){return{text:t.text,textImage:t.textImage,start:t.originalStart+e,originalStart:t.originalStart,end:t.originalEnd+e,originalEnd:t.originalEnd,displayTime:Rt(t.originalStart+e,r),track:t.track,index:n}}));return t&&Qe.current instanceof oa&&(Qe.current.offset(e),void 0!==x&&g.installed&&sa()(g.version,"0.22.0")&&Qe.current.subtitles(i,a.map((function(e){return e.name})))),i}})),v.offset=e}),[a,g,v,x]);function it(e,t,n){fe(!0),e.start(),n&&t.play()}function ot(e,t,n){fe(!1),e.stop(),n&&t.pause()}Object(b.useEffect)((function(){var e=void 0,t=!1;function n(){return n=Object(c.a)(d.a.mark((function n(){var s,b,p,j,m,k;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Qe.current instanceof oa&&Qe.current.close(),Qe.current=void 0,O.current=null,et.setTime(0),et.stop(),s=v.offset,ke(s),fe(!1),Pe(void 0),Re(void 0),X(N.normal),Ze.current&&(Ze.current.currentTime=0,Ze.current.pause()),!(a.length>0)){n.next=32;break}return ue(!0),n.prev=14,n.next=17,f.subtitles(a);case 17:p=n.sent,j=p.length>0?p[p.length-1].end+s:0,b=p.map((function(e,t){return{text:e.text,textImage:e.textImage,start:e.start+s,originalStart:e.start,end:e.end+s,originalEnd:e.end,displayTime:Rt(e.start+s,j),track:e.track,index:t}})),ne(b),ge(Date.now()),n.next=27;break;case 24:n.prev=24,n.t0=n.catch(14),n.t0 instanceof Error?F(n.t0.message):F(String(n.t0));case 27:return n.prev=27,ue(!1),n.finish(27);case 30:n.next=33;break;case 32:b=void 0;case 33:if(!i){n.next=39;break}return n.next=36,$e.onReady();case 36:Je(),n.next=62;break;case 39:if(!l&&!x){n.next=62;break}if(!t){n.next=42;break}return n.abrupt("return");case 42:if(!l){n.next=48;break}m=Object(Z.a)(),e=new oa(new nn(m)),_e(m),n.next=54;break;case 48:if(!x){n.next=53;break}(e=new oa(new an(x.id,x.src,g))).init(),n.next=54;break;case 53:throw new Error("Unreachable code");case 54:Qe.current=e,O.current=e,k=!1,e.onExit((function(){return l&&E(l)})),e.onPopOutToggle((function(){return W()})),e.onHideSubtitlePlayerToggle((function(){ze((function(t){var n;return null===(n=e)||void 0===n||n.hideSubtitlePlayerToggle(!t),!t}))})),e.onAppBarToggle((function(){L()})),e.onReady((function(t){var n,i,s,l,b,f,v,p,g,j,O,m,y,x,S,C,w,T,F,P,E,M;(nt.current=la(Ze,Qe,re.current),null===(n=e)||void 0===n||n.ready(nt.current),re.current)&&(null===(j=e)||void 0===j||j.subtitleSettings(h.subtitleSettings),null===(O=e)||void 0===O||O.subtitles(re.current,a.map((function(e){return e.name}))));(null===(i=e)||void 0===i||i.ankiSettings(h.ankiSettings),null===(s=e)||void 0===s||s.miscSettings(h.miscSettings),null===(l=e)||void 0===l||l.playMode(J.current),null===(b=e)||void 0===b||b.hideSubtitlePlayerToggle(null!==(f=qe.current)&&void 0!==f&&f),null!==(v=e)&&void 0!==v&&v.audioTracks&&(null===(p=e)||void 0===p||null===(g=p.audioTracks)||void 0===g?void 0:g.length)>1)?(Pe(null===(m=e)||void 0===m?void 0:m.audioTracks),Re(null===(y=e)||void 0===y?void 0:y.selectedAudioTrack)):(Pe(void 0),Re(void 0));(Qe.current&&et.setTime(1e3*Qe.current.currentTime),t?et.stop():et.start(),fe(!t),k)||(null===(x=e)||void 0===x||x.onPlay((function(e){return it(et,$e,e)})),null===(S=e)||void 0===S||S.onPause((function(e){return ot(et,$e,e)})),null===(C=e)||void 0===C||C.onOffset((function(e){var t;return rt(Math.max(null!==(t=-nt.current)&&void 0!==t?t:0,e),!1)})),null===(w=e)||void 0===w||w.onCopy((function(t,n,i,o,c,s,l,d,b){var f;return I(t,n,r,u,t?a[t.track]:void 0,et.time(nt.current),null===(f=e)||void 0===f?void 0:f.selectedAudioTrack,i,o,c,s,l,d,b)})),null===(T=e)||void 0===T||T.onPlayMode((function(t){var n;X(t),null===(n=e)||void 0===n||n.playMode(t)})),null===(F=e)||void 0===F||F.onCurrentTime(function(){var e=Object(c.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ye.current&&et.stop(),e.next=3,at(1e3*t,et,n);case 3:ye.current&&et.start();case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),null===(P=e)||void 0===P||P.onAudioTrackSelected(function(){var e=Object(c.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ye.current&&et.stop(),e.next=3,$e.onReady();case 3:ye.current&&et.start(),Re(t);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),null===(E=e)||void 0===E||E.onAnkiDialogRequest((function(e){return D(e)})),null===(M=e)||void 0===M||M.onToggleSubtitleTrackInList((function(e){return Xe((function(t){var n=Object(o.a)({},t);return n[e]=!t[e],n}))})),k=!0)}));case 62:case"end":return n.stop()}}),n,null,[[14,24,27,30]])}))),n.apply(this,arguments)}return function(){return n.apply(this,arguments)}().then((function(){return R()})),function(){var n;null===(n=e)||void 0===n||n.close(),t=!0}}),[f,g,h,v,et,$e,at,R,F,E,I,D,L,W,a,r,i,u,l,x,Je,j,O,rt]),Object(b.useEffect)((function(){C&&Qe.current instanceof oa&&Qe.current.ankiDialogRequest()}),[C]),Object(b.useEffect)((function(){T&&T.timestamp>0&&(Qe.current instanceof oa&&Qe.current.finishedAnkiDialogRequest(T.resume),Le((function(e){return e&&T.resume&&it(et,$e,!0),!1})))}),[T,et,$e]),Object(b.useEffect)((function(){w&&ye.current&&(ot(et,$e,!0),Le(!0))}),[w,et,$e]),Object(b.useEffect)((function(){if(G===N.condensed&&ee&&0!==ee.length){var e=!1,t=1e3,n=setInterval(Object(c.a)(d.a.mark((function n(){var a,r,i,o,c;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=nt.current){n.next=3;break}return n.abrupt("return");case 3:if(r=et.time(a),!((i=ae.subtitlesAt(r)).nextToShow&&i.nextToShow.length>0)){n.next=18;break}if(!((o=i.nextToShow[0]).start-r<t+500)){n.next=9;break}return n.abrupt("return");case 9:if(ye.current&&et.stop(),e){n.next=17;break}return e=!0,c=Date.now(),n.next=15,at(o.start,et,!0);case 15:t=Date.now()-c,e=!1;case 17:ye.current&&et.start();case 18:case"end":return n.stop()}}),n)}))),100);return function(){return clearInterval(n)}}}),[ee,ae,G,et,at]);var ct=Object(b.useCallback)((function(){G!==N.autoPause||h.autoPausePreference!==A.atStart||l||ot(et,$e,!0)}),[G,et,$e,l,h]),st=Object(b.useCallback)((function(){G!==N.autoPause||h.autoPausePreference!==A.atEnd||l||ot(et,$e,!0)}),[G,et,$e,l,h]);Object(b.useEffect)((function(){y&&Ne&&l&&window.open("/asbplayer/?video="+encodeURIComponent(l)+"&channel="+Ne+"&popout=true","asbplayer-video-"+l,"resizable,width=800,height=450"),ge(Date.now())}),[y,Ne,l,j]);var ut=Object(b.useCallback)((function(){return it(et,$e,!0)}),[et,$e]),lt=Object(b.useCallback)((function(){return ot(et,$e,!0)}),[et,$e]),dt=Object(b.useCallback)(function(){var e=Object(c.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(nt.current){e.next=2;break}return e.abrupt("return");case 2:return ye.current&&et.stop(),e.next=5,at(t*nt.current,et,!0);case 5:ye.current&&et.start();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[et,at]),bt=Object(b.useCallback)(function(){var e=Object(c.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n||ot(et,$e,!0),ye.current&&et.stop(),e.next=4,at(t,et,!0);case 4:n&&!ye.current&&it(et,$e,!0);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[et,at,$e]),ft=Object(b.useCallback)((function(e,t,n,i){I(e,t,r,u,a[e.track],et.time(nt.current),Ie,void 0,void 0,void 0,n,!1,i,void 0)}),[et,I,r,u,a,Ie]),ht=Object(b.useCallback)((function(e){Ye.current.x=e.screenX,Ye.current.y=e.screenY}),[]),vt=Object(b.useCallback)(function(){var e=Object(c.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Qe.current instanceof oa&&Qe.current.audioTrackSelected(t),ot(et,$e,!0),e.next=4,at(0,et,!0);case 4:ye.current&&it(et,$e,!0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[et,$e,at]),pt=Object(b.useCallback)((function(e){var t;rt(Math.max(null!==(t=-nt.current)&&void 0!==t?t:0,e),!0)}),[rt]),gt=Object(b.useCallback)((function(e){Ze.current instanceof HTMLMediaElement&&(Ze.current.volume=e)}),[]),jt=Object(b.useCallback)((function(e){return X(e)}),[]),Ot=Object(b.useCallback)((function(e){return Xe((function(t){var n=Object(o.a)({},t);return n[e]=!t[e],n}))}),[]);Object(b.useEffect)((function(){if(!x){var e=setInterval(Object(c.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=nt.current,!(et.progress(t)>=1)){e.next=7;break}return ot(et,$e,!0),e.next=6,at(0,et,!0);case 6:ge(Date.now());case 7:case"end":return e.stop()}}),e)}))),1e3);return function(){return clearInterval(e)}}}),[et,ee,$e,at,x]),Object(b.useEffect)((function(){var e=p.bindPlay((function(e){e.preventDefault(),be?ot(et,$e,!0):it(et,$e,!0)}),(function(){return H}));return function(){return e()}}),[p,be,et,$e,H]);var mt=Object(b.useCallback)((function(e,t){if(ie){e.preventDefault();var n=G===t?N.normal:t;X(n),U(G,n),Qe.current instanceof oa&&Qe.current.playMode(n)}}),[G,ie,U]);Object(b.useEffect)((function(){return p.bindAutoPause((function(e){return mt(e,N.autoPause)}),(function(){return H}))}),[mt,p,H]),Object(b.useEffect)((function(){return p.bindCondensedPlayback((function(e){return mt(e,N.condensed)}),(function(){return H}))}),[mt,p,H]),Object(b.useEffect)((function(){if((r||u)&&(!ee||0===ee.length)){var e=p.bindCopy((function(e,t){e.preventDefault(),e.stopPropagation();var n=M(t,nt.current,5e3);I(t,n,r,u,void 0,et.time(nt.current),Ie,void 0,void 0,void 0,void 0,void 0,void 0,void 0)}),(function(){return H}),(function(){if(nt.current){var e=et.time(nt.current),t=Math.min(e+5e3,nt.current);return{text:"",start:e,originalStart:e,end:t,originalEnd:t,track:0}}})),t=p.bindAnkiExport((function(e){e.preventDefault(),e.stopPropagation();var t=et.time(nt.current),n=Math.min(t+5e3,nt.current),a={text:"",start:t,originalStart:t,end:n,originalEnd:n,track:0},i=M(a,nt.current,5e3);I(a,i,r,u,void 0,t,Ie,void 0,void 0,void 0,B.showAnkiDialog,!1,void 0,void 0)}),(function(){return!1}));return function(){e(),t()}}}),[p,r,u,ee,et,Ie,H,I,D]),Object(b.useEffect)((function(){Qe.current instanceof oa&&Qe.current.appBarToggle(k)}),[k]),Object(b.useEffect)((function(){q&&(ye.current&&et.stop(),bt(q.start,!1))}),[et,q,bt]);var kt=nt.current,yt=i||l||ee,xt=Boolean(yt&&l&&!y);return Object(te.jsxs)("div",{onMouseMove:ht,className:tt.root,children:[Object(te.jsxs)(Se.a,{container:!0,direction:"row",wrap:"nowrap",className:tt.container,children:[xt&&Object(te.jsx)(Se.a,{item:!0,style:{flexGrow:1,minWidth:600},children:Object(te.jsx)("iframe",{ref:j,className:tt.videoFrame,src:"/asbplayer/?video="+encodeURIComponent(l)+"&channel="+Ne+"&popout=false",title:"asbplayer"})}),(!xt||ee&&(null===(t=ee)||void 0===t?void 0:t.length)>0)&&Object(te.jsxs)(Se.a,{item:!0,style:{flexGrow:xt?0:1,width:xt&&He?0:"auto"},children:[yt&&!(l&&!y)&&Object(te.jsx)(Xn,{mousePositionRef:Ye,playing:be,clock:et,length:kt,displayLength:la(Ze,Qe,ee,!1),audioTracks:Fe,selectedAudioTrack:Ie,tabs:!l&&!i&&S||void 0,selectedTab:x,audioFile:null===r||void 0===r?void 0:r.name,videoFile:null===u||void 0===u?void 0:u.name,offsetEnabled:!0,offset:me,volumeEnabled:Boolean(i),playModeEnabled:ie,playMode:G,onPlay:ut,onPause:lt,onSeek:dt,onAudioTrackSelected:vt,onTabSelected:_,onUnloadAudio:function(){return i&&P(i)},onUnloadVideo:function(){return l&&E(l)},onOffsetChange:pt,onVolumeChange:gt,onPlayMode:jt,disableKeyEvents:H,playbackPreferences:v,showOnMouseMovement:!0}),Object(te.jsx)(ia,{playing:be,subtitles:ee,subtitleCollection:ae,clock:et,length:kt,jumpToSubtitle:z,drawerOpen:m,appBarHidden:k,compressed:Boolean(l&&!y),copyButtonEnabled:void 0===x,loading:se,displayHelp:(null===r||void 0===r?void 0:r.name)||y&&(null===u||void 0===u?void 0:u.name)||void 0,disableKeyEvents:H,lastJumpToTopTimestamp:pe,hidden:xt&&He,disabledSubtitleTracks:Ge,onSeek:bt,onCopy:ft,onOffsetChange:pt,onToggleSubtitleTrack:Ot,onStartedShowing:ct,onWillStopShowing:st,settingsProvider:h,keyBinder:p})]})]}),Object(te.jsx)("audio",{ref:Ze,src:i})]})}var ba=n(358);function fa(e){var t=e.open,n=e.onProceed,a=e.onCancel,r=e.existingCustomFieldNames,o=Object(b.useState)(""),c=Object(s.a)(o,2),u=c[0],l=c[1];Object(b.useEffect)((function(){l("")}),[t]);var d=[].concat(Object(i.a)(r),["Sentence","Word","Definition","Source","Image","Audio"]).includes(u);return Object(te.jsxs)(de.a,{open:t,disableEnforceFocus:!0,fullWidth:!0,maxWidth:"xs",onClose:a,children:[Object(te.jsx)(ba.a,{children:"New Custom Field"}),Object(te.jsx)(Oe.a,{children:Object(te.jsx)("form",{children:Object(te.jsx)(ie.a,{error:d,helperText:d&&"Field ".concat(u," already exists"),variant:"filled",fullWidth:!0,label:"Field Name",value:u,color:"secondary",onChange:function(e){return l(e.target.value)}})})}),Object(te.jsxs)(je.a,{children:[Object(te.jsx)(ve.a,{onClick:function(){return a()},children:"Cancel"}),Object(te.jsx)(ve.a,{disabled:d||""===u.trim(),onClick:function(){return n(u.trim())},children:"Create"})]})]})}var ha=n(190),va=n.n(ha),pa=n(192),ga=n.n(pa),ja=n(283),Oa=n(360),ma=n(289),ka=n(286),ya=n(285),xa=n(284),Sa=n(359),Ca=n(189),wa=n.n(Ca),Ta=n(368),Fa=n(191),Pa=n.n(Fa),Ea=n(291),Ma=n(32),Ia=n(361),Ra=n(362),Ba=Object(se.a)((function(e){return{root:{"& .MuiTextField-root":{marginTop:e.spacing(1),marginBottom:e.spacing(1)}},subtitleSetting:{"& .MuiTextField-root":{marginTop:e.spacing(1),marginBottom:e.spacing(1)}},subtitlePreview:{backgroundImage:"linear-gradient(45deg, ".concat(e.palette.action.disabledBackground," 25%, transparent 25%), linear-gradient(-45deg, ").concat(e.palette.action.disabledBackground," 25%, transparent 25%), linear-gradient(45deg, transparent 75%, ").concat(e.palette.action.disabledBackground," 75%), linear-gradient(-45deg, transparent 75%,").concat(e.palette.action.disabledBackground," 75%)"),backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px",marginTop:e.spacing(1),marginBottom:e.spacing(1),maxWidth:"100%",padding:10},subtitlePreviewInput:{border:"none",width:"100%",textAlign:"center",backgroundColor:"rgba(0,0,0,0)","&:focus":{outline:"none"}},addFieldButton:{width:"100%"},switchLabel:{justifyContent:"space-between",marginLeft:0}}})),Aa=Object(se.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120},root:{display:"flex",flexDirection:"row",justifyContent:"end",alignItems:"flex-end"}}}));function Na(e){var t=e.label,n=e.value,a=e.selections,r=e.removable,i=e.onChange,o=e.onSelectionChange,c=e.onRemoval,s=Aa();return Object(te.jsxs)("div",{className:s.root,children:[Object(te.jsx)(ie.a,{label:t,value:n,onChange:i,fullWidth:!0,color:"secondary",InputProps:{endAdornment:r&&Object(te.jsx)(we.a,{position:"end",children:Object(te.jsx)(Ce.a,{onClick:function(e){return null===c||void 0===c?void 0:c()},children:Object(te.jsx)(wa.a,{})})})}}),Object(te.jsxs)(ja.a,{className:s.formControl,children:[Object(te.jsx)(xa.a,{}),Object(te.jsx)(Ea.a,{value:n,disabled:!a,color:"secondary",onChange:o,children:a&&a.map((function(e){return Object(te.jsx)(Sa.a,{value:e,children:e},e)}))})]})]})}var _a={copySubtitle:{label:"Mine current subtitle",extensionOverridden:!0},ankiExport:{label:"Mine current subtitle and open Anki dialog",extensionOverridden:!0},updateLastCard:{label:"Update last-created Anki card with asbplayer-captured screenshot, audio, etc.",extensionOverridden:!0},togglePlay:{label:"Play/pause",extensionOverridden:!1},toggleAutoPause:{label:"Toggle auto-pause",extensionOverridden:!1},toggleCondensedPlayback:{label:"Toggle condensed playback",extensionOverridden:!1},toggleSubtitles:{label:"Toggle subtitles",extensionOverridden:!1},toggleVideoSubtitleTrack1:{label:"Toggle subtitle track 1 in video",extensionOverridden:!1},toggleVideoSubtitleTrack2:{label:"Toggle subtitle track 2 in video",extensionOverridden:!1},toggleAsbplayerSubtitleTrack1:{label:"Toggle subtitle track 1 in asbplayer",extensionOverridden:!1},toggleAsbplayerSubtitleTrack2:{label:"Toggle subtitle track 2 in asbplayer",extensionOverridden:!1},seekBackward:{label:"Seek backward 10 seconds",extensionOverridden:!1},seekForward:{label:"Seek forward 10 seconds",extensionOverridden:!1},seekToPreviousSubtitle:{label:"Seek to previous subtitle",extensionOverridden:!1},seekToNextSubtitle:{label:"Seek to next subtitle",extensionOverridden:!1},seekToBeginningOfCurrentSubtitle:{label:"Seek to beginning of current subtitle",extensionOverridden:!1},adjustOffsetToPreviousSubtitle:{label:"Adjust subtitle offset so that previous subtitle is at current timestamp",extensionOverridden:!1},adjustOffsetToNextSubtitle:{label:"Adjust subtitle offset so that next subtitle is at current timestamp",extensionOverridden:!1},increaseOffset:{label:"Adjust subtitle offset by +100ms",extensionOverridden:!1},decreaseOffset:{label:"Adjust subtitle offset by -100ms",extensionOverridden:!1}},Da=Ma.isMacOs?{}:{"\u2303":"ctrl","\u21e7":"shift","\u2325":"alt"},La=["\u2303","\u21e7","\u2325","ctrl","shift","alt","option","control","command","\u2318"],Wa=Object(se.a)((function(e){return{container:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},labelItem:{}}}));function Ua(e){var t=e.label,n=e.keys,a=e.extensionOverridden,r=e.onKeysChange,i=e.onOpenExtensionShortcuts,o=Wa(),c=Object(b.useState)(n),u=Object(s.a)(c,2),l=u[0],d=u[1],f=Object(b.useRef)();f.current=l;var h=Object(b.useRef)();h.current=r;var v=Object(b.useState)(!1),p=Object(s.a)(v,2),g=p[0],j=p[1];Object(b.useEffect)((function(){return d(n)}),[n]);var O,m=Object(b.useCallback)((function(e){0!==e.nativeEvent.detail&&(a?i():(d(""),j(!0)))}),[i,a]),k=Object(b.useRef)(null);return Object(b.useEffect)((function(){if(g){var e=function(e){if("keydown"===e.type){var t=x.a.getPressedKeyString();console.log(t),d(t.map((function(e){var t;return null!==(t=Da[e])&&void 0!==t?t:e})).sort((function(e,t){var n=La.includes(e),a=La.includes(t);return n&&!a?-1:!n&&a?1:0})).join("+"))}else"keyup"===e.type&&(j(!1),f.current&&h.current(f.current))};return Object(x.a)("*",{keyup:!0},e),function(){return x.a.unbind("*",e)}}}),[g]),Object(b.useEffect)((function(){var e=function(e){var t;!g||null!==(t=k.current)&&void 0!==t&&t.contains(e.target)||(j(!1),d(""),r(""))};return window.document.addEventListener("click",e),function(){return window.document.removeEventListener("click",e)}}),[g,r]),O=g?"Recording":a?"Overridden":"Unbound",Object(te.jsxs)(Se.a,{container:!0,className:o.container,wrap:"nowrap",spacing:1,children:[Object(te.jsx)(Se.a,{item:!0,className:o.labelItem,xs:6,children:Object(te.jsx)(_e.a,{children:t})}),Object(te.jsx)(Se.a,{item:!0,xs:6,children:Object(te.jsx)(ie.a,{placeholder:O,size:"small",contentEditable:!1,disabled:a,helperText:a?"Extension shortcut":void 0,value:l,color:"secondary",InputProps:{endAdornment:Object(te.jsx)(we.a,{position:"end",children:Object(te.jsx)(Ce.a,{ref:k,onClick:m,children:Object(te.jsx)(va.a,{})})})}})})]})}function Ha(e){var t=e.anki,n=e.extension,a=e.open,r=e.settings,u=e.scrollToId,l=e.onClose,h=Ba(),v=Object(b.useState)(r.ankiConnectUrl),p=Object(s.a)(v,2),g=p[0],j=p[1],O=Object(b.useState)(),m=Object(s.a)(O,2),k=m[0],y=m[1],x=Object(b.useState)(0),S=Object(s.a)(x,2),C=S[0],w=S[1],T=Object(b.useState)(r.deck||""),F=Object(s.a)(T,2),P=F[0],E=F[1],M=Object(b.useState)(),I=Object(s.a)(M,2),R=I[0],B=I[1],N=Object(b.useState)(r.noteType||""),_=Object(s.a)(N,2),D=_[0],L=_[1],W=Object(b.useState)(),U=Object(s.a)(W,2),H=U[0],z=U[1],q=Object(b.useState)(r.sentenceField||""),V=Object(s.a)(q,2),K=V[0],G=V[1],X=Object(b.useState)(r.definitionField||""),J=Object(s.a)(X,2),Y=J[0],Z=J[1],Q=Object(b.useState)(r.audioField||""),$=Object(s.a)(Q,2),ee=$[0],ne=$[1],ae=Object(b.useState)(r.imageField||""),re=Object(s.a)(ae,2),oe=re[0],se=re[1],ue=Object(b.useState)(r.wordField||""),le=Object(s.a)(ue,2),be=le[0],fe=le[1],he=Object(b.useState)(r.sourceField||""),pe=Object(s.a)(he,2),ge=pe[0],me=pe[1],ke=Object(b.useState)(r.urlField||""),ye=Object(s.a)(ke,2),xe=ye[0],Te=ye[1],Fe=Object(b.useState)(r.customAnkiFields),Pe=Object(s.a)(Fe,2),Ee=Pe[0],Me=Pe[1],Ie=Object(b.useState)(r.tags),Re=Object(s.a)(Ie,2),Be=Re[0],Ae=Re[1],_e=Object(b.useState)(r.preferMp3),De=Object(s.a)(_e,2),Le=De[0],We=De[1],Ue=Object(b.useState)(),He=Object(s.a)(Ue,2),ze=He[0],qe=He[1],Ve=Object(b.useState)(!1),Ke=Object(s.a)(Ve,2),Ge=Ke[0],Xe=Ke[1],Je=Object(b.useState)(r.audioPaddingStart),Ye=Object(s.a)(Je,2),Ze=Ye[0],Qe=Ye[1],$e=Object(b.useState)(r.audioPaddingEnd),et=Object(s.a)($e,2),tt=et[0],nt=et[1],at=Object(b.useState)(r.maxImageWidth),rt=Object(s.a)(at,2),it=rt[0],ot=rt[1],ct=Object(b.useState)(r.maxImageHeight),st=Object(s.a)(ct,2),ut=st[0],lt=st[1],dt=Object(b.useState)(r.surroundingSubtitlesCountRadius),bt=Object(s.a)(dt,2),ft=bt[0],ht=bt[1],vt=Object(b.useState)(r.surroundingSubtitlesTimeRadius),pt=Object(s.a)(vt,2),gt=pt[0],jt=pt[1],Ot=Object(b.useState)(r.subtitleColor),mt=Object(s.a)(Ot,2),kt=mt[0],yt=mt[1],xt=Object(b.useState)(r.subtitleSize),St=Object(s.a)(xt,2),Ct=St[0],wt=St[1],Tt=Object(b.useState)(r.subtitleOutlineColor),Ft=Object(s.a)(Tt,2),Pt=Ft[0],Et=Ft[1],Mt=Object(b.useState)(r.subtitleOutlineThickness),Rt=Object(s.a)(Mt,2),Bt=Rt[0],At=Rt[1],Nt=Object(b.useState)(r.subtitleBackgroundColor),_t=Object(s.a)(Nt,2),Dt=_t[0],Lt=_t[1],Wt=Object(b.useState)(r.subtitleBackgroundOpacity),Ut=Object(s.a)(Wt,2),Ht=Ut[0],zt=Ut[1],qt=Object(b.useState)(r.subtitleFontFamily),Vt=Object(s.a)(qt,2),Kt=Vt[0],Gt=Vt[1],Xt=Object(b.useState)(r.imageBasedSubtitleScaleFactor),Jt=Object(s.a)(Xt,2),Yt=Jt[0],Zt=Jt[1],Qt=Object(b.useState)(r.subtitlePreview),en=Object(s.a)(Qt,2),tn=en[0],nn=en[1],an=Object(b.useState)(r.themeType),rn=Object(s.a)(an,2),on=rn[0],cn=rn[1],sn=Object(b.useState)(r.copyToClipboardOnMine),un=Object(s.a)(sn,2),ln=un[0],dn=un[1],bn=Object(b.useState)(r.autoPausePreference),fn=Object(s.a)(bn,2),hn=fn[0],vn=fn[1],pn=Object(b.useState)(r.keyBindSet),gn=Object(s.a)(pn,2),jn=gn[0],On=gn[1],mn=Object(b.useState)(r.rememberSubtitleOffset),kn=Object(s.a)(mn,2),yn=kn[0],xn=kn[1],Sn=Object(b.useCallback)((function(e){j(e.target.value),w(Date.now())}),[]),Cn=Object(b.useCallback)((function(e){return w(Date.now())}),[]),wn=Object(b.useCallback)((function(e){return E(e.target.value)}),[]),Tn=Object(b.useCallback)((function(e){return E(e.target.value)}),[]),Fn=Object(b.useCallback)((function(e){return L(e.target.value)}),[]),Pn=Object(b.useCallback)((function(e){return L(e.target.value)}),[]),En=Object(b.useCallback)((function(e){return G(e.target.value)}),[]),Mn=Object(b.useCallback)((function(e){return G(e.target.value)}),[]),In=Object(b.useCallback)((function(e){return Z(e.target.value)}),[]),Rn=Object(b.useCallback)((function(e){return Z(e.target.value)}),[]),Bn=Object(b.useCallback)((function(e){return ne(e.target.value)}),[]),An=Object(b.useCallback)((function(e){return ne(e.target.value)}),[]),Nn=Object(b.useCallback)((function(e){return se(e.target.value)}),[]),_n=Object(b.useCallback)((function(e){return se(e.target.value)}),[]),Dn=Object(b.useCallback)((function(e){return fe(e.target.value)}),[]),Ln=Object(b.useCallback)((function(e){return fe(e.target.value)}),[]),Wn=Object(b.useCallback)((function(e){return me(e.target.value)}),[]),Un=Object(b.useCallback)((function(e){return me(e.target.value)}),[]),Hn=Object(b.useCallback)((function(e){return Te(e.target.value)}),[]),zn=Object(b.useCallback)((function(e){return Te(e.target.value)}),[]),qn=Object(b.useCallback)((function(e){return Qe(Number(e.target.value))}),[]),Vn=Object(b.useCallback)((function(e){return nt(Number(e.target.value))}),[]),Kn=Object(b.useCallback)((function(e){return ot(Number(e.target.value))}),[]),Gn=Object(b.useCallback)((function(e){return lt(Number(e.target.value))}),[]),Xn=Object(b.useCallback)((function(e){return ht(Number(e.target.value))}),[]),Jn=Object(b.useCallback)((function(e){return jt(Number(e.target.value))}),[]),Yn=Object(b.useCallback)((function(e){return yt(e.target.value)}),[]),Zn=Object(b.useCallback)((function(e){return wt(Number(e.target.value))}),[]),Qn=Object(b.useCallback)((function(e){return Et(e.target.value)}),[]),$n=Object(b.useCallback)((function(e){return At(Number(e.target.value))}),[]),ea=Object(b.useCallback)((function(e){return Lt(e.target.value)}),[]),ta=Object(b.useCallback)((function(e){return zt(Number(e.target.value))}),[]),na=Object(b.useCallback)((function(e){return Gt(e.target.value)}),[]),aa=Object(b.useCallback)((function(e){return nn(e.target.value)}),[]),ra=Object(b.useCallback)((function(e){return Zt(Number(e.target.value))}),[]),ia=Object(b.useCallback)((function(e){Me((function(t){var n={};return Object.assign(n,t),n[e]="",n})),Xe(!1)}),[]),oa=Object(b.useCallback)((function(e,t){Me((function(n){var a={};return Object.assign(a,n),a[e]=t,a}))}),[]),ca=Object(b.useCallback)((function(e){return Me((function(t){var n={};return Object.assign(n,t),delete n[e],n}))}),[]),sa=Object(b.useCallback)((function(e){Ae(e)}),[]),ua=Object(b.useCallback)((function(e){return We(e.target.checked)}),[]),la=Object(b.useCallback)((function(e){if("dark"!==e.target.value&&"light"!==e.target.value)throw new Error("Invalid theme type ".concat(e.target.value));cn(e.target.value)}),[]),da=Object(b.useCallback)((function(e){return dn(e.target.checked)}),[]),ha=Object(b.useCallback)((function(e){vn(Number(e.target.value))}),[]),va=Object(b.useCallback)((function(e,t){On((function(n){var a=Object(o.a)({},n);return a[t]={keys:e},a}))}),[]),pa=Object(b.useCallback)((function(e){return xn(e.target.checked)}),[]),ja=Object(b.useMemo)((function(){return It({subtitleColor:kt,subtitleSize:Ct,subtitleOutlineThickness:Bt,subtitleOutlineColor:Pt,subtitleBackgroundOpacity:Ht,subtitleBackgroundColor:Dt,subtitleFontFamily:Kt})}),[kt,Ct,Bt,Pt,Ht,Dt,Kt]);Object(b.useEffect)((function(){var e=!1,n=setTimeout(Object(c.a)(d.a.mark((function n(){return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e){n.next=3;break}return n.abrupt("return");case 3:return n.next=5,t.requestPermission(g);case 5:return n.t0=B,n.next=8,t.deckNames(g);case 8:return n.t1=n.sent,(0,n.t0)(n.t1),n.t2=z,n.next=13,t.modelNames(g);case 13:n.t3=n.sent,(0,n.t2)(n.t3),y(void 0),n.next=26;break;case 18:if(n.prev=18,n.t4=n.catch(0),!e){n.next=22;break}return n.abrupt("return");case 22:console.error(n.t4),B(void 0),z(void 0),n.t4 instanceof Error?y(n.t4.message):"string"===typeof n.t4?y(n.t4):y(String(n.t4));case 26:case"end":return n.stop()}}),n,null,[[0,18]])}))),1e3);return function(){e=!0,clearTimeout(n)}}),[t,g,C]),Object(b.useEffect)((function(){if(D&&!k){var e=!1;return function(){n.apply(this,arguments)}(),function(){e=!0}}function n(){return(n=Object(c.a)(d.a.mark((function n(){return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e){n.next=3;break}return n.abrupt("return");case 3:return n.t0=qe,n.t1=[""],n.t2=i.a,n.next=8,t.modelFieldNames(D,g);case 8:n.t3=n.sent,n.t4=(0,n.t2)(n.t3),n.t5=n.t1.concat.call(n.t1,n.t4),(0,n.t0)(n.t5),y(void 0),n.next=22;break;case 15:if(n.prev=15,n.t6=n.catch(0),!e){n.next=19;break}return n.abrupt("return");case 19:console.error(n.t6),qe(void 0),n.t6 instanceof Error?y(n.t6.message):"string"===typeof n.t6?y(n.t6):y(String(n.t6));case 22:case"end":return n.stop()}}),n,null,[[0,15]])})))).apply(this,arguments)}}),[t,D,g,k,C]);var xa=Object(b.useCallback)((function(){l({ankiConnectUrl:g,deck:P,noteType:D,sentenceField:K,definitionField:Y,audioField:ee,imageField:oe,wordField:be,sourceField:ge,urlField:xe,tags:Be.filter((function(e){return""!==e})),subtitleSize:Number(Ct),subtitleColor:kt,subtitleOutlineThickness:Number(Bt),subtitleOutlineColor:Pt,subtitleBackgroundColor:Dt,subtitleBackgroundOpacity:Number(Ht),subtitleFontFamily:Kt,subtitlePreview:tn,imageBasedSubtitleScaleFactor:Yt,customAnkiFields:Ee,preferMp3:Le,themeType:on,audioPaddingStart:Ze,audioPaddingEnd:tt,maxImageWidth:it,maxImageHeight:ut,surroundingSubtitlesCountRadius:ft,surroundingSubtitlesTimeRadius:gt,copyToClipboardOnMine:ln,autoPausePreference:hn,keyBindSet:jn,rememberSubtitleOffset:yn})}),[l,g,P,D,K,Y,ee,oe,be,ge,xe,Ee,Be,Le,Ct,kt,Bt,Pt,Dt,Ht,Kt,tn,Yt,on,Ze,tt,it,ut,ft,gt,ln,hn,jn,yn]),Sa=Object.keys(Ee).map((function(e){return Object(te.jsx)(Na,{label:"".concat(e," Field"),value:Ee[e],selections:ze,onChange:function(t){return oa(e,t.target.value)},onSelectionChange:function(t){return oa(e,t.target.value)},onRemoval:function(){return ca(e)},removable:!0},e)}));return Object(b.useEffect)((function(){u&&setTimeout((function(){var e;return null===(e=document.getElementById(u))||void 0===e?void 0:e.scrollIntoView({behavior:"smooth"})}),0)}),[u]),Object(te.jsxs)(f.a.Fragment,{children:[Object(te.jsx)(fa,{open:Ge,existingCustomFieldNames:Object.keys(Ee),onProceed:ia,onCancel:function(){return Xe(!1)}}),Object(te.jsxs)(de.a,{open:a,maxWidth:"xs",fullWidth:!0,onClose:xa,children:[Object(te.jsx)(ba.a,{children:"Settings"}),Object(te.jsx)(Oe.a,{children:Object(te.jsxs)(Se.a,{container:!0,direction:"column",spacing:3,children:[Object(te.jsxs)(Se.a,{item:!0,id:"anki",children:[Object(te.jsx)(ya.a,{children:"Anki"}),Object(te.jsxs)(ma.a,{className:h.root,children:[Object(te.jsx)(ie.a,{label:"Anki Connect URL",value:g,error:Boolean(k),helperText:k,color:"secondary",onChange:Sn,InputProps:{endAdornment:Object(te.jsx)(we.a,{position:"end",children:Object(te.jsx)(Ce.a,{onClick:Cn,children:Object(te.jsx)(Pa.a,{})})})}}),Object(te.jsxs)(ka.a,{children:["Ensure that ",window.location.protocol+"//"+window.location.hostname," is in the webCorsOriginList in your AnkiConnect settings as in this"," ",Object(te.jsx)($t.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://youtu.be/Mv7fEVb6PHo?t=44",children:"video"}),"."]}),Object(te.jsx)(Na,{label:"Deck",value:P,selections:R,onChange:wn,onSelectionChange:Tn}),Object(te.jsx)(Na,{label:"Note Type",value:D,selections:H,onChange:Fn,onSelectionChange:Pn}),Object(te.jsx)(Na,{label:"Sentence Field",value:K,selections:ze,onChange:En,onSelectionChange:Mn}),Object(te.jsx)(Na,{label:"Definition Field",value:Y,selections:ze,onChange:In,onSelectionChange:Rn}),Object(te.jsx)(Na,{label:"Word Field",value:be,selections:ze,onChange:Dn,onSelectionChange:Ln}),Object(te.jsx)(Na,{label:"Audio Field",value:ee,selections:ze,onChange:Bn,onSelectionChange:An}),Object(te.jsx)(Na,{label:"Image Field",value:oe,selections:ze,onChange:Nn,onSelectionChange:_n}),Object(te.jsx)(Na,{label:"Source Field",value:ge,selections:ze,onChange:Wn,onSelectionChange:Un}),Object(te.jsx)(Na,{label:"URL Field",value:xe,selections:ze,onChange:Hn,onSelectionChange:zn}),Sa,Object(te.jsx)(ve.a,{className:h.addFieldButton,onClick:function(e){return Xe(!0)},children:"Add Custom Field"}),Object(te.jsx)(ce,{label:"Tags",helperText:"Comma-separated list of strings",fullWidth:!0,color:"secondary",tags:Be,onTagsChange:sa})]})]}),Object(te.jsxs)(Se.a,{item:!0,id:"mining",children:[Object(te.jsx)(ya.a,{children:"Mining"}),Object(te.jsxs)(ma.a,{className:h.root,children:[Object(te.jsx)(Oa.a,{control:Object(te.jsx)(Ia.a,{checked:Le,onChange:ua}),label:"Re-encode audio as mp3 (slower)",labelPlacement:"start",className:h.switchLabel}),Object(te.jsx)(Oa.a,{control:Object(te.jsx)(Ia.a,{checked:ln,onChange:da}),label:"Copy mined subtitles to clipboard",labelPlacement:"start",className:h.switchLabel}),Object(te.jsx)(ie.a,{type:"number",label:"Audio Padding Start",fullWidth:!0,value:Ze,color:"secondary",onChange:qn,inputProps:{min:0,step:1},InputProps:{endAdornment:Object(te.jsx)(we.a,{position:"end",children:"ms"})}}),Object(te.jsx)(ie.a,{type:"number",label:"Audio Padding End",fullWidth:!0,value:tt,color:"secondary",onChange:Vn,inputProps:{min:0,step:1},InputProps:{endAdornment:Object(te.jsx)(we.a,{position:"end",children:"ms"})}}),Object(te.jsx)(ie.a,{type:"number",label:"Max Image Width",fullWidth:!0,value:it,color:"secondary",onChange:Kn,inputProps:{min:0,step:1}}),Object(te.jsx)(ie.a,{type:"number",label:"Max Image Height",fullWidth:!0,value:ut,color:"secondary",onChange:Gn,inputProps:{min:0,step:1}}),Object(te.jsx)(ie.a,{type:"number",label:"Surrounding Subtitles Count Radius",fullWidth:!0,value:ft,color:"secondary",onChange:Xn,inputProps:{min:1,step:1}}),Object(te.jsx)(ie.a,{type:"number",label:"Surrounding Subtitles Time Radius",fullWidth:!0,value:gt,color:"secondary",onChange:Jn,inputProps:{min:0,step:1},InputProps:{endAdornment:Object(te.jsx)(we.a,{position:"end",children:"ms"})}})]})]}),Object(te.jsxs)(Se.a,{item:!0,id:"playback",children:[Object(te.jsx)(ya.a,{children:"Playback"}),Object(te.jsx)(ma.a,{children:Object(te.jsx)(Oa.a,{control:Object(te.jsx)(Ia.a,{checked:yn,onChange:pa}),label:"Remember subtitle offset",labelPlacement:"start",className:h.switchLabel})})]}),Object(te.jsxs)(Se.a,{item:!0,id:"auto-pause",children:[Object(te.jsxs)(Se.a,{container:!0,direction:"row",spacing:1,children:[Object(te.jsx)(Se.a,{item:!0,children:Object(te.jsx)(ya.a,{children:"Auto-pause Preference"})}),Object(te.jsx)(Se.a,{item:!0,children:Object(te.jsx)(Ne.a,{title:"Does not enable auto-pause. Sets the preference for when to pause when auto-pause is\r enabled.",placement:"top",children:Object(te.jsx)(ga.a,{fontSize:"small"})})})]}),Object(te.jsxs)(Ra.a,{row:!0,children:[Object(te.jsx)(Oa.a,{control:Object(te.jsx)(Ta.a,{checked:hn===A.atStart,value:A.atStart,onChange:ha}),label:"At Subtitle Start"}),Object(te.jsx)(Oa.a,{control:Object(te.jsx)(Ta.a,{checked:hn===A.atEnd,value:A.atEnd,onChange:ha}),label:"At Subtitle End"})]})]}),Object(te.jsxs)(Se.a,{item:!0,id:"video-subtitle-appearance",children:[Object(te.jsx)(ya.a,{children:"Video Subtitle Appearance"}),Object(te.jsxs)(ma.a,{className:h.root,children:[Object(te.jsx)("div",{className:h.subtitleSetting,children:Object(te.jsx)(ie.a,{type:"color",label:"Subtitle Color",fullWidth:!0,value:kt,color:"secondary",onChange:Yn})}),Object(te.jsx)("div",{className:h.subtitleSetting,children:Object(te.jsx)(ie.a,{type:"number",label:"Subtitle Size",fullWidth:!0,value:Ct,color:"secondary",onChange:Zn,inputProps:{min:1,step:1}})}),Object(te.jsx)("div",{className:h.subtitleSetting,children:Object(te.jsx)(ie.a,{type:"color",label:"Subtitle Outline Color",fullWidth:!0,value:Pt,color:"secondary",onChange:Qn})}),Object(te.jsx)("div",{className:h.subtitleSetting,children:Object(te.jsx)(ie.a,{type:"number",label:"Subtitle Outline Thickness",fullWidth:!0,value:Bt,onChange:$n,inputProps:{min:0,step:1},color:"secondary"})}),Object(te.jsx)("div",{className:h.subtitleSetting,children:Object(te.jsx)(ie.a,{type:"color",label:"Subtitle Background Color",fullWidth:!0,value:Dt,color:"secondary",onChange:ea})}),Object(te.jsx)("div",{className:h.subtitleSetting,children:Object(te.jsx)(ie.a,{type:"number",label:"Subtitle Background Opacity",fullWidth:!0,inputProps:{min:0,max:1,step:.1},value:Ht,color:"secondary",onChange:ta})}),Object(te.jsx)("div",{className:h.subtitleSetting,children:Object(te.jsx)(ie.a,{type:"text",label:"Subtitle Font Family",placeholder:"Inherited",fullWidth:!0,value:Kt,color:"secondary",onChange:na})}),Object(te.jsx)("div",{className:h.subtitleSetting,children:Object(te.jsx)(ie.a,{type:"number",label:"Image-based Subtitle Scale Factor",placeholder:"Inherited",fullWidth:!0,inputProps:{min:0,max:1,step:.1},value:Yt,color:"secondary",onChange:ra})}),Object(te.jsx)("div",{className:h.subtitlePreview,children:Object(te.jsx)("input",{value:tn,className:h.subtitlePreviewInput,onChange:aa,style:ja})})]})]}),Object(te.jsxs)(Se.a,{item:!0,id:"theme",children:[Object(te.jsx)(ya.a,{children:"Theme"}),Object(te.jsxs)("div",{children:[Object(te.jsx)(Oa.a,{control:Object(te.jsx)(Ta.a,{checked:"light"===on,value:"light",onChange:la}),label:"Light"}),Object(te.jsx)(Oa.a,{control:Object(te.jsx)(Ta.a,{checked:"dark"===on,value:"dark",onChange:la}),label:"Dark"})]})]}),Object(te.jsxs)(Se.a,{item:!0,id:"keyboard-shortcuts",children:[Object(te.jsx)(ya.a,{children:"Keyboard Shortcuts"}),Object(te.jsx)(ma.a,{children:Object.keys(_a).map((function(e){var t,a=e,r=_a[a];return Object(te.jsx)(Ua,{label:r.label,keys:n.installed&&r.extensionOverridden?null!==(t=n.extensionCommands[a])&&void 0!==t?t:"":jn[a].keys,extensionOverridden:n.installed&&r.extensionOverridden,onKeysChange:function(e){return va(e,a)},onOpenExtensionShortcuts:function(){return n.openShortcuts()}},e)}))})]})]})}),Object(te.jsx)(je.a,{children:Object(te.jsx)(ve.a,{onClick:xa,children:"OK"})})]})]})}var za=A.atEnd,qa={togglePlay:{keys:"space"},toggleAutoPause:{keys:Ma.isMacOs?"\u21e7+P":"shift+P"},toggleCondensedPlayback:{keys:Ma.isMacOs?"\u21e7+O":"shift+O"},toggleSubtitles:{keys:"S"},toggleVideoSubtitleTrack1:{keys:"1"},toggleVideoSubtitleTrack2:{keys:"2"},toggleAsbplayerSubtitleTrack1:{keys:"W+1"},toggleAsbplayerSubtitleTrack2:{keys:"W+2"},seekBackward:{keys:"A"},seekForward:{keys:"D"},seekToPreviousSubtitle:{keys:"left"},seekToNextSubtitle:{keys:"right"},seekToBeginningOfCurrentSubtitle:{keys:"down"},adjustOffsetToPreviousSubtitle:{keys:Ma.isMacOs?"\u21e7+left":"ctrl+left"},adjustOffsetToNextSubtitle:{keys:Ma.isMacOs?"\u21e7+right":"ctrl+right"},decreaseOffset:{keys:Ma.isMacOs?"\u21e7+\u2303+right":"ctrl+shift+right"},increaseOffset:{keys:Ma.isMacOs?"\u21e7+\u2303+left":"ctrl+shift+left"},copySubtitle:{keys:Ma.isMacOs?"\u21e7+\u2303+Z":"ctrl+shift+Z"},ankiExport:{keys:Ma.isMacOs?"\u21e7+\u2303+X":"ctrl+shift+X"},updateLastCard:{keys:Ma.isMacOs?"\u21e7+\u2303+U":"ctrl+shift+U"}},Va="ankiConnectUrl",Ka="deck",Ga="noteType",Xa="sentenceField",Ja="definitionField",Ya="audioField",Za="imageField",Qa="wordField",$a="sourceField",er="urlField",tr="customAnkiFields",nr="tags",ar="subtitleSize",rr="subtitleColor",ir="subtitleOutlineThickness",or="subtitleOutlineColor",cr="subtitleBackgroundColor",sr="subtitleBackgroundOpacity",ur="subtitleFontFamily",lr="subtitlePreview",dr="imageBasedSubtitleScaleFactor",br="audioPaddingStart",fr="audioPaddingEnd",hr="maxImageWidth",vr="maxImageHeight",pr="surroundingSubtitlesCountRadius",gr="surroundingSubtitlesTimeRadius",jr="preferMp3",Or="themeType",mr="copyToClipboardOnMine",kr="autoPausePreference",yr="keyBindSet",xr="rememberSubtitleOffset",Sr=function(){function e(){Object(k.a)(this,e),this._tags=void 0,this._keyBindSet=void 0,this._tags=this.tags,this._keyBindSet=this.keyBindSet}return Object(y.a)(e,[{key:"settings",get:function(){return{ankiConnectUrl:this.ankiConnectUrl,deck:this.deck,noteType:this.noteType,sentenceField:this.sentenceField,definitionField:this.definitionField,audioField:this.audioField,imageField:this.imageField,wordField:this.wordField,urlField:this.urlField,customAnkiFields:this.customAnkiFields,tags:this.tags,sourceField:this.sourceField,subtitleSize:this.subtitleSize,subtitleColor:this.subtitleColor,subtitleOutlineThickness:this.subtitleOutlineThickness,subtitleOutlineColor:this.subtitleOutlineColor,subtitleBackgroundColor:this.subtitleBackgroundColor,subtitleBackgroundOpacity:this.subtitleBackgroundOpacity,subtitleFontFamily:this.subtitleFontFamily,subtitlePreview:this.subtitlePreview,imageBasedSubtitleScaleFactor:this.imageBasedSubtitleScaleFactor,preferMp3:this.preferMp3,themeType:this.themeType,audioPaddingStart:this.audioPaddingStart,audioPaddingEnd:this.audioPaddingEnd,maxImageWidth:this.maxImageWidth,maxImageHeight:this.maxImageHeight,surroundingSubtitlesCountRadius:this.surroundingSubtitlesCountRadius,surroundingSubtitlesTimeRadius:this.surroundingSubtitlesTimeRadius,copyToClipboardOnMine:this.copyToClipboardOnMine,autoPausePreference:this.autoPausePreference,keyBindSet:this.keyBindSet,rememberSubtitleOffset:this.rememberSubtitleOffset}},set:function(e){this.ankiConnectUrl=e.ankiConnectUrl,this.deck=e.deck,this.noteType=e.noteType,this.sentenceField=e.sentenceField,this.definitionField=e.definitionField,this.audioField=e.audioField,this.imageField=e.imageField,this.wordField=e.wordField,this.sourceField=e.sourceField,this.urlField=e.urlField,this.tags=e.tags,this.subtitleSize=e.subtitleSize,this.subtitleColor=e.subtitleColor,this.subtitleOutlineThickness=e.subtitleOutlineThickness,this.subtitleOutlineColor=e.subtitleOutlineColor,this.subtitleBackgroundColor=e.subtitleBackgroundColor,this.subtitleBackgroundOpacity=e.subtitleBackgroundOpacity,this.subtitleFontFamily=e.subtitleFontFamily,this.subtitlePreview=e.subtitlePreview,this.imageBasedSubtitleScaleFactor=e.imageBasedSubtitleScaleFactor,this.customAnkiFields=e.customAnkiFields,this.preferMp3=e.preferMp3,this.themeType=e.themeType,this.audioPaddingStart=e.audioPaddingStart,this.audioPaddingEnd=e.audioPaddingEnd,this.maxImageWidth=e.maxImageWidth,this.maxImageHeight=e.maxImageHeight,this.surroundingSubtitlesCountRadius=e.surroundingSubtitlesCountRadius,this.surroundingSubtitlesTimeRadius=e.surroundingSubtitlesTimeRadius,this.copyToClipboardOnMine=e.copyToClipboardOnMine,this.autoPausePreference=e.autoPausePreference,this.keyBindSet=e.keyBindSet,this.rememberSubtitleOffset=e.rememberSubtitleOffset}},{key:"subtitleSettings",get:function(){return{subtitleSize:this.subtitleSize,subtitleColor:this.subtitleColor,subtitleOutlineThickness:this.subtitleOutlineThickness,subtitleOutlineColor:this.subtitleOutlineColor,subtitleBackgroundColor:this.subtitleBackgroundColor,subtitleBackgroundOpacity:this.subtitleBackgroundOpacity,subtitleFontFamily:this.subtitleFontFamily,imageBasedSubtitleScaleFactor:this.imageBasedSubtitleScaleFactor}}},{key:"ankiSettings",get:function(){return{ankiConnectUrl:this.ankiConnectUrl,deck:this.deck,noteType:this.noteType,sentenceField:this.sentenceField,definitionField:this.definitionField,audioField:this.audioField,imageField:this.imageField,wordField:this.wordField,sourceField:this.sourceField,urlField:this.urlField,customAnkiFields:this.customAnkiFields,tags:this.tags,preferMp3:this.preferMp3,audioPaddingStart:this.audioPaddingStart,audioPaddingEnd:this.audioPaddingEnd,maxImageWidth:this.maxImageWidth,maxImageHeight:this.maxImageHeight,surroundingSubtitlesCountRadius:this.surroundingSubtitlesCountRadius,surroundingSubtitlesTimeRadius:this.surroundingSubtitlesTimeRadius}}},{key:"miscSettings",get:function(){return{themeType:this.themeType,copyToClipboardOnMine:this.copyToClipboardOnMine,autoPausePreference:this.autoPausePreference,keyBindSet:this.keyBindSet,rememberSubtitleOffset:this.rememberSubtitleOffset}}},{key:"_getNumberItem",value:function(e,t){var n=localStorage.getItem(e);return null===n?t:Number(n)}},{key:"_setOptionalItem",value:function(e,t){"undefined"===typeof t?localStorage.removeItem(e):localStorage.setItem(e,t)}},{key:"ankiConnectUrl",get:function(){return localStorage.getItem(Va)||"http://127.0.0.1:8765"},set:function(e){localStorage.setItem(Va,e)}},{key:"deck",get:function(){var e;return null!==(e=localStorage.getItem(Ka))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Ka,e)}},{key:"noteType",get:function(){var e;return null!==(e=localStorage.getItem(Ga))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Ga,e)}},{key:"sentenceField",get:function(){var e;return null!==(e=localStorage.getItem(Xa))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Xa,e)}},{key:"definitionField",get:function(){var e;return null!==(e=localStorage.getItem(Ja))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Ja,e)}},{key:"audioField",get:function(){var e;return null!==(e=localStorage.getItem(Ya))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Ya,e)}},{key:"imageField",get:function(){var e;return null!==(e=localStorage.getItem(Za))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Za,e)}},{key:"wordField",get:function(){var e;return null!==(e=localStorage.getItem(Qa))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Qa,e)}},{key:"sourceField",get:function(){var e;return null!==(e=localStorage.getItem($a))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem($a,e)}},{key:"urlField",get:function(){var e;return null!==(e=localStorage.getItem(er))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(er,e)}},{key:"customAnkiFields",get:function(){var e=localStorage.getItem(tr);return e?JSON.parse(e):{}},set:function(e){localStorage.setItem(tr,JSON.stringify(e))}},{key:"tags",get:function(){if("undefined"!==typeof this._tags)return this._tags;var e=localStorage.getItem(nr);return e?(this._tags=JSON.parse(e),this._tags):[]},set:function(e){localStorage.setItem(nr,JSON.stringify(e)),this._tags=void 0}},{key:"subtitleColor",get:function(){return localStorage.getItem(rr)||"#ffffff"},set:function(e){localStorage.setItem(rr,e)}},{key:"subtitleSize",get:function(){return this._getNumberItem(ar,36)},set:function(e){localStorage.setItem(ar,String(e))}},{key:"subtitleOutlineColor",get:function(){return localStorage.getItem(or)||"#000000"},set:function(e){localStorage.setItem(or,e)}},{key:"subtitleOutlineThickness",get:function(){return this._getNumberItem(ir,0)},set:function(e){localStorage.setItem(ir,String(e))}},{key:"subtitleBackgroundColor",get:function(){return localStorage.getItem(cr)||"#000000"},set:function(e){localStorage.setItem(cr,e)}},{key:"subtitleBackgroundOpacity",get:function(){return this._getNumberItem(sr,.5)},set:function(e){localStorage.setItem(sr,String(e))}},{key:"subtitleFontFamily",get:function(){return localStorage.getItem(ur)||""},set:function(e){localStorage.setItem(ur,e)}},{key:"subtitlePreview",get:function(){return localStorage.getItem(lr)||"\u30a2\u3042\u5b89"},set:function(e){localStorage.setItem(lr,e)}},{key:"imageBasedSubtitleScaleFactor",get:function(){return this._getNumberItem(dr,1)},set:function(e){localStorage.setItem(dr,String(e))}},{key:"preferMp3",get:function(){return"true"===localStorage.getItem(jr)||!1},set:function(e){localStorage.setItem(jr,String(e))}},{key:"themeType",get:function(){var e=localStorage.getItem(Or);return null===e?"dark":e},set:function(e){localStorage.setItem(Or,e)}},{key:"audioPaddingStart",get:function(){var e=localStorage.getItem(br);return e?Number(e):0},set:function(e){localStorage.setItem(br,String(e))}},{key:"audioPaddingEnd",get:function(){return this._getNumberItem(fr,500)},set:function(e){localStorage.setItem(fr,String(e))}},{key:"maxImageWidth",get:function(){var e=localStorage.getItem(hr);return e?Number(e):0},set:function(e){localStorage.setItem(hr,String(e))}},{key:"maxImageHeight",get:function(){return this._getNumberItem(vr,0)},set:function(e){localStorage.setItem(vr,String(e))}},{key:"surroundingSubtitlesCountRadius",get:function(){return this._getNumberItem(pr,2)},set:function(e){localStorage.setItem(pr,String(e))}},{key:"surroundingSubtitlesTimeRadius",get:function(){return this._getNumberItem(gr,1e4)},set:function(e){localStorage.setItem(gr,String(e))}},{key:"copyToClipboardOnMine",get:function(){return"true"===localStorage.getItem(mr)||!1},set:function(e){localStorage.setItem(mr,String(e))}},{key:"autoPausePreference",get:function(){return this._getNumberItem(kr,za)},set:function(e){localStorage.setItem(kr,String(e))}},{key:"keyBindSet",get:function(){if(void 0!==this._keyBindSet)return this._keyBindSet;var e=localStorage.getItem(yr);if(null===e)return this._keyBindSet=qa,qa;for(var t=JSON.parse(e),n=0,a=Object.keys(qa);n<a.length;n++){var r=a[n];void 0===t[r]&&(t[r]=qa[r])}return this._keyBindSet=t,t},set:function(e){localStorage.setItem(yr,JSON.stringify(e)),this._keyBindSet=void 0}},{key:"rememberSubtitleOffset",get:function(){return"true"===localStorage.getItem(xr)||!1},set:function(e){localStorage.setItem(xr,String(e))}}]),e}(),Cr=function(){function e(t){Object(k.a)(this,e),this.channel=void 0,this.time=void 0,this.readyCallbacks=void 0,this.playCallbacks=void 0,this.pauseCallbacks=void 0,this.currentTimeCallbacks=void 0,this.audioTrackSelectedCallbacks=void 0,this.closeCallbacks=void 0,this.subtitlesCallbacks=void 0,this.offsetCallbacks=void 0,this.playModeCallbacks=void 0,this.hideSubtitlePlayerToggleCallbacks=void 0,this.appBarToggleCallbacks=void 0,this.ankiDialogRequestCallbacks=void 0,this.finishedAnkiDialogRequestCallbacks=void 0,this.subtitleSettingsCallbacks=void 0,this.miscSettingsCallbacks=void 0,this.ankiSettingsCallbacks=void 0,this.channel=new BroadcastChannel(t),this.time=0,this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.closeCallbacks=[],this.readyCallbacks=[],this.subtitlesCallbacks=[],this.offsetCallbacks=[],this.playModeCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.finishedAnkiDialogRequestCallbacks=[],this.subtitleSettingsCallbacks=[],this.miscSettingsCallbacks=[],this.ankiSettingsCallbacks=[];var n=this;this.channel.onmessage=function(e){switch(e.data.command){case"init":break;case"ready":var t,a=e.data,i=Object(r.a)(n.readyCallbacks);try{for(i.s();!(t=i.n()).done;){(0,t.value)(a.duration)}}catch(G){i.e(G)}finally{i.f()}break;case"play":var o,c=Object(r.a)(n.playCallbacks);try{for(c.s();!(o=c.n()).done;){(0,o.value)()}}catch(G){c.e(G)}finally{c.f()}break;case"pause":var s,u=Object(r.a)(n.pauseCallbacks);try{for(u.s();!(s=u.n()).done;){(0,s.value)()}}catch(G){u.e(G)}finally{u.f()}break;case"currentTime":var l,d=e.data,b=Object(r.a)(n.currentTimeCallbacks);try{for(b.s();!(l=b.n()).done;){(0,l.value)(d.value)}}catch(G){b.e(G)}finally{b.f()}break;case"audioTrackSelected":var f,h=e.data,v=Object(r.a)(n.audioTrackSelectedCallbacks);try{for(v.s();!(f=v.n()).done;){(0,f.value)(h.id)}}catch(G){v.e(G)}finally{v.f()}break;case"close":var p,g=Object(r.a)(n.closeCallbacks);try{for(g.s();!(p=g.n()).done;){(0,p.value)()}}catch(G){g.e(G)}finally{g.f()}break;case"subtitles":var j,O=e.data,m=Object(r.a)(n.subtitlesCallbacks);try{for(m.s();!(j=m.n()).done;){(0,j.value)(O.value)}}catch(G){m.e(G)}finally{m.f()}break;case"offset":var k,y=e.data,x=Object(r.a)(n.offsetCallbacks);try{for(x.s();!(k=x.n()).done;){(0,k.value)(y.value)}}catch(G){x.e(G)}finally{x.f()}break;case"subtitleSettings":var S,C=e.data,w=Object(r.a)(n.subtitleSettingsCallbacks);try{for(w.s();!(S=w.n()).done;){(0,S.value)(C.value)}}catch(G){w.e(G)}finally{w.f()}break;case"playMode":var T,F=e.data,P=Object(r.a)(n.playModeCallbacks);try{for(P.s();!(T=P.n()).done;){(0,T.value)(F.playMode)}}catch(G){P.e(G)}finally{P.f()}break;case"hideSubtitlePlayerToggle":var E,M=e.data,I=Object(r.a)(n.hideSubtitlePlayerToggleCallbacks);try{for(I.s();!(E=I.n()).done;){(0,E.value)(M.value)}}catch(G){I.e(G)}finally{I.f()}break;case"appBarToggle":var R,B=e.data,A=Object(r.a)(n.appBarToggleCallbacks);try{for(A.s();!(R=A.n()).done;){(0,R.value)(B.value)}}catch(G){A.e(G)}finally{A.f()}break;case"ankiDialogRequest":var N,_=Object(r.a)(n.ankiDialogRequestCallbacks);try{for(_.s();!(N=_.n()).done;){(0,N.value)()}}catch(G){_.e(G)}finally{_.f()}break;case"finishedAnkiDialogRequest":var D,L=e.data,W=Object(r.a)(n.finishedAnkiDialogRequestCallbacks);try{for(W.s();!(D=W.n()).done;){(0,D.value)(L.resume)}}catch(G){W.e(G)}finally{W.f()}break;case"ankiSettings":var U,H=e.data,z=Object(r.a)(n.ankiSettingsCallbacks);try{for(z.s();!(U=z.n()).done;){(0,U.value)(H.value)}}catch(G){z.e(G)}finally{z.f()}break;case"miscSettings":var q,V=e.data,K=Object(r.a)(n.miscSettingsCallbacks);try{for(K.s();!(q=K.n()).done;){(0,q.value)(V.value)}}catch(G){K.e(G)}finally{K.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(y.a)(e,[{key:"currentTime",set:function(e){var t;this.time=e,null===(t=this.channel)||void 0===t||t.postMessage({command:"currentTime",value:this.time,echo:!0})}},{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onClose",value:function(e){this.closeCallbacks.push(e)}},{key:"onReady",value:function(e){this.readyCallbacks.push(e)}},{key:"onSubtitles",value:function(e){this.subtitlesCallbacks.push(e)}},{key:"onOffset",value:function(e){this.offsetCallbacks.push(e)}},{key:"onPlayMode",value:function(e){this.playModeCallbacks.push(e)}},{key:"onHideSubtitlePlayerToggle",value:function(e){this.hideSubtitlePlayerToggleCallbacks.push(e)}},{key:"onAppBarToggle",value:function(e){this.appBarToggleCallbacks.push(e)}},{key:"onAnkiDialogRequest",value:function(e){this.ankiDialogRequestCallbacks.push(e)}},{key:"onFinishedAnkiDialogRequest",value:function(e){this.finishedAnkiDialogRequestCallbacks.push(e)}},{key:"onSubtitleSettings",value:function(e){this.subtitleSettingsCallbacks.push(e)}},{key:"onMiscSettings",value:function(e){this.miscSettingsCallbacks.push(e)}},{key:"onAnkiSettings",value:function(e){this.ankiSettingsCallbacks.push(e)}},{key:"ready",value:function(e,t,n,a){var r,i={command:"ready",duration:e,paused:t,currentTime:0,audioTracks:n,selectedAudioTrack:a,playbackRate:1};null===(r=this.channel)||void 0===r||r.postMessage(i)}},{key:"readyState",value:function(e){var t,n={command:"readyState",value:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"play",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"play",echo:!0})}},{key:"pause",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"pause",echo:!0})}},{key:"audioTrackSelected",value:function(e){var t,n={command:"audioTrackSelected",id:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"offset",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t,n={command:"offset",value:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}))},{key:"popOutToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"popOutToggle"})}},{key:"copy",value:function(e,t,n,a){var r,i={command:"copy",subtitle:e,surroundingSubtitles:t,preventDuplicate:a,postMineAction:n};null===(r=this.channel)||void 0===r||r.postMessage(i)}},{key:"playMode",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"playMode",playMode:e})}))},{key:"hideSubtitlePlayerToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"hideSubtitlePlayerToggle"})}},{key:"appBarToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"appBarToggle"})}},{key:"ankiDialogRequest",value:function(e){var t,n={command:"ankiDialogRequest",forwardToVideo:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"toggleSubtitleTrackInList",value:function(e){var t,n={command:"toggleSubtitleTrackInList",track:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"close",value:function(){this.channel&&(this.channel.postMessage({command:"exit"}),this.channel.close(),this.channel=void 0,this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.closeCallbacks=[],this.readyCallbacks=[],this.subtitlesCallbacks=[],this.offsetCallbacks=[],this.playModeCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.finishedAnkiDialogRequestCallbacks=[],this.subtitleSettingsCallbacks=[],this.miscSettingsCallbacks=[],this.ankiSettingsCallbacks=[])}}]),e}(),wr=function(){function e(t,n){var a=this;Object(k.a)(this,e),this.defaultKeyBinder=void 0,this.extension=void 0,this.copyHandlers=[],this.ankiExportHandlers=[],this.updateLastCardHandlers=[],this.onExtensionMessage=void 0,this.defaultKeyBinder=t,this.extension=n,this.onExtensionMessage=function(e){if("copy-subtitle"===e.data.command){var t,n=e.data;switch(n.postMineAction){case B.none:t=a.copyHandlers;break;case B.showAnkiDialog:t=a.ankiExportHandlers;break;case B.updateLastCard:t=a.updateLastCardHandlers;break;default:console.error("Unknown post mine action "+n.postMineAction)}var i,o=Object(r.a)(t);try{for(o.s();!(i=o.n()).done;){(0,i.value)(new KeyboardEvent("mock"))}}catch(c){o.e(c)}finally{o.f()}}},n.subscribe(this.onExtensionMessage)}return Object(y.a)(e,[{key:"bindCopy",value:function(e,t,n,a){var r=this;if(this.extension.installed){var i=this.defaultKeyBinder.copyHandler(e,t,n);return this.copyHandlers.push(i),function(){r._remove(i,r.copyHandlers)}}return this.defaultKeyBinder.bindCopy(e,t,n,a)}},{key:"bindAnkiExport",value:function(e,t,n){var a=this;if(this.extension.installed){var r=this.defaultKeyBinder.ankiExportHandler(e,t);return this.ankiExportHandlers.push(r),function(){a._remove(r,a.ankiExportHandlers)}}return this.defaultKeyBinder.bindAnkiExport(e,t,n)}},{key:"bindUpdateLastCard",value:function(e,t,n){var a=this;if(this.extension.installed){var r=this.defaultKeyBinder.updateLastCardHandler(e,t);return this.updateLastCardHandlers.push(r),function(){a._remove(r,a.updateLastCardHandlers)}}return this.defaultKeyBinder.bindUpdateLastCard(e,t,n)}},{key:"_remove",value:function(e,t){for(var n=t.length-1;n>=0;--n)if(e===t[n]){t.splice(n,1);break}}},{key:"bindSeekToSubtitle",value:function(e,t,n,a,r){return this.defaultKeyBinder.bindSeekToSubtitle(e,t,n,a,r)}},{key:"bindSeekToBeginningOfCurrentSubtitle",value:function(e,t,n,a,r){return this.defaultKeyBinder.bindSeekToBeginningOfCurrentSubtitle(e,t,n,a,r)}},{key:"bindSeekBackwardOrForward",value:function(e,t,n){return this.defaultKeyBinder.bindSeekBackwardOrForward(e,t,n)}},{key:"bindOffsetToSubtitle",value:function(e,t,n,a,r){return this.defaultKeyBinder.bindOffsetToSubtitle(e,t,n,a,r)}},{key:"bindAdjustOffset",value:function(e,t,n,a){return this.defaultKeyBinder.bindAdjustOffset(e,t,n,a)}},{key:"bindToggleSubtitles",value:function(e,t,n){return this.defaultKeyBinder.bindToggleSubtitles(e,t,n)}},{key:"bindToggleSubtitleTrackInVideo",value:function(e,t,n){return this.defaultKeyBinder.bindToggleSubtitleTrackInVideo(e,t,n)}},{key:"bindToggleSubtitleTrackInList",value:function(e,t,n){return this.defaultKeyBinder.bindToggleSubtitleTrackInList(e,t,n)}},{key:"bindPlay",value:function(e,t,n){return this.defaultKeyBinder.bindPlay(e,t,n)}},{key:"bindAutoPause",value:function(e,t,n){return this.defaultKeyBinder.bindAutoPause(e,t,n)}},{key:"bindCondensedPlayback",value:function(e,t,n){return this.defaultKeyBinder.bindCondensedPlayback(e,t,n)}}]),e}(),Tr=Object(p.a)({root:{position:"relative",backgroundColor:"black",height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},video:{margin:"auto"},cursorHidden:{cursor:"none"},subtitleContainer:{position:"absolute",paddingLeft:20,paddingRight:20,bottom:100,textAlign:"center",whiteSpace:"pre-wrap",lineHeight:"normal"}});function Fr(e,t,n,a){if(window.outerWidth&&e.videoWidth>0&&e.videoHeight>0){var i=window.screen.availWidth-(window.outerWidth-window.innerWidth),o=window.screen.availHeight-(window.outerHeight-window.innerHeight),c=Math.min(1,Math.min(i/e.videoWidth,o/e.videoHeight));window.resizeTo(c*e.videoWidth+(window.outerWidth-window.innerWidth),c*e.videoHeight+(window.outerHeight-window.innerHeight))}var s,u;if(e.audioTracks){s=[];var l,d=Object(r.a)(e.audioTracks);try{for(d.s();!(l=d.n()).done;){var b=l.value;s.push({id:b.id,label:b.label,language:b.language}),b.enabled&&(u=b.id)}}catch(f){d.e(f)}finally{d.f()}}else s=void 0,u=void 0;n(s),a(u),t.ready(e.duration,e.paused,s,u)}function Pr(e){var t=e.settingsProvider,n=e.playbackPreferences,a=e.extension,i=e.videoFile,u=e.channel,l=e.popOut,h=e.onError,v=e.onPlayModeChangedViaBind,p=Tr(),g=Object(b.useRef)(),j=Object(b.useRef)(),m=O(!0),k=Object(s.a)(m,2),y=k[0],x=k[1];j.current&&(j.current.width=y,j.current.height=x);var C=Object(b.useMemo)((function(){return new Cr(u)}),[u]),w=Object(b.useState)(!1),T=Object(s.a)(w,2),F=T[0],I=T[1],R=function(){var e=Object(b.useState)(Boolean(document.fullscreenElement)),t=Object(s.a)(e,2),n=t[0],a=t[1];return Object(b.useEffect)((function(){var e=function(){return a(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",e),function(){return document.removeEventListener("fullscreenchange",e)}}),[]),n}(),_=Object(b.useRef)();_.current=R;var D=Object(b.useRef)();D.current=F;var L=Object(b.useState)(0),W=Object(s.a)(L,2),U=W[0],H=W[1],z=Object(b.useState)(0),q=Object(s.a)(z,2),V=q[0],K=q[1],G=Object(b.useState)(),X=Object(s.a)(G,2),J=X[0],Z=X[1],Q=Object(b.useState)(),$=Object(s.a)(Q,2),ee=$[0],ne=$[1],re=Object(b.useState)([]),ie=Object(s.a)(re,2),oe=ie[0],ce=ie[1],se=Object(b.useMemo)((function(){return new Y(oe,{returnLastShown:!1,showingCheckRadiusMs:150})}),[oe]),ue=Object(b.useState)([]),le=Object(s.a)(ue,2),de=le[0],be=le[1],fe=Object(b.useState)(),he=Object(s.a)(fe,2),ve=he[0],pe=he[1],ge=Object(b.useState)(),je=Object(s.a)(ge,2),Oe=je[0],me=je[1],ke=Object(b.useState)(!0),ye=Object(s.a)(ke,2),xe=ye[0],Se=ye[1],Ce=Object(b.useState)({}),we=Object(s.a)(Ce,2),Te=we[0],Fe=we[1],Pe=Object(b.useState)(N.normal),Ee=Object(s.a)(Pe,2),Me=Ee[0],Ie=Ee[1],Re=Object(b.useState)(!1),Be=Object(s.a)(Re,2),Ae=Be[0],Ne=Be[1],_e=Object(b.useState)(n.theaterMode),De=Object(s.a)(_e,2),Le=De[0],We=De[1],Ue=Object(b.useRef)([]);Ue.current=de;var ze=Object(b.useMemo)((function(){return new rn}),[]),qe=Object(b.useRef)({x:0,y:0}),Ve=Object(b.useState)(!1),Ke=Object(s.a)(Ve,2),Ge=Ke[0],Xe=Ke[1],Je=Object(b.useRef)(0),Ye=Object(b.useRef)(null),Ze=Object(b.useState)(),Qe=Object(s.a)(Ze,2),$e=Qe[0],et=Qe[1],tt=Object(b.useState)(!1),nt=Object(s.a)(tt,2),at=nt[0],rt=nt[1],it=Object(b.useState)(!1),ot=Object(s.a)(it,2),ct=ot[0],st=ot[1],ut=Object(b.useRef)();ut.current=ct;var lt=Object(b.useState)(t.miscSettings),dt=Object(s.a)(lt,2),bt=dt[0],ft=dt[1],ht=Object(b.useState)(t.subtitleSettings),vt=Object(s.a)(ht,2),pt=vt[0],gt=vt[1],jt=Object(b.useState)(t.ankiSettings),Ot=Object(s.a)(jt,2),mt=Ot[0],kt=Ot[1],yt=Object(b.useMemo)((function(){return new wr(new S(bt.keyBindSet),a)}),[bt.keyBindSet,a]),xt=Object(b.useCallback)((function(e){if(e){var t=e;j.current=t,4===t.readyState?Fr(t,C,Z,ne):t.onloadeddata=function(e){Fr(t,C,Z,ne)},t.oncanplay=function(e){C.readyState(4),D.current&&ze.start()},t.ontimeupdate=function(t){return ze.setTime(1e3*e.currentTime)},t.onerror=function(t){return h(function(e){var t,n,a;switch(null===(t=e.error)||void 0===t?void 0:t.code){case 1:a="Aborted";break;case 2:a="Network error";break;case 3:a="Decoding error";break;case 4:a="Source not supported";break;default:a="Unknown error"}return a+": "+((null===(n=e.error)||void 0===n?void 0:n.message)||"<details missing>")}(e))}}}),[ze,C,h]);function St(e){var t,n=null===(t=j.current)||void 0===t?void 0:t.audioTracks;if(n){var a,i=Object(r.a)(n);try{for(i.s();!(a=i.n()).done;){var o=a.value;o.id===e?o.enabled=!0:o.enabled=!1}}catch(c){i.e(c)}finally{i.f()}}}var Ct=Object(b.useCallback)((function(e){K(e),ce((function(t){return t.map((function(t,n){return{text:t.text,textImage:t.textImage,start:t.originalStart+e,originalStart:t.originalStart,end:t.originalEnd+e,originalEnd:t.originalEnd,track:t.track,index:n}}))}))}),[]);Object(b.useEffect)((function(){return C.onReady((function(e){return H(e)})),C.onPlay(Object(c.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=j.current)||void 0===t?void 0:t.play();case 2:ze.start(),I(!0);case 4:case"end":return e.stop()}}),e)})))),C.onPause((function(){var e;null===(e=j.current)||void 0===e||e.pause(),ze.stop(),I(!1)})),C.onCurrentTime((function(e){var t;j.current&&(j.current.currentTime=e),4===(null===(t=j.current)||void 0===t?void 0:t.readyState)&&C.readyState(4),ze.stop(),ze.setTime(1e3*e)})),C.onAudioTrackSelected((function(e){St(e),ne(e),C.audioTrackSelected(e)})),C.onClose((function(){C.close(),window.close()})),C.onSubtitles((function(e){if(ce(e.map((function(e,t){return Object(o.a)(Object(o.a)({},e),{},{index:t})}))),e&&e.length>0){var t=e[0],n=t.start-t.originalStart;K(n)}})),C.onPlayMode((function(e){return Ie(e)})),C.onHideSubtitlePlayerToggle((function(e){return Ne(e)})),C.onAppBarToggle((function(e){return We(e)})),C.onAnkiDialogRequest((function(){_.current&&!l&&(document.exitFullscreen(),st(!0))})),C.onFinishedAnkiDialogRequest(function(){var e=Object(c.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ut.current){e.next=11;break}if(!t){e.next=10;break}return e.prev=2,e.next=5,null===(n=Ye.current)||void 0===n?void 0:n.requestFullscreen();case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.error(e.t0);case 10:st(!1);case 11:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}()),C.onSubtitleSettings(gt),C.onMiscSettings(ft),C.onAnkiSettings(kt),C.onOffset(Ct),window.onbeforeunload=function(e){g.current||C.close()},function(){return C.close()}}),[ze,C,Ct,l]);var wt=Object(b.useCallback)((function(){j.current&&C.play()}),[C]),Tt=Object(b.useCallback)((function(){return C.pause()}),[C]),Ft=Object(b.useCallback)((function(e){D.current&&ze.stop();var t=e*U;C.currentTime=t/1e3}),[U,ze,C]);var Pt=Object(b.useCallback)((function(e){D.current&&(ze.stop(),C.pause()),St(e),ne(e),C.currentTime=0,C.audioTrackSelected(e)}),[C,ze]);Object(b.useEffect)((function(){if(oe&&0!==oe.length){var e=setInterval((function(){var e,t=ze.time(U),n=[],a=se.subtitlesAt(t),i=Object(r.a)(a.showing);try{for(i.s();!(e=i.n()).done;){var o=e.value;Te[o.track]||n.push(o)}}catch(c){i.e(c)}finally{i.f()}Me===N.autoPause&&(bt.autoPausePreference===A.atStart?a.startedShowing&&a.startedShowing!==ve&&!Te[a.startedShowing.track]&&(C.pause(),pe(a.startedShowing)):a.willStopShowing&&a.willStopShowing!==Oe&&!Te[a.willStopShowing.track]&&(C.pause(),me(a.willStopShowing))),function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};if(e.length!==t.length)return!1;for(var a=0;a<e.length;++a)if(!n(e[a],t[a]))return!1;return!0}(n=n.sort((function(e,t){return e.track-t.track})),Ue.current,(function(e,t){return e.index===t.index}))||be(n)}),100);return function(){return clearTimeout(e)}}}),[se,C,Me,oe,Te,ze,U,bt,ve,Oe]);var Et=Object(b.useCallback)((function(e){Ct(e),C.offset(e)}),[C,Ct]);Object(b.useEffect)((function(){return yt.bindSeekToSubtitle((function(e,t){e.stopPropagation(),e.preventDefault(),C.currentTime=t.start/1e3}),(function(){return!j.current}),(function(){return ze.time(U)}),(function(){return oe}))}),[yt,C,oe,U,ze]),Object(b.useEffect)((function(){return yt.bindSeekToBeginningOfCurrentSubtitle((function(e,t){e.stopPropagation(),e.preventDefault(),C.currentTime=t.start/1e3}),(function(){return!j.current}),(function(){return ze.time(U)}),(function(){return oe}))}),[yt,C,oe,U,ze]),Object(b.useEffect)((function(){return yt.bindSeekBackwardOrForward((function(e,t){e.stopPropagation(),e.preventDefault();var n=ze.time(U);C.currentTime=t?Math.min(U/1e3,(n+1e4)/1e3):Math.max(0,(n-1e4)/1e3)}),(function(){return!j.current}))}),[yt,C,U,ze]);var Mt=Object(b.useCallback)((function(e){return E(oe,e,mt.surroundingSubtitlesCountRadius,mt.surroundingSubtitlesTimeRadius)}),[oe,mt.surroundingSubtitlesCountRadius,mt.surroundingSubtitlesTimeRadius]);Object(b.useEffect)((function(){return yt.bindCopy((function(e,t){e.stopPropagation(),e.preventDefault();var n=!oe||0===oe.length;C.copy(t,n?M(t,U,5e3):Mt(t.index),B.none),R&&(et(""===t.text?"Saved ".concat(P(t.start)):'Copied: "'.concat(t.text,'"')),rt(!0))}),(function(){return!1}),(function(){if(!oe||0===oe.length){var e=ze.time(U),t=Math.min(e+5e3,U);return{text:"",start:e,originalStart:e,end:t,originalEnd:t,track:0,index:0}}if(Ue.current&&0!==Ue.current.length)return Ue.current[0]}))}),[yt,C,ze,U,oe,Mt,R]),Object(b.useEffect)((function(){return yt.bindAdjustOffset((function(e,t){e.preventDefault(),e.stopPropagation(),Et(t)}),(function(){return!1}),(function(){return oe}))}),[yt,Et,oe]),Object(b.useEffect)((function(){return yt.bindToggleSubtitles((function(e){e.preventDefault(),e.stopPropagation(),Se((function(e){return!e}))}),(function(){return!1}))}),[yt]),Object(b.useEffect)((function(){return yt.bindToggleSubtitleTrackInVideo((function(e,t){e.preventDefault(),e.stopPropagation(),Fe((function(e){var n=Object(o.a)({},e);return n[t]=!e[t],n}))}),(function(){return!1}))}),[yt]),Object(b.useEffect)((function(){return yt.bindToggleSubtitleTrackInList((function(e,t){e.preventDefault(),e.stopPropagation(),C.toggleSubtitleTrackInList(t)}),(function(){return!1}))}),[yt,C]),Object(b.useEffect)((function(){return yt.bindOffsetToSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),Et(t)}),(function(){return!1}),(function(){return ze.time(U)}),(function(){return oe}))}),[yt,Et,oe,ze,U]);var Rt=Object(b.useCallback)((function(e,t){if(oe&&0!==oe.length){if(Ue.current&&Ue.current.length>0){var n=Ue.current[0];t(n,Mt(n.index))}}else{var a=ze.time(U),r=Math.min(a+5e3,U),i={text:"",start:a,originalStart:a,end:r,originalEnd:r,track:0};e(i,M(i,U,5e3))}}),[oe,Mt,U,ze]);Object(b.useEffect)((function(){return yt.bindAnkiExport((function(e){e.preventDefault(),e.stopPropagation(),Rt((function(e,t){return C.copy(e,t,B.showAnkiDialog,!1)}),(function(e,t){return C.copy(e,t,B.showAnkiDialog,!0)}))}),(function(){return!1}))}),[yt,C,Rt,R]),Object(b.useEffect)((function(){return yt.bindUpdateLastCard((function(e){e.preventDefault(),e.stopPropagation(),Rt((function(e,t){return C.copy(e,t,B.updateLastCard,!1)}),(function(e,t){return C.copy(e,t,B.updateLastCard,!0)}))}),(function(){return!1}))}),[yt,C,Rt]),Object(b.useEffect)((function(){return yt.bindPlay((function(e){e.preventDefault(),F?C.pause():C.play()}),(function(){return!1}))}),[yt,F,C]);var Bt=Object(b.useCallback)((function(e,t){e.preventDefault();var n=Me===t?N.normal:t;C.playMode(n),v(Me,n)}),[Me,C,v]);Object(b.useEffect)((function(){return yt.bindAutoPause((function(e){return Bt(e,N.autoPause)}),(function(){return!1}))}),[yt,Bt]),Object(b.useEffect)((function(){return yt.bindCondensedPlayback((function(e){return Bt(e,N.condensed)}),(function(){return!1}))}),[yt,Bt]);var At=Object(b.useCallback)((function(){return Se((function(e){return!e}))}),[]),Nt=Object(b.useCallback)((function(){var e;R?document.exitFullscreen():null===(e=Ye.current)||void 0===e||e.requestFullscreen()}),[R]),_t=Object(b.useCallback)((function(e){j.current&&(j.current.volume=e)}),[]),Dt=Object(b.useCallback)((function(){C.popOutToggle(),l&&(g.current=!0,window.close())}),[C,l]),Lt=Object(b.useCallback)((function(e){C.playMode(e)}),[C]),Wt=Object(b.useCallback)((function(){C.close(),window.close()}),[C]),Ut=Object(b.useCallback)((function(){C.hideSubtitlePlayerToggle()}),[C]),Ht=Object(b.useCallback)((function(){C.appBarToggle()}),[C]),zt=Object(b.useCallback)((function(){F?C.pause():C.play()}),[C,F]),qt=Object(b.useCallback)((function(){return Nt()}),[Nt]),Vt=Object(b.useCallback)((function(){return rt(!1)}),[]),Kt=pt.subtitleSize,Gt=pt.subtitleColor,Xt=pt.subtitleOutlineThickness,Jt=pt.subtitleOutlineColor,Yt=pt.subtitleBackgroundColor,Zt=pt.subtitleBackgroundOpacity,Qt=pt.subtitleFontFamily,$t=pt.imageBasedSubtitleScaleFactor,en=Object(b.useMemo)((function(){return It({subtitleSize:Kt,subtitleColor:Gt,subtitleOutlineThickness:Xt,subtitleOutlineColor:Jt,subtitleBackgroundColor:Yt,subtitleBackgroundOpacity:Zt,subtitleFontFamily:Qt})}),[Kt,Gt,Xt,Jt,Yt,Zt,Qt]);return Object(b.useEffect)((function(){var e=setInterval((function(){Date.now()-Je.current>300?Ge&&Xe(!1):Ge||Xe(!0)}),100);return function(){return clearInterval(e)}}),[Ge]),Object(te.jsxs)("div",{ref:Ye,onMouseMove:function(e){if(Je.current=Date.now(),Ye.current){var t=Ye.current.getBoundingClientRect();qe.current.x=e.clientX-t.left,qe.current.y=e.clientY-t.top}},className:p.root,children:[Object(te.jsx)("video",{preload:"auto",controls:!1,onClick:zt,onDoubleClick:qt,className:Ge?p.video:"".concat(p.cursorHidden," ").concat(p.video),ref:xt,src:i}),xe&&Object(te.jsx)("div",{className:p.subtitleContainer,children:de.map((function(e,t){var n,a,r;e.textImage?n=Object(te.jsx)(He,{availableWidth:null!==(a=null===(r=j.current)||void 0===r?void 0:r.width)&&void 0!==a?a:window.screen.availWidth,subtitle:e,scale:$t}):n=Object(te.jsx)("span",{style:en,children:e.text});return t<de.length-1?Object(te.jsxs)(f.a.Fragment,{children:[n,Object(te.jsx)("br",{})]},e.index):Object(te.jsx)(f.a.Fragment,{children:n},e.index)}))}),R&&Object(te.jsx)(ae,{open:at,onClose:Vt,autoHideDuration:3e3,severity:"success",children:$e}),Object(te.jsx)(Xn,{mousePositionRef:qe,playing:F,clock:ze,length:U,audioTracks:J,selectedAudioTrack:ee,subtitlesToggle:oe&&oe.length>0,subtitlesEnabled:xe,offsetEnabled:!0,offset:V,fullscreenEnabled:!0,fullscreen:R,closeEnabled:!l,popOut:l,volumeEnabled:!0,popOutEnabled:!Ma.isMobile,playModeEnabled:oe&&oe.length>0,playMode:Me,hideSubtitlePlayerToggleEnabled:(null===oe||void 0===oe?void 0:oe.length)>0&&!l&&!R,subtitlePlayerHidden:Ae,onPlay:wt,onPause:Tt,onSeek:Ft,onAudioTrackSelected:Pt,onSubtitlesToggle:At,onFullscreenToggle:Nt,onVolumeChange:_t,onOffsetChange:Et,onPopOutToggle:Dt,onPlayMode:Lt,onClose:Wt,onHideSubtitlePlayerToggle:Ut,playbackPreferences:n,showOnMouseMovement:!1,theaterModeToggleEnabled:!l&&!R,theaterModeEnabled:Le,onTheaterModeToggle:Ht})]})}var Er=Object(Z.a)(),Mr=function(){function e(t,n){var a=this;Object(k.a)(this,e),this.version=void 0,this.extensionCommands=void 0,this.tabs=void 0,this.installed=void 0,this.windowEventListener=void 0,this.onMessageCallbacks=void 0,this.onTabsCallbacks=void 0,this.heartbeatStarted=!1,this.onMessageCallbacks=[],this.onTabsCallbacks=[],this.tabs=[],this.installed=void 0!==t,this.version=null!==t&&void 0!==t?t:"",this.extensionCommands=null!==n&&void 0!==n?n:{},this.windowEventListener=function(e){if(e.source===window&&"asbplayer-extension-to-player"===e.data.sender&&e.data.message)if("tabs"===e.data.message.command){var t=e.data;a.tabs=t.message.tabs;var n,i=Object(r.a)(a.onTabsCallbacks);try{for(i.s();!(n=i.n()).done;){(0,n.value)(a.tabs)}}catch(u){i.e(u)}finally{i.f()}t.message.ackRequested&&window.postMessage({sender:"asbplayerv2",message:{command:"ackTabs",id:Er,receivedTabs:a.tabs}},"*")}else{var o,c=e.data,s=Object(r.a)(a.onMessageCallbacks);try{for(s.s();!(o=s.n()).done;){(0,o.value)({data:c.message,tabId:c.tabId,src:c.src})}}catch(u){s.e(u)}finally{s.f()}}},window.addEventListener("message",this.windowEventListener)}return Object(y.a)(e,[{key:"startHeartbeat",value:function(){var e=this;this.heartbeatStarted||(this._sendHeartbeat(),setInterval((function(){return e._sendHeartbeat()}),1e3),this.heartbeatStarted=!0)}},{key:"_sendHeartbeat",value:function(){window.postMessage({sender:"asbplayerv2",message:{command:"heartbeat",id:Er,receivedTabs:this.tabs}},"*")}},{key:"openShortcuts",value:function(){window.postMessage({sender:"asbplayerv2",message:{command:"open-extension-shortcuts"}})}},{key:"sendMessage",value:function(e,t,n){var a={sender:"asbplayerv2",message:e,tabId:t,src:n};window.postMessage(a,"*")}},{key:"publishMessage",value:function(e){var t,n=Object(r.a)(this.tabs);try{for(n.s();!(t=n.n()).done;){var a=t.value,i={sender:"asbplayerv2",message:e,tabId:a.id,src:a.src};window.postMessage(i,"*")}}catch(o){n.e(o)}finally{n.f()}}},{key:"subscribeTabs",value:function(e){var t=this;return this.onTabsCallbacks.push(e),function(){return t._remove(e,t.onTabsCallbacks)}}},{key:"subscribe",value:function(e){var t=this;return this.onMessageCallbacks.push(e),function(){return t._remove(e,t.onMessageCallbacks)}}},{key:"_remove",value:function(e,t){for(var n=t.length-1;n>=0;--n)if(e===t[n]){t.splice(n,1);break}}},{key:"unbind",value:function(){window.removeEventListener("message",this.windowEventListener),this.onMessageCallbacks=[],this.onTabsCallbacks=[]}}]),e}(),Ir={"copy-subtitle":"copySubtitle","copy-subtitle-with-dialog":"ankiExport","update-last-card":"updateLastCard"},Rr=function(){function e(){var t=this;Object(k.a)(this,e),this.extension=new Mr,this.callbacks=[];window.addEventListener("message",(function e(n){if(n.source===window&&"asbplayer-extension-to-player"===n.data.sender&&"version"===n.data.message.command){var a,i=n.data.message,o=Object(r.a)(t.callbacks);try{for(o.s();!(a=o.n()).done;){var c,s=a.value;t.extension.unbind();for(var u={},l=null!==(c=i.extensionCommands)&&void 0!==c?c:{},d=0,b=Object.keys(l);d<b.length;d++){var f=b[d];u[Ir[f]]=l[f]}t.extension=new Mr(i.version,u),s(t.extension)}}catch(h){o.e(h)}finally{o.f()}window.removeEventListener("message",e)}}))}return Object(y.a)(e,[{key:"onChromeExtension",value:function(e){this.callbacks.push(e),e(this.extension)}}]),e}(),Br="volume",Ar="theaterMode",Nr="offset",_r=function(){function e(t){Object(k.a)(this,e),this.settingsProvider=void 0,this.settingsProvider=t}return Object(y.a)(e,[{key:"volume",get:function(){var e=localStorage.getItem(Br);return null===e?100:Number(e)},set:function(e){localStorage.setItem(Br,String(e))}},{key:"theaterMode",get:function(){return"true"===localStorage.getItem(Ar)||!1},set:function(e){localStorage.setItem(Ar,String(e))}},{key:"offset",get:function(){if(!this.settingsProvider.rememberSubtitleOffset)return 0;var e=localStorage.getItem(Nr);return null===e?0:Number(e)},set:function(e){localStorage.setItem(Nr,String(e))}}]),e}(),Dr=Object(p.a)((function(e){return{content:{flexGrow:1,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginRight:0},contentShift:function(t){var n=t.drawerWidth;return{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:n}}}}));function Lr(e,t,n,a){if(e.audio){var r,i,o,c,s=null!==(r=e.audio.start)&&void 0!==r?r:e.start,u=null!==(i=e.audio.end)&&void 0!==i?i:e.end;return U.fromBase64(e.subtitleFile.name,Math.max(0,s-(null!==(o=e.audio.paddingStart)&&void 0!==o?o:0)),u+(null!==(c=e.audio.paddingEnd)&&void 0!==c?c:0),e.audio.base64,e.audio.extension)}var l,d;if(e.audioFile||e.videoFile)return t?(l=t.subtitleStart,d=t.subtitleEnd):(l=e.start,d=e.end),U.fromFile(e.audioFile||e.videoFile,Math.max(0,l-n),d+a,e.audioTrack)}function Wr(e,t,n){return e.image?V.fromBase64(e.subtitleFile.name,e.start,e.image.base64,e.image.extension):e.videoFile?V.fromFile(e.videoFile,null!==(a=e.mediaTimestamp)&&void 0!==a?a:e.start,t,n):void 0;var a}function Ur(e){var t,n,a,r,i;if(e){var o=null!==(t=null!==(n=null===(a=e.subtitleFile)||void 0===a?void 0:a.name)&&void 0!==n?n:null===(r=e.audioFile)||void 0===r?void 0:r.name)&&void 0!==t?t:null===(i=e.videoFile)||void 0===i?void 0:i.name;if(o)return"".concat(o," (").concat(P(e.start),")")}}function Hr(e){var t=e.searchParams,n=t.get("video"),a=t.get("channel"),r=t.get("popout");return Object(te.jsx)(h.a,{to:"/video?video="+encodeURIComponent(n)+"&channel="+a+"&popout="+r})}function zr(e){var t=e.searchParams,n=e.settingsProvider,a=e.playbackPreferences,r=e.extension,i=e.onError,o=e.onPlayModeChangedViaBind,c=t.get("video"),s=t.get("channel"),u="true"===t.get("popout");return Object(te.jsx)(Pr,{settingsProvider:n,playbackPreferences:a,extension:r,videoFile:c,popOut:u,channel:s,onError:i,onPlayModeChangedViaBind:o})}function qr(e){var t=Dr(e);return Object(te.jsx)("main",{className:Object(Q.a)(t.content,Object(u.a)({},t.contentShift,e.drawerOpen)),children:e.children})}var Vr=function(){var e=Object(b.useMemo)((function(){return new bt}),[]),t=Object(b.useMemo)((function(){return new Sr}),[]),n=Object(b.useMemo)((function(){return new _r(t)}),[t]),a=Object(b.useMemo)((function(){return Object(g.a)({palette:{primary:{main:"#49007a"},secondary:{main:"#ff1f62"},error:{main:m.a.A400},type:t.themeType}})}),[t.themeType]),u=Object(b.useMemo)((function(){return new X(t)}),[t]),l=Object(h.f)(),f=Object(v.b)(),p=Object(s.a)(f,1)[0],k="/video"===l.pathname||null!==p.get("video"),y=Object(b.useMemo)((function(){return new Rr}),[]),x=Object(b.useState)(y.extension),C=Object(s.a)(x,2),w=C[0],T=C[1];Object(b.useEffect)((function(){return y.onChromeExtension(T)}),[y]);var F=Object(b.useMemo)((function(){return new wr(new S(t.keyBindSet),w)}),[t.keyBindSet,w]),E=Object(b.useRef)(null),M=Object(b.useRef)(null),I=O(!k),A=Object(s.a)(I,1)[0],_=E.current?.2:.3,D=E.current?150:300,L=Math.max(D,A*_),W=Object(b.useState)([]),U=Object(s.a)(W,2),H=U[0],z=U[1],q=Object(b.useRef)([]);q.current=H;var V=Object(b.useState)(!1),K=Object(s.a)(V,2),G=K[0],J=K[1],Y=Object(b.useState)(n.theaterMode),Q=Object(s.a)(Y,2),$=Q[0],ee=Q[1],ne=Object(b.useState)(!1),re=Object(s.a)(ne,2),ie=re[0],oe=re[1],ce=Object(b.useState)(),se=Object(s.a)(ce,2),ue=se[0],le=se[1],de=Object(b.useState)(!1),be=Object(s.a)(de,2),he=be[0],ve=be[1],pe=Object(b.useState)(),ge=Object(s.a)(pe,2),je=ge[0],Oe=ge[1],me=Object(b.useState)(),ke=Object(s.a)(me,2),ye=ke[0],xe=ke[1],Se=Object(b.useState)(),Ce=Object(s.a)(Se,2),we=Ce[0],Te=Ce[1],Fe=Object(b.useState)({subtitleFiles:[]}),Pe=Object(s.a)(Fe,2),Ee=Pe[0],Me=Pe[1],Ie=Object(b.useState)(!1),Re=Object(s.a)(Ie,2),Be=Re[0],Ae=Re[1],Ne=Object(b.useState)(!1),_e=Object(s.a)(Ne,2),De=_e[0],Le=_e[1],We=Object(b.useRef)(null),Ue=Object(b.useState)(),He=Object(s.a)(Ue,2),ze=He[0],qe=He[1],Ve=Object(b.useState)(!1),Ke=Object(s.a)(Ve,2),Ge=Ke[0],Xe=Ke[1],Je=Object(b.useState)(!1),Ye=Object(s.a)(Je,2),$e=Ye[0],et=Ye[1],tt=Object(b.useState)(),at=Object(s.a)(tt,2),rt=at[0],it=at[1],ot=Object(b.useMemo)((function(){return rt&&function(e){if(e)return{subtitleStart:e.start,subtitleEnd:e.end,subtitles:e.surroundingSubtitles||[{start:e.start,end:e.end,text:e.text,track:e.track}]}}(rt)}),[rt]),ct=Object(b.useMemo)((function(){return rt&&Lr(rt,ot,t.audioPaddingStart,t.audioPaddingEnd)}),[rt,ot,t.audioPaddingStart,t.audioPaddingEnd]),st=Object(b.useMemo)((function(){return rt&&Wr(rt,t.maxImageWidth,t.maxImageHeight)}),[rt,t.maxImageWidth,t.maxImageHeight]),ut=Object(b.useState)(),lt=Object(s.a)(ut,2),dt=lt[0],ft=lt[1],ht=Object(b.useState)(!1),vt=Object(s.a)(ht,2),pt=vt[0],gt=vt[1],jt=Object(b.useState)({timestamp:0,resume:!1}),Ot=Object(s.a)(jt,2),mt=Ot[0],kt=Ot[1],yt=Object(b.useState)(!1),xt=Object(s.a)(yt,2),St=xt[0],Ct=xt[1],wt=Object(b.useState)(),Tt=Object(s.a)(wt,2),Ft=Tt[0],Pt=Tt[1],Et=Object(b.useState)(!1),It=Object(s.a)(Et,2),Rt=It[0],Bt=It[1],At=Object(b.useState)(!1),Nt=Object(s.a)(At,2),_t=Nt[0],Dt=Nt[1],Lt=Object(b.useState)(),Wt=Object(s.a)(Lt,2),Ut=Wt[0],Ht=Wt[1],zt=Object(b.useState)(),qt=Object(s.a)(zt,2),Vt=qt[0],Kt=qt[1],Gt=Object(b.useState)([]),Xt=Object(s.a)(Gt,2),Jt=Xt[0],Zt=Xt[1],Qt=Object(b.useRef)(null),$t=Object(b.useRef)(!1);$t.current=pt;var en=Ee.subtitleFiles,nn=Object(b.useCallback)((function(e){Oe("error"),le(e),ve(!0)}),[]),an=Object(b.useCallback)((function(e,t){if(t||0!==q.current.length){var n=null!==t&&void 0!==t?t:q.current[q.current.length-1];it(n),Xe(!0),et(!1),Dt(!0),gt(!0),e&&ft(Date.now())}}),[]),rn=Object(b.useCallback)(function(){var e=Object(c.a)(d.a.mark((function e(t,n,a,r,i,o,c,s,l,b){var f;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return et(!0),e.prev=1,e.next=4,u.export(t,n,a,r,i,o,c,s,l,b);case 4:f=e.sent,"gui"!==b&&("default"===b?(Oe("success"),le("Exported card: "+f),ve(!0)):"updateLast"===b&&(Oe("success"),le("Updated card: "+f),ve(!0)),Xe(!1),$t.current&&(kt({timestamp:Date.now(),resume:!0}),gt(!1))),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.t0 instanceof Error?nn(e.t0.message):nn(String(e.t0));case 12:return e.prev=12,et(!1),Dt(!1),e.finish(12);case 16:case"end":return e.stop()}}),e,null,[[1,8,12,16]])})));return function(t,n,a,r,i,o,c,s,u,l){return e.apply(this,arguments)}}(),[u,nn]),on=Object(b.useCallback)((function(e,n,a,r,c,s,u,l,d,b,f,h,v,p){var g;e&&t.copyToClipboardOnMine&&navigator.clipboard.writeText(e.text);var j=Object(o.a)(Object(o.a)({},e),{},{surroundingSubtitles:n,timestamp:Date.now(),id:p||Object(Z.a)(),name:ze,subtitleFile:c,audioFile:a,videoFile:r,mediaTimestamp:s,audioTrack:u,audio:l,image:d,url:b});switch(z((function(t){if(v&&t.length>0){var n,a=t[t.length-1];if(e.start===a.start&&e.end===a.end&&e.text===a.text&&(null===c||void 0===c?void 0:c.name)===(null===(n=a.subtitleFile)||void 0===n?void 0:n.name)){if(void 0!==s&&s!==a.mediaTimestamp){var r=Object(i.a)(t);return r[r.length-1]=j,r}return t}}return[].concat(Object(i.a)(t),[j])})),null!==f&&void 0!==f?f:B.none){case B.none:break;case B.showAnkiDialog:an(h,j);break;case B.updateLastCard:gt(!0),rn(e.text,"",Lr(j,void 0,t.audioPaddingStart,t.audioPaddingEnd),Wr(j,t.maxImageWidth,t.maxImageHeight),"",null!==(g=Ur(j))&&void 0!==g?g:"","",{},t.tags,"updateLast");break;default:throw new Error("Unknown post mine action: "+f)}e&&(Oe("success"),le(""===e.text?"Saved ".concat(P(e.start)):'Copied: "'.concat(e.text,'"')),ve(!0))}),[ze,t,rn,an]),cn=Object(b.useCallback)((function(){return J((function(e){return!e}))}),[]),sn=Object(b.useCallback)((function(){return J(!1)}),[]),un=Object(b.useCallback)((function(){n.theaterMode=!n.theaterMode,ee(n.theaterMode)}),[n]),ln=Object(b.useCallback)((function(){oe((function(e){return!e}))}),[]),dn=Object(b.useCallback)((function(){Dt(!0),Ct(!0)}),[]),bn=Object(b.useCallback)((function(){return ve(!1)}),[]),fn=Object(b.useCallback)((function(){return Bt(!1)}),[]),hn=Object(b.useCallback)((function(e){var n,a,r;t.settings=e,Ct(!1),Pt(void 0),Dt(Ge),null===(n=M.current)||void 0===n||n.subtitleSettings(t.subtitleSettings),null===(a=M.current)||void 0===a||a.ankiSettings(t.ankiSettings),null===(r=M.current)||void 0===r||r.miscSettings(t.miscSettings)}),[t,Ge]),vn=Object(b.useCallback)((function(e){var t,n=[],a=Object(r.a)(H);try{for(a.s();!(t=a.n()).done;){var i=t.value;e.id!==i.id&&n.push(i)}}catch(o){a.e(o)}finally{a.f()}z(n)}),[H]),pn=Object(b.useCallback)((function(e){e===Ee.audioFileUrl&&Me((function(t){return URL.revokeObjectURL(e),{subtitleFiles:t.subtitleFiles,audioFile:void 0,audioFileUrl:void 0,videoFile:t.videoFile,videoFileUrl:t.videoFileUrl}}))}),[Ee]),gn=Object(b.useCallback)((function(e){e===Ee.videoFileUrl&&Me((function(t){return URL.revokeObjectURL(e),{subtitleFiles:t.subtitleFiles,audioFile:t.audioFile,audioFileUrl:t.audioFileUrl,videoFile:void 0,videoFileUrl:void 0}}))}),[Ee]),jn=Object(b.useCallback)(function(){var e=Object(c.a)(d.a.mark((function e(n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Lr(n,void 0,t.audioPaddingStart,t.audioPaddingEnd);case 3:a=e.sent,t.preferMp3?a.toMp3().download():a.download(),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0),e.t0 instanceof Error?nn(e.t0.message):nn(String(e.t0));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),[nn,t]),On=Object(b.useCallback)(function(){var e=Object(c.a)(d.a.mark((function e(n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Wr(n,t.maxImageWidth,t.maxImageHeight);case 3:e.sent.download(),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),console.error(e.t0),e.t0 instanceof Error?nn(e.t0.message):nn(String(e.t0));case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),[nn,t]),mn=Object(b.useCallback)((function(t,n){var a,i=[],o=Object(r.a)(n);try{var c=function(){var e=a.value;void 0===i.find((function(t){return t.start===e.start&&t.end===e.end&&t.text===e.text}))&&i.push(e)};for(o.s();!(a=o.n()).done;)c()}catch(s){o.e(s)}finally{o.f()}R(new Blob([e.subtitlesToSrt(i)],{type:"text/plain"}),"".concat(t,"_MiningHistory_").concat((new Date).toISOString(),".srt"))}),[e]),kn=Object(b.useCallback)((function(e){var t;en.find((function(t){var n;return t.name===(null===(n=e.subtitleFile)||void 0===n?void 0:n.name)}))?xe({text:e.text,start:e.start,end:e.end,originalStart:e.originalStart,originalEnd:e.originalEnd,track:e.track}):nn("Subtitle file "+(null===(t=e.subtitleFile)||void 0===t?void 0:t.name)+" is not open.")}),[en,nn]),yn=Object(b.useCallback)((function(e){it(e),Xe(!0),et(!1),Dt(!0)}),[]),xn=Object(b.useCallback)((function(){Xe(!1),et(!1),Dt(!1),pt&&(kt({timestamp:Date.now(),resume:!0}),gt(!1))}),[pt]),Sn=Object(b.useCallback)((function(){if(rt)if(en.find((function(e){var t;return e.name===(null===(t=rt.subtitleFile)||void 0===t?void 0:t.name)}))){var e={text:rt.text,start:rt.start,end:rt.end,originalStart:rt.originalStart,originalEnd:rt.originalEnd,track:rt.track};Te(e),xe(e),xn()}else{var t;nn("Subtitle file "+(null===(t=rt.subtitleFile)||void 0===t?void 0:t.name)+" is not open.")}}),[rt,en,xn,nn]),Cn=Object(b.useCallback)((function(e){Ht(e),Bt(!0)}),[]);Object(b.useEffect)((function(){return w.subscribeTabs((function(e){if(e.length!==Jt.length)Zt(e);else{for(var t=!1,n=0;n<Jt.length;++n){var a=Jt[n],r=e[n];if(a.id!==r.id||a.title!==r.title||a.src!==r.src){t=!0;break}}t&&Zt(e)}Vt&&0===e.filter((function(e){return e.id===Vt.id&&e.src===Vt.src})).length&&(Kt(void 0),nn("Lost connection with tab "+Vt.id+" "+Vt.title))}))}),[Jt,Vt,w,nn]);var wn=Object(b.useCallback)((function(e){return Kt(e)}),[]),Tn=Object(b.useCallback)((function(e){try{var t=function(e){for(var t=[],n=void 0,a=void 0,r=0;r<e.length;++r){var i=e[r],o=i.name.lastIndexOf(".");if(-1===o)throw new Error("Unable to determine extension of "+i.name);var c=i.name.substring(o+1,i.name.length);switch(c){case"ass":case"srt":case"vtt":case"sup":t.push(i);break;case"mkv":case"mp4":case"avi":if(a)throw new Error("Cannot open two video files simultaneously");a=i;break;case"mp3":case"m4a":case"aac":case"flac":case"ogg":case"wav":case"opus":if(n)throw new Error("Cannot open two audio files simultaneously");n=i;break;default:throw new Error("Unsupported extension "+c)}}if(a&&n)throw new Error("Cannot load both an audio and video file simultaneously");return{subtitleFiles:t,audioFile:n,videoFile:a}}(e),n=t.subtitleFiles,a=t.audioFile,r=t.videoFile;if(Me((function(e){Ae(!0);var t=void 0,i=void 0;return r||a?(!function(e){e.audioFileUrl&&URL.revokeObjectURL(e.audioFileUrl),e.videoFileUrl&&URL.revokeObjectURL(e.videoFileUrl)}(e),r?t=URL.createObjectURL(r):a&&(i=URL.createObjectURL(a)),Kt(void 0)):(r=e.videoFile,t=e.videoFileUrl,a=e.audioFile,i=e.audioFileUrl),{subtitleFiles:0===n.length?e.subtitleFiles:n,audioFile:a,audioFileUrl:i,videoFile:r,videoFileUrl:t}})),n.length>0){var i=n[0].name;qe(i.substring(0,i.lastIndexOf(".")))}}catch(o){console.error(o),o instanceof Error?nn(o.message):nn(String(o))}}),[nn]),Fn=Object(b.useCallback)(function(){var e=Object(c.a)(d.a.mark((function e(t){var n,a,i,o,c,s,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1===t.length){e.next=3;break}return nn("Cannot load more than one directory at a time"),e.abrupt("return");case 3:if((n=t[0].webkitGetAsEntry())&&n.isDirectory){e.next=7;break}return nn("Failed to load directory"),e.abrupt("return");case 7:return a=n,e.prev=8,e.next=11,new Promise((function(e,t){return a.createReader().readEntries(e,t)}));case 11:if(!(i=e.sent).find((function(e){return e.isDirectory}))){e.next=15;break}return nn("Cannot load a directory with subdirectories"),e.abrupt("return");case 15:o=i.map((function(e){return new Promise((function(t,n){return e.file(t,n)}))})),c=[],s=Object(r.a)(o),e.prev=18,s.s();case 20:if((u=s.n()).done){e.next=29;break}return l=u.value,e.t0=c,e.next=25,l;case 25:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 27:e.next=20;break;case 29:e.next=34;break;case 31:e.prev=31,e.t2=e.catch(18),s.e(e.t2);case 34:return e.prev=34,s.f(),e.finish(34);case 37:Tn(c),e.next=44;break;case 40:e.prev=40,e.t3=e.catch(8),console.error(e.t3),e.t3 instanceof Error?nn(e.t3.message):nn(String(e.t3));case 44:case"end":return e.stop()}}),e,null,[[8,40],[18,31,34,37]])})));return function(t){return e.apply(this,arguments)}}(),[nn,Tn]);Object(b.useEffect)((function(){if(!k){var e=w.subscribe((function(e){return t.apply(this,arguments)}));return w.startHeartbeat(),e}function t(){return t=Object(c.a)(d.a.mark((function e(t){var n,a,r,i,o,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("sync"!==t.data.command&&"syncv2"!==t.data.command){e.next=35;break}if(0!==(n=w.tabs.filter((function(e){return e.id===t.tabId&&(!t.src||e.src===t.src)}))).length){e.next=5;break}return t.src?console.error("Received sync request but the requesting tab ID "+t.tabId+" with src "+t.src+" was not found"):console.error("Received sync request but the requesting tab ID "+t.tabId+" was not found"),e.abrupt("return");case 5:if(a=n[0],"sync"!==t.data.command){e.next=20;break}return i=t.data,e.t0=File,e.next=11,fetch("data:text/plain;base64,"+i.subtitles.base64);case 11:return e.next=13,e.sent.blob();case 13:e.t1=e.sent,e.t2=[e.t1],e.t3=i.subtitles.name,e.t4=new e.t0(e.t2,e.t3),r=[e.t4],e.next=29;break;case 20:if("syncv2"!==t.data.command){e.next=27;break}return o=t.data,e.next=24,Promise.all(o.subtitles.map(function(){var e=Object(c.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=File,e.next=3,fetch("data:text/plain;base64,"+t.base64);case 3:return e.next=5,e.sent.blob();case 5:return e.t1=e.sent,e.t2=[e.t1],e.t3=t.name,e.abrupt("return",new e.t0(e.t2,e.t3));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 24:r=e.sent,e.next=29;break;case 27:return console.error("Unknown message "+t.data.command),e.abrupt("return");case 29:s=r[0].name,qe(s.substring(0,s.lastIndexOf("."))),Me({subtitleFiles:r,audioFile:void 0,audioFileUrl:void 0,videoFile:void 0,videoFileUrl:void 0}),Kt(a),e.next=36;break;case 35:"edit-keyboard-shortcuts"===t.data.command&&(Ct(!0),Pt("keyboard-shortcuts"));case 36:case"end":return e.stop()}}),e)}))),t.apply(this,arguments)}}),[w,k]);var Pn=Object(b.useCallback)((function(e,t){switch(t){case N.autoPause:le("Auto-pause: On");break;case N.condensed:le("Condensed playback: On");break;case N.normal:e===N.autoPause?le("Auto-pause: Off"):e===N.condensed&&le("Condensed playback: Off")}Oe("info"),ve(!0)}),[]),En=Object(b.useCallback)((function(e){Ge||(e.preventDefault(),k?nn("Video player cannot receive dropped files. Drop outside of the video frame instead."):(Le(!1),We.current=null,e.dataTransfer.items&&e.dataTransfer.items.length>0&&function(e){for(var t=0;t<e.length;++t){var n;if(null===(n=e[t].webkitGetAsEntry())||void 0===n||!n.isDirectory)return!1}return!0}(e.dataTransfer.items)?Fn(e.dataTransfer.items):e.dataTransfer.files&&e.dataTransfer.files.length>0&&Tn(e.dataTransfer.files)))}),[k,nn,Tn,Fn,Ge]),Mn=Object(b.useCallback)((function(){var e,t=null===(e=Qt.current)||void 0===e?void 0:e.files;t&&t.length>0&&Tn(t)}),[Tn]),In=Object(b.useCallback)((function(){var e;return null===(e=Qt.current)||void 0===e?void 0:e.click()}),[]),Rn=Object(b.useCallback)(Object(c.a)(d.a.mark((function t(){var n;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==Ee.subtitleFiles){t.next=2;break}return t.abrupt("return");case 2:if(0!==(n=Ee.subtitleFiles.filter((function(e){return!e.name.endsWith(".sup")}))).length){t.next=5;break}return t.abrupt("return");case 5:return t.t0=R,t.t1=Blob,t.next=9,e.filesToSrt(n);case 9:t.t2=t.sent,t.t3=[t.t2],t.t4={type:"text/plain"},t.t5=new t.t1(t.t3,t.t4),t.t6="".concat(ze,".srt"),(0,t.t0)(t.t5,t.t6);case 15:case"end":return t.stop()}}),t)}))),[ze,Ee.subtitleFiles,e]),Bn=Object(b.useCallback)((function(e){Ge||e.preventDefault()}),[Ge]),An=Object(b.useCallback)((function(e){Ge||(e.preventDefault(),e.stopPropagation(),k||(We.current=e.target,Le(!0)))}),[k,Ge]),Nn=Object(b.useCallback)((function(e){e.nativeEvent.preventDefault(),e.nativeEvent.stopPropagation(),k||We.current!==e.target||Le(!1)}),[k]),_n=Object(b.useCallback)((function(){return Ae(!1)}),[]);if(Object(b.useEffect)((function(){if("settings"===p.get("view")&&(Ct(!0),l.hash&&l.hash.startsWith("#"))){var e=l.hash.substring(1,l.hash.length);Pt(e)}}),[p,l]),"/"===l.pathname&&p.get("video"))return Object(te.jsx)(Hr,{searchParams:p});var Dn=Be&&!E.current||0===Ee.subtitleFiles.length&&!Ee.audioFile&&!Ee.videoFile,Ln=void 0!==Ee.videoFile&&$&&!ie;return Object(te.jsxs)(j.a,{theme:a,children:[Object(te.jsx)(Qe.a,{}),Object(te.jsxs)("div",{onDrop:En,onDragOver:Bn,onDragEnter:An,onDragLeave:Nn,children:[Object(te.jsx)(ae,{open:he,onClose:bn,autoHideDuration:3e3,severity:je,children:ue}),Object(te.jsxs)(h.d,{children:[Object(te.jsx)(h.b,{path:"/video",element:Object(te.jsx)(zr,{searchParams:p,settingsProvider:t,playbackPreferences:n,extension:w,onError:nn,onPlayModeChangedViaBind:Pn})}),Object(te.jsx)(h.b,{path:"/",element:Object(te.jsxs)("div",{children:[Object(te.jsx)(Yt,{items:H,open:G,drawerWidth:L,onClose:sn,onDelete:vn,onClipAudio:jn,onDownloadImage:On,onDownloadSectionAsSrt:mn,onSelect:kn,onAnki:yn}),Object(te.jsx)(Ze,{open:Ge,disabled:$e,audioClip:ct,image:st,source:Ur(rt),url:null===rt||void 0===rt?void 0:rt.url,sliderContext:ot,customFields:t.customAnkiFields,anki:u,settingsProvider:t,onCancel:xn,onRewind:Sn,onProceed:rn,onViewImage:Cn,onOpenSettings:dn}),Object(te.jsx)(fe,{open:Rt,image:Ut,onClose:fn}),Object(te.jsx)(Ha,{anki:u,extension:w,open:St,onClose:hn,settings:t.settings,scrollToId:Ft}),Object(te.jsx)(Mt,{title:ze||"asbplayer",drawerWidth:L,drawerOpen:G,hidden:Ln,subtitleFiles:Ee.subtitleFiles,onOpenCopyHistory:cn,onDownloadSubtitleFilesAsSrt:Rn,onOpenSettings:dn,onFileSelector:In}),Object(te.jsx)("input",{ref:Qt,onChange:Mn,type:"file",accept:".srt,.ass,.vtt,.sup,.mp3,.m4a,.aac,.flac,.ogg,.wav,.opus,.mkv,.mp4,.avi",multiple:!0,hidden:!0}),Object(te.jsxs)(qr,{drawerWidth:L,drawerOpen:G,children:[Dn&&Object(te.jsx)(tn,{latestExtensionVersion:"0.22.0",extensionUrl:"https://github.com/killergerbah/asbplayer/releases/latest",extension:w,loading:Be,dragging:De,appBarHidden:Ln,onFileSelector:In}),Object(te.jsx)(nt,{dragging:De,appBarHidden:Ln,loading:Be}),Object(te.jsx)(da,{subtitleReader:e,settingsProvider:t,playbackPreferences:n,onCopy:on,onError:nn,onUnloadAudio:pn,onUnloadVideo:gn,onLoaded:_n,onTabSelected:wn,onAnkiDialogRequest:an,onAppBarToggle:un,onVideoPopOut:ln,onPlayModeChangedViaBind:Pn,tab:Vt,availableTabs:Jt,sources:Ee,jumpToSubtitle:ye,rewindSubtitle:we,videoFrameRef:E,videoChannelRef:M,extension:w,drawerOpen:G,appBarHidden:Ln,videoPopOut:ie,disableKeyEvents:_t,ankiDialogRequested:pt,ankiDialogRequestToVideo:dt,ankiDialogFinishedRequest:mt,keyBinder:F})]})]})})]})]})]})},Kr=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,372)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),a(e),r(e),i(e),o(e)}))};Object(a.createRoot)(document.querySelector("#root")).render(Object(te.jsx)(v.a,{basename:"/asbplayer",children:Object(te.jsx)(Vr,{})})),Kr()}},[[278,1,2]]]);
//# sourceMappingURL=main.5ac61d1e.chunk.js.map