(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{154:function(e,t){},156:function(e,t){},175:function(e,t){},177:function(e,t){},185:function(e,t){},187:function(e,t){},194:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n(0),i=n(10),c=n.n(i),o=n(254),s=n(253),l=n(8),u=n(78),d=n(7),b=n(36),f=n(13),h=n(233),j=n(4),v=n(256),O=n(195),p=Object(h.a)({root:{display:"flex",justifyContent:"center",position:"fixed",top:80,width:"100%",pointerEvents:"none",zIndex:2e3}});function m(e){var t=p();return Object(r.useEffect)((function(){if(e.open){var t=setTimeout(e.onClose,e.autoHideDuration);return function(){return clearTimeout(t)}}return null}),[e.open,e.autoHideDuration,e.onClose]),Object(a.jsx)("div",{className:t.root,children:Object(a.jsx)(O.a,{in:e.open,children:Object(a.jsx)(v.a,{severity:e.severity,children:e.children})})})}var k=n(16),y=n(17),g=n(119),x=n(255),w=function(){function e(){Object(k.a)(this,e)}return Object(y.a)(e,[{key:"subtitles",value:function(e){if(e.name.endsWith(".srt"))return e.text().then((function(e){return Object(g.a)(e)})).then((function(e){return e.map((function(e){return e.data}))}));if(e.name.endsWith(".ass"))return e.text().then((function(e){return Object(x.a)(e)})).then((function(e){return e.events.dialogue.map((function(e){return{start:Math.round(1e3*e.Start),end:Math.round(1e3*e.End),text:e.Text.raw}}))}));throw new Error("Unsupported subtitle file format")}},{key:"clipAudioFromAudioFile",value:function(e,t,n,a){var r=this;return new Promise((function(i,c){var o=document.createElement("audio");r._clipMedia(o,e,t,n,a,i)}))}},{key:"clipAudioFromVideoFile",value:function(e,t,n,a){var r=this;return new Promise((function(i,c){var o=document.createElement("video");r._clipMedia(o,e,t,n,a,i)}))}},{key:"_clipMedia",value:function(e,t,n,a,r,i){var c=this;if(e.src=URL.createObjectURL(t),e.preload="none",r&&e.audioTracks&&e.audioTracks.length>0){var o,s=Object(l.a)(e.audioTracks);try{for(s.s();!(o=s.n()).done;){var u=o.value;u.enabled=r===u.id}}catch(d){s.e(d)}finally{s.f()}}e.currentTime=n/1e3,e.load(),e.oncanplay=function(r){e.play();var o,s=e.captureStream(),u=Object(l.a)(s.getVideoTracks());try{for(u.s();!(o=u.n()).done;){o.value.enabled=!1}}catch(d){u.e(d)}finally{u.f()}var b=new MediaRecorder(s),f=[];b.ondataavailable=function(e){f.push(e.data)},b.onstop=function(e){c._saveToFile(new Blob(f),c._nameWithoutExtension(t.name)+"_"+n+"_"+a+".wav"),i()},b.start(),setTimeout((function(){e.pause(),b.stop();var t=e.src;e.src=null,URL.revokeObjectURL(t)}),a-n+100)}}},{key:"_nameWithoutExtension",value:function(e){return e.substring(0,e.lastIndexOf("."))}},{key:"_saveToFile",value:function(e,t){var n=window.URL.createObjectURL(e),a=document.createElement("a");document.body.appendChild(a),a.style="display: none",a.href=n,a.download=t,a.click(),URL.revokeObjectURL(n),a.remove()}}]),e}(),C=n(237),T=n(236),S=n(123),R=n.n(S),F=n(238),M=n(80);function E(e){var t,n=(t=e.drawerWidth,Object(h.a)((function(e){return{root:{height:"64px"},title:{flexGrow:1},appBar:{transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{width:"calc(100% - ".concat(t,"px)"),transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:t},hide:{display:"none"}}})))();return Object(a.jsx)(C.a,{position:"static",className:Object(j.a)(n.appBar,Object(b.a)({},n.appBarShift,e.drawerOpen)),children:Object(a.jsxs)(F.a,{children:[Object(a.jsx)(M.a,{variant:"h6",className:n.title,children:e.title}),Object(a.jsx)(T.a,{edge:"end",color:"inherit","aria-label":"menu",onClick:e.onOpenCopyHistory,className:Object(j.a)(e.drawerOpen&&n.hide),children:Object(a.jsx)(R.a,{})})]})})}var U=function(){function e(){var t=this;Object(k.a)(this,e),this.onMessageCallbacks=[],this.tabs=[],window.addEventListener("message",(function(e){if(e.source===window&&"asbplayer-extension-to-player"===e.data.sender&&e.data.message)if("tabs"===e.data.message.command)t.tabs=e.data.message.tabs;else{var n,a=Object(l.a)(t.onMessageCallbacks);try{for(a.s();!(n=a.n()).done;){(0,n.value)({data:e.data.message,tabId:e.data.tabId})}}catch(r){a.e(r)}finally{a.f()}}}))}return Object(y.a)(e,[{key:"sendMessage",value:function(e,t){window.postMessage({sender:"asbplayer",message:e,tabId:t},"*")}},{key:"subscribe",value:function(e){this.onMessageCallbacks.push(e)}},{key:"unsubscribe",value:function(e){for(var t=this.onMessageCallbacks.length-1;t>=0;--t)if(e===this.onMessageCallbacks[t]){this.onMessageCallbacks.splice(t,1);break}}}]),e}(),P=n(89),A=n(245),I=n(258),D=n(125),L=n.n(D),N=n(128),W=n.n(N),z=n(127),H=n.n(z),B=n(74),_=n.n(B),V=n(126),X=n.n(V),q=n(243),G=n(259),J=n(240),Y=n(242),K=n(239),Q=n(257);function Z(e){var t,n=(t=e.drawerWidth,Object(h.a)((function(e){return{drawer:{width:t,flexShrink:0},drawerPaper:{width:t},drawerHeader:Object(P.a)(Object(P.a)({display:"flex",alignItems:"center",position:"static",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-start"}),listContainer:{position:"relative",height:"100%",overflowY:"auto",overflowX:"hidden"},listItemIconRoot:{minWidth:20}}})))(),i=Object(r.useCallback)((function(e){e&&e.scrollIntoView()}),[]),c=null;if(e.items.length>0){c=[];var o,s=null,u=0,d=Object(l.a)(e.items);try{var b=function(){var t=o.value;null!==s&&s===t.name||(s=t.name,c.push(Object(a.jsx)(K.a,{disableSticky:!0,children:t.name},t.name)));var r=u===e.items.length-1?i:null;c.push(Object(a.jsxs)(G.a,{ref:r,children:[Object(a.jsx)(J.a,{classes:{root:n.listItemIconRoot},children:Object(a.jsx)(Q.a,{title:"Copy",children:Object(a.jsx)(T.a,{onClick:function(e){return navigator.clipboard.writeText(t.text)},children:Object(a.jsx)(_.a,{fontSize:"small"})})})}),Object(a.jsx)(J.a,{classes:{root:n.listItemIconRoot},children:Object(a.jsx)(Q.a,{title:"Clip Audio",children:Object(a.jsx)(T.a,{disabled:!t.audioFile&&!t.videoFile,onClick:function(){return e.onClipAudio(t)},children:Object(a.jsx)(L.a,{fontSize:"small"})})})}),Object(a.jsx)(J.a,{classes:{root:n.listItemIconRoot},children:Object(a.jsx)(Q.a,{title:"Jump To",children:Object(a.jsx)(T.a,{onClick:function(){return e.onSelect(t)},children:Object(a.jsx)(X.a,{fontSize:"small"})})})}),Object(a.jsx)(Y.a,{children:t.text}),Object(a.jsx)(J.a,{classes:{root:n.listItemIconRoot},children:Object(a.jsx)(T.a,{onClick:function(){return e.onDelete(t)},children:Object(a.jsx)(H.a,{fontSize:"small"})})})]},t.timestamp)),++u};for(d.s();!(o=d.n()).done;)b()}catch(j){d.e(j)}finally{d.f()}}else c=Object(a.jsx)(G.a,{children:"Copy history is empty."});var f=Object(a.jsx)(q.a,{children:c});return Object(a.jsxs)(I.a,{variant:"persistent",anchor:"right",open:e.open,className:n.drawer,classes:{paper:n.drawerPaper},children:[Object(a.jsx)("div",{className:n.drawerHeader,children:Object(a.jsx)(T.a,{onClick:e.onClose,children:Object(a.jsx)(W.a,{})})}),Object(a.jsx)(A.a,{}),Object(a.jsx)("div",{className:n.listContainer,children:f})]})}var $=function(){function e(t){Object(k.a)(this,e),this.channel=new BroadcastChannel(t);var n=this;this.channel.onmessage=function(e){var t;null===(t=n.onMessage)||void 0===t||t.call(n,e)}}return Object(y.a)(e,[{key:"postMessage",value:function(e){this.channel.postMessage(e)}},{key:"close",value:function(){this.channel.close()}}]),e}(),ee=function(){function e(t,n){var a=this;Object(k.a)(this,e),this.tabId=t,this.listener=function(e){var n;e.tabId===t&&(null===(n=a.onMessage)||void 0===n||n.call(a,{data:e.data}))},n.subscribe(this.listener),this.extension=n}return Object(y.a)(e,[{key:"postMessage",value:function(e){this.extension.sendMessage(e,this.tabId)}},{key:"close",value:function(){this.extension.unsubscribe(this.listener)}}]),e}(),te=function(){function e(){Object(k.a)(this,e),this.accumulated=0,this.started=!1}return Object(y.a)(e,[{key:"time",value:function(e){return this.started?Math.min(e,this.accumulated+Date.now()-this.startTime):Math.min(e,this.accumulated)}},{key:"stop",value:function(){this.started&&(this.started=!1,this.accumulated+=Date.now()-this.startTime)}},{key:"start",value:function(){this.startTime=Date.now(),this.started=!0}},{key:"setTime",value:function(e){this.started?(this.startTime=Date.now(),this.accumulated=e):this.accumulated=e}},{key:"progress",value:function(e){return 0===e?0:Math.min(1,this.time(e)/e)}}]),e}(),ne=n(244),ae=n(247),re=n(246),ie=n(129),ce=n.n(ie),oe=n(130),se=n.n(oe),le=n(131),ue=n.n(le),de=n(132),be=n.n(de),fe=Object(h.a)((function(e){return{container:{position:"absolute",left:"50%",width:"50%",bottom:0},buttonContainer:{flexDirection:"row"},timeDisplay:{color:"white",display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",cursor:"default"},paper:{background:"linear-gradient(to bottom, rgba(0,0,0,0), rgba(0, 0, 0, 0.5))",position:"relative",left:"-100%",width:"200%",zIndex:10,padding:10},activeButton:{color:"#55ff55"},button:{color:"white"},progress:{margin:5},bar1Determinate:{transition:"none",background:"linear-gradient(to left, #e21e4a, #a92fff)"}}})),he=Object(h.a)((function(e){return{container:{width:"100%",background:"rgba(30,30,30,0.7)",height:5,marginBottom:5,cursor:"pointer"},fillContainer:{width:"100%"},fill:{background:"linear-gradient(to left, #e21e4a, #a92fff)",height:"100%"},handleContainer:{position:"relative",width:0,height:0},handle:{borderRadius:"50%",width:15,height:15,background:"white",position:"absolute",top:5,left:2,filter:"drop-shadow(3px 3px 3px rgba(0,0,0,0.3))"}}}));function je(e){var t=Math.floor(e/1e3),n=Math.floor(t/60),a=t%60;return String(n)+":"+String(a).padStart(2,"0")}function ve(e){var t=e.getBoundingClientRect();return t.right-t.left}function Oe(e){var t=he(),n=Object(r.useRef)(null);var i={width:e.value+"%"},c={marginLeft:n.current?ve(n.current)*e.value/100:0};return Object(a.jsxs)("div",{ref:n,onClick:function(t){var n=t.currentTarget.getBoundingClientRect(),a=n.right-n.left,r=(t.pageX-n.left)/a;e.onSeek(r)},className:t.container,children:[Object(a.jsx)("div",{className:t.fill,style:i}),Object(a.jsx)("div",{className:t.handleAnchor,children:Object(a.jsx)("div",{className:t.handle,style:c})})]})}function pe(e){if(!e.audioTracks||0===e.audioTracks.length)return null;var t=e.audioTracks.map((function(t){return Object(a.jsxs)(G.a,{selected:t.id===e.selectedAudioTrack,button:!0,onClick:function(){return e.onAudioTrackSelected(t.id)},children:[t.language," ",t.label]},t.id)}));return Object(a.jsx)("div",{children:Object(a.jsx)(re.a,{disableEnforceFocus:!0,open:e.open,anchorEl:e.anchorEl,onClose:e.onClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(a.jsx)(q.a,{children:t})})})}function me(e){if(!e.tabs||0===e.tabs.length)return null;var t=e.tabs.map((function(t){return Object(a.jsxs)(G.a,{selected:t.id===e.selectedTab,button:!0,onClick:function(){return e.onTabSelected(t.id)},children:[t.id," ",t.title," ",t.src]},t.id)}));return Object(a.jsx)("div",{children:Object(a.jsx)(re.a,{disableEnforceFocus:!0,open:e.open,anchorEl:e.anchorEl,onClose:e.onClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(a.jsx)(q.a,{children:t})})})}function ke(e){var t=fe(),n=Object(r.useState)(!0),i=Object(d.a)(n,2),c=i[0],o=i[1],s=Object(r.useState)(!1),l=Object(d.a)(s,2),u=l[0],b=l[1],f=Object(r.useState)(),h=Object(d.a)(f,2),j=h[0],v=h[1],O=Object(r.useState)(!1),p=Object(d.a)(O,2),m=p[0],k=p[1],y=Object(r.useState)(),g=Object(d.a)(y,2),x=g[0],w=g[1],C=Object(r.useRef)({x:0,y:0}),S=Object(r.useRef)(Date.now()),R=Object(r.useRef)(!0),F=Object(r.useRef)(!1),E=Object(r.useState)(),U=Object(d.a)(E,2)[1],P=Object(r.useCallback)((function(){return U({})}),[]),A=Object(r.useCallback)((function(t){e.onSeek(t)}),[e]);Object(r.useEffect)((function(){var t=setInterval((function(){var t=Date.now()-S.current<2e3||Math.pow(e.mousePositionRef.current.x-C.current.x,2)+Math.pow(e.mousePositionRef.current.y-C.current.y,2)>100||F.current;t&&!R.current?(S.current=Date.now(),o(t)):!t&&R.current&&o(t),R.current=t,C.current.x=e.mousePositionRef.current.x,C.current.y=e.mousePositionRef.current.y}),100);return function(){return clearInterval(t)}}),[e.mousePositionRef,o,c]),Object(r.useEffect)((function(){function t(t){32===t.keyCode&&(t.preventDefault(),e.playing?e.onPause():e.onPlay())}return window.addEventListener("keydown",t),function(){window.removeEventListener("keydown",t)}}),[e]),Object(r.useEffect)((function(){var e=setInterval((function(){P()}),100);return function(){return clearInterval(e)}}),[P]);var I=Object(r.useCallback)((function(){v(null),b(!1)}),[]),D=Object(r.useCallback)((function(e){v(e.currentTarget),b(!0)}),[]),L=Object(r.useCallback)((function(t){e.onAudioTrackSelected(t),v(null),b(!1)}),[e]),N=Object(r.useCallback)((function(){w(null),k(!1)}),[]),W=Object(r.useCallback)((function(e){w(e.currentTarget),k(!0)}),[]),z=Object(r.useCallback)((function(t){e.onTabSelected(t),w(null),k(!1)}),[e]),H=e.clock.progress(e.length);return Object(a.jsxs)("div",{className:t.container,onMouseOver:function(e){F.current=!0},onMouseOut:function(e){F.current=!1},children:[Object(a.jsx)(ne.a,{in:c,timeout:200,children:Object(a.jsxs)("div",{className:t.paper,children:[Object(a.jsx)(Oe,{onSeek:A,value:100*H}),Object(a.jsxs)(ae.a,{container:!0,direction:"row",children:[Object(a.jsx)(ae.a,{item:!0,children:Object(a.jsx)(T.a,{onClick:function(){return e.playing?e.onPause():e.onPlay()},children:e.playing?Object(a.jsx)(ce.a,{className:t.button}):Object(a.jsx)(se.a,{className:t.button})})}),Object(a.jsx)(ae.a,{item:!0,children:Object(a.jsxs)(M.a,{variant:"h6",className:t.timeDisplay,children:[je(H*e.length)," / ",je(e.length)]})}),Object(a.jsx)(ae.a,{style:{flexGrow:1},item:!0}),Object(a.jsx)(ae.a,{item:!0,children:e.audioTracks&&e.audioTracks.length>1&&Object(a.jsx)(T.a,{onClick:D,children:Object(a.jsx)(ue.a,{className:t.button})})}),Object(a.jsx)(ae.a,{item:!0,children:e.tabs&&e.tabs.length>0&&Object(a.jsx)(T.a,{onClick:W,children:Object(a.jsx)(be.a,{className:e.selectedTab?t.activeButton:t.button})})})]})]})}),Object(a.jsx)(me,{open:m&&c,anchorEl:x,tabs:e.tabs,selectedTab:e.selectedTab,onClose:N,onTabSelected:z}),Object(a.jsx)(pe,{open:u&&c,anchorEl:j,audioTracks:e.audioTracks,selectedAudioTrack:e.selectedAudioTrack,onClose:I,onAudioTrackSelected:L})]})}var ye=function(){function e(t){Object(k.a)(this,e),this.ref=t,this.readyResolves=[]}return Object(y.a)(e,[{key:"seek",value:function(e){var t=this;return new Promise((function(n,a){t.ref.current?(t.ref.current.currentTime=e,t._onMediaCanPlay((function(){return n()}))):n()}))}},{key:"onReady",value:function(){var e=this;return new Promise((function(t,n){e.ref.current?e._onMediaCanPlay((function(){return t()})):t()}))}},{key:"_onMediaCanPlay",value:function(e){var t=this;4!==this.ref.readyState?(this.ref.current&&!this.ref.current.oncanplay&&(this.ref.current.oncanplay=function(e){var n,a=Object(l.a)(t.readyResolves);try{for(a.s();!(n=a.n()).done;){(0,n.value)()}}catch(r){a.e(r)}finally{a.f()}t.readyResolves.length=0,t.ref.current.oncanplay=null}),this.readyResolves.push(e)):e()}},{key:"play",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.play()}},{key:"pause",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.pause()}}]),e}(),ge=n(249),xe=n(250),we=n(252),Ce=n(248),Te=n(251),Se=Object(h.a)({container:{height:"calc(100vh - 64px)",position:"relative",overflowX:"hidden"},selectedSubtitle:{fontSize:20},subtitle:{fontSize:20,width:"100%"},timestamp:{fontSize:14,color:"#aaaaaa",textAlign:"right"},copyButton:{fontSize:14,color:"#aaaaaa",textAlign:"right",padding:0},noSubtitles:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}});function Re(e){var t=e.clock,n=e.subtitles,i=Object(r.useMemo)((function(){return n?Array(n.length).fill().map((function(e,t){return Object(r.createRef)()})):[]}),[n]),c=Object(r.useState)(0),o=Object(d.a)(c,2),s=o[0],u=o[1],b=Object(r.useRef)(0),f=Object(r.useState)(!1),h=Object(d.a)(f,2),j=h[0],v=h[1],O=Object(r.useState)(null),p=Object(d.a)(O,2),k=p[0],y=p[1],g=Object(r.useRef)(0),x=Object(r.useRef)(),w=Object(r.createRef)(),C=Se();Object(r.useEffect)((function(){if(!n||0===n.length)return function(){return cancelAnimationFrame(x.current)};return x.current=requestAnimationFrame((function a(r){for(var c=e.length,o=t.progress(c),s=-1,l=n.length-1;l>=0;--l)if(o>=n[l].start/c){s=l;break}if(-1!==s&&s!==b.current){u(s),b.current=s;var d=i[s],f=Date.now()-g.current>5e3;d.current&&f&&d.current.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}x.current=requestAnimationFrame(a)})),function(){return cancelAnimationFrame(x.current)}}),[n,t,e.length,i]),Object(r.useEffect)((function(){function t(t){if(n&&0!==n.length){var a;if(37===t.keyCode)a=Math.max(0,s-1);else{if(39!==t.keyCode)return;a=Math.min(e.subtitles.length-1,s+1)}t.preventDefault();var r=e.subtitles[a].start/e.length;e.onSeek(r,!1)}}return window.addEventListener("keydown",t),function(){window.removeEventListener("keydown",t)}}),[e,s,n]),Object(r.useEffect)((function(){function e(e){g.current=Date.now()}var t=w.current;return null===t||void 0===t||t.addEventListener("wheel",e),function(){null===t||void 0===t||t.removeEventListener("wheel",e)}}),[w,g]),Object(r.useEffect)((function(){if(e.jumpToSubtitle&&e.subtitles){var t,n=-1,a=0,r=Object(l.a)(e.subtitles);try{for(r.s();!(t=r.n()).done;){var c=t.value;c.start===e.jumpToSubtitle.start&&c.text===e.jumpToSubtitle.text&&(n=a),++a}}catch(o){r.e(o)}finally{r.f()}-1!==n&&i[n].current.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}),[e.jumpToSubtitle,e.subtitles,i]);var S,R=Object(r.useCallback)((function(t){var n=e.subtitles[t].start/e.length;e.onSeek(n,!e.playing&&t===s)}),[e,s]),F=Object(r.useCallback)((function(t,n){t.stopPropagation();var a=e.subtitles[n],r=a.text;navigator.clipboard.writeText(r),e.onCopy(r,a.start,a.end),y(r),v(!0)}),[e]),M=Object(r.useCallback)((function(){v(!1)}),[v]);return S=e.subtitles?0===e.subtitles.length?null:Object(a.jsx)(Ce.a,{ref:w,children:Object(a.jsx)(ge.a,{children:Object(a.jsx)(xe.a,{children:e.subtitles.map((function(e,t){var n=t===s,r=n?C.selectedSubtitle:C.subtitle;return Object(a.jsxs)(Te.a,{onClick:function(e){return R(t)},ref:i[t],selected:n,children:[Object(a.jsx)(we.a,{className:r,children:e.text}),Object(a.jsx)(we.a,{className:C.copyButton,children:Object(a.jsx)(T.a,{onClick:function(e){return F(e,t)},children:Object(a.jsx)(_.a,{})})}),Object(a.jsx)(we.a,{className:C.timestamp,children:e.displayTime})]},t)}))})})}):Object(a.jsxs)("div",{className:C.noSubtitles,children:[Object(a.jsx)("span",{children:"Drag and drop srt, ass, mp3, or mkv files."}),Object(a.jsxs)("span",{children:["Install the ",Object(a.jsx)("a",{target:"_blank",href:"https://github.com/killergerbah/asbplayer/releases/tag/v0.1.0",children:"extension"})," to sync subtitles with videos in other tabs."]})]}),Object(a.jsxs)("div",{className:C.container,children:[S,Object(a.jsxs)(m,{open:j,onClose:M,autoHideDuration:3e3,severity:"success",children:["Copied ",k]})]})}var Fe=function(){function e(t){Object(k.a)(this,e),this.protocol=t,this.time=0,this.duration=0,this.isReady=!1,this.readyState=0,this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[];var n=this;this.protocol.onMessage=function(e){switch(e.data.command){case"ready":n.duration=e.data.duration,n.isReady=!0,n.audioTracks=e.data.audioTracks,n.selectedAudioTrack=e.data.selectedAudioTrack,n.readyState=4,n.time=e.data.currentTime;var t,a=Object(l.a)(n.readyCallbacks);try{for(a.s();!(t=a.n()).done;){(0,t.value)(e.data.paused)}}catch(h){a.e(h)}finally{a.f()}break;case"readyState":var r;if(n.readyState=e.data.value,4===n.readyState)null===(r=n.oncanplay)||void 0===r||r.call(n);break;case"play":var i,c=Object(l.a)(n.playCallbacks);try{for(c.s();!(i=c.n()).done;){(0,i.value)(e.data.echo)}}catch(h){c.e(h)}finally{c.f()}break;case"pause":var o,s=Object(l.a)(n.pauseCallbacks);try{for(s.s();!(o=s.n()).done;){(0,o.value)(e.data.echo)}}catch(h){s.e(h)}finally{s.f()}break;case"audioTrackSelected":var u,d=Object(l.a)(n.audioTrackSelectedCallbacks);try{for(d.s();!(u=d.n()).done;){(0,u.value)(e.data.id)}}catch(h){d.e(h)}finally{d.f()}break;case"currentTime":var b,f=Object(l.a)(n.currentTimeCallbacks);try{for(f.s();!(b=f.n()).done;){(0,b.value)(e.data.value,e.data.echo)}}catch(h){f.e(h)}finally{f.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(y.a)(e,[{key:"onReady",value:function(e){this.isReady&&e(),this.readyCallbacks.push(e)}},{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"ready",value:function(e){this.protocol.postMessage({command:"ready",duration:e})}},{key:"init",value:function(){this.protocol.postMessage({command:"init"})}},{key:"play",value:function(){this.protocol.postMessage({command:"play"})}},{key:"pause",value:function(){this.protocol.postMessage({command:"pause"})}},{key:"audioTrackSelected",value:function(e){this.protocol.postMessage({command:"audioTrackSelected",id:e})}},{key:"close",value:function(){this.protocol.postMessage({command:"close"}),this.protocol.close()}},{key:"currentTime",get:function(){return this.time},set:function(e){this.time=e,this.readyState=3,this.protocol.postMessage({command:"currentTime",value:this.time})}}]),e}(),Me=Object(h.a)({root:{height:"calc(100vh - 64px)",position:"relative",overflowX:"hidden"}});function Ee(e,t){var n=e%1e3,a=(e=(e-n)/1e3)%60,r=(e=(e-a)/60)%60;return t>=36e5?Ue((e-r)/60)+":"+Ue(r)+":"+Ue(a)+"."+Pe(n):Ue(r)+":"+Ue(a)+"."+Pe(n)}function Ue(e){return String(e).padStart(2,"0")}function Pe(e){return String(e).padEnd(3,"0")}function Ae(e,t,n){var a=n&&n.length>0?n[n.length-1].end-n[0].start:0,r=e.current&&e.current.duration?1e3*e.current.duration:0,i=t.current&&t.current.duration?1e3*t.current.duration:0;return Math.max(i,Math.max(a,r))}function Ie(e){var t=e.api,n=e.extension,i=e.onError,c=e.sources,o=c.subtitleFile,s=c.audioFile,l=c.audioFileUrl,u=c.videoFile,b=c.videoFileUrl,f=Object(r.useState)(),h=Object(d.a)(f,2),j=h[0],v=h[1],O=Object(r.useState)(),p=Object(d.a)(O,2),m=p[0],k=p[1],y=Object(r.useState)(!1),g=Object(d.a)(y,2),x=g[0],w=g[1],C=Object(r.useRef)();C.current=x;var T=Object(r.useState)(),S=Object(d.a)(T,2)[1],R=Object(r.useState)(),F=Object(d.a)(R,2),M=F[0],E=F[1],U=Object(r.useState)(),P=Object(d.a)(U,2),A=P[0],I=P[1],D=Object(r.useCallback)((function(){return S({})}),[]),L=Object(r.useRef)({x:0,y:0}),N=Object(r.useRef)(),W=Object(r.useRef)(),z=Object(r.useMemo)((function(){return new ye(l?N:b||j?W:{})}),[l,b,j]),H=Object(r.useMemo)((function(){return new te}),[]),B=Me(),_=Object(r.useState)([]),V=Object(d.a)(_,2),X=V[0],q=V[1],G=Object(r.useRef)(0);G.current=Ae(N,W,m);var J=Object(r.useCallback)((function(e,t,n,a){var r=e*G.current;t.setTime(r),D(),n?z.seek(r/1e3).then((function(e){return a()})):a()}),[D,z]);function Y(e,t,n){w(!0),e.start(),n&&t.play()}function K(e,t,n){w(!1),e.stop(),n&&t.pause()}Object(r.useEffect)((function(){var e,a;H.setTime(0),H.stop(),w(!1),N.current.currentTime=0,N.current.pause(),null===(e=W.current)||void 0===e||e.close(),W.current=null,a=o?t.subtitles(o).then((function(e){var t=e.length>0?e[e.length-1].end-e[0].start:0,n=e.map((function(e){return{text:e.text,start:e.start,end:e.end,displayTime:Ee(e.start,t)}}));k(n)})).catch((function(e){return i(e)})):new Promise((function(e,t){return e()})),l&&z.onReady().then((function(){return D()})),(b||j)&&a.then((function(e){var t;if(b){var a=String(Date.now());t=new Fe(new $(a)),window.open("/asbplayer/?video="+encodeURIComponent(b)+"&channel="+a,"asbplayer-video-"+b,"resizable,width=800,height=450")}else j&&(t=new Fe(new ee(j.id,n))).init();W.current=t,t.onReady((function(n){G.current=Ae(N,W,e),t.ready(G.current),t.onPlay((function(e){Y(H,z,e)})),t.onPause((function(e){K(H,z,e)})),t.onCurrentTime((function(e,t){var n=1e3*e/G.current;C.current&&H.stop(),J(n,H,t,(function(e){C.current&&H.start()}))})),t.onAudioTrackSelected((function(e){C.current&&H.stop(),z.onReady().then((function(){C.current&&H.start()})),I(e)})),t.audioTracks&&t.audioTracks.length>1?(E(W.current.audioTracks),I(W.current.selectedAudioTrack)):(E(null),I(null)),H.setTime(1e3*W.current.currentTime),n?H.stop():H.start(),w(!n)}))}))}),[t,n,H,z,J,i,o,l,b,j,D]);var Q=Object(r.useCallback)((function(){Y(H,z,!0)}),[H,z]),Z=Object(r.useCallback)((function(){K(H,z,!0)}),[H,z]),ne=Object(r.useCallback)((function(e){C.current&&H.stop(),J(e,H,!0,(function(){C.current&&H.start()}))}),[H,J]),ae=Object(r.useCallback)((function(e,t){t||K(H,z,!0),C.current&&H.stop(),J(e,H,!0,(function(){t&&!C.current&&Y(H,z,!0)}))}),[H,J,z]),re=Object(r.useCallback)((function(t,n,a){e.onCopy(t,n,a,s,u,o,A)}),[e,s,u,o,A]);var ie=Object(r.useCallback)((function(e){W.current&&W.current.audioTrackSelected(e),K(H,z,!0),J(0,H,!0,(function(){C.current&&Y(H,z,!0)}))}),[H,z,J]),ce=Object(r.useCallback)((function(e){var t=X.filter((function(t){return t.id===e}))[0];v(t)}),[X]);Object(r.useEffect)((function(){var e=setInterval((function(){var e=G.current;H.progress(e)>=1&&(H.setTime(0),H.stop(),z.pause(),w(!1))}),1e3);return function(){return clearInterval(e)}}),[H,m,z]),Object(r.useEffect)((function(){var t=setInterval((function(){if(e.extension.tabs.length!==X.length)q(e.extension.tabs);else{for(var t=!1,n=0;n<X.length;++n){var a=X[n],r=e.extension.tabs[n];if(a.id!==r.id||a.title!==r.title||a.src!==r.src){t=!0;break}}t&&q(e.extension.tabs)}j&&0===e.extension.tabs.filter((function(e){return e.id===j.id&&e.src===j.src})).length&&(v(null),e.onError("Lost connection with tab "+j.id+" "+j.title))}),1e3);return function(){return clearInterval(t)}}),[X,j,e]);var oe=G.current,se=l||b||m;return Object(a.jsxs)("div",{onMouseMove:function(e){L.current.x=e.screenX,L.current.y=e.screenY},className:B.root,children:[se&&Object(a.jsx)(ke,{mousePositionRef:L,playing:x,clock:H,length:oe,audioTracks:M,selectedAudioTrack:A,tabs:!b&&!l&&X,selectedTab:j&&j.id,onPlay:Q,onPause:Z,onSeek:ne,onAudioTrackSelected:ie,onTabSelected:ce}),Object(a.jsx)(Re,{playing:x,subtitles:m,clock:H,length:oe,jumpToSubtitle:e.jumpToSubtitle,onSeek:ae,onCopy:re}),Object(a.jsx)("audio",{ref:N,src:l})]})}var De=function(){function e(t){Object(k.a)(this,e),this.channel=new BroadcastChannel(t),this.time=0,this.duration=0,this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.closeCallbacks=[],this.readyCallbacks=[];var n=this;this.channel.onmessage=function(e){switch(e.data.command){case"init":break;case"ready":var t,a=Object(l.a)(n.readyCallbacks);try{for(a.s();!(t=a.n()).done;){(0,t.value)(e.data.duration)}}catch(j){a.e(j)}finally{a.f()}break;case"play":var r,i=Object(l.a)(n.playCallbacks);try{for(i.s();!(r=i.n()).done;){(0,r.value)()}}catch(j){i.e(j)}finally{i.f()}break;case"pause":var c,o=Object(l.a)(n.pauseCallbacks);try{for(o.s();!(c=o.n()).done;){(0,c.value)()}}catch(j){o.e(j)}finally{o.f()}break;case"currentTime":var s,u=Object(l.a)(n.currentTimeCallbacks);try{for(u.s();!(s=u.n()).done;){(0,s.value)(e.data.value)}}catch(j){u.e(j)}finally{u.f()}break;case"audioTrackSelected":var d,b=Object(l.a)(n.audioTrackSelectedCallbacks);try{for(b.s();!(d=b.n()).done;){(0,d.value)(e.data.id)}}catch(j){b.e(j)}finally{b.f()}break;case"close":var f,h=Object(l.a)(n.closeCallbacks);try{for(h.s();!(f=h.n()).done;){(0,f.value)()}}catch(j){h.e(j)}finally{h.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(y.a)(e,[{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onClose",value:function(e){this.closeCallbacks.push(e)}},{key:"onReady",value:function(e){this.readyCallbacks.push(e)}},{key:"ready",value:function(e,t,n,a){this.channel.postMessage({command:"ready",duration:e,paused:t,currentTime:0,audioTracks:n,selectedAudioTrack:a})}},{key:"readyState",value:function(e){this.channel.postMessage({command:"readyState",value:e})}},{key:"play",value:function(){this.channel.postMessage({command:"play",echo:!0})}},{key:"pause",value:function(){this.channel.postMessage({command:"pause",echo:!0})}},{key:"audioTrackSelected",value:function(e){this.channel.postMessage({command:"audioTrackSelected",id:e})}},{key:"close",value:function(){this.channel&&(this.channel.close(),this.channel=null)}},{key:"currentTime",get:function(){return this.time},set:function(e){this.time=e,this.channel.postMessage({command:"currentTime",value:this.time,echo:!0})}}]),e}(),Le=Object(h.a)({root:{backgroundColor:"black",width:"100%",height:"100vh",overflow:"hidden"},video:{objectFit:"cover",position:"absolute",width:"auto",height:"100%"}});function Ne(e,t,n,a){if(window.outerWidth&&e.videoWidth>0&&e.videoHeight>0){var r=window.screen.availWidth-(window.outerWidth-window.innerWidth),i=window.screen.availHeight-(window.outerHeight-window.innerHeight),c=Math.min(1,Math.min(r/e.videoWidth,i/e.videoHeight));window.resizeTo(c*e.videoWidth+(window.outerWidth-window.innerWidth),c*e.videoHeight+(window.outerHeight-window.innerHeight))}var o,s;if(e.audioTracks){o=[];var u,d=Object(l.a)(e.audioTracks);try{for(d.s();!(u=d.n()).done;){var b=u.value;o.push({id:b.id,label:b.label,language:b.language}),b.enabled&&(s=b.id)}}catch(f){d.e(f)}finally{d.f()}}else o=null,s=null;n(o),a(s),t.ready(e.duration,e.paused,o,s)}function We(e){var t=Le(),n=Object(r.useMemo)((function(){var e=new URLSearchParams(window.location.search);return{videoFile:e.get("video"),channel:e.get("channel")}}),[]),i=n.videoFile,c=n.channel,o=Object(r.useMemo)((function(){return new De(c)}),[c]),s=Object(r.useState)(!1),u=Object(d.a)(s,2),b=u[0],f=u[1],h=Object(r.useRef)();h.current=b;var j=Object(r.useState)(0),v=Object(d.a)(j,2),O=v[0],p=v[1],m=Object(r.useState)(null),k=Object(d.a)(m,2),y=k[0],g=k[1],x=Object(r.useState)(null),w=Object(d.a)(x,2),C=w[0],T=w[1],S=Object(r.useMemo)((function(){return new te}),[]),R=Object(r.useRef)({x:0,y:0}),F=Object(r.useRef)(null),M=Object(r.useCallback)((function(t){t&&(F.current=t,4===t.readyState?Ne(t,o,g,T):t.onloadeddata=function(e){Ne(t,o,g,T)},t.oncanplay=function(e){o.readyState(4),h.current&&S.start()},t.onerror=function(n){e.onError(function(e){var t;switch(e.error.code){case 1:t="Aborted";break;case 2:t="Network error";break;case 3:t="Decoding error";break;case 4:t="Source not supported";break;default:t="Unknown error"}return t+": "+(e.error.message||"<details missing>")}(t))})}),[g,T,S,o,e]);function E(e){var t,n=Object(l.a)(F.current.audioTracks);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.id===e?a.enabled=!0:a.enabled=!1}}catch(r){n.e(r)}finally{n.f()}}Object(r.useEffect)((function(){return o.onReady((function(e){p(e)})),o.onPlay((function(){F.current.play(),S.start(),f(!0)})),o.onPause((function(){F.current.pause(),S.stop(),f(!1)})),o.onCurrentTime((function(e){var t;F.current&&(F.current.currentTime=e),4===(null===(t=F.current)||void 0===t?void 0:t.readyState)&&o.readyState(4),S.stop(),S.setTime(1e3*e)})),o.onAudioTrackSelected((function(e){E(e),o.audioTrackSelected(e)})),o.onClose((function(){o.close(),window.close()})),function(){o.close()}}),[S,f,o]);var U=Object(r.useCallback)((function(){F.current&&o.play()}),[o]),P=Object(r.useCallback)((function(){o.pause()}),[o]),A=Object(r.useCallback)((function(e){h.current&&S.stop();var t=e*O;o.currentTime=t/1e3}),[O,S,o]);var I=Object(r.useCallback)((function(e){h.current&&(S.stop(),o.pause()),E(e),T(e),o.currentTime=0,o.audioTrackSelected(e)}),[o,S]);return Object(a.jsxs)("div",{onMouseMove:function(e){R.current.x=e.screenX,R.current.y=e.screenY},className:t.root,children:[Object(a.jsx)("video",{preload:"auto",nocontrols:1,className:t.video,ref:M,src:i}),Object(a.jsx)(ke,{mousePositionRef:R,playing:b,clock:S,length:O,audioTracks:y,selectedAudioTrack:C,onPlay:U,onPause:P,onSeek:A,onAudioTrackSelected:I})]})}function ze(e){var t,n=(t=e.drawerWidth,Object(h.a)((function(e){return{content:{flexGrow:1,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginRight:0},contentShift:{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:t}}})))();return Object(a.jsx)("main",{className:Object(j.a)(n.content,Object(b.a)({},n.contentShift,e.drawerOpen)),children:e.children})}var He=function(){var e=Object(r.useMemo)((function(){return new w}),[]),t=Object(r.useMemo)((function(){return new U}),[]),n=function(e){var t=Object(r.useState)([0,0]),n=Object(d.a)(t,2),a=n[0],i=n[1];return Object(r.useLayoutEffect)((function(){function t(){e||i([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",t),t(),function(){return window.removeEventListener("resize",t)}}),[e]),a}("/video"===Object(f.g)().pathname),i=Object(d.a)(n,1)[0],c=Math.max(400,.3*i),o=Object(r.useState)([]),s=Object(d.a)(o,2),b=s[0],h=s[1],j=Object(r.useState)(!1),v=Object(d.a)(j,2),O=v[0],p=v[1],k=Object(r.useState)(),y=Object(d.a)(k,2),g=y[0],x=y[1],C=Object(r.useState)(!1),T=Object(d.a)(C,2),S=T[0],R=T[1],F=Object(r.useState)(),M=Object(d.a)(F,2),P=M[0],A=M[1],I=Object(r.useState)({}),D=Object(d.a)(I,2),L=D[0],N=D[1],W=Object(r.useState)(),z=Object(d.a)(W,2),H=z[0],B=z[1],_=L.subtitleFile,V=Object(r.useCallback)((function(e,t,n,a,r,i,c){h((function(o){return[].concat(Object(u.a)(o),[{timestamp:Date.now(),text:e,start:t,end:n,name:H,subtitleFile:i,audioFile:a,videoFile:r,audioTrack:c}])}))}),[H]),X=Object(r.useCallback)((function(e){p(!O)}),[O]),q=Object(r.useCallback)((function(){p(!1)}),[p]),G=Object(r.useCallback)((function(e){var t,n=[],a=Object(l.a)(b);try{for(a.s();!(t=a.n()).done;){var r=t.value;e.timestamp!==r.timestamp&&n.push(r)}}catch(i){a.e(i)}finally{a.f()}h(n)}),[b]),J=Object(r.useCallback)((function(){R(!1)}),[]),Y=Object(r.useCallback)((function(e){x(e),R(!0)}),[]),K=Object(r.useCallback)((function(t){t.audioFile?e.clipAudioFromAudioFile(t.audioFile,t.start,t.end).catch((function(e){Y(e.message)})):t.videoFile&&e.clipAudioFromVideoFile(t.videoFile,t.start,t.end,t.audioTrack).catch((function(e){Y(e.message)}))}),[e,Y]),Q=Object(r.useCallback)((function(e){_===e.subtitleFile?A({text:e.text,start:e.start}):Y("Subtitle file "+e.subtitleFile.name+" is not open.")}),[_,Y]);function $(e){e.audioFileUrl&&URL.revokeObjectURL(e.audioFileUrl),e.videoFileUrl&&URL.revokeObjectURL(e.videoFileUrl)}var ee=Object(r.useCallback)((function(e){if(e.preventDefault(),e.dataTransfer.files&&0!==e.dataTransfer.files.length){var t=e.dataTransfer.files[0],n=t.name.lastIndexOf(".");if(-1!==n){var a=t.name.substring(n+1,t.name.length);switch(a){case"ass":case"srt":N((function(e){return{subtitleFile:t,audioFile:e.audioFile,audioFileUrl:e.audioFileUrl,videoFile:e.videoFile,videoFileUrl:e.videoFileUrl}})),B(t.name);break;case"mkv":N((function(e){return $(e),{subtitleFile:e.subtitleFile,audioFile:null,audioFileUrl:null,videoFile:t,videoFileUrl:URL.createObjectURL(t)}})),L.subtitleFile||B(t.name);break;case"mp3":N((function(e){return $(e),{subtitleFile:e.subtitleFile,audioFile:t,audioFileUrl:URL.createObjectURL(t),videoFile:null,videoFileUrl:null}})),L.subtitleFile||B(H);break;default:Y("Unsupported file type "+a)}}else Y("Unable to determine file type of "+t.name)}}),[L,H,Y]);return Object(a.jsxs)("div",{onDrop:ee,onDragOver:function(e){return e.preventDefault()},children:[Object(a.jsx)(m,{open:S,onClose:J,autoHideDuration:3e3,severity:"error",children:g}),Object(a.jsxs)(f.d,{children:[Object(a.jsx)(f.b,{exact:!0,path:"/",render:function(){var n=new URLSearchParams(window.location.search),r=n.get("video"),i=n.get("channel");return r&&i?Object(a.jsx)(f.a,{to:"/video?video="+encodeURIComponent(r)+"&channel="+i}):Object(a.jsxs)("div",{children:[Object(a.jsx)(Z,{items:b,open:O,drawerWidth:c,onClose:q,onDelete:G,onClipAudio:K,onSelect:Q}),Object(a.jsx)(E,{title:H||"a subtitle player",drawerWidth:c,drawerOpen:O,onOpenCopyHistory:X}),Object(a.jsx)(ze,{drawerWidth:c,drawerOpen:O,children:Object(a.jsx)(Ie,{api:e,onCopy:V,onError:Y,sources:L,jumpToSubtitle:P,extension:t})})]})}}),Object(a.jsx)(f.b,{exact:!0,path:"/video",children:Object(a.jsx)(We,{api:e,onError:Y})})]})]})},Be=n(79),_e=n(133),Ve=Object(_e.a)({palette:{primary:{main:"#556cd6"},secondary:{main:"#19857b"},error:{main:Be.a.A400},background:{default:"#fff"}}}),Xe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,260)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),i(e),c(e)}))},qe=n(66);c.a.render(Object(a.jsx)(qe.a,{basename:"/asbplayer",forceRefresh:!1,children:Object(a.jsxs)(s.a,{theme:Ve,children:[Object(a.jsx)(o.a,{}),Object(a.jsx)(He,{})]})}),document.querySelector("#root")),Xe()}},[[194,1,2]]]);
//# sourceMappingURL=main.e9b7e1b2.chunk.js.map