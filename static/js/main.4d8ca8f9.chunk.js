(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{165:function(e,t){},167:function(e,t){},186:function(e,t){},188:function(e,t){},196:function(e,t){},198:function(e,t){},206:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n(0),i=n.n(r),c=n(13),o=n.n(c),s=n(268),l=n(267),u=n(8),d=n(36),b=n(42),f=n(5),h=n(39),j=n(15),v=n(246);function O(e){var t=Object(r.useState)([0,0]),n=Object(f.a)(t,2),a=n[0],i=n[1];return Object(r.useLayoutEffect)((function(){function t(){e&&i([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",t),t(),function(){return window.removeEventListener("resize",t)}}),[e]),a}var p=n(4),m=n(270),g=n(207),k=Object(v.a)({root:{display:"flex",justifyContent:"center",position:"fixed",top:80,width:"100%",pointerEvents:"none",zIndex:2e3}});function y(e){var t=k();return Object(r.useEffect)((function(){if(e.open){var t=setTimeout(e.onClose,e.autoHideDuration);return function(){return clearTimeout(t)}}return null}),[e.open,e.autoHideDuration,e.onClose]),Object(a.jsx)("div",{className:t.root,children:Object(a.jsx)(g.a,{in:e.open,children:Object(a.jsx)(m.a,{severity:e.severity,children:e.children})})})}var x=n(21),C=n(22),w=n(121),S=n(269),T=function(){function e(){Object(x.a)(this,e)}return Object(C.a)(e,[{key:"subtitles",value:function(e){if(e.name.endsWith(".srt"))return e.text().then((function(e){return Object(w.a)(e)})).then((function(e){return e.map((function(e){return e.data}))}));if(e.name.endsWith(".ass"))return e.text().then((function(e){return Object(S.a)(e)})).then((function(e){return e.events.dialogue.map((function(e){return{start:Math.round(1e3*e.Start),end:Math.round(1e3*e.End),text:e.Text.combined}}))}));throw new Error("Unsupported subtitle file format")}},{key:"clipAudioFromAudioFile",value:function(e,t,n,a){var r=this;return new Promise((function(i,c){var o=document.createElement("audio");r._clipMedia(o,e,t,n,a,i)}))}},{key:"clipAudioFromVideoFile",value:function(e,t,n,a){var r=this;return new Promise((function(i,c){var o=document.createElement("video");r._clipMedia(o,e,t,n,a,i)}))}},{key:"_clipMedia",value:function(e,t,n,a,r,i){var c=this;if(e.src=URL.createObjectURL(t),e.preload="none",r&&e.audioTracks&&e.audioTracks.length>0){var o,s=Object(u.a)(e.audioTracks);try{for(s.s();!(o=s.n()).done;){var l=o.value;l.enabled=r===l.id}}catch(d){s.e(d)}finally{s.f()}}e.currentTime=n/1e3,e.load(),e.oncanplay=function(r){e.play();var o,s=e.captureStream(),l=Object(u.a)(s.getVideoTracks());try{for(l.s();!(o=l.n()).done;){o.value.enabled=!1}}catch(d){l.e(d)}finally{l.f()}var b=new MediaRecorder(s),f=[];b.ondataavailable=function(e){f.push(e.data)},b.onstop=function(e){c._saveToFile(new Blob(f),c._nameWithoutExtension(t.name)+"_"+n+"_"+a+".wav"),i()},b.start(),setTimeout((function(){e.pause(),b.stop();var t=e.src;e.src=null,URL.revokeObjectURL(t)}),a-n+100)}}},{key:"_nameWithoutExtension",value:function(e){return e.substring(0,e.lastIndexOf("."))}},{key:"_saveToFile",value:function(e,t){var n=window.URL.createObjectURL(e),a=document.createElement("a");document.body.appendChild(a),a.style="display: none",a.href=n,a.download=t,a.click(),URL.revokeObjectURL(n),a.remove()}}]),e}(),E=n(250),F=n(249),R=n(125),M=n.n(R),U=n(251),I=n(67);function A(e){var t,n=(t=e.drawerWidth,Object(v.a)((function(e){return{title:{flexGrow:1},appBar:{transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{width:"calc(100% - ".concat(t,"px)"),transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:t},hide:{display:"none"}}})))();return Object(a.jsx)(E.a,{position:"static",className:Object(p.a)(n.appBar,Object(h.a)({},n.appBarShift,e.drawerOpen)),children:Object(a.jsxs)(U.a,{children:[Object(a.jsx)(I.a,{variant:"h6",className:n.title,children:e.title}),Object(a.jsx)(F.a,{edge:"end",color:"inherit","aria-label":"menu",onClick:e.onOpenCopyHistory,className:Object(p.a)(e.drawerOpen&&n.hide),children:Object(a.jsx)(M.a,{})})]})})}var N=function(){function e(){var t=this;Object(x.a)(this,e),this.onMessageCallbacks=[],this.tabs=[],window.addEventListener("message",(function(e){if(e.source===window&&"asbplayer-extension-to-player"===e.data.sender&&e.data.message)if("tabs"===e.data.message.command)t.tabs=e.data.message.tabs;else{var n,a=Object(u.a)(t.onMessageCallbacks);try{for(a.s();!(n=a.n()).done;){(0,n.value)({data:e.data.message,tabId:e.data.tabId})}}catch(r){a.e(r)}finally{a.f()}}}))}return Object(C.a)(e,[{key:"sendMessage",value:function(e,t){window.postMessage({sender:"asbplayer",message:e,tabId:t},"*")}},{key:"subscribe",value:function(e){this.onMessageCallbacks.push(e)}},{key:"unsubscribe",value:function(e){for(var t=this.onMessageCallbacks.length-1;t>=0;--t)if(e===this.onMessageCallbacks[t]){this.onMessageCallbacks.splice(t,1);break}}}]),e}(),L=n(259),P=n(272),D=n(128),z=n.n(D),H=n(127),W=n.n(H),B=n(253),_=n(254),V=n(257),X=n(255),G=n(256),q=n(252),J=n(126),Y=n.n(J);function K(e){var t=e.open,n=e.anchorEl,i=e.onClose,c=e.onSelect,o=e.onClipAudio,s=e.item,l=Object(r.useCallback)((function(){navigator.clipboard.writeText(s.text),i()}),[s,i]),u=Object(r.useCallback)((function(){c(s),i()}),[s,c,i]),d=Object(r.useCallback)((function(){o(s),i()}),[s,o,i]);return s?Object(a.jsx)(q.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:i,anchorOrigin:{vertical:"center",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"right"},children:Object(a.jsxs)(B.a,{children:[Object(a.jsx)(_.a,{button:!0,onClick:l,children:Object(a.jsx)(X.a,{primaryTypographyProps:{variant:"body2"},primary:"Copy"})}),Object(a.jsx)(_.a,{button:!0,onClick:u,children:Object(a.jsx)(X.a,{primaryTypographyProps:{variant:"body2"},primary:"Jump To"})}),(s.videoFile||s.audioFile)&&Object(a.jsx)(_.a,{button:!0,onClick:d,children:Object(a.jsx)(X.a,{primaryTypographyProps:{variant:"body2"},primary:"Clip Audio"})})]})}):null}function $(e){var t,n=(t=e.drawerWidth,Object(v.a)((function(e){return{drawer:{width:t,flexShrink:0},drawerPaper:{width:t},drawerHeader:Object(d.a)(Object(d.a)({display:"flex",alignItems:"center",position:"static",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-start"}),listContainer:{position:"relative",height:"100%",overflowY:"auto",overflowX:"hidden"},listItem:{"&:hover":{backgroundColor:e.palette.action.hover}},listItemGutters:{paddingLeft:5,paddingRight:5},listItemIconRoot:{minWidth:20}}})))(),c=Object(r.useCallback)((function(e){e&&e.scrollIntoView()}),[]),o=Object(r.useState)(),s=Object(f.a)(o,2),l=s[0],b=s[1],h=Object(r.useState)(!1),j=Object(f.a)(h,2),O=j[0],p=j[1],m=Object(r.useState)(),g=Object(f.a)(m,2),k=g[0],y=g[1],x=Object(r.useCallback)((function(e,t){b(t),p(!0),y(e.currentTarget)}),[]),C=Object(r.useCallback)((function(e,t){b(null),p(!1),y(null)}),[]),w=Object(r.useCallback)((function(t){e.onDelete(t)}),[e]),S=null;if(e.items.length>0){S=[];var T,E=null,R=0,M=Object(u.a)(e.items);try{var U=function(){var t=T.value;null!==E&&E===t.name||(E=t.name,S.push(Object(a.jsx)(G.a,{disableSticky:!0,children:t.name},t.name)));var r=R===e.items.length-1?c:null;S.push(Object(a.jsxs)(_.a,{ref:r,className:n.listItem,classes:{gutters:n.listItemGutters},children:[Object(a.jsx)(V.a,{classes:{root:n.listItemIconRoot},children:Object(a.jsx)(F.a,{onClick:function(e){return x(e,t)},children:Object(a.jsx)(Y.a,{fontSize:"small"})})}),Object(a.jsx)(X.a,{children:t.text}),Object(a.jsx)(V.a,{classes:{root:n.listItemIconRoot},children:Object(a.jsx)(F.a,{onClick:function(){return w(t)},children:Object(a.jsx)(W.a,{fontSize:"small"})})})]},t.timestamp)),++R};for(M.s();!(T=M.n()).done;)U()}catch(A){M.e(A)}finally{M.f()}}else S=Object(a.jsx)(_.a,{children:"Copy history is empty."});var I=Object(a.jsx)(B.a,{children:S});return Object(a.jsxs)(i.a.Fragment,{children:[Object(a.jsxs)(P.a,{variant:"persistent",anchor:"right",open:e.open,className:n.drawer,classes:{paper:n.drawerPaper},children:[Object(a.jsx)("div",{className:n.drawerHeader,children:Object(a.jsx)(F.a,{onClick:e.onClose,children:Object(a.jsx)(z.a,{})})}),Object(a.jsx)(L.a,{}),Object(a.jsx)("div",{className:n.listContainer,children:I})]}),Object(a.jsx)(K,{open:e.open&&O,anchorEl:k,item:l,onClose:C,onSelect:e.onSelect,onClipAudio:e.onClipAudio})]})}var Q=function(){function e(t){Object(x.a)(this,e),this.channel=new BroadcastChannel(t);var n=this;this.channel.onmessage=function(e){var t;null===(t=n.onMessage)||void 0===t||t.call(n,e)}}return Object(C.a)(e,[{key:"postMessage",value:function(e){this.channel.postMessage(e)}},{key:"close",value:function(){this.channel.close()}}]),e}(),Z=function(){function e(t,n){var a=this;Object(x.a)(this,e),this.tabId=t,this.listener=function(e){var n;e.tabId===t&&(null===(n=a.onMessage)||void 0===n||n.call(a,{data:e.data}))},n.subscribe(this.listener),this.extension=n}return Object(C.a)(e,[{key:"postMessage",value:function(e){this.extension.sendMessage(e,this.tabId)}},{key:"close",value:function(){this.extension.unsubscribe(this.listener)}}]),e}(),ee=function(){function e(){Object(x.a)(this,e),this.accumulated=0,this.started=!1}return Object(C.a)(e,[{key:"time",value:function(e){return this.started?Math.min(e,this.accumulated+Date.now()-this.startTime):Math.min(e,this.accumulated)}},{key:"stop",value:function(){this.started&&(this.started=!1,this.accumulated+=Date.now()-this.startTime)}},{key:"start",value:function(){this.startTime=Date.now(),this.started=!0}},{key:"setTime",value:function(e){this.started?(this.startTime=Date.now(),this.accumulated=e):this.accumulated=e}},{key:"progress",value:function(e){return 0===e?0:Math.min(1,this.time(e)/e)}}]),e}(),te=n(6),ne=n(135),ae=n.n(ne),re=n(129),ie=n.n(re),ce=n(258),oe=n(260),se=n(271),le=n(137),ue=n.n(le),de=n(139),be=n.n(de),fe=n(138),he=n.n(fe),je=n(130),ve=n.n(je),Oe=n(131),pe=n.n(Oe),me=n(136),ge=n.n(me),ke=n(273),ye=n(134),xe=n.n(ye),Ce=n(94),we=n.n(Ce),Se=n(132),Te=n.n(Se),Ee=n(133),Fe=n.n(Ee),Re=Object(v.a)((function(e){return{container:{position:"absolute",left:"50%",width:"50%",bottom:0},buttonContainer:{flexDirection:"row"},timeDisplay:{color:e.palette.action.active,display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",cursor:"default",fontSize:20,marginLeft:10},offsetInput:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",fontSize:20,marginLeft:10,width:100,color:e.palette.text.secondary},volumeInputContainerShown:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:5},volumeInputContainerHidden:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:0},volumeInputHidden:{transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),width:0},volumeInputShown:{transition:e.transitions.create("width",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),width:100},volumeInputThumbHidden:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),opacity:0},volumeInputThumbShown:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),opacity:1},subContainer:{background:"linear-gradient(to bottom, rgba(0,0,0,0), rgba(0,0,0,0.7))",position:"relative",left:"-100%",width:"200%",zIndex:10,padding:10},button:{color:e.palette.action.active},inactiveButton:{color:e.palette.action.disabled},progress:{margin:5},closeButton:{position:"absolute",top:0,right:0}}})),Me=Object(v.a)((function(e){return{container:{background:"rgba(30,30,30,0.7)",height:5,margin:"0 10px 5px 10px",cursor:"pointer"},fillContainer:{width:"100%"},fill:{background:"linear-gradient(to left, #e21e4a, #a92fff)",height:"100%"},handleContainer:{position:"relative",width:0,height:0},handle:{borderRadius:"50%",width:15,height:15,background:"white",position:"absolute",top:5,left:12,filter:"drop-shadow(3px 3px 3px rgba(0,0,0,0.3))"}}})),Ue=Object(te.a)((function(e){return{root:{color:e.palette.text.secondary,verticalAlign:"middle"},thumb:{backgroundColor:"white",color:e.palette.text.secondary,"&:focus":{boxShadow:"inherit"},"&:hover, &$active":{boxShadow:"0px 0px 0px 8px rgba(255, 255, 255, 0.1)"}},active:{color:e.palette.text.secondary}}}))(ke.a);function Ie(e){var t=Math.floor(e/1e3),n=Math.floor(t/60),a=t%60;return String(n)+":"+String(a).padStart(2,"0")}function Ae(e){var t=e.getBoundingClientRect();return t.right-t.left}function Ne(e){var t=Me(),n=Object(r.useRef)(null);var i={width:e.value+"%"},c={marginLeft:n.current?Ae(n.current)*e.value/100:0};return Object(a.jsxs)("div",{ref:n,onClick:function(t){var n=t.currentTarget.getBoundingClientRect(),a=n.right-n.left,r=Math.min(1,Math.max(0,(t.pageX-n.left)/a));e.onSeek(r)},className:t.container,children:[Object(a.jsx)("div",{className:t.fill,style:i}),Object(a.jsx)("div",{className:t.handleAnchor,children:Object(a.jsx)("div",{className:t.handle,style:c})})]})}function Le(e){if(!e.audioTracks||0===e.audioTracks.length)return null;var t=e.audioTracks.map((function(t){return Object(a.jsxs)(_.a,{selected:t.id===e.selectedAudioTrack,button:!0,onClick:function(){return e.onAudioTrackSelected(t.id)},children:[t.language," ",t.label]},t.id)}));return Object(a.jsx)("div",{children:Object(a.jsx)(q.a,{disableEnforceFocus:!0,open:e.open,anchorEl:e.anchorEl,onClose:e.onClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(a.jsx)(B.a,{children:t})})})}function Pe(e){if(!e.tabs||0===e.tabs.length)return null;var t=e.tabs.map((function(t){return Object(a.jsxs)(_.a,{selected:t.id===e.selectedTab,button:!0,onClick:function(){return e.onTabSelected(t.id)},children:[t.id," ",t.title," ",t.src]},t.id)}));return Object(a.jsx)("div",{children:Object(a.jsx)(q.a,{disableEnforceFocus:!0,open:e.open,anchorEl:e.anchorEl,onClose:e.onClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(a.jsx)(B.a,{children:t})})})}function De(e){return Object(a.jsx)("div",{children:Object(a.jsx)(q.a,{disableEnforceFocus:!0,open:e.open,anchorEl:e.anchorEl,onClose:e.onClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(a.jsx)(B.a,{children:Object(a.jsxs)(_.a,{button:!0,onClick:function(t){return e.onUnload()},children:["Unload ",e.file]})})})})}function ze(e){var t=Re(),n=e.playing,c=e.length,o=e.offsetEnabled,s=e.displayLength,l=e.offset,u=e.onAudioTrackSelected,d=e.onSeek,b=e.mousePositionRef,h=e.onPause,j=e.onPlay,v=e.onTabSelected,O=e.onUnloadAudio,p=e.onUnloadVideo,m=e.onOffsetChange,g=e.onVolumeChange,k=Object(r.useState)(!0),y=Object(f.a)(k,2),x=y[0],C=y[1],w=Object(r.useState)(!1),S=Object(f.a)(w,2),T=S[0],E=S[1],R=Object(r.useState)(),M=Object(f.a)(R,2),U=M[0],I=M[1],A=Object(r.useState)(!1),N=Object(f.a)(A,2),L=N[0],P=N[1],D=Object(r.useState)(),z=Object(f.a)(D,2),H=z[0],W=z[1],B=Object(r.useState)(!1),_=Object(f.a)(B,2),V=_[0],X=_[1],G=Object(r.useState)(),q=Object(f.a)(G,2),J=q[0],Y=q[1],K=Object(r.useState)(!1),$=Object(f.a)(K,2),Q=$[0],Z=$[1],ee=Object(r.useState)(),te=Object(f.a)(ee,2),ne=te[0],re=te[1],le=Object(r.useState)(!1),de=Object(f.a)(le,2),fe=de[0],je=de[1],Oe=Object(r.useState)(100),me=Object(f.a)(Oe,2),ke=me[0],ye=me[1],Ce=Object(r.useState)(100),Se=Object(f.a)(Ce,2),Ee=Se[0],Me=Se[1],Ae=Object(r.useRef)({x:0,y:0}),ze=Object(r.useRef)(Date.now()),He=Object(r.useRef)(!0),We=Object(r.useRef)(!1),Be=Object(r.useRef)(),_e=Object(r.useState)(),Ve=Object(f.a)(_e,2)[1],Xe=Object(r.useCallback)((function(){return Ve({})}),[]),Ge=Object(r.useCallback)((function(e){d(e)}),[d]);Object(r.useEffect)((function(){var e=setInterval((function(){var e=Date.now()-ze.current<2e3||Math.pow(b.current.x-Ae.current.x,2)+Math.pow(b.current.y-Ae.current.y,2)>100||We.current||Be.current===document.activeElement;e&&!He.current?(ze.current=Date.now(),C(e)):!e&&He.current&&C(e),He.current=e,Ae.current.x=b.current.x,Ae.current.y=b.current.y}),100);return function(){return clearInterval(e)}}),[b,C,x]),Object(r.useEffect)((function(){function e(e){if(32===e.keyCode)e.preventDefault(),n?h():j();else if(13===e.keyCode&&Be.current===document.activeElement){var t=Number(Be.current.value);if(Number.isNaN(t))return;m(1e3*t),Be.current.blur()}}return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[n,h,j,m]),Object(r.useEffect)((function(){var e=setInterval((function(){Xe()}),100);return function(){return clearInterval(e)}}),[Xe]),Object(r.useEffect)((function(){if(Be.current)if(0===l)Be.current.value=null;else{var e=l/1e3,t=e>=0?"+"+e.toFixed(2):String(e.toFixed(2));Be.current.value=t}}),[l]);var qe=Object(r.useCallback)((function(){I(null),E(!1)}),[]),Je=Object(r.useCallback)((function(e){I(e.currentTarget),E(!0)}),[]),Ye=Object(r.useCallback)((function(e){u(e),I(null),E(!1)}),[u]),Ke=Object(r.useCallback)((function(){W(null),P(!1)}),[]),$e=Object(r.useCallback)((function(e){W(e.currentTarget),P(!0)}),[]),Qe=Object(r.useCallback)((function(e){v(e),W(null),P(!1)}),[v]),Ze=Object(r.useCallback)((function(){Y(null),X(!1)}),[]),et=Object(r.useCallback)((function(e){Y(e.currentTarget),X(!0)}),[]),tt=Object(r.useCallback)((function(){O(),X(!1)}),[O]),nt=Object(r.useCallback)((function(e){re(null),Z(!1)}),[]),at=Object(r.useCallback)((function(e){re(e.currentTarget),Z(!0)}),[]),rt=Object(r.useCallback)((function(){p(),Z(!1)}),[p]),it=Object(r.useCallback)((function(){return je(!1)}),[]),ct=Object(r.useCallback)((function(){return je(!0)}),[]),ot=Object(r.useCallback)((function(e,t){ye(t),g(t/100)}),[g]),st=Object(r.useCallback)((function(e,t){t>0&&Me(t)}),[]),lt=Object(r.useCallback)((function(e,t){ye((function(e){var t=e>0?0:Ee;return g(t/100),t}))}),[g,Ee]),ut=e.clock.progress(c);return Object(a.jsxs)(i.a.Fragment,{children:[e.closeEnabled&&Object(a.jsx)(ce.a,{in:x,timeout:200,children:Object(a.jsx)(F.a,{className:t.closeButton,onClick:function(){return e.onClose()},children:Object(a.jsx)(ie.a,{})})}),Object(a.jsxs)("div",{className:t.container,onMouseOver:function(e){We.current=!0},onMouseOut:function(e){We.current=!1},children:[Object(a.jsx)(ce.a,{in:x,timeout:200,children:Object(a.jsxs)("div",{className:t.subContainer,children:[Object(a.jsx)(Ne,{onSeek:Ge,value:100*ut}),Object(a.jsxs)(oe.a,{container:!0,direction:"row",children:[Object(a.jsx)(oe.a,{item:!0,children:Object(a.jsx)(F.a,{onClick:function(){return n?h():j()},children:n?Object(a.jsx)(ve.a,{className:t.button}):Object(a.jsx)(pe.a,{className:t.button})})}),e.volumeEnabled&&Object(a.jsxs)(oe.a,{item:!0,onMouseOver:ct,onMouseOut:it,className:fe?t.volumeInputContainerShown:t.volumeInputContainerHidden,children:[Object(a.jsx)(F.a,{onClick:lt,children:0===ke?Object(a.jsx)(Te.a,{}):Object(a.jsx)(Fe.a,{})}),Object(a.jsx)(Ue,{onChange:ot,onChangeCommitted:st,value:ke,defaultValue:100,classes:{root:fe?t.volumeInputShown:t.volumeInputHidden,thumb:fe?t.volumeInputThumbShown:t.volumeInputThumbHidden}})]}),Object(a.jsx)(oe.a,{item:!0,children:Object(a.jsxs)("div",{className:t.timeDisplay,children:[Ie(ut*c)," / ",Ie(s||c)]})}),o&&Object(a.jsx)(oe.a,{item:!0,children:Object(a.jsx)(se.a,{inputRef:Be,disableUnderline:!0,className:t.offsetInput,placeholder:"\xb1"+Number(0).toFixed(2)})}),Object(a.jsx)(oe.a,{style:{flexGrow:1},item:!0}),e.subtitlesToggle&&Object(a.jsx)(oe.a,{item:!0,children:Object(a.jsx)(F.a,{onClick:function(t){return e.onSubtitlesToggle()},children:Object(a.jsx)(xe.a,{className:e.subtitlesEnabled?t.button:t.inactiveButton})})}),e.videoFile&&Object(a.jsx)(oe.a,{item:!0,children:Object(a.jsx)(F.a,{onClick:at,children:Object(a.jsx)(we.a,{className:t.button})})}),e.audioFile&&Object(a.jsx)(oe.a,{item:!0,children:Object(a.jsx)(F.a,{onClick:et,children:Object(a.jsx)(ae.a,{className:t.button})})}),e.audioTracks&&e.audioTracks.length>1&&Object(a.jsx)(oe.a,{item:!0,children:Object(a.jsx)(F.a,{onClick:Je,children:Object(a.jsx)(ge.a,{className:t.button})})}),e.tabs&&e.tabs.length>0&&Object(a.jsx)(oe.a,{item:!0,children:Object(a.jsx)(F.a,{onClick:$e,children:Object(a.jsx)(we.a,{className:e.selectedTab?t.button:t.inactiveButton})})}),e.popOutEnabled&&Object(a.jsx)(oe.a,{item:!0,children:Object(a.jsx)(F.a,{onClick:function(){return e.onPopOutToggle()},children:Object(a.jsx)(ue.a,{style:e.popOut?{transform:"rotateX(180deg)"}:{}})})}),e.fullscreenEnabled&&Object(a.jsx)(oe.a,{item:!0,children:Object(a.jsx)(F.a,{onClick:function(){return e.onFullscreenToggle()},children:e.fullscreen?Object(a.jsx)(he.a,{}):Object(a.jsx)(be.a,{})})})]})]})}),Object(a.jsx)(Pe,{open:L&&x,anchorEl:H,tabs:e.tabs,selectedTab:e.selectedTab,onClose:Ke,onTabSelected:Qe}),Object(a.jsx)(Le,{open:T&&x,anchorEl:U,audioTracks:e.audioTracks,selectedAudioTrack:e.selectedAudioTrack,onClose:qe,onAudioTrackSelected:Ye}),Object(a.jsx)(De,{open:V,anchorEl:J,file:e.audioFile,onClose:Ze,onUnload:tt}),Object(a.jsx)(De,{open:Q,anchorEl:ne,file:e.videoFile,onClose:nt,onUnload:rt})]})]})}var He=function(){function e(t){Object(x.a)(this,e),this.ref=t,this.readyResolves=[]}return Object(C.a)(e,[{key:"seek",value:function(e){var t=this;return new Promise((function(n,a){t.ref.current?(t.ref.current.currentTime=e,t._onMediaCanPlay((function(){return n()}))):n()}))}},{key:"onReady",value:function(){var e=this;return new Promise((function(t,n){e.ref.current?e._onMediaCanPlay((function(){return t()})):t()}))}},{key:"_onMediaCanPlay",value:function(e){var t=this;4!==this.ref.readyState?(this.ref.current&&!this.ref.current.oncanplay&&(this.ref.current.oncanplay=function(e){var n,a=Object(u.a)(t.readyResolves);try{for(a.s();!(n=a.n()).done;){(0,n.value)()}}catch(r){a.e(r)}finally{a.f()}t.readyResolves.length=0,t.ref.current.oncanplay=null}),this.readyResolves.push(e)):e()}},{key:"play",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.play()}},{key:"pause",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.pause()}}]),e}();function We(e){return e.ctrlKey&&e.shiftKey&&65===e.keyCode}var Be=n(140),_e=n.n(Be),Ve=n(261),Xe=n(144),Ge=n(263),qe=n(264),Je=n(266),Ye=n(262),Ke=n(265),$e=n.p+"static/media/background.aa598bb3.png",Qe=Object(v.a)((function(e){return{container:{height:"calc(100vh - 64px)",position:"relative",overflowX:"hidden",backgroundColor:e.palette.background.default},table:{backgroundColor:e.palette.background.default,marginBottom:75},subtitleRow:{"&:hover":{backgroundColor:e.palette.action.hover}},subtitle:{fontSize:20,paddingRight:0,minWidth:200,width:"100%"},compressedSubtitle:{fontSize:16,paddingRight:0,minWidth:200,width:"100%"},timestamp:{fontSize:14,color:"#aaaaaa",textAlign:"right",paddingRight:15,paddingLeft:5},copyButton:{textAlign:"right",padding:0},noSubtitles:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundImage:"url("+$e+")",backgroundSize:"500px 500px",backgroundRepeat:"no-repeat",backgroundPosition:"center",padding:15,textAlign:"center"}}}));function Ze(e){var t=e.clock,n=e.onSeek,c=e.onCopy,o=e.playing,s=e.subtitles,l=e.length,d=e.jumpToSubtitle,h=e.compressed,j=Object(r.useRef)();j.current=t;var v=Object(r.useRef)();v.current=s;var O=Object(r.useMemo)((function(){return s?Array(s.length).fill().map((function(e,t){return Object(r.createRef)()})):[]}),[s]),p=Object(r.useRef)();p.current=O;var m=Object(r.useState)({}),g=Object(f.a)(m,2),k=g[0],y=g[1],x=Object(r.useRef)({}),C=Object(r.useRef)();C.current=e.length;var w=Object(r.useRef)(0),S=Object(r.useRef)(),T=Object(r.useRef)();Object(r.useRef)().current=e.drawerOpen;var E=Qe();Object(r.useEffect)((function(){return S.current=requestAnimationFrame((function e(t){for(var n=v.current||[],a=p.current,r=C.current,i=j.current.progress(C.current),c=Number.MAX_SAFE_INTEGER,o=-1,s={},l=n.length-1;l>=0;--l){var u=n[l],d=u.start/r,b=u.end/r;if(i>=d)i<b&&(c=l<c?l:c,s[l]=!0),-1===o&&(o=l);else if(c!==Number.MAX_SAFE_INTEGER)break}if(c===Number.MAX_SAFE_INTEGER&&-1!==o&&(s[o]=!0),!function(e,t){for(var n in e)if(!(n in t))return!1;for(var a in t)if(!(a in e))return!1;return!0}(s,x.current)&&(x.current=s,y(s),c!==Number.MAX_SAFE_INTEGER)){var f=a[c],h=Date.now()-w.current>5e3;(null===f||void 0===f?void 0:f.current)&&h&&f.current.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}S.current=requestAnimationFrame(e)})),function(){return cancelAnimationFrame(S.current)}}),[]),Object(r.useEffect)((function(){function e(e){if(s&&0!==s.length){var t,a=Object.keys(k);if(37===e.keyCode)t=a.length>0?Math.max(0,Math.min.apply(Math,Object(b.a)(a))-1):-1;else{if(39!==e.keyCode)return;t=a.length>0?Math.min(s.length-1,Math.max.apply(Math,Object(b.a)(a))+1):-1}if(-1!==t){e.preventDefault();var r=s[t].start/l;n(r,!1)}}}return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[n,k,s,l]),Object(r.useEffect)((function(){function e(e){w.current=Date.now()}var t=T.current;return null===t||void 0===t||t.addEventListener("wheel",e),function(){null===t||void 0===t||t.removeEventListener("wheel",e)}}),[T,w]),Object(r.useEffect)((function(){if(d&&s){var e,t=-1,n=0,a=Object(u.a)(s);try{for(a.s();!(e=a.n()).done;){var r=e.value;if(r.originalStart===d.originalStart&&r.text===d.text){t=n;break}++n}}catch(i){a.e(i)}finally{a.f()}-1!==t&&O[t].current.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}),[d,s,O]);var R,M=Object(r.useCallback)((function(e){var t=s[e].start/l;n(t,!o&&e in k)}),[s,l,o,n,k]),U=Object(r.useCallback)((function(e,t){e.stopPropagation();var n=s[t],a=n.text;navigator.clipboard.writeText(a),c(n)}),[s,c]);return Object(r.useEffect)((function(){function e(e){var t=Object.keys(x.current);if(0!==t.length&&We(e)){var n=Math.min.apply(Math,Object(b.a)(t));U(e,n)}}return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[U]),R=s?0===s.length?null:Object(a.jsx)(Ye.a,{className:E.table,children:Object(a.jsx)(Ge.a,{children:Object(a.jsx)(qe.a,{children:s.map((function(e,t){var n=t in k,r=h?E.compressedSubtitle:E.subtitle;return e.start<0&&e.end<0?null:Object(a.jsxs)(Ke.a,{onClick:function(e){return M(t)},ref:O[t],selected:n,className:E.subtitleRow,children:[Object(a.jsx)(Je.a,{className:r,children:e.text}),Object(a.jsx)(Je.a,{className:E.copyButton,children:Object(a.jsx)(F.a,{onClick:function(e){return U(e,t)},children:Object(a.jsx)(_e.a,{fontSize:h?"small":"default"})})}),Object(a.jsx)(Je.a,{className:E.timestamp,children:e.displayTime})]},t)}))})})}):Object(a.jsxs)("div",{className:E.noSubtitles,children:[!h&&Object(a.jsxs)(i.a.Fragment,{children:[Object(a.jsx)(I.a,{variant:"h6",children:"Drag and drop srt, ass, mp3, or mkv files."}),Object(a.jsxs)(I.a,{variant:"h6",children:["Install the ",Object(a.jsx)(Ve.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://github.com/killergerbah/asbplayer/releases/tag/v0.2.1",children:"extension"})," to sync subtitles with videos in other tabs."]})]}),h&&Object(a.jsx)(i.a.Fragment,{children:Object(a.jsx)(I.a,{children:"No subtitles loaded."})})]}),Object(a.jsx)(Xe.a,{square:!0,elevation:0,ref:T,className:E.container,children:R})}var et=function(){function e(t){Object(x.a)(this,e),this.protocol=t,this.time=0,this.duration=0,this.isReady=!1,this.readyState=0,this.selectedAudioTrack=null,this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[];var n=this;this.protocol.onMessage=function(e){switch(e.data.command){case"ready":n.duration=e.data.duration,n.isReady=!0,n.audioTracks=e.data.audioTracks,n.selectedAudioTrack=e.data.selectedAudioTrack,n.readyState=4,n.time=e.data.currentTime;var t,a=Object(u.a)(n.readyCallbacks);try{for(a.s();!(t=a.n()).done;){(0,t.value)(e.data.paused)}}catch(x){a.e(x)}finally{a.f()}break;case"readyState":var r;if(n.readyState=e.data.value,4===n.readyState)null===(r=n.oncanplay)||void 0===r||r.call(n);break;case"play":var i,c=Object(u.a)(n.playCallbacks);try{for(c.s();!(i=c.n()).done;){(0,i.value)(e.data.echo)}}catch(x){c.e(x)}finally{c.f()}break;case"pause":var o,s=Object(u.a)(n.pauseCallbacks);try{for(s.s();!(o=s.n()).done;){(0,o.value)(e.data.echo)}}catch(x){s.e(x)}finally{s.f()}break;case"audioTrackSelected":var l,d=Object(u.a)(n.audioTrackSelectedCallbacks);try{for(d.s();!(l=d.n()).done;){var b=l.value;n.selectedAudioTrack=e.data.id,b(e.data.id)}}catch(x){d.e(x)}finally{d.f()}break;case"currentTime":var f,h=Object(u.a)(n.currentTimeCallbacks);try{for(h.s();!(f=h.n()).done;){(0,f.value)(e.data.value,e.data.echo)}}catch(x){h.e(x)}finally{h.f()}break;case"exit":var j,v=Object(u.a)(n.exitCallbacks);try{for(v.s();!(j=v.n()).done;){(0,j.value)()}}catch(x){v.e(x)}finally{v.f()}break;case"offset":var O,p=Object(u.a)(n.offsetCallbacks);try{for(p.s();!(O=p.n()).done;){(0,O.value)(e.data.value)}}catch(x){p.e(x)}finally{p.f()}break;case"popOutToggle":var m,g=Object(u.a)(n.popOutToggleCallbacks);try{for(g.s();!(m=g.n()).done;){(0,m.value)()}}catch(x){g.e(x)}finally{g.f()}break;case"copy":var k,y=Object(u.a)(n.copyCallbacks);try{for(y.s();!(k=y.n()).done;){(0,k.value)(e.data.subtitle)}}catch(x){y.e(x)}finally{y.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(C.a)(e,[{key:"onReady",value:function(e){this.isReady&&e(),this.readyCallbacks.push(e)}},{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onExit",value:function(e){this.exitCallbacks.push(e)}},{key:"onOffset",value:function(e){this.offsetCallbacks.push(e)}},{key:"onPopOutToggle",value:function(e){this.popOutToggleCallbacks.push(e)}},{key:"onCopy",value:function(e){this.copyCallbacks.push(e)}},{key:"ready",value:function(e){this.protocol.postMessage({command:"ready",duration:e})}},{key:"init",value:function(){this.protocol.postMessage({command:"init"})}},{key:"play",value:function(){this.protocol.postMessage({command:"play"})}},{key:"pause",value:function(){this.protocol.postMessage({command:"pause"})}},{key:"audioTrackSelected",value:function(e){this.protocol.postMessage({command:"audioTrackSelected",id:e})}},{key:"subtitles",value:function(e){this.protocol.postMessage({command:"subtitles",value:e})}},{key:"close",value:function(){this.protocol.postMessage({command:"close"}),this.protocol.close()}},{key:"currentTime",get:function(){return this.time},set:function(e){this.time=e,this.readyState=3,this.protocol.postMessage({command:"currentTime",value:this.time})}}]),e}(),tt=Object(v.a)({root:{maxHeight:"calc(100vh - 64px)",position:"relative",overflowX:"hidden"},videoFrame:{width:"100%",height:"100%",border:0}});function nt(e,t){if(e<0)return nt(0,t);var n=e%1e3,a=(e=(e-n)/1e3)%60,r=(e=(e-a)/60)%60;return t>=36e5?at((e-r)/60)+":"+at(r)+":"+at(a)+"."+rt(n):at(r)+":"+at(a)+"."+rt(n)}function at(e){return String(e).padStart(2,"0")}function rt(e){return String(e).padEnd(3,"0")}function it(e,t,n,a){var r;r=n&&n.length>0?a?n[n.length-1].end:n[n.length-1].originalEnd:0;var i=e.current&&e.current.duration?1e3*e.current.duration:0,c=t.current&&t.current.duration?1e3*t.current.duration:0;return Math.max(c,Math.max(r,i))}function ct(e){var t=e.api,n=e.extension,i=e.offsetRef,c=e.videoFrameRef,o=e.drawerOpen,s=e.onError,l=e.onUnloadVideo,u=e.onCopy,d=e.sources,b=d.subtitleFile,h=d.audioFile,j=d.audioFileUrl,v=d.videoFile,p=d.videoFileUrl,m=Object(r.useState)(),g=Object(f.a)(m,2),k=g[0],y=g[1],x=Object(r.useState)(),C=Object(f.a)(x,2),w=C[0],S=C[1],T=Object(r.useState)(!1),E=Object(f.a)(T,2),F=E[0],R=E[1],M=O(!0),U=Object(f.a)(M,1)[0]<1300?8:9,I=Object(r.useRef)();I.current=F;var A=Object(r.useState)(),N=Object(f.a)(A,2)[1],L=Object(r.useState)(),P=Object(f.a)(L,2),D=P[0],z=P[1],H=Object(r.useState)(),W=Object(f.a)(H,2),B=W[0],_=W[1],V=Object(r.useState)(0),X=Object(f.a)(V,2),G=X[0],q=X[1],J=Object(r.useState)(),Y=Object(f.a)(J,2),K=Y[0],$=Y[1],te=Object(r.useState)(!1),ne=Object(f.a)(te,2),ae=ne[0],re=ne[1],ie=Object(r.useCallback)((function(){return N({})}),[]),ce=Object(r.useRef)({x:0,y:0}),se=Object(r.useRef)(),le=Object(r.useRef)(),ue=Object(r.useMemo)((function(){return new He(j?se:p||k?le:{})}),[j,p,k]),de=Object(r.useMemo)((function(){return new ee}),[]),be=tt(),fe=Object(r.useState)([]),he=Object(f.a)(fe,2),je=he[0],ve=he[1],Oe=Object(r.useRef)(0);Oe.current=it(se,le,w,!0);var pe=Object(r.useCallback)((function(e,t,n,a){var r=e*Oe.current;t.setTime(r),ie(),n?ue.seek(r/1e3).then((function(e){return a()})):a()}),[ie,ue]);function me(e,t,n){R(!0),e.start(),n&&t.play()}function ge(e,t,n){R(!1),e.stop(),n&&t.pause()}Object(r.useEffect)((function(){var e,a;null===(e=le.current)||void 0===e||e.close(),le.current=null,de.setTime(0),de.stop(),R(!1),z(null),_(null),q(0),se.current.currentTime=0,se.current.pause(),a=b?t.subtitles(b).then((function(e){var t=e.length>0?e[e.length-1].end:0,n=e.map((function(e){return{text:e.text,start:e.start,originalStart:e.start,end:e.end,originalEnd:e.end,displayTime:nt(e.start,t)}}));return S(n),n})).catch((function(e){return s(e)})):new Promise((function(e,t){return e()})),j?ue.onReady().then((function(){return ie()})):(p||k)&&a.then((function(e){var t;if(p){var a=String(Date.now());t=new et(new Q(a)),$(a)}else k&&(t=new et(new Z(k.id,n))).init();le.current=t;var r=!1;t.onReady((function(n){Oe.current=it(se,le,e),t.ready(Oe.current),e&&t.subtitles(e),t.audioTracks&&t.audioTracks.length>1?(z(le.current.audioTracks),_(le.current.selectedAudioTrack)):(z(null),_(null)),de.setTime(1e3*le.current.currentTime),n?de.stop():de.start(),R(!n),r||(t.onPlay((function(e){me(de,ue,e)})),t.onPause((function(e){ge(de,ue,e)})),t.onCurrentTime((function(e,t){var n=1e3*e/Oe.current;I.current&&de.stop(),pe(n,de,t,(function(e){I.current&&de.start()}))})),t.onAudioTrackSelected((function(e){I.current&&de.stop(),ue.onReady().then((function(){I.current&&de.start()})),_(e)})),t.onExit((function(){l(p)})),t.onOffset((function(e){var t;q(Math.max(null!==(t=-Oe.current)&&void 0!==t?t:0,e))})),t.onPopOutToggle((function(){re((function(e){return!e}))})),t.onCopy((function(e){u(e,h,v,b,t.selectedAudioTrack)})),r=!0)}))}))}),[t,n,de,ue,pe,s,l,u,b,h,j,v,p,k,ie,c]),Object(r.useEffect)((function(){ae&&K&&p&&window.open("/asbplayer/?video="+encodeURIComponent(p)+"&channel="+K+"&popout=true","asbplayer-video-"+p,"resizable,width=800,height=450")}),[ae,K,p,c]);var ke=Object(r.useCallback)((function(){me(de,ue,!0)}),[de,ue]),ye=Object(r.useCallback)((function(){ge(de,ue,!0)}),[de,ue]),xe=Object(r.useCallback)((function(e){I.current&&de.stop(),pe(e,de,!0,(function(){I.current&&de.start()}))}),[de,pe]),Ce=Object(r.useCallback)((function(e,t){t||ge(de,ue,!0),I.current&&de.stop(),pe(e,de,!0,(function(){t&&!I.current&&me(de,ue,!0)}))}),[de,pe,ue]),we=Object(r.useCallback)((function(e){u(e,h,v,b,B)}),[u,h,v,b,B]);var Se=Object(r.useCallback)((function(e){le.current&&le.current.audioTrackSelected(e),ge(de,ue,!0),pe(0,de,!0,(function(){I.current&&me(de,ue,!0)}))}),[de,ue,pe]),Te=Object(r.useCallback)((function(e){var t=je.filter((function(t){return t.id===e}))[0];y(t)}),[je]),Ee=Object(r.useCallback)((function(e){var t;q(Math.max(null!==(t=-Oe.current)&&void 0!==t?t:0,e))}),[]);Object(r.useEffect)((function(){i&&(i.current=G),S((function(e){var t;if(e){var n=e.length>0?e[e.length-1].end+G:0,a=e.map((function(e){return{text:e.text,start:e.originalStart+G,originalStart:e.originalStart,end:e.originalEnd+G,originalEnd:e.originalEnd,displayTime:nt(e.originalStart+G,n)}}));return null===(t=le.current)||void 0===t||t.subtitles(a),a}}))}),[G,i]);var Fe=Object(r.useCallback)((function(e){se.current&&(se.current.volume=e)}),[]);Object(r.useEffect)((function(){var e=setInterval((function(){var e=Oe.current;de.progress(e)>=1&&(de.setTime(0),de.stop(),ue.pause(),R(!1))}),1e3);return function(){return clearInterval(e)}}),[de,w,ue]),Object(r.useEffect)((function(){var t=setInterval((function(){if(e.extension.tabs.length!==je.length)ve(e.extension.tabs);else{for(var t=!1,n=0;n<je.length;++n){var a=je[n],r=e.extension.tabs[n];if(a.id!==r.id||a.title!==r.title||a.src!==r.src){t=!0;break}}t&&ve(e.extension.tabs)}k&&0===e.extension.tabs.filter((function(e){return e.id===k.id&&e.src===k.src})).length&&(y(null),e.onError("Lost connection with tab "+k.id+" "+k.title))}),1e3);return function(){return clearInterval(t)}}),[je,k,e]),Object(r.useEffect)((function(){y(null)}),[h,v]);var Re=Oe.current,Me=j||p||w,Ue=Me&&p&&K&&!ae;return Object(a.jsxs)("div",{onMouseMove:function(e){ce.current.x=e.screenX,ce.current.y=e.screenY},className:be.root,children:[Object(a.jsxs)(oe.a,{container:!0,direction:"row",wrap:"nowrap",children:[Ue&&Object(a.jsx)(oe.a,{item:!0,xs:U,children:Object(a.jsx)("iframe",{ref:c,className:be.videoFrame,src:"/asbplayer/?video="+encodeURIComponent(p)+"&channel="+K+"&popout=false",title:"asbplayer"})}),Object(a.jsxs)(oe.a,{item:!0,xs:Ue?12-U:12,children:[Me&&!(p&&!ae)&&Object(a.jsx)(ze,{mousePositionRef:ce,playing:F,clock:de,length:Re,displayLength:it(se,le,w,!1),audioTracks:D,selectedAudioTrack:B,tabs:!p&&!j&&je,selectedTab:k&&k.id,audioFile:null===h||void 0===h?void 0:h.name,videoFile:null===v||void 0===v?void 0:v.name,offsetEnabled:!0,offset:G,volumeEnabled:Boolean(j),onPlay:ke,onPause:ye,onSeek:xe,onAudioTrackSelected:Se,onTabSelected:Te,onUnloadAudio:function(){return e.onUnloadAudio(j)},onUnloadVideo:function(){return e.onUnloadVideo(p)},onOffsetChange:Ee,onVolumeChange:Fe}),Object(a.jsx)(Ze,{playing:F,subtitles:w,clock:de,length:Re,jumpToSubtitle:e.jumpToSubtitle,drawerOpen:o,compressed:p&&!ae,onSeek:Ce,onCopy:we})]})]}),Object(a.jsx)("audio",{ref:se,src:j})]})}var ot=function(){function e(t){Object(x.a)(this,e),this.channel=new BroadcastChannel(t),this.time=0,this.duration=0,this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.closeCallbacks=[],this.readyCallbacks=[],this.subtitlesCallbacks=[];var n=this;this.channel.onmessage=function(e){switch(e.data.command){case"init":break;case"ready":var t,a=Object(u.a)(n.readyCallbacks);try{for(a.s();!(t=a.n()).done;){(0,t.value)(e.data.duration)}}catch(O){a.e(O)}finally{a.f()}break;case"play":var r,i=Object(u.a)(n.playCallbacks);try{for(i.s();!(r=i.n()).done;){(0,r.value)()}}catch(O){i.e(O)}finally{i.f()}break;case"pause":var c,o=Object(u.a)(n.pauseCallbacks);try{for(o.s();!(c=o.n()).done;){(0,c.value)()}}catch(O){o.e(O)}finally{o.f()}break;case"currentTime":var s,l=Object(u.a)(n.currentTimeCallbacks);try{for(l.s();!(s=l.n()).done;){(0,s.value)(e.data.value)}}catch(O){l.e(O)}finally{l.f()}break;case"audioTrackSelected":var d,b=Object(u.a)(n.audioTrackSelectedCallbacks);try{for(b.s();!(d=b.n()).done;){(0,d.value)(e.data.id)}}catch(O){b.e(O)}finally{b.f()}break;case"close":var f,h=Object(u.a)(n.closeCallbacks);try{for(h.s();!(f=h.n()).done;){(0,f.value)()}}catch(O){h.e(O)}finally{h.f()}break;case"subtitles":var j,v=Object(u.a)(n.subtitlesCallbacks);try{for(v.s();!(j=v.n()).done;){(0,j.value)(e.data.value)}}catch(O){v.e(O)}finally{v.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(C.a)(e,[{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onClose",value:function(e){this.closeCallbacks.push(e)}},{key:"onReady",value:function(e){this.readyCallbacks.push(e)}},{key:"onSubtitles",value:function(e){this.subtitlesCallbacks.push(e)}},{key:"ready",value:function(e,t,n,a){this.channel.postMessage({command:"ready",duration:e,paused:t,currentTime:0,audioTracks:n,selectedAudioTrack:a})}},{key:"readyState",value:function(e){this.channel.postMessage({command:"readyState",value:e})}},{key:"play",value:function(){this.channel.postMessage({command:"play",echo:!0})}},{key:"pause",value:function(){this.channel.postMessage({command:"pause",echo:!0})}},{key:"audioTrackSelected",value:function(e){this.channel.postMessage({command:"audioTrackSelected",id:e})}},{key:"offset",value:function(e){this.channel.postMessage({command:"offset",value:e})}},{key:"popOutToggle",value:function(){this.channel.postMessage({command:"popOutToggle"})}},{key:"copy",value:function(e){this.channel.postMessage({command:"copy",subtitle:e})}},{key:"close",value:function(){this.channel&&(this.channel.postMessage({command:"exit"}),this.channel.close(),this.channel=null)}},{key:"currentTime",get:function(){return this.time},set:function(e){this.time=e,this.channel.postMessage({command:"currentTime",value:this.time,echo:!0})}}]),e}(),st=Object(v.a)({root:{position:"relative",backgroundColor:"black",height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},video:{margin:"auto"},subtitle:{position:"absolute",paddingLeft:20,paddingRight:20,width:"100%",bottom:100,textAlign:"center",color:"white",textShadow:"0 0 2px black, 0 0 2px black, 0 0 2px black, 0 0 2px black",fontSize:36}});function lt(e,t,n,a){if(window.outerWidth&&e.videoWidth>0&&e.videoHeight>0){var r=window.screen.availWidth-(window.outerWidth-window.innerWidth),i=window.screen.availHeight-(window.outerHeight-window.innerHeight),c=Math.min(1,Math.min(r/e.videoWidth,i/e.videoHeight));window.resizeTo(c*e.videoWidth+(window.outerWidth-window.innerWidth),c*e.videoHeight+(window.outerHeight-window.innerHeight))}var o,s;if(e.audioTracks){o=[];var l,d=Object(u.a)(e.audioTracks);try{for(d.s();!(l=d.n()).done;){var b=l.value;o.push({id:b.id,label:b.label,language:b.language}),b.enabled&&(s=b.id)}}catch(f){d.e(f)}finally{d.f()}}else o=null,s=null;n(o),a(s),t.ready(e.duration,e.paused,o,s)}function ut(e){var t=st(),n=e.videoFile,c=e.channel,o=e.popOut,s=e.onError,l=Object(r.useRef)(),b=Object(r.useRef)(),h=O(!0),j=Object(f.a)(h,2),v=j[0],p=j[1];b.current&&(b.current.width=v,b.current.height=p);var m=Object(r.useMemo)((function(){return new ot(c)}),[c]),g=Object(r.useState)(!1),k=Object(f.a)(g,2),x=k[0],C=k[1],w=function(){var e=Object(r.useState)(Boolean(document.fullscreenElement)),t=Object(f.a)(e,2),n=t[0],a=t[1];return Object(r.useEffect)((function(){var e=function(){return a(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",e),function(){return document.removeEventListener("fullscreenchange",e)}}),[]),n}(),S=Object(r.useRef)();S.current=x;var T=Object(r.useState)(0),E=Object(f.a)(T,2),F=E[0],R=E[1],M=Object(r.useState)(0),U=Object(f.a)(M,2),I=U[0],A=U[1],N=Object(r.useState)(),L=Object(f.a)(N,2),P=L[0],D=L[1],z=Object(r.useState)(),H=Object(f.a)(z,2),W=H[0],B=H[1],_=Object(r.useState)([]),V=Object(f.a)(_,2),X=V[0],G=V[1],q=Object(r.useState)([]),J=Object(f.a)(q,2),Y=J[0],K=J[1],$=Object(r.useState)(!0),Q=Object(f.a)($,2),Z=Q[0],te=Q[1],ne=Object(r.useRef)([]);ne.current=Y;var ae=Object(r.useMemo)((function(){return new ee}),[]),re=Object(r.useRef)({x:0,y:0}),ie=Object(r.useRef)(),ce=Object(r.useState)(),oe=Object(f.a)(ce,2),se=oe[0],le=oe[1],ue=Object(r.useState)(!1),de=Object(f.a)(ue,2),be=de[0],fe=de[1],he=Object(r.useCallback)((function(e){e&&(b.current=e,4===e.readyState?lt(e,m,D,B):e.onloadeddata=function(t){lt(e,m,D,B)},e.oncanplay=function(e){m.readyState(4),S.current&&ae.start()},e.onerror=function(t){s(function(e){var t;switch(e.error.code){case 1:t="Aborted";break;case 2:t="Network error";break;case 3:t="Decoding error";break;case 4:t="Source not supported";break;default:t="Unknown error"}return t+": "+(e.error.message||"<details missing>")}(e))})}),[ae,m,s]);function je(e){var t,n=Object(u.a)(b.current.audioTracks);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.id===e?a.enabled=!0:a.enabled=!1}}catch(r){n.e(r)}finally{n.f()}}Object(r.useEffect)((function(){return m.onReady((function(e){R(e)})),m.onPlay((function(){b.current.play(),ae.start(),C(!0)})),m.onPause((function(){b.current.pause(),ae.stop(),C(!1)})),m.onCurrentTime((function(e){var t;b.current&&(b.current.currentTime=e),4===(null===(t=b.current)||void 0===t?void 0:t.readyState)&&m.readyState(4),ae.stop(),ae.setTime(1e3*e)})),m.onAudioTrackSelected((function(e){je(e),m.audioTrackSelected(e)})),m.onClose((function(){m.close(),window.close()})),m.onSubtitles((function(e){if(G(e),e&&e.length>0){var t=e[0],n=t.start-t.originalStart;A(n)}})),window.onbeforeunload=function(e){l.current||m.close()},function(){m.close()}}),[ae,m]);var ve=Object(r.useCallback)((function(){b.current&&m.play()}),[m]),Oe=Object(r.useCallback)((function(){m.pause()}),[m]),pe=Object(r.useCallback)((function(e){S.current&&ae.stop();var t=e*F;m.currentTime=t/1e3}),[F,ae,m]);var me=Object(r.useCallback)((function(e){S.current&&(ae.stop(),m.pause()),je(e),B(e),m.currentTime=0,m.audioTrackSelected(e)}),[m,ae]);Object(r.useEffect)((function(){if(X&&0!==X.length){var e=setInterval((function(){for(var e=1e3*b.current.currentTime,t=[],n=0;n<X.length;++n){var a=X[n];if(e>=a.start&&e<a.end&&t.push(Object(d.a)(Object(d.a)({},a),{},{index:n})),e<a.start)break}(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};if(e.length!==t.length)return!1;for(var a=0;a<e.length;++a)if(!n(e[a],t[a]))return!1;return!0})(t,ne.current,(function(e,t){return e.index===t.index}))||K(t)}),10);return function(){return clearTimeout(e)}}}),[X]),Object(r.useEffect)((function(){function e(e){if(b.current&&X&&0!==X.length){var t;if(37===e.keyCode)t=!1;else{if(39!==e.keyCode)return;t=!0}var n=1e3*b.current.currentTime,a=-1;if(t){for(var r=0;r<X.length;++r)if(n<X[r].start){a=r;break}}else for(var i=X.length-1;i>=0;--i){var c=X[i];if(n>c.start){a=n<c.end?Math.max(0,i-1):i;break}}-1!==a&&(e.preventDefault(),m.currentTime=X[a].start/1e3)}}return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[m,ae,X,F]),Object(r.useEffect)((function(){function e(e){if(ne.current&&0!==ne.current.length&&We(e)){e.stopPropagation(),e.preventDefault();var t=ne.current[0];m.copy(t),w&&(le("Copied "+t.text),fe(!0))}}return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[m,w]);var ge=Object(r.useCallback)((function(){te((function(e){return!e}))}),[]),ke=Object(r.useCallback)((function(){var e;w?document.exitFullscreen():null===(e=ie.current)||void 0===e||e.requestFullscreen()}),[w]),ye=Object(r.useCallback)((function(e){b.current&&(b.current.volume=e)}),[]),xe=Object(r.useCallback)((function(e){m.offset(e)}),[m]),Ce=Object(r.useCallback)((function(){m.popOutToggle(),o&&(l.current=!0,window.close())}),[m,o]),we=Object(r.useCallback)((function(){m.close(),window.close()}),[m]),Se=Object(r.useCallback)((function(){x?m.pause():m.play()}),[m,x]),Te=Object(r.useCallback)((function(){fe(!1)}),[]);return Object(a.jsxs)("div",{ref:ie,onMouseMove:function(e){re.current.x=e.screenX,re.current.y=e.screenY},className:t.root,children:[Object(a.jsx)("video",{preload:"auto",nocontrols:1,onClick:Se,className:t.video,ref:he,src:n}),Z&&Object(a.jsx)("div",{className:t.subtitle,children:Y.map((function(e){return Object(a.jsxs)(i.a.Fragment,{children:[e.text,Object(a.jsx)("br",{})]},e.index)}))}),w&&Object(a.jsx)(y,{open:be,onClose:Te,autoHideDuration:3e3,severity:"success",children:se}),Object(a.jsx)(ze,{mousePositionRef:re,playing:x,clock:ae,length:F,audioTracks:P,selectedAudioTrack:W,subtitlesToggle:X&&X.length>0,subtitlesEnabled:Z,offsetEnabled:!0,offset:I,fullscreenEnabled:!0,fullscreen:w,closeEnabled:!o,popOut:o,volumeEnabled:!0,popOutEnabled:!0,onPlay:ve,onPause:Oe,onSeek:pe,onAudioTrackSelected:me,onSubtitlesToggle:ge,onFullscreenToggle:ke,onVolumeChange:ye,onOffsetChange:xe,onPopOutToggle:Ce,onClose:we})]})}function dt(e){var t,n=(t=e.drawerWidth,Object(v.a)((function(e){return{content:{flexGrow:1,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginRight:0},contentShift:{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:t}}})))();return Object(a.jsx)("main",{className:Object(p.a)(n.content,Object(h.a)({},n.contentShift,e.drawerOpen)),children:e.children})}var bt=function(){var e=Object(r.useMemo)((function(){return new T}),[]),t=Object(r.useMemo)((function(){return new N}),[]),n=Object(j.g)(),i=Object(r.useRef)(),c=O("/video"!==n.pathname),o=Object(f.a)(c,1)[0],s=i.current?.2:.3,l=i.current?150:300,h=Math.max(l,o*s),v=Object(r.useState)([]),p=Object(f.a)(v,2),m=p[0],g=p[1],k=Object(r.useState)(!1),x=Object(f.a)(k,2),C=x[0],w=x[1],S=Object(r.useState)(),E=Object(f.a)(S,2),F=E[0],R=E[1],M=Object(r.useState)(!1),U=Object(f.a)(M,2),I=U[0],L=U[1],P=Object(r.useState)(),D=Object(f.a)(P,2),z=D[0],H=D[1],W=Object(r.useState)(),B=Object(f.a)(W,2),_=B[0],V=B[1],X=Object(r.useState)({}),G=Object(f.a)(X,2),q=G[0],J=G[1],Y=Object(r.useState)(),K=Object(f.a)(Y,2),Q=K[0],Z=K[1],ee=Object(r.useRef)(),te=q.subtitleFile,ne=Object(r.useCallback)((function(e,t,n,a,r){g((function(i){return[].concat(Object(b.a)(i),[Object(d.a)(Object(d.a)({},e),{},{timestamp:Date.now(),name:Q,subtitleFile:a,audioFile:t,videoFile:n,audioTrack:r})])})),H("success"),R("Copied "+e.text),L(!0)}),[Q]),ae=Object(r.useCallback)((function(e){w(!C)}),[C]),re=Object(r.useCallback)((function(){w(!1)}),[w]),ie=Object(r.useCallback)((function(e){var t,n=[],a=Object(u.a)(m);try{for(a.s();!(t=a.n()).done;){var r=t.value;e.timestamp!==r.timestamp&&n.push(r)}}catch(i){a.e(i)}finally{a.f()}g(n)}),[m]),ce=Object(r.useCallback)((function(){L(!1)}),[]),oe=Object(r.useCallback)((function(e){H("error"),R(e),L(!0)}),[]),se=Object(r.useCallback)((function(e){e===q.audioFileUrl&&J((function(t){return URL.revokeObjectURL(e),{subtitleFile:t.subtitleFile,audioFile:null,audioFileUrl:null,videoFile:t.videoFile,videoFileUrl:t.videoFileUrl}}))}),[q]),le=Object(r.useCallback)((function(e){e===q.videoFileUrl&&J((function(t){return URL.revokeObjectURL(e),{subtitleFile:t.subtitleFile,audioFile:t.audioFile,audioFileUrl:t.audioFileUrl,videoFile:null,videoFileUrl:null}}))}),[q]),ue=Object(r.useCallback)((function(t){var n=ee.current||0;t.audioFile?e.clipAudioFromAudioFile(t.audioFile,t.originalStart+n,t.originalEnd+n).catch((function(e){oe(e.message)})):t.videoFile&&e.clipAudioFromVideoFile(t.videoFile,t.originalStart+n,t.originalEnd+n,t.audioTrack).catch((function(e){oe(e.message)}))}),[e,oe]),de=Object(r.useCallback)((function(e){te.name===e.subtitleFile.name?V({text:e.text,originalStart:e.originalStart}):oe("Subtitle file "+e.subtitleFile.name+" is not open.")}),[te,oe]),be=Object(r.useCallback)((function(e){if(e.preventDefault(),e.dataTransfer.files&&0!==e.dataTransfer.files.length)try{var t=function(e){var t,n=null,a=null,r=null,i=Object(u.a)(e);try{for(i.s();!(t=i.n()).done;){var c=t.value,o=c.name.lastIndexOf(".");if(-1===o)throw new Error("Unable to determine extension of "+c.name);var s=c.name.substring(o+1,c.name.length);switch(s){case"ass":case"srt":if(n)throw new Error("Cannot open two subtitle files simultaneously");n=c;break;case"mkv":if(r)throw new Error("Cannot open two video files simultaneously");r=c;break;case"mp3":if(a)throw new Error("Cannot open two audio files simultaneously");a=c;break;default:throw new Error("Unsupported extension "+s)}}}catch(l){i.e(l)}finally{i.f()}if(r&&a)throw new Error("Cannot load both an audio and video file simultaneously");return{subtitleFile:n,audioFile:a,videoFile:r}}(e.dataTransfer.files),n=t.subtitleFile,a=t.audioFile,r=t.videoFile;J((function(e){var t=null,i=null;return r||a?(!function(e){e.audioFileUrl&&URL.revokeObjectURL(e.audioFileUrl),e.videoFileUrl&&URL.revokeObjectURL(e.videoFileUrl)}(e),r?t=URL.createObjectURL(r):a&&(i=URL.createObjectURL(a))):(r=e.videoFile,t=e.videoFileUrl,a=e.audioFile,i=e.audioFileUrl),{subtitleFile:n||e.subtitleFile,audioFile:a,audioFileUrl:i,videoFile:r,videoFileUrl:t}})),n&&Z(n.name)}catch(e){oe(e.message)}}),[oe]);return Object(a.jsxs)("div",{onDrop:be,onDragOver:function(e){return e.preventDefault()},children:[Object(a.jsx)(y,{open:I,onClose:ce,autoHideDuration:3e3,severity:z,children:F}),Object(a.jsxs)(j.d,{children:[Object(a.jsx)(j.b,{exact:!0,path:"/",render:function(){var n=new URLSearchParams(window.location.search),r=n.get("video"),c=n.get("channel"),o=n.get("popout");return r&&c?Object(a.jsx)(j.a,{to:"/video?video="+encodeURIComponent(r)+"&channel="+c+"&popout="+o}):Object(a.jsxs)("div",{children:[Object(a.jsx)($,{items:m,open:C,drawerWidth:h,onClose:re,onDelete:ie,onClipAudio:ue,onSelect:de}),Object(a.jsx)(A,{title:Q||"a subtitle player",drawerWidth:h,drawerOpen:C,onOpenCopyHistory:ae}),Object(a.jsx)(dt,{drawerWidth:h,drawerOpen:C,children:Object(a.jsx)(ct,{api:e,onCopy:ne,onError:oe,onUnloadAudio:se,onUnloadVideo:le,offsetRef:ee,sources:q,jumpToSubtitle:_,videoFrameRef:i,extension:t,drawerOpen:C})})]})}}),Object(a.jsx)(j.b,{exact:!0,path:"/video",render:function(){var t=new URLSearchParams(window.location.search),n=t.get("video"),r=t.get("channel"),i="true"===t.get("popout");return Object(a.jsx)(ut,{api:e,videoFile:n,popOut:i,channel:r,onError:oe})}})]})]})},ft=n(82),ht=n(141),jt=Object(ht.a)({palette:{primary:{main:"#49007a"},secondary:{main:"#ff1f62"},error:{main:ft.a.A400},type:"dark"}}),vt=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,274)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),i(e),c(e)}))},Ot=n(93);n(205);o.a.render(Object(a.jsx)(Ot.a,{basename:"/asbplayer",forceRefresh:!1,children:Object(a.jsxs)(l.a,{theme:jt,children:[Object(a.jsx)(s.a,{}),Object(a.jsx)(bt,{})]})}),document.querySelector("#root")),vt()}},[[206,1,2]]]);
//# sourceMappingURL=main.4d8ca8f9.chunk.js.map