(this["webpackJsonp@project/client"]=this["webpackJsonp@project/client"]||[]).push([[0],{212:function(e,t){},214:function(e,t){},232:function(e,t){},234:function(e,t){},256:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(17),c=n.n(i),o=n(5),s=n.n(o),u=n(9),l=n(36),d=n(46),b=n(6),f=n(51),h=n(13),j=n(24),p=n(304),O=n(173),v=n(336);function g(e){var t=Object(r.useState)([0,0]),n=Object(b.a)(t,2),a=n[0],i=n[1];return Object(r.useLayoutEffect)((function(){function t(){e&&i([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",t),t(),function(){return window.removeEventListener("resize",t)}}),[e]),a}var m=n(96),k=n(4),x=n(339),y=n(257),w=n(1),C=Object(p.a)({root:{display:"flex",justifyContent:"center",position:"fixed",top:80,width:"100%",pointerEvents:"none",zIndex:2e3}});function S(e){var t=C();return Object(r.useEffect)((function(){if(e.open){var t=setTimeout(e.onClose,e.autoHideDuration);return function(){return clearTimeout(t)}}return null}),[e.open,e.autoHideDuration,e.onClose]),Object(w.jsx)("div",{className:t.root,children:Object(w.jsx)(y.a,{in:e.open,children:Object(w.jsx)(x.a,{severity:e.severity,children:e.children})})})}var T=n(15),F=n(16),E=['"',"*","_","\\",":"],M=function(){function e(t){Object(T.a)(this,e),this.settingsProvider=t}return Object(F.a)(e,[{key:"deckNames",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("deckNames",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelNames",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("modelNames",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelFieldNames",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("modelFieldNames",{modelName:t},n);case 2:return r=e.sent,e.abrupt("return",r.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findNotesWithWord",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("findNotes",{query:this.settingsProvider.wordField+":"+this._escapeQuery(t)},n);case 2:return r=e.sent,e.abrupt("return",r.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findNotesWithWordGui",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("guiBrowse",{query:this.settingsProvider.wordField+":"+this._escapeQuery(t)},n);case 2:return r=e.sent,e.abrupt("return",r.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_escapeQuery",value:function(e){for(var t="",n=0;n<e.length;++n){var r=e[n];E.includes(r)?t+="\\".concat(r):t+=r}return'"'.concat(t,'"')}},{key:"export",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n,r,a,i,c,o,u,l){var d,b,f,h,j,p,O,v;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d={},this._appendField(d,this.settingsProvider.sentenceField,t,!0),this._appendField(d,this.settingsProvider.definitionField,n,!0),this._appendField(d,this.settingsProvider.wordField,i,!1),this._appendField(d,this.settingsProvider.sourceField,c,!1),o)for(b=0,f=Object.keys(o);b<f.length;b++)h=f[b],this._appendField(d,this.settingsProvider.customAnkiFields[h],o[h],!1);if(j={note:{deckName:this.settingsProvider.deck,modelName:this.settingsProvider.noteType,options:{allowDuplicate:!1,duplicateScope:"deck",duplicateScopeOptions:{deckName:this.settingsProvider.deck,checkChildren:!1}}}},!this.settingsProvider.audioField||!r){e.next=27;break}if(!u){e.next=21;break}return e.t0=this,e.t1=r.name,e.next=13,r.base64();case 13:return e.t2=e.sent,e.t3=l,e.next=17,e.t0._storeMediaFile.call(e.t0,e.t1,e.t2,e.t3);case 17:p=e.sent.result,this._appendField(d,this.settingsProvider.audioField,"[sound:".concat(p,"]"),!1),e.next=27;break;case 21:return e.t4=r.name,e.next=24,r.base64();case 24:e.t5=e.sent,e.t6=[this.settingsProvider.audioField],j.note.audio={filename:e.t4,data:e.t5,fields:e.t6};case 27:if(!this.settingsProvider.imageField||!a){e.next=47;break}if(!u){e.next=41;break}return e.t7=this,e.t8=a.name,e.next=33,a.base64();case 33:return e.t9=e.sent,e.t10=l,e.next=37,e.t7._storeMediaFile.call(e.t7,e.t8,e.t9,e.t10);case 37:O=e.sent.result,this._appendField(d,this.settingsProvider.imageField,'<div><img src="'.concat(O,'"></div>'),!1),e.next=47;break;case 41:return e.t11=a.name,e.next=44,a.base64();case 44:e.t12=e.sent,e.t13=[this.settingsProvider.imageField],j.note.picture={filename:e.t11,data:e.t12,fields:e.t13};case 47:return j.note.fields=d,e.next=50,this._executeAction(u?"guiAddCards":"addNote",j,l);case 50:return v=e.sent,e.abrupt("return",v.result);case 52:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,i,c,o,s,u){return e.apply(this,arguments)}}()},{key:"_appendField",value:function(e,t,n,r){if(t&&n){var a=r?n.split("\n").join("<br>"):n,i=e[t];i&&(a=i+"<br>"+a),e[t]=a}}},{key:"_storeMediaFile",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAction("storeMediaFile",{filename:t,data:n},r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_executeAction",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n,r){var a,i,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={action:t,version:6},n&&(a.params=n),e.next=4,fetch(r||this.settingsProvider.ankiConnectUrl,{method:"POST",body:JSON.stringify(a)});case 4:return i=e.sent,e.next=7,i.json();case 7:if(!(c=e.sent).error){e.next=10;break}throw new Error(c.error);case 10:return e.abrupt("return",c);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}(),I=n(267),R=n(317),P=n(312),N=n(308),A=n(316),_=n(311),U=n(258),D=n(315),B=n(145),L=n.n(B),W=n(89),H=n.n(W),z=n(310),V=n(343),K=n(55),G=Object(I.a)((function(e){return{root:{"& .MuiTextField-root":{marginBottom:e.spacing(1)}},title:{flexGrow:1},mediaField:{cursor:"pointer","& input":{cursor:"pointer"}}}}));function X(e){var t=e.open,n=e.disabled,a=e.text,i=e.onProceed,c=e.onCancel,o=e.onViewImage,l=e.onOpenSettings,d=e.audioClip,f=e.image,h=e.source,j=e.customFields,p=e.settingsProvider,O=e.anki,v=G(),g=Object(r.useState)(""),m=Object(b.a)(g,2),k=m[0],x=m[1],y=Object(r.useState)(),C=Object(b.a)(y,2),S=C[0],T=C[1],F=Object(r.useState)(),E=Object(b.a)(F,2),M=E[0],I=E[1],B=Object(r.useState)(),W=Object(b.a)(B,2),X=W[0],q=W[1],J=Object(r.useState)([]),Q=Object(b.a)(J,2),Y=Q[0],Z=Q[1],$=Object(r.useState)(0),ee=Object(b.a)($,2),te=ee[0],ne=ee[1],re=Object(r.useState)({}),ae=Object(b.a)(re,2),ie=ae[0],ce=ae[1],oe=Object(r.useMemo)((function(){return d&&p.preferMp3?d.toMp3():d}),[d,p.preferMp3]);Object(r.useEffect)((function(){T(a)}),[a]),Object(r.useEffect)((function(){t&&(x(""),I(""),Z([]),ce({}))}),[t]),Object(r.useEffect)((function(){ne(Date.now())}),[M]),Object(r.useEffect)((function(){if(M&&p.wordField){var e=M.trim();if(""!==e&&e!==X){var t=setTimeout(Object(u.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=Z,t.next=4,O.findNotesWithWord(e);case 4:t.t1=t.sent,(0,t.t0)(t.t1),q(e),t.next=12;break;case 9:t.prev=9,t.t2=t.catch(0),console.error(t.t2);case 12:case"end":return t.stop()}}),t,null,[[0,9]])}))),500);return function(){return clearTimeout(t)}}}}),[M,te,X,O,p.wordField]);var se,ue=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),oe.play()}),[oe]),le=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),o(f)}),[f,o]),de=Object(r.useCallback)((function(e,t){var n={};Object.assign(n,ie),n[e]=t,ce(n)}),[ie]);return se=M&&M.trim()===X&&p.wordField?Y.length>0?"Found ".concat(Y.length,' notes with word "').concat(M,'" in field "').concat(p.wordField,'"'):'No notes found with word "'.concat(M.trim(),'" in field "').concat(p.wordField,'"'):"",Object(w.jsxs)(N.a,{open:t,disableEnforceFocus:!0,fullWidth:!0,maxWidth:"sm",onBackdropClick:function(){return c()},children:[Object(w.jsxs)(z.a,{children:[Object(w.jsx)(K.a,{variant:"h6",className:v.title,children:"Anki Export"}),Object(w.jsx)(U.a,{edge:"end",onClick:function(){return l()},children:Object(w.jsx)(H.a,{})})]}),Object(w.jsx)(_.a,{children:Object(w.jsxs)("form",{className:v.root,children:[Object(w.jsx)(P.a,{variant:"filled",color:"secondary",multiline:!0,fullWidth:!0,rowsMax:8,label:"Sentence",value:S,onChange:function(e){return T(e.target.value)}}),Object(w.jsx)(P.a,{variant:"filled",color:"secondary",multiline:!0,fullWidth:!0,rows:8,label:"Definition",value:k,onChange:function(e){return x(e.target.value)}}),Object(w.jsx)(P.a,{variant:"filled",color:"secondary",fullWidth:!0,label:"Word",value:M,onChange:function(e){return I(e.target.value)},helperText:se,InputProps:{endAdornment:Object(w.jsx)(D.a,{position:"end",children:Object(w.jsx)(V.a,{title:"Search in Anki",children:Object(w.jsx)("span",{children:Object(w.jsx)(U.a,{disabled:n||!p.wordField||!M||""===M.trim(),onClick:function(){return O.findNotesWithWordGui(M.trim())},edge:"end",children:Object(w.jsx)(L.a,{})})})})})}}),Object.keys(j).map((function(e){return Object(w.jsx)(P.a,{variant:"filled",color:"secondary",fullWidth:!0,label:e,value:ie[e]||"",onChange:function(t){return de(e,t.target.value)}},e)})),oe&&Object(w.jsx)("div",{className:v.mediaField,onClick:ue,children:Object(w.jsx)(P.a,{variant:"filled",color:"secondary",fullWidth:!0,value:oe.name,label:"Audio"})}),f&&Object(w.jsx)("div",{className:v.mediaField,onClick:le,children:Object(w.jsx)(P.a,{variant:"filled",color:"secondary",fullWidth:!0,value:f.name,label:"Image"})}),Object(w.jsx)(P.a,{variant:"filled",color:"secondary",fullWidth:!0,label:"Source",value:h})]})}),Object(w.jsxs)(A.a,{children:[Object(w.jsx)(R.a,{disabled:n,onClick:function(){return c()},children:"Cancel"}),Object(w.jsx)(R.a,{disabled:n,onClick:function(){return i(S,k,oe,f,M,h,ie,!0)},children:"Open in Anki"}),Object(w.jsx)(R.a,{disabled:n,onClick:function(){return i(S,k,oe,f,M,h,ie,!1)},children:"Export"})]})]})}function q(){return new Worker(n.p+"static/js/mp3-encoder-worker.4a1beec0.worker.js")}var J=new AudioContext,Q=function(){function e(){Object(T.a)(this,e)}return Object(F.a)(e,null,[{key:"encode",value:function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(u.a)(s.a.mark((function e(n,r){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(a=new FileReader).onload=function(){var e=Object(u.a)(s.a.mark((function e(t){var a,i,c,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,J.decodeAudioData(t.target.result);case 3:for(a=e.sent,i=[],c=0;c<a.numberOfChannels;++c)i.push(a.getChannelData(c));(o=new q).postMessage({command:"encode",audioBuffer:{channels:i,numberOfChannels:a.numberOfChannels,length:a.length,sampleRate:a.sampleRate}}),o.onmessage=function(e){n(new Blob(e.data.buffer,{type:"audio/mp3"})),o.terminate()},o.onerror=function(){r("MP3 encoding failed"),o.terminate()},e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),r(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}(),a.readAsArrayBuffer(t);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Y={"audio/ogg;codecs=opus":"ogg","audio/webm;codecs=opus":"webm"},Z=Object(b.a)(Object.keys(Y).filter(MediaRecorder.isTypeSupported).map((function(e){return[e,Y[e]]}))[0],2),$=Z[0],ee=Z[1],te=function(){function e(t,n,r,a,i){Object(T.a)(this,e),this.name=t,this.start=n,this.end=r,this._base64=a,this.extension=i}return Object(F.a)(e,[{key:"base64",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._base64);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,r=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return t=e.sent,(n=new Audio).src=URL.createObjectURL(t),n.preload="none",n.load(),e.next=9,n.play();case 9:return e.abrupt("return",new Promise((function(e,t){setTimeout((function(){n.pause();var t=n.src;n.src=null,URL.revokeObjectURL(t),e()}),r.end-r.start+1e3)})));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_blob",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cachedBlob){e.next=6;break}return e.next=3,fetch("data:audio/"+this.extension+";base64,"+this._base64);case 3:return e.next=5,e.sent.blob();case 5:this.cachedBlob=e.sent;case 6:return e.abrupt("return",this.cachedBlob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),ne=function(){function e(t,n,r,a){Object(T.a)(this,e),this.file=t,this.name=t.name+"_"+n+"_"+r,this.start=n,this.end=r,this.trackId=a,this.extension=ee}return Object(F.a)(e,[{key:"base64",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(u.a)(s.a.mark((function e(n,r){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new FileReader,e.t0=a,e.next=4,t.blob();case 4:e.t1=e.sent,e.t0.readAsDataURL.call(e.t0,e.t1),a.onloadend=function(){var e=a.result,t=e.substr(e.indexOf(",")+1);n(t)};case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=5;break}return e.next=3,this._clipAudio();case 3:return this._blob=e.sent,e.abrupt("return");case 5:return t=this._audioElement(this._blob),e.next=8,t.play();case 8:return e.next=10,this._stopAudio(t);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=4;break}return e.next=3,this._clipAudio();case 3:this._blob=e.sent;case 4:return e.abrupt("return",this._blob);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_clipAudio",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t._audioElement(t.file);r.oncanplay=function(){var n=Object(u.a)(s.a.mark((function n(a){var i,c,o,u,l;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r.play(),i=t._captureStream(r),c=Object(h.a)(i.getVideoTracks());try{for(c.s();!(o=c.n()).done;)o.value.stop()}catch(a){c.e(a)}finally{c.f()}return u=new MediaRecorder(i,{mimeType:$}),l=[],u.ondataavailable=function(e){l.push(e.data)},u.onstop=function(t){e(new Blob(l))},u.start(),n.next=11,t._stopAudio(r);case 11:u.stop();case 12:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_audioElement",value:function(e){var t=new Audio;if(t.src=URL.createObjectURL(e),t.preload="none",this.trackId&&t.audioTracks&&t.audioTracks.length>0){var n,r=Object(h.a)(t.audioTracks);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.enabled=this.trackId===a.id}}catch(i){r.e(i)}finally{r.f()}}return t.currentTime=this.start/1e3,t.load(),t}},{key:"_captureStream",value:function(e){if("function"===typeof e.captureStream)return e.captureStream();if("function"===typeof e.mozCaptureStream)return e.mozCaptureStream();throw new Error("Unable to capture stream from audio")}},{key:"_stopAudio",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){setTimeout((function(){t.pause();var n=t.src;t.src=null,URL.revokeObjectURL(n),e()}),n.end-n.start+100)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),re=function(){function e(t){Object(T.a)(this,e),this.data=t}return Object(F.a)(e,[{key:"name",get:function(){return this.data.name}},{key:"extension",get:function(){return"mp3"}},{key:"base64",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(u.a)(s.a.mark((function e(n,r){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new FileReader,e.t0=a,e.next=4,t.blob();case 4:e.t1=e.sent,e.t0.readAsDataURL.call(e.t0,e.t1),a.onloadend=function(){var e=a.result,t=e.substr(e.indexOf(",")+1);n(t)};case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.play();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=8;break}return e.t0=Q,e.next=4,this.data.blob();case 4:return e.t1=e.sent,e.next=7,e.t0.encode.call(e.t0,e.t1);case 7:this._blob=e.sent;case 8:return e.abrupt("return",this._blob);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),ae=function(){function e(t){Object(T.a)(this,e),this.data=t}return Object(F.a)(e,[{key:"name",get:function(){return this.data.name+"."+this.data.extension}},{key:"play",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.play();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"base64",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.base64();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:t=e.sent,n=window.URL.createObjectURL(t),r=document.createElement("a"),document.body.appendChild(r),r.style="display: none",r.href=n,r.download=this.name,r.click(),URL.revokeObjectURL(n),r.remove();case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toMp3",value:function(){return new e(new re(this.data))}}],[{key:"fromBase64",value:function(t,n,r,a,i){var c=t.name.substring(0,t.name.lastIndexOf("."))+"_"+n+"_"+r;return new e(new te(c,n,r,a,i))}},{key:"fromFile",value:function(t,n,r,a){return new e(new ne(t,n,r,a))}}]),e}(),ie=n(337),ce=n(177),oe=n.p+"static/media/background-colored.8c5dbfe0.png",se=Object(I.a)((function(e){return{root:function(e){return{position:"absolute",height:"calc(100% - 64px)",width:"100%",zIndex:101,pointerEvents:e.dragging?"auto":"none"}},transparentBackground:{"&::before":{content:"' '",position:"absolute",height:"calc(100vh - 64px)",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",backgroundSize:"500px 500px",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundImage:"url(".concat(oe,")"),backgroundBlendMode:"overlay",background:"rgba(0, 0, 0, .3)",filter:"drop-shadow(10px 10px 10px rgb(0, 0, 0, .4))"},width:"100%",height:"100%"}}}));function ue(e){var t=e.dragging,n=e.loading,r=se({dragging:t});return Object(w.jsx)("div",{className:r.root,children:Object(w.jsx)(ce.a,{in:t||n,children:Object(w.jsx)("div",{className:r.transparentBackground})})})}var le=n(318),de=n(91),be=n.n(de),fe=n(90),he=n.n(fe),je=n(320),pe=n(321),Oe=n(319),ve=n(323),ge=n(322),me=n(77),ke=n.n(me),xe=Object(I.a)((function(e){return{inlineIcon:{maxWidth:"80%",height:20,display:"inline-flex",flexDirection:"column",flexWrap:"wrap",alignItems:"start",textAlign:"left"}}}));function ye(e){var t=xe(),n=e.open,r=e.extensionUrl,a=e.onClose;return Object(w.jsxs)(N.a,{open:n,onBackdropClick:function(){return a()},children:[Object(w.jsxs)(_.a,{children:[Object(w.jsx)(K.a,{variant:"h6",children:"Loading files"}),Object(w.jsxs)(K.a,{component:"ul",children:[Object(w.jsx)("li",{children:"Drag and drop mkv, srt, ass, or mp3 files into the player."}),Object(w.jsx)("li",{children:"Multiple files can be dragged and dropped simultaneously e.g. mkv+srt, mp3+ass, etc."})]}),Object(w.jsx)("br",{}),Object(w.jsx)(K.a,{variant:"h6",children:"Syncing with streaming video in another tab"}),Object(w.jsxs)(K.a,{component:"ul",children:[Object(w.jsxs)("li",{children:["Install the Chrome ",Object(w.jsx)(le.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:r,children:"extension"}),"."]}),Object(w.jsx)("li",{children:"Drag-and-drop a subtitle file into the video element you want to sync."}),Object(w.jsx)("li",{children:"Or, load a subtitle file into asbplayer."}),Object(w.jsx)("li",{children:Object(w.jsxs)("div",{className:t.inlineIcon,children:["Use the \xa0",Object(w.jsx)(ke.a,{fontSize:"small"}),"\xa0 button in the bottom right."]})}),Object(w.jsx)("li",{children:"If the icon does not appear try refreshing the video in the other tab."}),Object(w.jsxs)("li",{children:["It is recommended to use the extension keyboard shortcut (Ctrl+Alt+Z by default) to mine subtitles since that will include audio/screenshots. If the keyboard shortcut  is not working for some reason try:",Object(w.jsxs)(K.a,{component:"ul",children:[Object(w.jsx)("li",{children:"Uninstalling and reinstalling the extension and restarting Chrome."}),Object(w.jsxs)("li",{children:["Verifying the keyboard shortcut is  bound as in this ",Object(w.jsx)(le.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://youtu.be/wYWbgovfNlI",children:"video"}),"."]})]})]})]}),Object(w.jsx)("br",{}),Object(w.jsx)(K.a,{variant:"h6",children:"Anki"}),Object(w.jsxs)(K.a,{component:"ul",children:[Object(w.jsx)("li",{children:Object(w.jsxs)("div",{className:t.inlineIcon,children:["Use the \xa0",Object(w.jsx)(he.a,{fontSize:"small"}),"\xa0 button in the copy history."]})}),Object(w.jsx)("li",{children:"Audio/image will be exported only if an audio/image source was available when the subtitle was copied."}),Object(w.jsx)("li",{children:"Specifically, for synced streaming video, an audio/image will only be available if the extension keyboard shortcut was used (Ctrl+Alt+Z by default)."}),Object(w.jsxs)("li",{children:["Configure Anki settings with the settings button in the top right. See this ",Object(w.jsx)(le.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://youtu.be/Mv7fEVb6PHo?t=44",children:"video"})," for how to configure AnkiConnect so that asbplayer can connect to Anki."]})]}),Object(w.jsx)("br",{}),Object(w.jsx)(K.a,{variant:"h6",children:"Changing subtitle offset"}),Object(w.jsxs)(K.a,{component:"ul",children:[Object(w.jsx)("li",{children:"Click on the subtitle offset input field in the controls."}),Object(w.jsx)("li",{children:"Type in a number and hit enter."})]}),Object(w.jsx)("br",{}),Object(w.jsx)(K.a,{variant:"h6",children:"Condensed playback of local media files"}),Object(w.jsxs)(K.a,{component:"ul",children:[Object(w.jsx)("li",{children:"Load an audio/video file with a subtitle file."}),Object(w.jsx)("li",{children:Object(w.jsxs)("div",{className:t.inlineIcon,children:["Use the \xa0",Object(w.jsx)(be.a,{fontSize:"small"}),"\xa0 button in the bottom right."]})})]}),Object(w.jsx)("br",{}),Object(w.jsx)(K.a,{variant:"h6",children:"Keyboard shortcuts"}),Object(w.jsx)(Oe.a,{children:Object(w.jsx)(je.a,{size:"small",children:Object(w.jsxs)(pe.a,{children:[Object(w.jsxs)(ge.a,{children:[Object(w.jsx)(ve.a,{children:Object(w.jsx)(K.a,{children:"Ctrl+Shift+A"})}),Object(w.jsx)(ve.a,{children:Object(w.jsx)(K.a,{children:"Copy current subtitle"})})]}),Object(w.jsxs)(ge.a,{children:[Object(w.jsx)(ve.a,{children:Object(w.jsx)(K.a,{children:"Ctrl+Shift+Z"})}),Object(w.jsx)(ve.a,{children:Object(w.jsx)(K.a,{children:"Copy current subtitle (streaming video in another tab)"})})]}),Object(w.jsxs)(ge.a,{children:[Object(w.jsx)(ve.a,{children:Object(w.jsx)(K.a,{children:"Space"})}),Object(w.jsx)(ve.a,{children:Object(w.jsx)(K.a,{children:"Play/pause"})})]}),Object(w.jsxs)(ge.a,{children:[Object(w.jsx)(ve.a,{children:Object(w.jsx)(K.a,{children:"Left/Right"})}),Object(w.jsx)(ve.a,{children:Object(w.jsx)(K.a,{children:"Seek to previous/next subtitle"})})]}),Object(w.jsxs)(ge.a,{children:[Object(w.jsx)(ve.a,{children:Object(w.jsx)(K.a,{children:"Ctrl+Left/Right"})}),Object(w.jsx)(ve.a,{children:Object(w.jsx)(K.a,{children:"Adjust offset to previous/next subtitle"})})]}),Object(w.jsxs)(ge.a,{children:[Object(w.jsx)(ve.a,{children:Object(w.jsx)(K.a,{children:"Ctrl+Shift+Left/Right"})}),Object(w.jsx)(ve.a,{children:Object(w.jsx)(K.a,{children:"Adjust offset by +/-100 ms"})})]})]})})}),Object(w.jsx)("br",{}),Object(w.jsx)(K.a,{variant:"h6",children:"Demos"}),Object(w.jsxs)(K.a,{component:"ul",children:[Object(w.jsx)("li",{children:Object(w.jsx)(le.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://www.youtube.com/watch?v=7v0Hly_Q_Bs",children:"Sentence mining video files"})}),Object(w.jsx)("li",{children:Object(w.jsx)(le.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://www.youtube.com/watch?v=m55HbFJMilk",children:"Sentence mining streaming video"})}),Object(w.jsx)("li",{children:Object(w.jsx)(le.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://www.youtube.com/watch?v=kJXVVixD8H8",children:"Sentence mining streaming video (drag and drop)"})})]}),Object(w.jsx)("br",{}),Object(w.jsx)(K.a,{variant:"h6",children:"Guides"}),Object(w.jsx)(K.a,{component:"ul",children:Object(w.jsx)("li",{children:Object(w.jsx)(le.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://learnjapanese.moe/streamworkflow/",children:"Sentence mining streaming workflow"})})}),Object(w.jsx)("br",{}),Object(w.jsx)(K.a,{variant:"h6",children:"Browser Compatibility"}),Object(w.jsxs)(K.a,{component:"ul",children:[Object(w.jsx)("li",{children:"The asbplayer application and the asbplayer extension has only been tested and Chrome 91 and later."}),Object(w.jsx)("li",{children:"The asbplayer application and the asbplayer extension may work on other Chromium-based browsers."}),Object(w.jsx)("li",{children:"Local video file playback is supported only for codecs supported by the browser."})]})]}),Object(w.jsx)(A.a,{children:Object(w.jsx)(R.a,{onClick:function(){return a()},children:"OK"})})]})}var we=n(324),Ce=n(325),Se=Object(I.a)((function(e){return{image:function(e){return{width:e.width,height:e.height,backgroundSize:"contain"}}}}));function Te(e){var t,n=e.open,a=e.image,i=e.onClose,c=Object(r.useState)(),o=Object(b.a)(c,2),l=o[0],d=o[1],f=Object(r.useState)(),h=Object(b.a)(f,2),j=h[0],p=h[1],O=Object(r.useState)(),v=Object(b.a)(O,2),m=v[0],k=v[1],x=g(!0),y=Object(b.a)(x,2),C=y[0],S=y[1];t=j>0&&m>0?Math.min(1,Math.min(C/(2*j),S/(2*m))):1;var T=Se({width:j*t,height:m*t});return Object(r.useEffect)((function(){function e(){return(e=Object(u.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dataUrl();case 2:t=e.sent,(n=new Image).onload=function(){p(n.width),k(n.height),d(t)},n.src=t;case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a&&function(){e.apply(this,arguments)}()}),[a]),Object(r.useEffect)((function(){n||(p(0),k(0),d(null))}),[n]),a&&l?Object(w.jsx)(N.a,{open:n,onBackdropClick:function(){return i()},maxWidth:"lg",children:Object(w.jsx)(we.a,{children:Object(w.jsx)(Ce.a,{className:T.image,image:l,title:a.name,style:{width:j*t,height:m*t}})})}):null}var Fe=n(146),Ee=n(338),Me=n(111),Ie=function(){function e(){Object(T.a)(this,e)}return Object(F.a)(e,[{key:"subtitles",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.name.endsWith(".srt")){e.next=7;break}return e.t0=Fe.a,e.next=4,t.text();case 4:return e.t1=e.sent,n=(0,e.t0)(e.t1),e.abrupt("return",n.map((function(e){return e.data})).sort((function(e,t){return e.start-t.start})));case 7:if(!t.name.endsWith(".vtt")){e.next=9;break}return e.abrupt("return",new Promise(function(){var e=Object(u.a)(s.a.mark((function e(n,r){var a,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Me.WebVTT.Parser(window,Me.WebVTT.StringDecoder()),i=[],a.oncue=function(e){return i.push(e)},a.onflush=function(){return n(i.map((function(e){return{start:Math.floor(1e3*e.startTime),end:Math.floor(1e3*e.endTime),text:e.text}})).sort((function(e,t){return e.start-t.start})))},e.t0=a,e.next=7,t.text();case 7:e.t1=e.sent,e.t0.parse.call(e.t0,e.t1),a.flush();case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 9:if(!t.name.endsWith(".ass")){e.next=16;break}return e.t2=Ee.a,e.next=13,t.text();case 13:return e.t3=e.sent,r=(0,e.t2)(e.t3),e.abrupt("return",r.events.dialogue.map((function(e){return{start:Math.round(1e3*e.Start),end:Math.round(1e3*e.End),text:e.Text.combined}})).sort((function(e,t){return e.start-t.start})));case 16:throw new Error("Unsupported subtitle file format");case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Re=n(326),Pe=n(151),Ne=n.n(Pe),Ae=n(152),_e=n.n(Ae),Ue=n(150),De=n.n(Ue),Be=n(153),Le=n.n(Be),We=Object(p.a)((function(e){return{title:{flexGrow:1},appBar:{transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{width:function(e){var t=e.drawerWidth;return"calc(100% - ".concat(t,"px)")},transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:function(e){return e.drawerWidth}},copyHistoryButton:{transform:"scaleX(1)",width:48,padding:12,transition:e.transitions.create(["transform","padding","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},copyHistoryButtonShift:{transform:"scaleX(0)",width:0,padding:5,transition:e.transitions.create(["transform","padding","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},hide:{display:"none"}}}));function He(e){var t=We(e);return Object(w.jsx)(Re.a,{position:"static",elevation:0,className:Object(k.a)(t.appBar,Object(f.a)({},t.appBarShift,e.drawerOpen)),children:Object(w.jsxs)(z.a,{children:[Object(w.jsx)(V.a,{title:"Open Files",children:Object(w.jsx)(U.a,{edge:"start",color:"inherit",onClick:e.onFileSelector,children:Object(w.jsx)(De.a,{})})}),Object(w.jsx)(K.a,{variant:"h6",className:t.title,children:e.title}),Object(w.jsx)(V.a,{title:"Submit Issue",children:Object(w.jsx)(U.a,{edge:"end",color:"inherit",component:"a",href:"https://github.com/killergerbah/asbplayer/issues",target:"_blank",rel:"noreferrer",children:Object(w.jsx)(Ne.a,{})})}),Object(w.jsx)(V.a,{title:"Help",children:Object(w.jsx)(U.a,{edge:"end",color:"inherit",onClick:e.onOpenHelp,children:Object(w.jsx)(_e.a,{})})}),Object(w.jsx)(V.a,{title:"Settings",children:Object(w.jsx)(U.a,{edge:"end",color:"inherit",onClick:e.onOpenSettings,children:Object(w.jsx)(H.a,{})})}),Object(w.jsx)(V.a,{title:"Copy History",children:Object(w.jsx)(U.a,{edge:"end",color:"inherit","aria-label":"menu",onClick:e.onOpenCopyHistory,className:Object(k.a)(t.copyHistoryButton,Object(f.a)({},t.copyHistoryButtonShift,e.drawerOpen)),children:Object(w.jsx)(Le.a,{})})})]})})}var ze=n(341),Ve=function(){function e(t){var n=this;Object(T.a)(this,e),this.onMessageCallbacks=[],this.onTabsCallbacks=[],this.tabs=[],this.versionPromise=new Promise((function(e,t){n.versionResolve=e})),this.id=Object(ze.a)(),window.addEventListener("message",(function(e){if(e.source===window&&"asbplayer-extension-to-player"===e.data.sender&&e.data.message){if("tabs"===e.data.message.command){n.tabs=e.data.message.tabs;var t,r=Object(h.a)(n.onTabsCallbacks);try{for(r.s();!(t=r.n()).done;){(0,t.value)(n.tabs)}}catch(c){r.e(c)}finally{r.f()}return}if("version"===e.data.message.command)return void n.versionResolve(e.data.message.version);var a,i=Object(h.a)(n.onMessageCallbacks);try{for(i.s();!(a=i.n()).done;){(0,a.value)({data:e.data.message,tabId:e.data.tabId,src:e.data.src})}}catch(c){i.e(c)}finally{i.f()}}})),t&&(this._sendHeartbeat(),setInterval((function(){return n._sendHeartbeat()}),1e3))}return Object(F.a)(e,[{key:"_sendHeartbeat",value:function(){window.postMessage({sender:"asbplayerv2",message:{command:"heartbeat",id:this.id}},"*")}},{key:"installedVersion",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.versionPromise;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(e,t,n){window.postMessage({sender:"asbplayer",message:e,tabId:t,src:n},"*")}},{key:"publishMessage",value:function(e){var t,n=Object(h.a)(this.tabs);try{for(n.s();!(t=n.n()).done;){var r=t.value;window.postMessage({sender:"asbplayer",message:e,tabId:r.id,src:r.src},"*")}}catch(a){n.e(a)}finally{n.f()}}},{key:"subscribeTabs",value:function(e){this.onTabsCallbacks.push(e)}},{key:"unsubscribeTabs",value:function(e){this._remove(e,this.onTabsCallbacks)}},{key:"subscribe",value:function(e){this.onMessageCallbacks.push(e)}},{key:"unsubscribe",value:function(e){this._remove(e,this.onMessageCallbacks)}},{key:"_remove",value:function(e,t){for(var n=t.length-1;n>=0;--n)if(e===t[n]){t.splice(n,1);break}}}]),e}(),Ke=n(330),Ge=n(344),Xe=n(155),qe=n.n(Xe),Je=n(94),Qe=n.n(Je),Ye=n(314),Ze=n(266),$e=n(329),et=n(327),tt=n(328),nt=n(313),rt=n(154),at=n.n(rt),it=Object(p.a)((function(e){return{drawer:{width:function(e){return e.drawerWidth},flexShrink:0},drawerPaper:{width:function(e){return e.drawerWidth}},drawerHeader:Object(l.a)(Object(l.a)({display:"flex",alignItems:"center",position:"static",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-start"}),listContainer:{position:"relative",height:"100%",overflowY:"auto",overflowX:"hidden"},listItem:{"&:hover":{backgroundColor:e.palette.action.hover}},listItemGutters:{paddingLeft:5,paddingRight:5},listItemIconRoot:{minWidth:20},emptyState:{display:"flex",justifyContent:"center",flexDirection:"column",textAlign:"center",height:"100%",padding:15}}}));function ct(e){var t=e.open,n=e.anchorEl,a=e.onClose,i=e.onSelect,c=e.onClipAudio,o=e.onDownloadImage,s=e.item,u=Object(r.useCallback)((function(){navigator.clipboard.writeText(s.text),a()}),[s,a]),l=Object(r.useCallback)((function(){i(s),a()}),[s,i,a]),d=Object(r.useCallback)((function(){c(s),a()}),[s,c,a]),b=Object(r.useCallback)((function(){o(s),a()}),[s,o,a]);return s?Object(w.jsx)(nt.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:a,anchorOrigin:{vertical:"center",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"right"},children:Object(w.jsxs)(Ye.a,{children:[Object(w.jsx)(Ze.a,{button:!0,onClick:u,children:Object(w.jsx)(et.a,{primaryTypographyProps:{variant:"body2"},primary:"Copy"})}),Object(w.jsx)(Ze.a,{button:!0,onClick:l,children:Object(w.jsx)(et.a,{primaryTypographyProps:{variant:"body2"},primary:"Jump To"})}),(s.videoFile||s.audioFile||s.audio)&&Object(w.jsx)(Ze.a,{button:!0,onClick:d,children:Object(w.jsx)(et.a,{primaryTypographyProps:{variant:"body2"},primary:"Download Audio"})}),(s.videoFile||s.image)&&Object(w.jsx)(Ze.a,{button:!0,onClick:b,children:Object(w.jsx)(et.a,{primaryTypographyProps:{variant:"body2"},primary:"Download Image"})})]})}):null}function ot(e){var t,n=it(e),i=Object(r.useCallback)((function(e){e&&e.scrollIntoView()}),[]),c=Object(r.useState)(),o=Object(b.a)(c,2),s=o[0],u=o[1],l=Object(r.useState)(!1),d=Object(b.a)(l,2),f=d[0],j=d[1],p=Object(r.useState)(),O=Object(b.a)(p,2),v=O[0],g=O[1],m=Object(r.useCallback)((function(e,t){u(t),j(!0),g(e.currentTarget)}),[]),k=Object(r.useCallback)((function(e,t){u(null),j(!1),g(null)}),[]),x=Object(r.useCallback)((function(t){e.onDelete(t)}),[e]);if(e.items.length>0){var y,C=[],S=null,T=0,F={},E=Object(h.a)(e.items);try{var M=function(){var t=y.value;null!==S&&S===t.name||(t.name in F?F[t.name]++:F[t.name]=0,S=t.name,C.push(Object(w.jsx)(tt.a,{disableSticky:!0,children:t.name},t.name+"-"+F[t.name])));var r=T===e.items.length-1?i:null;C.push(Object(w.jsxs)(Ze.a,{ref:r,className:n.listItem,classes:{gutters:n.listItemGutters},children:[Object(w.jsx)($e.a,{classes:{root:n.listItemIconRoot},children:Object(w.jsx)(V.a,{title:"Export to Anki",children:Object(w.jsx)(U.a,{onClick:function(){return e.onAnki(t)},children:Object(w.jsx)(he.a,{fontSize:"small"})})})}),Object(w.jsx)($e.a,{classes:{root:n.listItemIconRoot},children:Object(w.jsx)(U.a,{onClick:function(e){return m(e,t)},children:Object(w.jsx)(at.a,{fontSize:"small"})})}),Object(w.jsx)(et.a,{children:t.text}),Object(w.jsx)($e.a,{classes:{root:n.listItemIconRoot},children:Object(w.jsx)(U.a,{onClick:function(){return x(t)},children:Object(w.jsx)(Qe.a,{fontSize:"small"})})})]},t.timestamp)),++T};for(E.s();!(y=E.n()).done;)M()}catch(I){E.e(I)}finally{E.f()}t=Object(w.jsx)("div",{className:n.listContainer,children:Object(w.jsx)(Ye.a,{children:C})})}else t=Object(w.jsxs)("div",{className:n.emptyState,children:[Object(w.jsx)(K.a,{variant:"h6",children:"Copy history is empty."}),Object(w.jsx)(K.a,{variant:"caption",children:"See the help for keyboard shortcuts or use the copy button next to the subtitle."})]});return Object(w.jsxs)(a.a.Fragment,{children:[Object(w.jsxs)(Ge.a,{variant:"persistent",anchor:"right",open:e.open,className:n.drawer,classes:{paper:n.drawerPaper},children:[Object(w.jsx)("div",{className:n.drawerHeader,children:Object(w.jsx)(U.a,{onClick:e.onClose,children:Object(w.jsx)(qe.a,{})})}),Object(w.jsx)(Ke.a,{}),t]}),Object(w.jsx)(ct,{open:e.open&&f,anchorEl:v,item:s,onClose:k,onSelect:e.onSelect,onClipAudio:e.onClipAudio,onDownloadImage:e.onDownloadImage})]})}var st=function(){function e(t,n,r){Object(T.a)(this,e),this.name=t,this._base64=n,this.extension=r}return Object(F.a)(e,[{key:"base64",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._base64);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_blob",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cachedBlob){e.next=6;break}return e.next=3,fetch(this._dataUrl());case 3:return e.next=5,e.sent.blob();case 5:this.cachedBlob=e.sent;case 6:return e.abrupt("return",this.cachedBlob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._dataUrl());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_dataUrl",value:function(){return"data:image/"+this.extension+";base64,"+this._base64}}]),e}(),ut=function(){function e(t,n){Object(T.a)(this,e),this.file=t,this.name=t.name+"_"+n+".jpeg",this.timestamp=n}return Object(F.a)(e,[{key:"base64",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(u.a)(s.a.mark((function e(n,r){var a,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._canvas();case 2:a=e.sent,i=a.toDataURL("image/jpeg"),n(i.substr(i.indexOf(",")+1));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(u.a)(s.a.mark((function e(n,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._canvas();case 2:e.sent.toBlob((function(e){t._blob=e,n(e)}),"image/jpeg");case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canvas();case 2:return t=e.sent,e.abrupt("return",t.toDataURL());case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_canvas",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t._videoElement(t.file);r.oncanplay=function(){var t=Object(u.a)(s.a.mark((function t(n){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(a=document.createElement("canvas")).width=r.videoWidth,a.height=r.videoHeight,a.getContext("2d").drawImage(r,0,0,a.width,a.height),e(a),URL.revokeObjectURL(r.src);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_videoElement",value:function(e){var t=document.createElement("video");return t.src=URL.createObjectURL(e),t.preload="none",t.currentTime=this.timestamp/1e3,t.load(),t}}]),e}(),lt=function(){function e(t){Object(T.a)(this,e),this.data=t}return Object(F.a)(e,[{key:"name",get:function(){return this.data.name}},{key:"base64",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.base64();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.dataUrl();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:t=e.sent,n=window.URL.createObjectURL(t),r=document.createElement("a"),document.body.appendChild(r),r.style="display: none",r.href=n,r.download=this.data.name,r.click(),URL.revokeObjectURL(n),r.remove();case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"fromBase64",value:function(t,n,r,a){var i=t.name.substring(0,t.name.lastIndexOf("."))+"_"+n+"."+a;return new e(new st(i,r,a))}},{key:"fromFile",value:function(t,n){return new e(new ut(t,n))}}]),e}(),dt=n(156),bt=n.n(dt),ft=Object(I.a)((function(e){return{background:{position:"absolute",height:"calc(100vh - 64px)",width:"100%",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center"},browseLink:{cursor:"pointer"}}}));function ht(e){var t=e.extension,n=e.latestExtensionVersion,i=e.extensionUrl,c=e.loading,o=e.dragging,l=e.onFileSelector,d=ft(),f=Object(r.useState)(),h=Object(b.a)(f,2),j=h[0],p=h[1];Object(r.useEffect)((function(){function e(){return(e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=p,e.next=3,t.installedVersion();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t]);var O=j&&bt()(n,j),v=!j;return Object(w.jsx)(a.a.Fragment,{children:Object(w.jsx)(ce.a,{in:!c&&!o,timeout:500,children:Object(w.jsx)("div",{className:d.background,children:Object(w.jsxs)(K.a,{variant:"h6",children:["Drag and drop subtitle and media files, or ",Object(w.jsx)(le.a,{target:"#",className:d.browseLink,onClick:l,color:"secondary",component:"label",children:"browse"}),".",Object(w.jsx)("br",{}),v&&Object(w.jsxs)("span",{children:["Install the ",Object(w.jsx)(le.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:i,children:"Chrome extension"})," to sync subtitles with streaming video."]}),O&&Object(w.jsxs)("span",{children:["An extension ",Object(w.jsx)(le.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:i,children:"update"})," is available."]})]})})})})}var jt=function(){function e(t){Object(T.a)(this,e),this.channel=new BroadcastChannel(t);var n=this;this.channel.onmessage=function(e){var t;null===(t=n.onMessage)||void 0===t||t.call(n,e)}}return Object(F.a)(e,[{key:"postMessage",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage(e)}},{key:"close",value:function(){var e;null===(e=this.channel)||void 0===e||e.close(),this.channel=null}}]),e}(),pt=function(){function e(t,n,r){var a=this;Object(T.a)(this,e),this.tabId=t,this.src=n,this.listener=function(e){var r;e.tabId!==t||e.src&&e.src!==n||(null===(r=a.onMessage)||void 0===r||r.call(a,{data:e.data}))},r.subscribe(this.listener),this.extension=r}return Object(F.a)(e,[{key:"postMessage",value:function(e){this.extension.sendMessage(e,this.tabId,this.src)}},{key:"close",value:function(){this.extension.unsubscribe(this.listener)}}]),e}(),Ot=function(){function e(){Object(T.a)(this,e),this.accumulated=0,this.started=!1}return Object(F.a)(e,[{key:"time",value:function(e){return this.started?Math.min(e,this.accumulated+Date.now()-this.startTime):Math.min(e,this.accumulated)}},{key:"stop",value:function(){this.started&&(this.started=!1,this.accumulated+=Date.now()-this.startTime)}},{key:"start",value:function(){this.startTime=Date.now(),this.started=!0}},{key:"setTime",value:function(e){this.started?(this.startTime=Date.now(),this.accumulated=e):this.accumulated=e}},{key:"progress",value:function(e){return 0===e?0:Math.min(1,this.time(e)/e)}}]),e}(),vt=n(7),gt=n(158),mt=n.n(gt),kt=n(159),xt=n.n(kt),yt=n(165),wt=n.n(yt),Ct=n(157),St=n.n(Ct),Tt=n(331),Ft=n(260),Et=n(167),Mt=n.n(Et),It=n(169),Rt=n.n(It),Pt=n(168),Nt=n.n(Pt),At=n(160),_t=n.n(At),Ut=n(161),Dt=n.n(Ut),Bt=n(166),Lt=n.n(Bt),Wt=n(345),Ht=n(164),zt=n.n(Ht),Vt=n(162),Kt=n.n(Vt),Gt=n(163),Xt=n.n(Gt),qt=Object(p.a)((function(e){return{container:{position:"absolute",left:"50%",width:"50%",bottom:0,pointerEvents:"none",color:"#fff"},buttonContainer:{flexDirection:"row"},timeDisplay:{color:"#fff",display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",cursor:"default",fontSize:20,marginLeft:10},offsetInput:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",fontSize:20,marginLeft:10,width:100,color:"#fff",pointerEvents:"auto"},volumeInputContainerShown:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:5,pointerEvents:"auto"},volumeInputContainerHidden:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:0,pointerEvents:"auto"},volumeInputHidden:{transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),width:0,pointerEvents:"auto"},volumeInputShown:{transition:e.transitions.create("width",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),width:100,pointerEvents:"auto"},volumeInputThumbHidden:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),opacity:0,pointerEvents:"auto"},volumeInputThumbShown:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),opacity:1,pointerEvents:"auto"},subContainer:{background:"linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, .4) 40%, rgba(0, 0, 0, 0.7))",position:"relative",left:"-100%",width:"200%",zIndex:10},button:{pointerEvents:"auto"},inactiveButton:{color:"rgba(72, 72, 72, 0.7)",pointerEvents:"auto"},progress:{margin:5},closeButton:{position:"absolute",top:0,left:0,pointerEvents:"auto",color:"#fff"},hideSubtitlePlayerToggleButton:{position:"absolute",top:0,right:0,pointerEvents:"auto",color:"#fff"},gridContainer:{pointerEvents:"auto",padding:2}}})),Jt=Object(p.a)((function(e){return{root:{height:10},container:{height:10,pointerEvents:"auto",display:"flex",justifyContent:"center",flexDirection:"column",position:"absolute",width:"calc(100% - 20px)",marginLeft:10},mouseEventListener:{zIndex:1,height:10,cursor:"pointer",pointerEvents:"auto",position:"absolute",width:"100%"},fillContainer:{background:"rgba(30,30,30,0.7)",width:"100%",height:5,position:"relative"},fillContainerThick:{transition:e.transitions.create("height",{easing:e.transitions.easing.easeInOut,duration:50}),height:8},fill:{background:"linear-gradient(to left, #ff1f62, #49007a)",height:"100%"},handleContainer:{position:"absolute",display:"flex",justifyContent:"center",flexDirection:"column",height:"100%",bottom:0},handle:{borderRadius:"50%",width:16,height:16,opacity:0,left:-8,background:"white",position:"absolute"},handleOn:{opacity:1,transition:e.transitions.create("opacity",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.shortest})}}})),Qt=Object(vt.a)((function(e){return{root:{color:"white",verticalAlign:"middle"},thumb:{backgroundColor:"white",color:"white","&:focus":{boxShadow:"inherit"},"&:hover, &$active":{boxShadow:"0px 0px 0px 8px rgba(255, 255, 255, 0.1)"}},active:{color:"white"}}}))(Wt.a);function Yt(e){var t=Math.floor(e/1e3),n=Math.floor(t/60),r=t%60;return String(n)+":"+String(r).padStart(2,"0")}function Zt(e){var t=Jt(),n=Object(r.useState)(!1),a=Object(b.a)(n,2),i=a[0],c=a[1],o=Object(r.useRef)(null),s=e.onSeek,u=Object(r.useCallback)((function(e){var t=e.currentTarget.getBoundingClientRect(),n=t.right-t.left-20,r=Math.min(1,Math.max(0,(e.pageX-t.left-10)/n));s(r)}),[s]),l=Object(r.useCallback)((function(){return c(!0)}),[]),d=Object(r.useCallback)((function(){return c(!1)}),[]),f=o.current?function(e){var t=e.getBoundingClientRect();return t.right-t.left}(o.current)*e.value/100:0,h={width:f},j={marginLeft:f},p=i?t.fillContainer+" "+t.fillContainerThick:t.fillContainer,O=i?t.handle+" "+t.handleOn:t.handle;return Object(w.jsxs)("div",{className:t.root,children:[Object(w.jsx)("div",{ref:o,className:t.container,children:Object(w.jsxs)("div",{className:p,children:[Object(w.jsx)("div",{className:t.fill,style:h}),Object(w.jsx)("div",{className:t.handleContainer,children:Object(w.jsx)("div",{className:O,style:j})})]})}),Object(w.jsx)("div",{className:t.mouseEventListener,onClick:u,onMouseOver:l,onMouseOut:d})]})}function $t(e){if(!e.audioTracks||0===e.audioTracks.length)return null;var t=e.audioTracks.map((function(t){return Object(w.jsxs)(Ze.a,{selected:t.id===e.selectedAudioTrack,button:!0,onClick:function(){return e.onAudioTrackSelected(t.id)},children:[t.language," ",t.label]},t.id)}));return Object(w.jsx)("div",{children:Object(w.jsx)(nt.a,{disableEnforceFocus:!0,open:e.open,anchorEl:e.anchorEl,onClose:e.onClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(w.jsx)(Ye.a,{children:t})})})}function en(e){var t=e.open,n=e.anchorEl,r=e.onClose,a=e.tabs,i=e.selectedTab,c=e.onTabSelected;if(!a||0===a.length)return null;var o=a.map((function(e){return Object(w.jsxs)(Ze.a,{selected:i&&e.id===i.id&&e.src===i.src,button:!0,onClick:function(){return c(e)},children:[e.id," ",e.title," ",e.src]},e.id)}));return Object(w.jsx)("div",{children:Object(w.jsx)(nt.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:r,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(w.jsx)(Ye.a,{children:o})})})}function tn(e){return Object(w.jsx)("div",{children:Object(w.jsx)(nt.a,{disableEnforceFocus:!0,open:e.open,anchorEl:e.anchorEl,onClose:e.onClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(w.jsx)(Ye.a,{children:Object(w.jsxs)(Ze.a,{button:!0,onClick:function(t){return e.onUnload()},children:["Unload ",e.file]})})})})}function nn(e){var t=e.clock,n=e.playing,i=e.length,c=e.offsetEnabled,o=e.displayLength,s=e.offset,u=e.onAudioTrackSelected,l=e.onSeek,d=e.mousePositionRef,f=e.onShow,h=e.onPause,j=e.onPlay,p=e.onTabSelected,O=e.onUnloadAudio,v=e.onUnloadVideo,g=e.onOffsetChange,m=e.onVolumeChange,k=e.disableKeyEvents,x=e.settingsProvider,y=e.closeEnabled,C=e.onClose,S=e.volumeEnabled,T=e.condensedModeEnabled,F=e.condensedModeToggleEnabled,E=e.onCondensedModeToggle,M=e.subtitlesEnabled,I=e.subtitlesToggle,R=e.onSubtitlesToggle,P=e.videoFile,N=e.audioFile,A=e.audioTracks,_=e.selectedAudioTrack,D=e.tabs,B=e.selectedTab,L=e.popOutEnabled,W=e.popOut,H=e.onPopOutToggle,z=e.fullscreenEnabled,K=e.fullscreen,G=e.onFullscreenToggle,X=e.hideSubtitlePlayerToggleEnabled,q=e.subtitlePlayerHidden,J=e.onHideSubtitlePlayerToggle,Q=qt(),Y=Object(r.useState)(!0),Z=Object(b.a)(Y,2),$=Z[0],ee=Z[1],te=Object(r.useState)(!1),ne=Object(b.a)(te,2),re=ne[0],ae=ne[1],ie=Object(r.useState)(),oe=Object(b.a)(ie,2),se=oe[0],ue=oe[1],le=Object(r.useState)(!1),de=Object(b.a)(le,2),fe=de[0],he=de[1],je=Object(r.useState)(),pe=Object(b.a)(je,2),Oe=pe[0],ve=pe[1],ge=Object(r.useState)(!1),me=Object(b.a)(ge,2),xe=me[0],ye=me[1],we=Object(r.useState)(),Ce=Object(b.a)(we,2),Se=Ce[0],Te=Ce[1],Fe=Object(r.useState)(!1),Ee=Object(b.a)(Fe,2),Me=Ee[0],Ie=Ee[1],Re=Object(r.useState)(),Pe=Object(b.a)(Re,2),Ne=Pe[0],Ae=Pe[1],_e=Object(r.useState)(!1),Ue=Object(b.a)(_e,2),De=Ue[0],Be=Ue[1],Le=Object(r.useState)(100),We=Object(b.a)(Le,2),He=We[0],ze=We[1],Ve=Object(r.useState)(100),Ke=Object(b.a)(Ve,2),Ge=Ke[0],Xe=Ke[1],qe=Object(r.useRef)({x:0,y:0}),Je=Object(r.useRef)(Date.now()),Qe=Object(r.useRef)(Date.now()),Ye=Object(r.useRef)(!0),Ze=Object(r.useRef)(!1),$e=Object(r.useRef)(),et=Object(r.useState)(),tt=Object(b.a)(et,2)[1],nt=Object(r.useCallback)((function(){return tt({})}),[]),rt=Object(r.useCallback)((function(e){l(e)}),[l]);function at(e){Ze.current=!0}function it(e){Ze.current=!1}Object(r.useEffect)((function(){var e=Number(x.volume);ze(e),m(e/100),e>0&&Xe(e)}),[x,m]),Object(r.useEffect)((function(){var e=setInterval((function(){var e=Date.now(),t=e-Je.current<2e3||Math.pow(d.current.x-qe.current.x,2)+Math.pow(d.current.y-qe.current.y,2)>100||Ze.current||$e.current===document.activeElement||e-Qe.current<2e3;t&&!Ye.current?(Je.current=Date.now(),ee(t)):!t&&Ye.current&&ee(t),Ye.current=t,qe.current.x=d.current.x,qe.current.y=d.current.y}),100);return function(){return clearInterval(e)}}),[d,ee,$]),Object(r.useEffect)((function(){return null===f||void 0===f?void 0:f($)}),[f,$]),Object(r.useEffect)((function(){if(!k)return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)};function e(e){if(32===e.keyCode)e.preventDefault(),n?h():j();else if(13===e.keyCode&&$e.current===document.activeElement){var t=Number($e.current.value);if(Number.isNaN(t))return;g(1e3*t),$e.current.blur()}}}),[n,h,j,g,k]);var ct=Object(r.useCallback)((function(e){var t;return e.target.setSelectionRange(0,(null===(t=e.target.value)||void 0===t?void 0:t.length)||0)}),[]);Object(r.useEffect)((function(){var e=setInterval((function(){nt()}),100);return function(){return clearInterval(e)}}),[nt]),Object(r.useEffect)((function(){if($e.current)if(0===s)$e.current.value=null;else{var e=s/1e3,t=e>=0?"+"+e.toFixed(2):String(e.toFixed(2));$e.current.value=t,Qe.current=Date.now()}}),[s]);var ot=Object(r.useCallback)((function(){ue(null),ae(!1)}),[]),st=Object(r.useCallback)((function(e){ue(e.currentTarget),ae(!0)}),[]),ut=Object(r.useCallback)((function(e){u(e),ue(null),ae(!1)}),[u]),lt=Object(r.useCallback)((function(){ve(null),he(!1)}),[]),dt=Object(r.useCallback)((function(e){ve(e.currentTarget),he(!0)}),[]),bt=Object(r.useCallback)((function(e){p(e),ve(null),he(!1)}),[p]),ft=Object(r.useCallback)((function(){Te(null),ye(!1)}),[]),ht=Object(r.useCallback)((function(e){Te(e.currentTarget),ye(!0)}),[]),jt=Object(r.useCallback)((function(){O(),ye(!1)}),[O]),pt=Object(r.useCallback)((function(e){Ae(null),Ie(!1)}),[]),Ot=Object(r.useCallback)((function(e){Ae(e.currentTarget),Ie(!0)}),[]),vt=Object(r.useCallback)((function(){v(),Ie(!1)}),[v]),gt=Object(r.useCallback)((function(){return Be(!1)}),[]),kt=Object(r.useCallback)((function(){return Be(!0)}),[]),yt=Object(r.useCallback)((function(e,t){ze(t),m(t/100)}),[m]),Ct=Object(r.useCallback)((function(e,t){t>0&&Xe(t),x.volume=t}),[x]),Et=Object(r.useCallback)((function(e,t){ze((function(e){var t=e>0?0:Ge;return m(t/100),t}))}),[m,Ge]),It=t.progress(i);return Object(w.jsxs)(a.a.Fragment,{children:[y&&Object(w.jsx)(ce.a,{in:$,timeout:200,children:Object(w.jsx)(U.a,{color:"inherit",className:Q.closeButton,onClick:C,onMouseOver:at,onMouseOut:it,children:Object(w.jsx)(St.a,{})})}),X&&Object(w.jsx)(ce.a,{in:$,timeout:200,children:Object(w.jsx)(U.a,{color:"inherit",className:Q.hideSubtitlePlayerToggleButton,onClick:J,onMouseOver:at,onMouseOut:it,children:q?Object(w.jsx)(mt.a,{}):Object(w.jsx)(xt.a,{})})}),Object(w.jsxs)("div",{className:Q.container,onMouseOver:at,onMouseOut:it,children:[Object(w.jsx)(ce.a,{in:$,timeout:200,children:Object(w.jsxs)("div",{className:Q.subContainer,children:[Object(w.jsx)(Zt,{onSeek:rt,value:100*It}),Object(w.jsxs)(Tt.a,{container:!0,className:Q.gridContainer,direction:"row",children:[Object(w.jsx)(Tt.a,{item:!0,children:Object(w.jsx)(U.a,{color:"inherit",onClick:function(){return n?h():j()},children:n?Object(w.jsx)(_t.a,{className:Q.button}):Object(w.jsx)(Dt.a,{className:Q.button})})}),S&&Object(w.jsxs)(Tt.a,{item:!0,onMouseOver:kt,onMouseOut:gt,className:De?Q.volumeInputContainerShown:Q.volumeInputContainerHidden,children:[Object(w.jsx)(U.a,{color:"inherit",onClick:Et,children:0===He?Object(w.jsx)(Kt.a,{}):Object(w.jsx)(Xt.a,{})}),Object(w.jsx)(Qt,{onChange:yt,onChangeCommitted:Ct,value:He,defaultValue:100,classes:{root:De?Q.volumeInputShown:Q.volumeInputHidden,thumb:De?Q.volumeInputThumbShown:Q.volumeInputThumbHidden}})]}),Object(w.jsx)(Tt.a,{item:!0,children:Object(w.jsxs)("div",{className:Q.timeDisplay,children:[Yt(It*i)," / ",Yt(o||i)]})}),c&&Object(w.jsx)(Tt.a,{item:!0,children:Object(w.jsx)(Ft.a,{inputRef:$e,disableUnderline:!0,className:Q.offsetInput,placeholder:"\xb1"+Number(0).toFixed(2),onClick:ct})}),Object(w.jsx)(Tt.a,{item:!0,style:{flexGrow:1}}),F&&Object(w.jsx)(Tt.a,{item:!0,children:Object(w.jsx)(V.a,{title:"Condensed Mode",children:Object(w.jsx)(U.a,{color:"inherit",onClick:E,children:Object(w.jsx)(be.a,{className:T?Q.button:Q.inactiveButton})})})}),I&&Object(w.jsx)(Tt.a,{item:!0,children:Object(w.jsx)(U.a,{color:"inherit",onClick:R,children:Object(w.jsx)(zt.a,{className:M?Q.button:Q.inactiveButton})})}),P&&Object(w.jsx)(Tt.a,{item:!0,children:Object(w.jsx)(U.a,{color:"inherit",onClick:Ot,children:Object(w.jsx)(ke.a,{className:Q.button})})}),N&&Object(w.jsx)(Tt.a,{item:!0,children:Object(w.jsx)(U.a,{color:"inherit",onClick:ht,children:Object(w.jsx)(wt.a,{className:Q.button})})}),A&&A.length>1&&Object(w.jsx)(Tt.a,{item:!0,children:Object(w.jsx)(U.a,{color:"inherit",onClick:st,children:Object(w.jsx)(Lt.a,{className:Q.button})})}),D&&D.length>0&&Object(w.jsx)(Tt.a,{item:!0,children:Object(w.jsx)(U.a,{color:"inherit",onClick:dt,children:Object(w.jsx)(ke.a,{className:B?Q.button:Q.inactiveButton})})}),L&&Object(w.jsx)(Tt.a,{item:!0,children:Object(w.jsx)(U.a,{color:"inherit",onClick:H,children:Object(w.jsx)(Mt.a,{className:Q.button,style:W?{transform:"rotateX(180deg)"}:{}})})}),z&&Object(w.jsx)(Tt.a,{item:!0,children:Object(w.jsx)(U.a,{color:"inherit",onClick:G,children:K?Object(w.jsx)(Nt.a,{className:Q.button}):Object(w.jsx)(Rt.a,{className:Q.button})})})]})]})}),Object(w.jsx)(en,{open:fe&&$,anchorEl:Oe,tabs:D,selectedTab:B,onClose:lt,onTabSelected:bt}),Object(w.jsx)($t,{open:re&&$,anchorEl:se,audioTracks:A,selectedAudioTrack:_,onClose:ot,onAudioTrackSelected:ut}),Object(w.jsx)(tn,{open:xe,anchorEl:Se,file:N,onClose:ft,onUnload:jt}),Object(w.jsx)(tn,{open:Me,anchorEl:Ne,file:P,onClose:pt,onUnload:vt})]})]})}var rn=function(){function e(t){Object(T.a)(this,e),this.ref=t,this.readyResolves=[]}return Object(F.a)(e,[{key:"seek",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){n.ref.current?(n.ref.current.currentTime=t,n._onMediaCanPlay((function(){return e()}))):e()})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onReady",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.ref.current?t._onMediaCanPlay((function(){return e()})):e()})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_onMediaCanPlay",value:function(e){var t=this;4!==this.ref.readyState?(this.ref.current&&!this.ref.current.oncanplay&&(this.ref.current.oncanplay=function(e){var n,r=Object(h.a)(t.readyResolves);try{for(r.s();!(n=r.n()).done;){(0,n.value)()}}catch(a){r.e(a)}finally{r.f()}t.readyResolves.length=0,t.ref.current.oncanplay=null}),this.readyResolves.push(e)):e()}},{key:"play",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.play()}},{key:"pause",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.pause()}}]),e}(),an=n(174);var cn=function(){function e(){Object(T.a)(this,e)}return Object(F.a)(e,null,[{key:"detectCopy",value:function(e){return e.ctrlKey&&e.shiftKey&&65===e.keyCode}},{key:"detectDecreaseOffset",value:function(e){return e.ctrlKey&&e.shiftKey&&39===e.keyCode}},{key:"detectIncreaseOffset",value:function(e){return e.ctrlKey&&e.shiftKey&&37===e.keyCode}},{key:"detectDecreaseOffsetToNextSubtitle",value:function(t){return!e.detectDecreaseOffset(t)&&t.ctrlKey&&39===t.keyCode}},{key:"detectIncreaseOffsetToPreviousSubtitle",value:function(t){return!e.detectIncreaseOffset(t)&&t.ctrlKey&&37===t.keyCode}},{key:"detectPreviousSubtitle",value:function(t){return!e.detectIncreaseOffset(t)&&!e.detectIncreaseOffsetToPreviousSubtitle(t)&&37===t.keyCode}},{key:"detectNextSubtitle",value:function(t){return!e.detectDecreaseOffset(t)&&!e.detectDecreaseOffsetToNextSubtitle(t)&&39===t.keyCode}},{key:"detectToggleSubtitles",value:function(e){return 83===e.keyCode}}]),e}(),on=function(){function e(){Object(T.a)(this,e)}return Object(F.a)(e,null,[{key:"bindCopy",value:function(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return e._bind((function(e){if(!n()&&cn.detectCopy(e)){var a=r();a&&t(e,a)}}),a)}},{key:"bindSeekToSubtitle",value:function(t,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return e._bind((function(i){if(!n()){var c=a();if(c&&0!==c.length){var o;if(cn.detectPreviousSubtitle(i))o=!1;else{if(!cn.detectNextSubtitle(i))return;o=!0}var s=e._adjacentSubtitle(o,r(),c);null!==s&&s.start>=0&&s.end>=0&&t(i,s)}}}),i)}},{key:"bindOffsetToSubtitle",value:function(t,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return e._bind((function(i){if(!n()){var c=a();if(c&&0!==c.length){var o;if(cn.detectIncreaseOffsetToPreviousSubtitle(i))o=!1;else{if(!cn.detectDecreaseOffsetToNextSubtitle(i))return;o=!0}var s=r(),u=e._adjacentSubtitle(o,s,c);if(null!==u){var l=u.originalStart;t(i,s-l)}}}}),i)}},{key:"_adjacentSubtitle",value:function(e,t,n){for(var r=t,a=-1,i=Number.MAX_SAFE_INTEGER,c=0;c<n.length;++c){var o=n[c],s=e?o.start-r:r-o.start;i<=s||(e&&r<o.start?(i=s,a=c):!e&&r>o.start&&(i=s,a=r<o.end?Math.max(0,c-1):c))}return-1!==a?n[a]:null}},{key:"bindAdjustOffset",value:function(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return e._bind((function(e){if(!n()){var a=r();if(a&&0!==a.length){var i;if(cn.detectDecreaseOffset(e))i=!1;else{if(!cn.detectIncreaseOffset(e))return;i=!0}var c=a[0].start-a[0].originalStart;t(e,c+(i?100:-100))}}}),a)}},{key:"bindToggleSubtitles",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e._bind((function(e){n()||cn.detectToggleSubtitles(e)&&t(e)}),r)}},{key:"_bind",value:function(e,t){return window.addEventListener("keydown",e,t),function(){return window.removeEventListener("keydown",e,t)}}}]),e}(),sn=n(170),un=n.n(sn),ln=n(97),dn=["index","compressed","selected","subtitle","subtitleRef","onClick","onCopy"],bn=Object(p.a)((function(e){return{container:{height:"calc(100vh - 64px)",position:"relative",overflowX:"hidden",backgroundColor:e.palette.background.default,width:function(e){var t=e.compressed,n=e.windowWidth;return t?Math.max(350,.25*n):"100%"}},table:{backgroundColor:e.palette.background.default,marginBottom:75},noSubtitles:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center"}}})),fn=Object(p.a)((function(e){return{subtitleRow:{"&:hover":{backgroundColor:e.palette.action.hover}},subtitle:{fontSize:20,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere"},compressedSubtitle:{fontSize:16,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere"},timestamp:{fontSize:14,color:"#aaaaaa",textAlign:"right",paddingRight:15,paddingLeft:5},copyButton:{textAlign:"right",padding:0}}})),hn=a.a.memo((function(e){var t=e.index,n=e.compressed,r=e.selected,a=e.subtitle,i=e.subtitleRef,c=e.onClick,o=e.onCopy,s=Object(an.a)(e,dn),u=fn(),d=n?u.compressedSubtitle:u.subtitle;return a.start<0||a.end<0?null:Object(w.jsxs)(ge.a,Object(l.a)(Object(l.a)({onClick:function(e){return c(t)},ref:i,className:u.subtitleRow,selected:r},s),{},{children:[Object(w.jsx)(ve.a,{className:d,children:Object(w.jsx)("span",{onClick:function(e){return e.stopPropagation()},children:a.text})}),Object(w.jsx)(ve.a,{className:u.copyButton,children:Object(w.jsx)(U.a,{onClick:function(e){return o(e,t)},children:Object(w.jsx)(un.a,{fontSize:n?"small":"default"})})}),Object(w.jsx)(ve.a,{className:u.timestamp,children:a.displayTime})]}))}));function jn(e){var t=e.clock,n=e.onSeek,a=e.onCopy,i=e.onOffsetChange,c=e.playing,o=e.subtitles,s=e.length,u=e.jumpToSubtitle,l=e.compressed,f=e.loading,j=e.drawerOpen,p=e.displayHelp,O=e.disableKeyEvents,v=e.lastJumpToTopTimestamp,m=e.hidden,k=Object(r.useRef)();k.current=c;var x=Object(r.useRef)();x.current=t;var y=Object(r.useRef)();y.current=o;var C=Object(r.useMemo)((function(){return o?Array(o.length).fill().map((function(e,t){return Object(r.createRef)()})):[]}),[o]),S=Object(r.useRef)();S.current=C;var T=Object(r.useRef)();T.current=O;var F=Object(r.useState)({}),E=Object(b.a)(F,2),M=E[0],I=E[1],R=Object(r.useRef)({}),P=Object(r.useRef)();P.current=s;var N=Object(r.useRef)();N.current=m;var A=Object(r.useRef)(0),_=Object(r.useRef)(),U=Object(r.useRef)();Object(r.useRef)().current=j;var D=g(!0),B=Object(b.a)(D,1)[0],L=bn({compressed:l,windowWidth:B});Object(r.useEffect)((function(){return _.current=requestAnimationFrame((function e(t){for(var n=y.current||[],r=S.current,a=P.current,i=x.current.progress(P.current),c=Number.MAX_SAFE_INTEGER,o=-1,s={},u=n.length-1;u>=0;--u){var l=n[u],d=l.start/a,b=l.end/a;if(i>=d)i<b&&(c=u<c?u:c,s[u]=!0),-1===o&&(o=u);else if(c!==Number.MAX_SAFE_INTEGER)break}if(c===Number.MAX_SAFE_INTEGER&&-1!==o&&(s[o]=!0),!function(e,t){for(var n in e)if(!(n in t))return!1;for(var r in t)if(!(r in e))return!1;return!0}(s,R.current)&&(R.current=s,I(s),c!==Number.MAX_SAFE_INTEGER)){var f=r[c],h=!N.current&&Date.now()-A.current>5e3;(null===f||void 0===f?void 0:f.current)&&h&&f.current.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}_.current=requestAnimationFrame(e)})),function(){return cancelAnimationFrame(_.current)}}),[]);var W=Object(r.useCallback)((function(){var e,t=R.current;if(t){var n=Object.keys(t);if(0!==n.length){var r=C[n[0]];null===r||void 0===r||null===(e=r.current)||void 0===e||e.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}}),[C]);function H(e,t,n){e.preventDefault(),e.stopPropagation(),navigator.clipboard.writeText(t.text),n(t)}Object(r.useEffect)((function(){if(!m)return document.addEventListener("visibilitychange",e),function(){return document.removeEventListener("visibilitychange",e)};function e(){"visible"===document.visibilityState&&W()}}),[m,M,C,W]),Object(r.useEffect)((function(){m||W()}),[m,W]),Object(r.useEffect)((function(){var e;if(!N.current){var t=S.current;if(t&&0!==t.length){var n=t[0];null===n||void 0===n||null===(e=n.current)||void 0===e||e.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}}),[v]),Object(r.useEffect)((function(){var e=on.bindAdjustOffset((function(e,t){e.preventDefault(),e.stopPropagation(),i(t)}),(function(){return O}),(function(){return o}));return function(){return e()}}),[i,O,o]),Object(r.useEffect)((function(){var e=on.bindOffsetToSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),i(t)}),(function(){return O}),(function(){return t.time(s)}),(function(){return o}));return function(){return e()}}),[i,O,t,o,s]),Object(r.useEffect)((function(){var e=on.bindSeekToSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),n(t.start,!1)}),(function(){return O}),(function(){return t.time(s)}),(function(){return o}));return function(){return e()}}),[n,o,O,t,s]),Object(r.useEffect)((function(){function e(e){A.current=Date.now()}var t=U.current;return null===t||void 0===t||t.addEventListener("wheel",e),function(){return null===t||void 0===t?void 0:t.removeEventListener("wheel",e)}}),[U,A]),Object(r.useEffect)((function(){if(!m&&u&&o){var e,t,n,r=-1,a=0,i=Object(h.a)(o);try{for(i.s();!(e=i.n()).done;){var c=e.value;if(c.originalStart===u.originalStart&&c.text===u.text){r=a;break}++a}}catch(s){i.e(s)}finally{i.f()}if(-1!==r)null===(t=C[r])||void 0===t||null===(n=t.current)||void 0===n||n.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}),[m,u,o,C]),Object(r.useEffect)((function(){var e=on.bindCopy((function(e,t){return H(e,t,a)}),(function(){return T.current}),(function(){var e=Object.keys(R.current);if(!e||0===e.length)return null;var t=Math.min.apply(Math,Object(d.a)(e));return o[t]}));return function(){return e()}}),[o,a]);var z,V=Object(r.useCallback)((function(e){var t=R.current||{};n(o[e].start,!k.current&&e in t)}),[o,n]),G=Object(r.useCallback)((function(e,t){return H(e,o[t],a)}),[o,a]);return z=o&&0!==o.length?Object(w.jsx)(Oe.a,{className:L.table,children:Object(w.jsx)(je.a,{children:Object(w.jsx)(pe.a,{children:o.map((function(e,t){var n=t in M;return Object(w.jsx)(hn,{index:t,compressed:l,selected:n,subtitle:o[t],subtitleRef:C[t],onClick:V,onCopy:G},t)}))})})}):!f&&p&&Object(w.jsx)("div",{className:L.noSubtitles,children:Object(w.jsx)(K.a,{children:p})}),Object(w.jsx)(ln.a,{square:!0,elevation:0,ref:U,className:L.container,children:z})}var pn=function(){function e(t){Object(T.a)(this,e),this.protocol=t,this.time=0,this.duration=0,this.isReady=!1,this.readyState=0,this.selectedAudioTrack=null,this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[],this.condensedModeToggleCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[];var n=this;this.protocol.onMessage=function(e){switch(e.data.command){case"ready":n.duration=e.data.duration,n.isReady=!0,n.audioTracks=e.data.audioTracks,n.selectedAudioTrack=e.data.selectedAudioTrack,n.readyState=4,n.time=e.data.currentTime;var t,r=Object(h.a)(n.readyCallbacks);try{for(r.s();!(t=r.n()).done;){(0,t.value)(e.data.paused)}}catch(T){r.e(T)}finally{r.f()}break;case"readyState":var a;if(n.readyState=e.data.value,4===n.readyState)null===(a=n.oncanplay)||void 0===a||a.call(n);break;case"play":var i,c=Object(h.a)(n.playCallbacks);try{for(c.s();!(i=c.n()).done;){(0,i.value)(e.data.echo)}}catch(T){c.e(T)}finally{c.f()}break;case"pause":var o,s=Object(h.a)(n.pauseCallbacks);try{for(s.s();!(o=s.n()).done;){(0,o.value)(e.data.echo)}}catch(T){s.e(T)}finally{s.f()}break;case"audioTrackSelected":var u,l=Object(h.a)(n.audioTrackSelectedCallbacks);try{for(l.s();!(u=l.n()).done;){var d=u.value;n.selectedAudioTrack=e.data.id,d(e.data.id)}}catch(T){l.e(T)}finally{l.f()}break;case"currentTime":var b,f=Object(h.a)(n.currentTimeCallbacks);try{for(f.s();!(b=f.n()).done;){(0,b.value)(e.data.value,e.data.echo)}}catch(T){f.e(T)}finally{f.f()}break;case"exit":var j,p=Object(h.a)(n.exitCallbacks);try{for(p.s();!(j=p.n()).done;){(0,j.value)()}}catch(T){p.e(T)}finally{p.f()}break;case"offset":var O,v=Object(h.a)(n.offsetCallbacks);try{for(v.s();!(O=v.n()).done;){(0,O.value)(e.data.value)}}catch(T){v.e(T)}finally{v.f()}break;case"popOutToggle":var g,m=Object(h.a)(n.popOutToggleCallbacks);try{for(m.s();!(g=m.n()).done;){(0,g.value)()}}catch(T){m.e(T)}finally{m.f()}break;case"copy":var k,x=Object(h.a)(n.copyCallbacks);try{for(x.s();!(k=x.n()).done;){(0,k.value)(e.data.subtitle,e.data.audio,e.data.image)}}catch(T){x.e(T)}finally{x.f()}break;case"condensedModeToggle":var y,w=Object(h.a)(n.condensedModeToggleCallbacks);try{for(w.s();!(y=w.n()).done;){(0,y.value)()}}catch(T){w.e(T)}finally{w.f()}break;case"hideSubtitlePlayerToggle":var C,S=Object(h.a)(n.hideSubtitlePlayerToggleCallbacks);try{for(S.s();!(C=S.n()).done;){(0,C.value)()}}catch(T){S.e(T)}finally{S.f()}break;case"sync":break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(F.a)(e,[{key:"currentTime",get:function(){return this.time},set:function(e){this.time=e,this.readyState=3,this.protocol.postMessage({command:"currentTime",value:this.time})}},{key:"onReady",value:function(e){this.isReady&&e(),this.readyCallbacks.push(e)}},{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onExit",value:function(e){this.exitCallbacks.push(e)}},{key:"onOffset",value:function(e){this.offsetCallbacks.push(e)}},{key:"onPopOutToggle",value:function(e){this.popOutToggleCallbacks.push(e)}},{key:"onCopy",value:function(e){this.copyCallbacks.push(e)}},{key:"onCondensedModeToggle",value:function(e){this.condensedModeToggleCallbacks.push(e)}},{key:"onHideSubtitlePlayerToggle",value:function(e){this.hideSubtitlePlayerToggleCallbacks.push(e)}},{key:"ready",value:function(e){this.protocol.postMessage({command:"ready",duration:e})}},{key:"init",value:function(){this.protocol.postMessage({command:"init"})}},{key:"play",value:function(){this.protocol.postMessage({command:"play"})}},{key:"pause",value:function(){this.protocol.postMessage({command:"pause"})}},{key:"audioTrackSelected",value:function(e){this.protocol.postMessage({command:"audioTrackSelected",id:e})}},{key:"subtitles",value:function(e,t){this.protocol.postMessage({command:"subtitles",value:e,name:t})}},{key:"subtitleSettings",value:function(e){this.protocol.postMessage({command:"subtitleSettings",value:e})}},{key:"condensedModeToggle",value:function(e){this.protocol.postMessage({command:"condensedModeToggle",value:e})}},{key:"hideSubtitlePlayerToggle",value:function(e){this.protocol.postMessage({command:"hideSubtitlePlayerToggle",value:e})}},{key:"close",value:function(){this.protocol.postMessage({command:"close"}),this.protocol.close()}}]),e}(),On=Object(p.a)({root:{height:"calc(100vh - 64px)",position:"relative",overflowX:"hidden"},container:{width:"100%",height:"100%"},videoFrame:{width:"100%",height:"100%",border:0}});function vn(e,t){if(e<0)return vn(0,t);var n=(e=Math.round(e))%1e3,r=(e=(e-n)/1e3)%60,a=(e=(e-r)/60)%60;return t>=36e5?gn((e-a)/60)+":"+gn(a)+":"+gn(r)+"."+mn(n):gn(a)+":"+gn(r)+"."+mn(n)}function gn(e){return String(e).padStart(2,"0")}function mn(e){return String(e).padEnd(3,"0")}function kn(e,t,n,r){var a;a=n&&n.length>0?r?n[n.length-1].end:n[n.length-1].originalEnd:0;var i=e.current&&e.current.duration?1e3*e.current.duration:0,c=t.current&&t.current.duration?1e3*t.current.duration:0;return Math.max(c,Math.max(a,i))}function xn(e){var t,n,a=e.subtitleReader,i=e.settingsProvider,c=e.extension,o=e.offsetRef,l=e.videoFrameRef,d=e.drawerOpen,f=e.tab,h=e.availableTabs,j=e.onError,p=e.onUnloadVideo,O=e.onCopy,v=e.onLoaded,g=e.onTabSelected,m=e.disableKeyEvents,k=e.sources,x=k.subtitleFile,y=k.audioFile,C=k.audioFileUrl,S=k.videoFile,T=k.videoFileUrl,F=Object(r.useState)(),E=Object(b.a)(F,2),M=E[0],I=E[1],R=Object(r.useRef)();R.current=M;var P=Object(r.useState)(!1),N=Object(b.a)(P,2),A=N[0],_=N[1],U=Object(r.useState)(!1),D=Object(b.a)(U,2),B=D[0],L=D[1],W=Object(r.useState)(0),H=Object(b.a)(W,2),z=H[0],V=H[1],K=Object(r.useRef)();K.current=B;var G=Object(r.useState)(),X=Object(b.a)(G,2)[1],q=Object(r.useState)(),J=Object(b.a)(q,2),Q=J[0],Y=J[1],Z=Object(r.useState)(),$=Object(b.a)(Z,2),ee=$[0],te=$[1],ne=Object(r.useState)(0),re=Object(b.a)(ne,2),ae=re[0],ie=re[1],ce=Object(r.useState)(),oe=Object(b.a)(ce,2),se=oe[0],ue=oe[1],le=Object(r.useState)(!1),de=Object(b.a)(le,2),be=de[0],fe=de[1],he=Object(r.useState)(!1),je=Object(b.a)(he,2),pe=je[0],Oe=je[1],ve=Object(r.useRef)();ve.current=pe;var ge=Object(r.useState)(!1),me=Object(b.a)(ge,2),ke=me[0],xe=me[1],ye=Object(r.useRef)();ye.current=ke;var we=Object(r.useCallback)((function(){return X({})}),[]),Ce=Object(r.useRef)({x:0,y:0}),Se=Object(r.useRef)(),Te=Object(r.useRef)(),Fe=Object(r.useMemo)((function(){return new rn(C?Se:T||f?Te:{})}),[C,T,f]),Ee=Object(r.useMemo)((function(){return new Ot}),[]),Me=On(),Ie=Object(r.useRef)(0);Ie.current=kn(Se,Te,M,!0);var Re=Object(r.useCallback)(function(){var e=Object(u.a)(s.a.mark((function e(t,n,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.setTime(t),we(),!r){e.next=5;break}return e.next=5,Fe.seek(t/1e3);case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),[we,Fe]),Pe=Object(r.useCallback)((function(e,t){ie(e),o&&(o.current=e),I((function(n){if(n){var r,a=n.length>0?n[n.length-1].end+e:0,i=n.map((function(t){return{text:t.text,start:t.originalStart+e,originalStart:t.originalStart,end:t.originalEnd+e,originalEnd:t.originalEnd,displayTime:vn(t.originalStart+e,a)}}));if(t)null===(r=Te.current)||void 0===r||r.subtitles(i,null===x||void 0===x?void 0:x.name);return i}}))}),[x,o]);function Ne(e,t,n){L(!0),e.start(),n&&t.play()}function Ae(e,t,n){L(!1),e.stop(),n&&t.pause()}Object(r.useEffect)((function(){var e=null,t=!1;function n(){return(n=Object(u.a)(s.a.mark((function n(){var r,o,l,d,b,h;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null===(r=Te.current)||void 0===r||r.close(),Te.current=null,Ee.setTime(0),Ee.stop(),L(!1),Y(null),te(null),ie(0),xe(!1),Se.current.currentTime=0,Se.current.pause(),!x){n.next=31;break}return _(!0),n.prev=13,n.next=16,a.subtitles(x);case 16:l=n.sent,d=l.length>0?l[l.length-1].end:0,o=l.map((function(e){return{text:e.text,start:e.start,originalStart:e.start,end:e.end,originalEnd:e.end,displayTime:vn(e.start,d)}})),I(o),V(Date.now()),n.next=26;break;case 23:n.prev=23,n.t0=n.catch(13),j(n.t0.message);case 26:return n.prev=26,_(!1),n.finish(26);case 29:n.next=32;break;case 31:o=null;case 32:if(!C){n.next=38;break}return n.next=35,Fe.onReady();case 35:we(),n.next=48;break;case 38:if(!T&&!f){n.next=48;break}if(!t){n.next=41;break}return n.abrupt("return");case 41:T?(b=Object(ze.a)(),e=new pn(new jt(b)),ue(b)):f&&(e=new pn(new pt(f.id,f.src,c))).init(),Te.current=e,h=!1,e.onExit((function(){return p(T)})),e.onPopOutToggle((function(){return fe((function(e){return!e}))})),e.onHideSubtitlePlayerToggle((function(){Oe((function(t){return e.hideSubtitlePlayerToggle(!t),!t}))})),e.onReady((function(t){Ie.current=kn(Se,Te,R.current),e.ready(Ie.current),R.current&&(e.subtitleSettings(i.subtitleSettings),e.subtitles(R.current,null===x||void 0===x?void 0:x.name)),e.condensedModeToggle(ye.current),e.hideSubtitlePlayerToggle(ve.current),e.audioTracks&&e.audioTracks.length>1?(Y(Te.current.audioTracks),te(Te.current.selectedAudioTrack)):(Y(null),te(null)),Ee.setTime(1e3*Te.current.currentTime),t?Ee.stop():Ee.start(),L(!t),h||(e.onPlay((function(e){return Ne(Ee,Fe,e)})),e.onPause((function(e){return Ae(Ee,Fe,e)})),e.onOffset((function(e){var t;return Pe(Math.max(null!==(t=-Ie.current)&&void 0!==t?t:0,e),!1)})),e.onCopy((function(t,n,r){return O(t,y,S,x,e.selectedAudioTrack,n,r)})),e.onCondensedModeToggle((function(){return xe((function(t){var n=!t;return e.condensedModeToggle(n),n}))})),e.onCurrentTime(function(){var e=Object(u.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return K.current&&Ee.stop(),e.next=3,Re(1e3*t,Ee,n);case 3:K.current&&Ee.start();case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.onAudioTrackSelected(function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return K.current&&Ee.stop(),e.next=3,Fe.onReady();case 3:K.current&&Ee.start(),te(t);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),h=!0)}));case 48:case"end":return n.stop()}}),n,null,[[13,23,26,29]])})))).apply(this,arguments)}return function(){return n.apply(this,arguments)}().then((function(){return v()})),function(){var n;null===(n=e)||void 0===n||n.close(),t=!0}}),[a,c,i,Ee,Fe,Re,v,j,p,O,x,y,C,S,T,f,we,l,Pe]),Object(r.useEffect)((function(){if(ke&&M&&0!==M.length){var e=!1,t=1e3,n=setInterval(Object(u.a)(s.a.mark((function n(){var r,a,i,c,o,u,l,d,b,f;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=Ie.current){n.next=3;break}return n.abrupt("return");case 3:a=Ee.progress(r),i=0,c=-1,o=M.length-1;case 7:if(!(o>=0)){n.next=17;break}if(u=M[o],l=u.start/r,d=u.end/r,!(a>=l)){n.next=14;break}return a<d?(c=o,i=o):i=Math.min(M.length-1,o+1),n.abrupt("break",17);case 14:--o,n.next=7;break;case 17:if(c===i){n.next=30;break}if(!((b=M[i]).start-a*r<t+500)){n.next=21;break}return n.abrupt("return");case 21:if(K.current&&Ee.stop(),e){n.next=29;break}return e=!0,f=Date.now(),n.next=27,Re(b.start,Ee,!0);case 27:t=Date.now()-f,e=!1;case 29:K.current&&Ee.start();case 30:case"end":return n.stop()}}),n)}))),100);return function(){return clearInterval(n)}}}),[M,ke,Ee,Re]),Object(r.useEffect)((function(){be&&se&&T&&window.open("/asbplayer/?video="+encodeURIComponent(T)+"&channel="+se+"&popout=true","asbplayer-video-"+T,"resizable,width=800,height=450"),V(Date.now())}),[be,se,T,l]);var _e=Object(r.useCallback)((function(){return Ne(Ee,Fe,!0)}),[Ee,Fe]),Ue=Object(r.useCallback)((function(){return Ae(Ee,Fe,!0)}),[Ee,Fe]),De=Object(r.useCallback)(function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ie.current){e.next=2;break}return e.abrupt("return");case 2:return K.current&&Ee.stop(),e.next=5,Re(t*Ie.current,Ee,!0);case 5:K.current&&Ee.start();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Ee,Re]),Be=Object(r.useCallback)(function(){var e=Object(u.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n||Ae(Ee,Fe,!0),K.current&&Ee.stop(),e.next=4,Re(t,Ee,!0);case 4:n&&!K.current&&Ne(Ee,Fe,!0);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[Ee,Re,Fe]),Le=Object(r.useCallback)((function(e,t){O(e,y,S,x,ee)}),[O,y,S,x,ee]),We=Object(r.useCallback)((function(e){Ce.current.x=e.screenX,Ce.current.y=e.screenY}),[]),He=Object(r.useCallback)(function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Te.current&&Te.current.audioTrackSelected(t),Ae(Ee,Fe,!0),e.next=4,Re(0,Ee,!0);case 4:K.current&&Ne(Ee,Fe,!0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Ee,Fe,Re]),Ve=Object(r.useCallback)((function(e){var t;Pe(Math.max(null!==(t=-Ie.current)&&void 0!==t?t:0,e),!0)}),[Pe]),Ke=Object(r.useCallback)((function(e){Se.current&&(Se.current.volume=e)}),[]),Ge=Object(r.useCallback)((function(){return xe((function(e){return!e}))}),[]);Object(r.useEffect)((function(){var e=setInterval((function(){var e=Ie.current;Ee.progress(e)>=1&&(Ee.setTime(0),Ee.stop(),Fe.pause(),L(!1),V(Date.now()))}),1e3);return function(){return clearInterval(e)}}),[Ee,M,Fe]);var Xe=Ie.current,qe=C||T||M,Je=qe&&T&&se&&!be;return Object(w.jsxs)("div",{onMouseMove:We,className:Me.root,children:[Object(w.jsxs)(Tt.a,{container:!0,direction:"row",wrap:"nowrap",className:Me.container,children:[Je&&Object(w.jsx)(Tt.a,{item:!0,style:{flexGrow:1,minWidth:600},children:Object(w.jsx)("iframe",{ref:l,className:Me.videoFrame,src:"/asbplayer/?video="+encodeURIComponent(T)+"&channel="+se+"&popout=false",title:"asbplayer"})}),(!Je||(null===(t=M)||void 0===t?void 0:t.length)>0)&&Object(w.jsxs)(Tt.a,{item:!0,style:{flexGrow:Je?0:1,width:Je&&pe?0:"auto"},children:[qe&&!(T&&!be)&&Object(w.jsx)(nn,{mousePositionRef:Ce,playing:B,clock:Ee,length:Xe,displayLength:kn(Se,Te,M,!1),audioTracks:Q,selectedAudioTrack:ee,tabs:!T&&!C&&h,selectedTab:f,audioFile:null===y||void 0===y?void 0:y.name,videoFile:null===S||void 0===S?void 0:S.name,offsetEnabled:!0,offset:ae,volumeEnabled:Boolean(C),condensedModeToggleEnabled:Boolean(C)&&(null===(n=M)||void 0===n?void 0:n.length)>0,condensedModeEnabled:ke,onPlay:_e,onPause:Ue,onSeek:De,onAudioTrackSelected:He,onTabSelected:g,onUnloadAudio:function(){return e.onUnloadAudio(C)},onUnloadVideo:function(){return e.onUnloadVideo(T)},onOffsetChange:Ve,onVolumeChange:Ke,onCondensedModeToggle:Ge,disableKeyEvents:m,settingsProvider:i}),Object(w.jsx)(jn,{playing:B,subtitles:M,clock:Ee,length:Xe,jumpToSubtitle:e.jumpToSubtitle,drawerOpen:d,compressed:T&&!be,loading:A,displayHelp:(null===y||void 0===y?void 0:y.name)||be&&(null===S||void 0===S?void 0:S.name),disableKeyEvents:m,lastJumpToTopTimestamp:z,hidden:Je&&pe,onSeek:Be,onCopy:Le,onOffsetChange:Ve})]})]}),Object(w.jsx)("audio",{ref:Se,src:C})]})}var yn=n(342),wn=n(332);function Cn(e){var t=e.open,n=e.onProceed,a=e.onCancel,i=e.existingCustomFieldNames,c=Object(r.useState)(""),o=Object(b.a)(c,2),s=o[0],u=o[1];Object(r.useEffect)((function(){u("")}),[t]);var l=[].concat(Object(d.a)(i),["Sentence","Word","Definition","Source","Image","Audio"]).includes(s);return Object(w.jsxs)(N.a,{open:t,disableEnforceFocus:!0,fullWidth:!0,maxWidth:"xs",onBackdropClick:function(){return a()},children:[Object(w.jsx)(wn.a,{children:"New Custom Field"}),Object(w.jsx)(_.a,{children:Object(w.jsx)("form",{children:Object(w.jsx)(P.a,{error:l,helperText:l&&"Field ".concat(s," already exists"),variant:"filled",fullWidth:!0,label:"Field Name",value:s,color:"secondary",onChange:function(e){return u(e.target.value)}})})}),Object(w.jsxs)(A.a,{children:[Object(w.jsx)(R.a,{onClick:function(){return a()},children:"Cancel"}),Object(w.jsx)(R.a,{disabled:l||""===s.trim(),onClick:function(){return n(s.trim())},children:"Create"})]})]})}var Sn=n(262),Tn=n(335),Fn=n(334),En=n(265),Mn=n(264),In=n(263),Rn=n(333),Pn=n(340),Nn=n(171),An=n.n(Nn),_n=n(268),Un=Object(I.a)((function(e){return{root:{"& .MuiTextField-root":{marginTop:e.spacing(1),marginBottom:e.spacing(1)}},subtitleSetting:{"& .MuiTextField-root":{marginTop:e.spacing(1),marginBottom:e.spacing(1)}},addFieldButton:{width:"100%"}}})),Dn=Object(I.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120},root:{display:"flex",flexDirection:"row",justifyContent:"end",alignItems:"flex-end"}}}));function Bn(e){var t=e.label,n=e.value,r=e.selections,a=e.removable,i=e.onChange,c=e.onSelectionChange,o=e.onRemoval,s=Dn();return Object(w.jsxs)("div",{className:s.root,children:[Object(w.jsx)(P.a,{label:t,value:n,onChange:i,fullWidth:!0,color:"secondary",InputProps:{endAdornment:a&&Object(w.jsx)(D.a,{position:"end",children:Object(w.jsx)(U.a,{onClick:function(e){return null===o||void 0===o?void 0:o()},children:Object(w.jsx)(Qe.a,{})})})}}),Object(w.jsxs)(Sn.a,{className:s.formControl,children:[Object(w.jsx)(In.a,{}),Object(w.jsx)(_n.a,{value:n,disabled:!r,color:"secondary",onChange:c,children:r&&r.map((function(e){return Object(w.jsx)(Rn.a,{value:e,children:e},e)}))})]})]})}function Ln(e){var t=e.anki,n=e.open,i=e.settings,c=e.onClose,o=Un(),l=Object(r.useState)(i.ankiConnectUrl),f=Object(b.a)(l,2),h=f[0],j=f[1],p=Object(r.useState)(),O=Object(b.a)(p,2),v=O[0],g=O[1],m=Object(r.useState)(0),k=Object(b.a)(m,2),x=k[0],y=k[1],C=Object(r.useState)(i.deck||""),S=Object(b.a)(C,2),T=S[0],F=S[1],E=Object(r.useState)(),M=Object(b.a)(E,2),I=M[0],B=M[1],L=Object(r.useState)(i.noteType||""),W=Object(b.a)(L,2),H=W[0],z=W[1],V=Object(r.useState)(),K=Object(b.a)(V,2),G=K[0],X=K[1],q=Object(r.useState)(i.sentenceField||""),J=Object(b.a)(q,2),Q=J[0],Y=J[1],Z=Object(r.useState)(i.definitionField||""),$=Object(b.a)(Z,2),ee=$[0],te=$[1],ne=Object(r.useState)(i.audioField||""),re=Object(b.a)(ne,2),ae=re[0],ie=re[1],ce=Object(r.useState)(i.imageField||""),oe=Object(b.a)(ce,2),se=oe[0],ue=oe[1],de=Object(r.useState)(i.wordField||""),be=Object(b.a)(de,2),fe=be[0],he=be[1],je=Object(r.useState)(i.sourceField||""),pe=Object(b.a)(je,2),Oe=pe[0],ve=pe[1],ge=Object(r.useState)(i.customAnkiFields),me=Object(b.a)(ge,2),ke=me[0],xe=me[1],ye=Object(r.useState)(i.preferMp3),we=Object(b.a)(ye,2),Ce=we[0],Se=we[1],Te=Object(r.useState)(),Fe=Object(b.a)(Te,2),Ee=Fe[0],Me=Fe[1],Ie=Object(r.useState)(!1),Re=Object(b.a)(Ie,2),Pe=Re[0],Ne=Re[1],Ae=Object(r.useState)(i.subtitleColor),_e=Object(b.a)(Ae,2),Ue=_e[0],De=_e[1],Be=Object(r.useState)(i.subtitleSize),Le=Object(b.a)(Be,2),We=Le[0],He=Le[1],ze=Object(r.useState)(i.subtitleOutlineColor),Ve=Object(b.a)(ze,2),Ke=Ve[0],Ge=Ve[1],Xe=Object(r.useState)(i.subtitleOutlineThickness),qe=Object(b.a)(Xe,2),Je=qe[0],Qe=qe[1],Ye=Object(r.useState)(i.subtitleBackgroundColor),Ze=Object(b.a)(Ye,2),$e=Ze[0],et=Ze[1],tt=Object(r.useState)(i.subtitleBackgroundOpacity),nt=Object(b.a)(tt,2),rt=nt[0],at=nt[1],it=Object(r.useState)(i.themeType),ct=Object(b.a)(it,2),ot=ct[0],st=ct[1],ut=Object(r.useCallback)((function(e){j(e.target.value),y(Date.now())}),[]),lt=Object(r.useCallback)((function(e){return y(Date.now())}),[]),dt=Object(r.useCallback)((function(e){return F(e.target.value)}),[]),bt=Object(r.useCallback)((function(e){return z(e.target.value)}),[]),ft=Object(r.useCallback)((function(e){return Y(e.target.value)}),[]),ht=Object(r.useCallback)((function(e){return te(e.target.value)}),[]),jt=Object(r.useCallback)((function(e){return ie(e.target.value)}),[]),pt=Object(r.useCallback)((function(e){return ue(e.target.value)}),[]),Ot=Object(r.useCallback)((function(e){return he(e.target.value)}),[]),vt=Object(r.useCallback)((function(e){return ve(e.target.value)}),[]),gt=Object(r.useCallback)((function(e){return De(e.target.value)}),[]),mt=Object(r.useCallback)((function(e){return He(e.target.value)}),[]),kt=Object(r.useCallback)((function(e){return Ge(e.target.value)}),[]),xt=Object(r.useCallback)((function(e){return Qe(e.target.value)}),[]),yt=Object(r.useCallback)((function(e){return et(e.target.value)}),[]),wt=Object(r.useCallback)((function(e){return at(e.target.value)}),[]),Ct=Object(r.useCallback)((function(e){xe((function(t){var n={};return Object.assign(n,t),n[e]="",n})),Ne(!1)}),[]),St=Object(r.useCallback)((function(e,t){xe((function(n){var r={};return Object.assign(r,n),r[e]=t,r}))}),[]),Ft=Object(r.useCallback)((function(e){return xe((function(t){var n={};return Object.assign(n,t),delete n[e],n}))}),[]),Et=Object(r.useCallback)((function(e){return Se(e.target.checked)}),[]),Mt=Object(r.useCallback)((function(e){return st(e.target.value)}),[]);Object(r.useEffect)((function(){var e=!1,n=setTimeout(Object(u.a)(s.a.mark((function n(){return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e){n.next=3;break}return n.abrupt("return");case 3:return n.t0=B,n.next=6,t.deckNames(h);case 6:return n.t1=n.sent,(0,n.t0)(n.t1),n.t2=X,n.next=11,t.modelNames(h);case 11:n.t3=n.sent,(0,n.t2)(n.t3),g(null),n.next=24;break;case 16:if(n.prev=16,n.t4=n.catch(0),!e){n.next=20;break}return n.abrupt("return");case 20:console.error(n.t4),B(null),X(null),g(n.t4.message);case 24:case"end":return n.stop()}}),n,null,[[0,16]])}))),1e3);return function(){e=!0,clearTimeout(n)}}),[t,h,x]),Object(r.useEffect)((function(){if(H&&!v){var e=!1;return function(){n.apply(this,arguments)}(),function(){return e=!0}}function n(){return(n=Object(u.a)(s.a.mark((function n(){return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e){n.next=3;break}return n.abrupt("return");case 3:return n.t0=Me,n.t1=[""],n.t2=d.a,n.next=8,t.modelFieldNames(H,h);case 8:n.t3=n.sent,n.t4=(0,n.t2)(n.t3),n.t5=n.t1.concat.call(n.t1,n.t4),(0,n.t0)(n.t5),g(null),n.next=22;break;case 15:if(n.prev=15,n.t6=n.catch(0),!e){n.next=19;break}return n.abrupt("return");case 19:console.error(n.t6),Me(null),g(n.t6.message);case 22:case"end":return n.stop()}}),n,null,[[0,15]])})))).apply(this,arguments)}}),[t,H,h,v,x]);var It=Object(r.useCallback)((function(){c({ankiConnectUrl:h,deck:T,noteType:H,sentenceField:Q,definitionField:ee,audioField:ae,imageField:se,wordField:fe,sourceField:Oe,subtitleSize:Number(We),subtitleColor:Ue,subtitleOutlineThickness:Number(Je),subtitleOutlineColor:Ke,subtitleBackgroundColor:$e,subtitleBackgroundOpacity:Number(rt),customAnkiFields:ke,preferMp3:Ce,themeType:ot})}),[c,h,T,H,Q,ee,ae,se,fe,Oe,ke,Ce,We,Ue,Je,Ke,$e,rt,ot]),Rt=Object.keys(ke).map((function(e){return Object(w.jsx)(Bn,{label:"".concat(e," Field"),value:ke[e],selections:Ee,onChange:function(t){return St(e,t.target.value)},onSelectionChange:function(t){return St(e,t.target.value)},onRemoval:function(){return Ft(e)},removable:!0},e)}));return Object(w.jsxs)(a.a.Fragment,{children:[Object(w.jsx)(Cn,{open:Pe,existingCustomFieldNames:Object.keys(ke),onProceed:Ct,onCancel:function(){return Ne(!1)}}),Object(w.jsxs)(N.a,{open:n,maxWidth:"xs",fullWidth:!0,onBackdropClick:It,children:[Object(w.jsx)(wn.a,{children:"Settings"}),Object(w.jsx)(_.a,{children:Object(w.jsxs)(Tt.a,{container:!0,direction:"column",spacing:3,children:[Object(w.jsxs)(Tt.a,{item:!0,children:[Object(w.jsx)(Mn.a,{children:"Anki"}),Object(w.jsxs)(Fn.a,{className:o.root,children:[Object(w.jsx)(P.a,{label:"Anki Connect URL",value:h,error:Boolean(v),helperText:v,color:"secondary",onChange:ut,InputProps:{endAdornment:Object(w.jsx)(D.a,{position:"end",children:Object(w.jsx)(U.a,{onClick:lt,children:Object(w.jsx)(An.a,{})})})}}),Object(w.jsxs)(En.a,{children:["Ensure that ",window.location.protocol+"//"+window.location.hostname," is in the webCorsOriginList in your AnkiConnect settings as in this ",Object(w.jsx)(le.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://youtu.be/Mv7fEVb6PHo?t=44",children:"video"}),"."]}),Object(w.jsx)(Bn,{label:"Deck",value:T,selections:I,onChange:dt,onSelectionChange:dt}),Object(w.jsx)(Bn,{label:"Note Type",value:H,selections:G,onChange:bt,onSelectionChange:bt}),Object(w.jsx)(Bn,{label:"Sentence Field",value:Q,selections:Ee,onChange:ft,onSelectionChange:ft}),Object(w.jsx)(Bn,{label:"Definition Field",value:ee,selections:Ee,onChange:ht,onSelectionChange:ht}),Object(w.jsx)(Bn,{label:"Word Field",value:fe,selections:Ee,onChange:Ot,onSelectionChange:Ot}),Object(w.jsx)(Bn,{label:"Audio Field",value:ae,selections:Ee,onChange:jt,onSelectionChange:jt}),Object(w.jsx)(Bn,{label:"Image Field",value:se,selections:Ee,onChange:pt,onSelectionChange:pt}),Object(w.jsx)(Bn,{label:"Source Field",value:Oe,selections:Ee,onChange:vt,onSelectionChange:vt}),Rt,Object(w.jsx)(R.a,{className:o.addFieldButton,onClick:function(e){return Ne(!0)},children:"Add Custom Field"}),Object(w.jsx)(Tn.a,{control:Object(w.jsx)(yn.a,{checked:Ce,onChange:Et}),label:"Re-encode audio as mp3 (slower)"})]})]}),Object(w.jsxs)(Tt.a,{item:!0,children:[Object(w.jsx)(Mn.a,{children:"Video Subtitle Appearance"}),Object(w.jsxs)(Fn.a,{children:[Object(w.jsx)("div",{className:o.subtitleSetting,children:Object(w.jsx)(P.a,{type:"color",label:"Subtitle Color",fullWidth:!0,value:Ue,color:"secondary",onChange:gt})}),Object(w.jsx)("div",{className:o.subtitleSetting,children:Object(w.jsx)(P.a,{type:"number",label:"Subtitle Size",fullWidth:!0,value:We,color:"secondary",onChange:mt,inputProps:{min:1,step:1}})}),Object(w.jsx)("div",{className:o.subtitleSetting,children:Object(w.jsx)(P.a,{type:"color",label:"Subtitle Outline Color",fullWidth:!0,value:Ke,color:"secondary",onChange:kt})}),Object(w.jsx)("div",{className:o.subtitleSetting,children:Object(w.jsx)(P.a,{type:"number",label:"Subtitle Outline Thickness",fullWidth:!0,value:Je,onChange:xt,inputProps:{min:0,step:1},color:"secondary"})}),Object(w.jsx)("div",{className:o.subtitleSetting,children:Object(w.jsx)(P.a,{type:"color",label:"Subtitle Background Color",fullWidth:!0,value:$e,color:"secondary",onChange:yt})}),Object(w.jsx)("div",{className:o.subtitleSetting,children:Object(w.jsx)(P.a,{type:"number",label:"Subtitle Background Opacity",fullWidth:!0,inputProps:{min:0,max:1,step:.1},value:rt,color:"secondary",onChange:wt})})]})]}),Object(w.jsxs)(Tt.a,{item:!0,children:[Object(w.jsx)(Mn.a,{children:"Theme"}),Object(w.jsxs)("div",{children:[Object(w.jsx)(Tn.a,{control:Object(w.jsx)(Pn.a,{checked:"light"===ot,value:"light",onChange:Mt}),label:"Light"}),Object(w.jsx)(Tn.a,{control:Object(w.jsx)(Pn.a,{checked:"dark"===ot,value:"dark",onChange:Mt}),label:"Dark"})]})]})]})}),Object(w.jsx)(A.a,{children:Object(w.jsx)(R.a,{onClick:It,children:"OK"})})]})]})}var Wn="ankiConnectUrl",Hn="deck",zn="noteType",Vn="sentenceField",Kn="definitionField",Gn="audioField",Xn="imageField",qn="wordField",Jn="sourceField",Qn="customAnkiFields",Yn="subtitleSize",Zn="subtitleColor",$n="subtitleOutlineThickness",er="subtitleOutlineColor",tr="subtitleBackgroundColor",nr="subtitleBackgroundOpacity",rr="volume",ar="preferMp3",ir="themeType",cr=function(){function e(){Object(T.a)(this,e)}return Object(F.a)(e,[{key:"settings",get:function(){return{ankiConnectUrl:this.ankiConnectUrl,deck:this.deck,noteType:this.noteType,sentenceField:this.sentenceField,definitionField:this.definitionField,audioField:this.audioField,imageField:this.imageField,wordField:this.wordField,customAnkiFields:this.customAnkiFields,sourceField:this.sourceField,subtitleSize:this.subtitleSize,subtitleColor:this.subtitleColor,subtitleOutlineThickness:this.subtitleOutlineThickness,subtitleOutlineColor:this.subtitleOutlineColor,subtitleBackgroundColor:this.subtitleBackgroundColor,subtitleBackgroundOpacity:this.subtitleBackgroundOpacity,preferMp3:this.preferMp3,themeType:this.themeType}},set:function(e){this.ankiConnectUrl=e.ankiConnectUrl,this.deck=e.deck,this.noteType=e.noteType,this.modelNames=e.modelNames,this.sentenceField=e.sentenceField,this.definitionField=e.definitionField,this.audioField=e.audioField,this.imageField=e.imageField,this.wordField=e.wordField,this.sourceField=e.sourceField,this.subtitleSize=e.subtitleSize,this.subtitleColor=e.subtitleColor,this.subtitleOutlineThickness=e.subtitleOutlineThickness,this.subtitleOutlineColor=e.subtitleOutlineColor,this.subtitleBackgroundColor=e.subtitleBackgroundColor,this.subtitleBackgroundOpacity=e.subtitleBackgroundOpacity,this.customAnkiFields=e.customAnkiFields,this.preferMp3=e.preferMp3,this.themeType=e.themeType}},{key:"subtitleSettings",get:function(){return{subtitleSize:this.subtitleSize,subtitleColor:this.subtitleColor,subtitleOutlineThickness:this.subtitleOutlineThickness,subtitleOutlineColor:this.subtitleOutlineColor,subtitleBackgroundColor:this.subtitleBackgroundColor,subtitleBackgroundOpacity:this.subtitleBackgroundOpacity}}},{key:"ankiConnectUrl",get:function(){return localStorage.getItem(Wn)||"http://127.0.0.1:8765"},set:function(e){localStorage.setItem(Wn,e)}},{key:"deck",get:function(){return localStorage.getItem(Hn)},set:function(e){localStorage.setItem(Hn,e)}},{key:"noteType",get:function(){return localStorage.getItem(zn)},set:function(e){localStorage.setItem(zn,e)}},{key:"sentenceField",get:function(){return localStorage.getItem(Vn)},set:function(e){localStorage.setItem(Vn,e)}},{key:"definitionField",get:function(){return localStorage.getItem(Kn)},set:function(e){localStorage.setItem(Kn,e)}},{key:"audioField",get:function(){return localStorage.getItem(Gn)},set:function(e){localStorage.setItem(Gn,e)}},{key:"imageField",get:function(){return localStorage.getItem(Xn)},set:function(e){localStorage.setItem(Xn,e)}},{key:"wordField",get:function(){return localStorage.getItem(qn)},set:function(e){localStorage.setItem(qn,e)}},{key:"sourceField",get:function(){return localStorage.getItem(Jn)},set:function(e){localStorage.setItem(Jn,e)}},{key:"customAnkiFields",get:function(){var e=localStorage.getItem(Qn);return e?JSON.parse(e):{}},set:function(e){localStorage.setItem(Qn,JSON.stringify(e))}},{key:"subtitleColor",get:function(){return localStorage.getItem(Zn)||"#ffffff"},set:function(e){localStorage.setItem(Zn,e)}},{key:"subtitleSize",get:function(){return localStorage.getItem(Yn)||36},set:function(e){localStorage.setItem(Yn,e)}},{key:"subtitleOutlineColor",get:function(){return localStorage.getItem(er)||"#000000"},set:function(e){localStorage.setItem(er,e)}},{key:"subtitleOutlineThickness",get:function(){return localStorage.getItem($n)||0},set:function(e){localStorage.setItem($n,e)}},{key:"subtitleBackgroundColor",get:function(){return localStorage.getItem(tr)||"#000000"},set:function(e){localStorage.setItem(tr,e)}},{key:"subtitleBackgroundOpacity",get:function(){return localStorage.getItem(nr)||.5},set:function(e){localStorage.setItem(nr,e)}},{key:"volume",get:function(){return localStorage.getItem(rr)||100},set:function(e){localStorage.setItem(rr,e)}},{key:"preferMp3",get:function(){return"true"===localStorage.getItem(ar)||!1},set:function(e){localStorage.setItem(ar,e)}},{key:"themeType",get:function(){return localStorage.getItem(ir)||"dark"},set:function(e){localStorage.setItem(ir,e)}}]),e}(),or=n(172),sr=function(){function e(t){Object(T.a)(this,e),this.channel=new BroadcastChannel(t),this.time=0,this.duration=0,this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.closeCallbacks=[],this.readyCallbacks=[],this.subtitlesCallbacks=[],this.condensedModeToggleCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[];var n=this;this.channel.onmessage=function(e){switch(e.data.command){case"init":break;case"ready":var t,r=Object(h.a)(n.readyCallbacks);try{for(r.s();!(t=r.n()).done;){(0,t.value)(e.data.duration)}}catch(k){r.e(k)}finally{r.f()}break;case"play":var a,i=Object(h.a)(n.playCallbacks);try{for(i.s();!(a=i.n()).done;){(0,a.value)()}}catch(k){i.e(k)}finally{i.f()}break;case"pause":var c,o=Object(h.a)(n.pauseCallbacks);try{for(o.s();!(c=o.n()).done;){(0,c.value)()}}catch(k){o.e(k)}finally{o.f()}break;case"currentTime":var s,u=Object(h.a)(n.currentTimeCallbacks);try{for(u.s();!(s=u.n()).done;){(0,s.value)(e.data.value)}}catch(k){u.e(k)}finally{u.f()}break;case"audioTrackSelected":var l,d=Object(h.a)(n.audioTrackSelectedCallbacks);try{for(d.s();!(l=d.n()).done;){(0,l.value)(e.data.id)}}catch(k){d.e(k)}finally{d.f()}break;case"close":var b,f=Object(h.a)(n.closeCallbacks);try{for(f.s();!(b=f.n()).done;){(0,b.value)()}}catch(k){f.e(k)}finally{f.f()}break;case"subtitles":var j,p=Object(h.a)(n.subtitlesCallbacks);try{for(p.s();!(j=p.n()).done;){(0,j.value)(e.data.value)}}catch(k){p.e(k)}finally{p.f()}break;case"subtitleSettings":break;case"condensedModeToggle":var O,v=Object(h.a)(n.condensedModeToggleCallbacks);try{for(v.s();!(O=v.n()).done;){(0,O.value)(e.data.value)}}catch(k){v.e(k)}finally{v.f()}break;case"hideSubtitlePlayerToggle":var g,m=Object(h.a)(n.hideSubtitlePlayerToggleCallbacks);try{for(m.s();!(g=m.n()).done;){(0,g.value)(e.data.value)}}catch(k){m.e(k)}finally{m.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(F.a)(e,[{key:"currentTime",get:function(){return this.time},set:function(e){var t;this.time=e,null===(t=this.channel)||void 0===t||t.postMessage({command:"currentTime",value:this.time,echo:!0})}},{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onClose",value:function(e){this.closeCallbacks.push(e)}},{key:"onReady",value:function(e){this.readyCallbacks.push(e)}},{key:"onSubtitles",value:function(e){this.subtitlesCallbacks.push(e)}},{key:"onCondensedModeToggle",value:function(e){this.condensedModeToggleCallbacks.push(e)}},{key:"onHideSubtitlePlayerToggle",value:function(e){this.hideSubtitlePlayerToggleCallbacks.push(e)}},{key:"ready",value:function(e,t,n,r){var a;null===(a=this.channel)||void 0===a||a.postMessage({command:"ready",duration:e,paused:t,currentTime:0,audioTracks:n,selectedAudioTrack:r})}},{key:"readyState",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"readyState",value:e})}},{key:"play",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"play",echo:!0})}},{key:"pause",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"pause",echo:!0})}},{key:"audioTrackSelected",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"audioTrackSelected",id:e})}},{key:"offset",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"offset",value:e})}},{key:"popOutToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"popOutToggle"})}},{key:"copy",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"copy",subtitle:e})}},{key:"condensedModeToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"condensedModeToggle"})}},{key:"hideSubtitlePlayerToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"hideSubtitlePlayerToggle"})}},{key:"close",value:function(){this.channel&&(this.channel.postMessage({command:"exit"}),this.channel.close(),this.channel=null)}}]),e}(),ur=Object(p.a)({root:{position:"relative",backgroundColor:"black",height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},video:{margin:"auto"},cursorHidden:{cursor:"none"}});function lr(e,t,n,r,a,i){var c={position:"absolute",paddingLeft:20,paddingRight:20,bottom:100,textAlign:"center",color:t,fontSize:Number(e)};if(n>0){var o=n,s=r;c.textShadow="0 0 ".concat(o,"px ").concat(s,", 0 0 ").concat(o,"px ").concat(s,", 0 0 ").concat(o,"px ").concat(s,", 0 0 ").concat(o,"px ").concat(s)}if(i>0){var u=i,l=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}}(a),d=l.r,b=l.g,f=l.b;c.backgroundColor="rgba(".concat(d,", ").concat(b,", ").concat(f,", ").concat(u,")")}return c}function dr(e,t,n,r){if(window.outerWidth&&e.videoWidth>0&&e.videoHeight>0){var a=window.screen.availWidth-(window.outerWidth-window.innerWidth),i=window.screen.availHeight-(window.outerHeight-window.innerHeight),c=Math.min(1,Math.min(a/e.videoWidth,i/e.videoHeight));window.resizeTo(c*e.videoWidth+(window.outerWidth-window.innerWidth),c*e.videoHeight+(window.outerHeight-window.innerHeight))}var o,s;if(e.audioTracks){o=[];var u,l=Object(h.a)(e.audioTracks);try{for(l.s();!(u=l.n()).done;){var d=u.value;o.push({id:d.id,label:d.label,language:d.language}),d.enabled&&(s=d.id)}}catch(b){l.e(b)}finally{l.f()}}else o=null,s=null;n(o),r(s),t.ready(e.duration,e.paused,o,s)}function br(e){var t=ur(),n=e.settingsProvider,i=e.videoFile,c=e.channel,o=e.popOut,s=e.onError,u=Object(r.useRef)(),d=Object(r.useRef)(),f=g(!0),j=Object(b.a)(f,2),p=j[0],O=j[1];d.current&&(d.current.width=p,d.current.height=O);var v=Object(r.useMemo)((function(){return new sr(c)}),[c]),m=Object(r.useState)(!1),k=Object(b.a)(m,2),x=k[0],y=k[1],C=function(){var e=Object(r.useState)(Boolean(document.fullscreenElement)),t=Object(b.a)(e,2),n=t[0],a=t[1];return Object(r.useEffect)((function(){var e=function(){return a(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",e),function(){return document.removeEventListener("fullscreenchange",e)}}),[]),n}(),T=Object(r.useRef)();T.current=x;var F=Object(r.useState)(0),E=Object(b.a)(F,2),M=E[0],I=E[1],R=Object(r.useState)(0),P=Object(b.a)(R,2),N=P[0],A=P[1],_=Object(r.useState)(),U=Object(b.a)(_,2),D=U[0],B=U[1],L=Object(r.useState)(),W=Object(b.a)(L,2),H=W[0],z=W[1],V=Object(r.useState)([]),K=Object(b.a)(V,2),G=K[0],X=K[1],q=Object(r.useState)([]),J=Object(b.a)(q,2),Q=J[0],Y=J[1],Z=Object(r.useState)(!0),$=Object(b.a)(Z,2),ee=$[0],te=$[1],ne=Object(r.useState)(!1),re=Object(b.a)(ne,2),ae=re[0],ie=re[1],ce=Object(r.useState)(!1),oe=Object(b.a)(ce,2),se=oe[0],ue=oe[1],le=Object(r.useRef)([]);le.current=Q;var de=Object(r.useMemo)((function(){return new Ot}),[]),be=Object(r.useRef)({x:0,y:0}),fe=Object(r.useRef)(),he=Object(r.useState)(),je=Object(b.a)(he,2),pe=je[0],Oe=je[1],ve=Object(r.useState)(!1),ge=Object(b.a)(ve,2),me=ge[0],ke=ge[1],xe=Object(r.useState)(!0),ye=Object(b.a)(xe,2),we=ye[0],Ce=ye[1],Se=Object(r.useCallback)((function(e){e&&(d.current=e,4===e.readyState?dr(e,v,B,z):e.onloadeddata=function(t){dr(e,v,B,z)},e.oncanplay=function(e){v.readyState(4),T.current&&de.start()},e.onerror=function(t){return s(function(e){var t;switch(e.error.code){case 1:t="Aborted";break;case 2:t="Network error";break;case 3:t="Decoding error";break;case 4:t="Source not supported";break;default:t="Unknown error"}return t+": "+(e.error.message||"<details missing>")}(e))})}),[de,v,s]);function Te(e){var t,n=Object(h.a)(d.current.audioTracks);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.id===e?r.enabled=!0:r.enabled=!1}}catch(a){n.e(a)}finally{n.f()}}Object(r.useEffect)((function(){return v.onReady((function(e){return I(e)})),v.onPlay((function(){d.current.play(),de.start(),y(!0)})),v.onPause((function(){d.current.pause(),de.stop(),y(!1)})),v.onCurrentTime((function(e){var t;d.current&&(d.current.currentTime=e),4===(null===(t=d.current)||void 0===t?void 0:t.readyState)&&v.readyState(4),de.stop(),de.setTime(1e3*e)})),v.onAudioTrackSelected((function(e){Te(e),v.audioTrackSelected(e)})),v.onClose((function(){v.close(),window.close()})),v.onSubtitles((function(e){if(X(e),e&&e.length>0){var t=e[0],n=t.start-t.originalStart;A(n)}})),v.onCondensedModeToggle((function(e){return ie(e)})),v.onHideSubtitlePlayerToggle((function(e){return ue(e)})),window.onbeforeunload=function(e){u.current||v.close()},function(){return v.close()}}),[de,v]);var Fe=Object(r.useCallback)((function(){d.current&&v.play()}),[v]),Ee=Object(r.useCallback)((function(){return v.pause()}),[v]),Me=Object(r.useCallback)((function(e){T.current&&de.stop();var t=e*M;v.currentTime=t/1e3}),[M,de,v]);var Ie=Object(r.useCallback)((function(e){T.current&&(de.stop(),v.pause()),Te(e),z(e),v.currentTime=0,v.audioTrackSelected(e)}),[v,de]);Object(r.useEffect)((function(){if(G&&0!==G.length){var e=setInterval((function(){for(var e=1e3*d.current.currentTime,t=[],n=0;n<G.length;++n){var r=G[n];if(e>=r.start&&e<r.end&&t.push(Object(l.a)(Object(l.a)({},r),{},{index:n})),e<r.start)break}(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};if(e.length!==t.length)return!1;for(var r=0;r<e.length;++r)if(!n(e[r],t[r]))return!1;return!0})(t,le.current,(function(e,t){return e.index===t.index}))||Y(t)}),10);return function(){return clearTimeout(e)}}}),[G]);var Re=Object(r.useCallback)((function(e){A(e),X((function(t){return t.map((function(t){return{text:t.text,start:t.originalStart+e,originalStart:t.originalStart,end:t.originalEnd+e,originalEnd:t.originalEnd}}))})),v.offset(e)}),[v]);Object(r.useEffect)((function(){var e=on.bindSeekToSubtitle((function(e,t){e.stopPropagation(),e.preventDefault(),v.currentTime=t.start/1e3}),(function(){return!d.current}),(function(){return de.time(M)}),(function(){return G}));return function(){return e()}}),[v,G,M,de]),Object(r.useEffect)((function(){var e=on.bindCopy((function(e,t){e.stopPropagation(),e.preventDefault(),v.copy(t),C&&(Oe("Copied "+t.text),ke(!0))}),(function(){return!1}),(function(){return le.current&&0!==le.current.length?le.current[0]:null}));return function(){return e()}}),[v,C]),Object(r.useEffect)((function(){var e=on.bindAdjustOffset((function(e,t){e.preventDefault(),e.stopPropagation(),Re(t)}),(function(){return!1}),(function(){return G}));return function(){return e()}}),[Re,G]),Object(r.useEffect)((function(){var e=on.bindToggleSubtitles((function(e){return te((function(e){return!e}))}),(function(){return!1}));return function(){return e()}}),[]),Object(r.useEffect)((function(){var e=on.bindOffsetToSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),Re(t)}),(function(){return!1}),(function(){return de.time(M)}),(function(){return G}));return function(){return e()}}),[Re,G,de,M]);var Pe=Object(r.useCallback)((function(e){return Ce(e)}),[]),Ne=Object(r.useCallback)((function(){return te((function(e){return!e}))}),[]),Ae=Object(r.useCallback)((function(){var e;C?document.exitFullscreen():null===(e=fe.current)||void 0===e||e.requestFullscreen()}),[C]),_e=Object(r.useCallback)((function(e){d.current&&(d.current.volume=e)}),[]),Ue=Object(r.useCallback)((function(){v.popOutToggle(),o&&(u.current=!0,window.close())}),[v,o]),De=Object(r.useCallback)((function(){v.condensedModeToggle()}),[v]),Be=Object(r.useCallback)((function(){v.close(),window.close()}),[v]),Le=Object(r.useCallback)((function(){v.hideSubtitlePlayerToggle()}),[v]),We=Object(r.useCallback)((function(){x?v.pause():v.play()}),[v,x]),He=Object(r.useCallback)((function(){return ke(!1)}),[]),ze=n.subtitleSettings,Ve=ze.subtitleSize,Ke=ze.subtitleColor,Ge=ze.subtitleOutlineThickness,Xe=ze.subtitleOutlineColor,qe=ze.subtitleBackgroundColor,Je=ze.subtitleBackgroundOpacity,Qe=Object(r.useMemo)((function(){return lr(Ve,Ke,Ge,Xe,qe,Je)}),[Ve,Ke,Ge,Xe,qe,Je]);return Object(w.jsxs)("div",{ref:fe,onMouseMove:function(e){be.current.x=e.screenX,be.current.y=e.screenY},className:t.root,children:[Object(w.jsx)("video",{preload:"auto",nocontrols:1,onClick:We,className:we?t.video:"".concat(t.cursorHidden," ").concat(t.video),ref:Se,src:i}),ee&&Object(w.jsx)("div",{style:Qe,children:Q.map((function(e){return Object(w.jsxs)(a.a.Fragment,{children:[e.text,Object(w.jsx)("br",{})]},e.index)}))}),C&&Object(w.jsx)(S,{open:me,onClose:He,autoHideDuration:3e3,severity:"success",children:pe}),Object(w.jsx)(nn,{mousePositionRef:be,playing:x,clock:de,length:M,audioTracks:D,selectedAudioTrack:H,subtitlesToggle:G&&G.length>0,subtitlesEnabled:ee,offsetEnabled:!0,offset:N,fullscreenEnabled:!0,fullscreen:C,closeEnabled:!o,popOut:o,volumeEnabled:!0,popOutEnabled:!or.isMobile,condensedModeToggleEnabled:!0,condensedModeEnabled:ae,hideSubtitlePlayerToggleEnabled:(null===G||void 0===G?void 0:G.length)>0&&!o&&!C,subtitlePlayerHidden:se,onShow:Pe,onPlay:Fe,onPause:Ee,onSeek:Me,onAudioTrackSelected:Ie,onSubtitlesToggle:Ne,onFullscreenToggle:Ae,onVolumeChange:_e,onOffsetChange:Re,onPopOutToggle:Ue,onCondensedModeToggle:De,onClose:Be,onHideSubtitlePlayerToggle:Le,settingsProvider:n})]})}var fr="https://github.com/killergerbah/asbplayer/releases/latest",hr=Object(p.a)((function(e){return{content:{flexGrow:1,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginRight:0},contentShift:function(t){var n=t.drawerWidth;return{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:n}}}}));function jr(e,t){return e.audio?ae.fromBase64(e.subtitleFile,e.start,e.end,e.audio.base64,e.audio.extension):e.audioFile||e.videoFile?ae.fromFile(e.audioFile||e.videoFile,e.originalStart+t,e.originalEnd+t,e.audioTrack):null}function pr(e,t){return e.image?lt.fromBase64(e.subtitleFile,e.start,e.image.base64,e.image.extension):e.videoFile?lt.fromFile(e.videoFile,e.originalStart+t):null}function Or(e){var t=hr(e);return Object(w.jsx)("main",{className:Object(k.a)(t.content,Object(f.a)({},t.contentShift,e.drawerOpen)),children:e.children})}var vr=function(){var e=Object(r.useMemo)((function(){return new Ie}),[]),t=Object(r.useMemo)((function(){return new cr}),[]),n=Object(r.useMemo)((function(){return Object(O.a)({palette:{primary:{main:"#49007a"},secondary:{main:"#ff1f62"},error:{main:m.a.A400},type:t.themeType}})}),[t.themeType]),a=Object(r.useMemo)((function(){return new M(t)}),[t]),i="/video"===Object(j.g)().pathname,c=Object(r.useMemo)((function(){return new Ve(!i)}),[i]),o=Object(r.useRef)(),f=g(!i),p=Object(b.a)(f,1)[0],k=o.current?.2:.3,x=o.current?150:300,y=Math.max(x,p*k),C=Object(r.useState)([]),T=Object(b.a)(C,2),F=T[0],E=T[1],I=Object(r.useState)(!1),R=Object(b.a)(I,2),P=R[0],N=R[1],A=Object(r.useState)(),_=Object(b.a)(A,2),U=_[0],D=_[1],B=Object(r.useState)(!1),L=Object(b.a)(B,2),W=L[0],H=L[1],z=Object(r.useState)(),V=Object(b.a)(z,2),K=V[0],G=V[1],q=Object(r.useState)(),J=Object(b.a)(q,2),Q=J[0],Y=J[1],Z=Object(r.useState)({}),$=Object(b.a)(Z,2),ee=$[0],te=$[1],ne=Object(r.useState)(!1),re=Object(b.a)(ne,2),ae=re[0],ce=re[1],oe=Object(r.useState)(!1),se=Object(b.a)(oe,2),le=se[0],de=se[1],be=Object(r.useRef)(),fe=Object(r.useState)(),he=Object(b.a)(fe,2),je=he[0],pe=he[1],Oe=Object(r.useState)(!1),ve=Object(b.a)(Oe,2),ge=ve[0],me=ve[1],ke=Object(r.useState)(!1),xe=Object(b.a)(ke,2),we=xe[0],Ce=xe[1],Se=Object(r.useState)(),Fe=Object(b.a)(Se,2),Ee=Fe[0],Me=Fe[1],Re=Object(r.useState)(!1),Pe=Object(b.a)(Re,2),Ne=Pe[0],Ae=Pe[1],_e=Object(r.useState)(!1),Ue=Object(b.a)(_e,2),De=Ue[0],Be=Ue[1],Le=Object(r.useState)(!1),We=Object(b.a)(Le,2),ze=We[0],Ke=We[1],Ge=Object(r.useState)(!1),Xe=Object(b.a)(Ge,2),qe=Xe[0],Je=Xe[1],Qe=Object(r.useState)(),Ye=Object(b.a)(Qe,2),Ze=Ye[0],$e=Ye[1],et=Object(r.useState)(),tt=Object(b.a)(et,2),nt=tt[0],rt=tt[1],at=Object(r.useState)([]),it=Object(b.a)(at,2),ct=it[0],st=it[1],ut=Object(r.useRef)(),lt=Object(r.useRef)(),dt=ee.subtitleFile,bt=Object(r.useCallback)((function(e,t,n,r,a,i,c){E((function(o){return[].concat(Object(d.a)(o),[Object(l.a)(Object(l.a)({},e),{},{timestamp:Date.now(),name:je,subtitleFile:r,audioFile:t,videoFile:n,audioTrack:a,audio:i,image:c})])})),G("success"),D("Copied "+e.text),H(!0)}),[je]),ft=Object(r.useCallback)((function(){return N((function(e){return!e}))}),[]),jt=Object(r.useCallback)((function(){return N(!1)}),[]),pt=Object(r.useCallback)((function(){return Ae(!0)}),[]),Ot=Object(r.useCallback)((function(){return Be(!0)}),[]),vt=Object(r.useCallback)((function(){return Be(!1)}),[]),gt=Object(r.useCallback)((function(){return H(!1)}),[]),mt=Object(r.useCallback)((function(){return Ke(!1)}),[]),kt=Object(r.useCallback)((function(e){t.settings=e,Ae(!1),c.publishMessage({command:"subtitleSettings",value:t.subtitleSettings})}),[c,t]),xt=Object(r.useCallback)((function(e){var t,n=[],r=Object(h.a)(F);try{for(r.s();!(t=r.n()).done;){var a=t.value;e.timestamp!==a.timestamp&&n.push(a)}}catch(i){r.e(i)}finally{r.f()}E(n)}),[F]),yt=Object(r.useCallback)((function(e){G("error"),D(e),H(!0)}),[]),wt=Object(r.useCallback)((function(e){e===ee.audioFileUrl&&te((function(t){return URL.revokeObjectURL(e),{subtitleFile:t.subtitleFile,audioFile:null,audioFileUrl:null,videoFile:t.videoFile,videoFileUrl:t.videoFileUrl}}))}),[ee]),Ct=Object(r.useCallback)((function(e){e===ee.videoFileUrl&&te((function(t){return URL.revokeObjectURL(e),{subtitleFile:t.subtitleFile,audioFile:t.audioFile,audioFileUrl:t.audioFileUrl,videoFile:null,videoFileUrl:null}}))}),[ee]),St=Object(r.useCallback)(function(){var e=Object(u.a)(s.a.mark((function e(n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,jr(n,ut.current||0);case 3:r=e.sent,t.preferMp3?r.toMp3().download():r.download(),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0),yt(e.t0.message);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),[yt,t]),Tt=Object(r.useCallback)(function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,pr(t,ut.current||0).download();case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0),yt(e.t0.message);case 9:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),[yt]),Ft=Object(r.useCallback)((function(e){dt.name===e.subtitleFile.name?Y({text:e.text,originalStart:e.originalStart}):yt("Subtitle file "+e.subtitleFile.name+" is not open.")}),[dt,yt]),Et=Object(r.useCallback)((function(e){Me(e),me(!0),Ce(!1),Je(!0)}),[]),Mt=Object(r.useCallback)((function(){me(!1),Ce(!1),Je(!1)}),[]),It=Object(r.useCallback)(function(){var e=Object(u.a)(s.a.mark((function e(t,n,r,i,c,o,u,l){var d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ce(!0),e.prev=1,e.next=4,a.export(t,n,r,i,c,o,u,l);case 4:d=e.sent,l||(G("success"),D("Export succeeded: "+d),H(!0)),me(!1),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),console.error(e.t0),yt(e.t0.message);case 13:return e.prev=13,Ce(!1),Je(!1),e.finish(13);case 17:case"end":return e.stop()}}),e,null,[[1,9,13,17]])})));return function(t,n,r,a,i,c,o,s){return e.apply(this,arguments)}}(),[a,yt]),Rt=Object(r.useCallback)((function(e){$e(e),Ke(!0)}),[]);Object(r.useEffect)((function(){function e(e){if(e.length!==ct.length)st(e);else{for(var t=!1,n=0;n<ct.length;++n){var r=ct[n],a=e[n];if(r.id!==a.id||r.title!==a.title||r.src!==a.src){t=!0;break}}t&&st(e)}nt&&0===e.filter((function(e){return e.id===nt.id&&e.src===nt.src})).length&&(rt(null),yt("Lost connection with tab "+nt.id+" "+nt.title))}return c.subscribeTabs(e),function(){return c.unsubscribeTabs(e)}}),[ct,nt,c,yt]);var Pt=Object(r.useCallback)((function(e){return rt(e)}),[]),Nt=Object(r.useCallback)((function(e){try{var t=function(e){var t,n=null,r=null,a=null,i=Object(h.a)(e);try{for(i.s();!(t=i.n()).done;){var c=t.value,o=c.name.lastIndexOf(".");if(-1===o)throw new Error("Unable to determine extension of "+c.name);var s=c.name.substring(o+1,c.name.length);switch(s){case"ass":case"srt":case"vtt":if(n)throw new Error("Cannot open two subtitle files simultaneously");n=c;break;case"mkv":if(a)throw new Error("Cannot open two video files simultaneously");a=c;break;case"mp3":case"m4a":if(r)throw new Error("Cannot open two audio files simultaneously");r=c;break;default:throw new Error("Unsupported extension "+s)}}}catch(u){i.e(u)}finally{i.f()}if(a&&r)throw new Error("Cannot load both an audio and video file simultaneously");return{subtitleFile:n,audioFile:r,videoFile:a}}(e),n=t.subtitleFile,r=t.audioFile,a=t.videoFile;te((function(e){ce(!0);var t=null,i=null;return a||r?(!function(e){e.audioFileUrl&&URL.revokeObjectURL(e.audioFileUrl),e.videoFileUrl&&URL.revokeObjectURL(e.videoFileUrl)}(e),a?t=URL.createObjectURL(a):r&&(i=URL.createObjectURL(r)),rt(null)):(a=e.videoFile,t=e.videoFileUrl,r=e.audioFile,i=e.audioFileUrl),{subtitleFile:n||e.subtitleFile,audioFile:r,audioFileUrl:i,videoFile:a,videoFileUrl:t}})),n&&pe(n.name)}catch(i){console.error(i),yt(i.message)}}),[yt]);Object(r.useEffect)((function(){function e(e){return t.apply(this,arguments)}function t(){return(t=Object(u.a)(s.a.mark((function e(t){var n,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("sync"!==t.data.command){e.next=18;break}if(0!==(n=ct.filter((function(e){return e.id===t.tabId&&(!t.src||e.src===t.src)}))).length){e.next=5;break}return t.src?console.error("Received sync request but the requesting tab ID "+t.tabId+" with src "+t.src+" was not found"):console.error("Received sync request but the requesting tab ID "+t.tabId+" was not found"),e.abrupt("return");case 5:return r=n[0],e.t0=File,e.next=9,fetch("data:text/plain;base64,"+t.data.subtitles.base64);case 9:return e.next=11,e.sent.blob();case 11:e.t1=e.sent,e.t2=[e.t1],e.t3=t.data.subtitles.name,a=new e.t0(e.t2,e.t3),pe(a.name),te({subtitleFile:a,audioFile:null,audioFileUrl:null,videoFile:null,videoFileUrl:null}),rt(r);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return c.subscribe(e),function(){return c.unsubscribe(e)}}),[c,ct]);var At=Object(r.useCallback)((function(e){e.preventDefault(),i?yt("Video player cannot receive dropped files. Drop outside of the video frame instead."):(de(!1),be.current=null,e.dataTransfer.files&&0!==e.dataTransfer.files.length&&Nt(e.dataTransfer.files))}),[i,yt,Nt]),_t=Object(r.useCallback)((function(){var e,t=null===(e=lt.current)||void 0===e?void 0:e.files;t&&t.length>0&&Nt(t)}),[Nt]),Ut=Object(r.useCallback)((function(){var e;return null===(e=lt.current)||void 0===e?void 0:e.click()}),[]),Dt=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),i||(be.current=e.target,de(!0))}),[i]),Bt=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),i||be.current!==e.target||de(!1)}),[i]),Lt=Object(r.useCallback)((function(){return ce(!1)}),[]),Wt=ae&&!o.current||!ee.subtitleFile&&!ee.audioFile&&!ee.videoFile;return Object(w.jsxs)(v.a,{theme:n,children:[Object(w.jsx)(ie.a,{}),Object(w.jsxs)("div",{onDrop:At,onDragOver:function(e){return e.preventDefault()},onDragEnter:Dt,onDragLeave:Bt,children:[Object(w.jsx)(S,{open:W,onClose:gt,autoHideDuration:3e3,severity:K,children:U}),Object(w.jsxs)(j.d,{children:[Object(w.jsx)(j.b,{exact:!0,path:"/",render:function(){var n,r=new URLSearchParams(window.location.search),i=r.get("video"),s=r.get("channel"),u=r.get("popout");return i&&s?Object(w.jsx)(j.a,{to:"/video?video="+encodeURIComponent(i)+"&channel="+s+"&popout="+u}):Object(w.jsxs)("div",{children:[Object(w.jsx)(ot,{items:F,open:P,drawerWidth:y,onClose:jt,onDelete:xt,onClipAudio:St,onDownloadImage:Tt,onSelect:Ft,onAnki:Et}),Object(w.jsx)(X,{open:ge,disabled:we,text:null===Ee||void 0===Ee?void 0:Ee.text,audioClip:Ee&&jr(Ee,ut.current||0),image:Ee&&pr(Ee,ut.current||0),source:null===Ee||void 0===Ee||null===(n=Ee.subtitleFile)||void 0===n?void 0:n.name,customFields:t.customAnkiFields,anki:a,settingsProvider:t,onCancel:Mt,onProceed:It,onViewImage:Rt,onOpenSettings:pt}),Object(w.jsx)(Te,{open:ze,image:Ze,onClose:mt}),Object(w.jsx)(Ln,{anki:a,open:Ne,onClose:kt,settings:t.settings}),Object(w.jsx)(ye,{open:De,extensionUrl:fr,onClose:vt}),Object(w.jsx)(He,{title:je||"asbplayer",drawerWidth:y,drawerOpen:P,onOpenCopyHistory:ft,onOpenSettings:pt,onOpenHelp:Ot,onFileSelector:Ut}),Object(w.jsx)("input",{ref:lt,onChange:_t,type:"file",accept:".srt,.ass,.vtt,.mp3,.m4a,.mkv",multiple:!0,hidden:!0}),Object(w.jsxs)(Or,{drawerWidth:y,drawerOpen:P,children:[Wt&&Object(w.jsx)(ht,{latestExtensionVersion:"0.10.0",extensionUrl:fr,extension:c,loading:ae,dragging:le,onFileSelector:Ut}),Object(w.jsx)(ue,{dragging:le,loading:ae}),Object(w.jsx)(xn,{subtitleReader:e,settingsProvider:t,onCopy:bt,onError:yt,onUnloadAudio:wt,onUnloadVideo:Ct,onLoaded:Lt,onTabSelected:Pt,offsetRef:ut,tab:nt,availableTabs:ct,sources:ee,jumpToSubtitle:Q,videoFrameRef:o,extension:c,drawerOpen:P,disableKeyEvents:qe})]})]})}}),Object(w.jsx)(j.b,{exact:!0,path:"/video",render:function(){var e=new URLSearchParams(window.location.search),n=e.get("video"),r=e.get("channel"),a="true"===e.get("popout");return Object(w.jsx)(br,{settingsProvider:t,videoFile:n,popOut:a,channel:r,onError:yt})}})]})]})]})},gr=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,346)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),r(e),a(e),i(e),c(e)}))},mr=n(110);n(255);c.a.render(Object(w.jsx)(mr.a,{basename:"/asbplayer",forceRefresh:!1,children:Object(w.jsx)(vr,{})}),document.querySelector("#root")),gr()}},[[256,1,2]]]);
//# sourceMappingURL=main.97659933.chunk.js.map