(this["webpackJsonp@project/client"]=this["webpackJsonp@project/client"]||[]).push([[0],{298:function(e,t){},300:function(e,t){},314:function(e,t){},316:function(e,t){},369:function(e,t,n){"use strict";n.r(t);n(259);var a=n(190),i=n(10),r=n(23),o=n(25),s=n(8),c=n(3),u=n(19),l=n(4),d=n.n(l),b=n(0),f=n.n(b),h=n(20),p=n(123),v=n(416),g=n(237),j=n(425);function O(e){var t=Object(b.useState)([0,0]),n=Object(c.a)(t,2),a=n[0],i=n[1];return Object(b.useLayoutEffect)((function(){function t(){e&&i([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",t),t(),function(){return window.removeEventListener("resize",t)}}),[e]),a}var m=n(124),k=n(13),y=n(11),x=n(16),S=function(){function e(t){Object(k.a)(this,e),this.keyBindSet=void 0,this.keyBindSet=t}return Object(y.a)(e,[{key:"bindCopy",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this.keyBindSet.copySubtitle.keys;if(!i)return function(){};var r=this.copyHandler(e,t,n);return Object(x.a)(i,{capture:a},r),function(){return x.a.unbind(i,r)}}},{key:"copyHandler",value:function(e,t,n){return function(a){if(!t()){var i=n();i&&e(a,i)}}}},{key:"bindAnkiExport",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.ankiExport.keys;if(!a)return function(){};var i=this.ankiExportHandler(e,t);return Object(x.a)(a,{capture:n},i),function(){return x.a.unbind(a,i)}}},{key:"ankiExportHandler",value:function(e,t){return function(n){t()||e(n)}}},{key:"bindUpdateLastCard",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.updateLastCard.keys;if(!a)return function(){};var i=this.updateLastCardHandler(e,t);return Object(x.a)(a,{capture:n},i),function(){return x.a.unbind(a,i)}}},{key:"updateLastCardHandler",value:function(e,t){return function(n){t()||e(n)}}},{key:"bindSeekToSubtitle",value:function(e,t,n,a){var i=this,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=function(r,o){if(!t()){var s=a();if(s&&0!==s.length){var c=i._adjacentSubtitle(o,n(),s);null!==c&&c.start>=0&&c.end>=0&&e(r,c)}}},s=this.keyBindSet.seekToPreviousSubtitle.keys,c=this.keyBindSet.seekToNextSubtitle.keys,u=function(e){return o(e,!1)},l=function(e){return o(e,!0)};return s&&Object(x.a)(s,{capture:r},u),c&&Object(x.a)(c,{capture:r},l),function(){s&&x.a.unbind(s,u),c&&x.a.unbind(c,l)}}},{key:"bindSeekToBeginningOfCurrentSubtitle",value:function(e,t,n,a){var i=this,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this.keyBindSet.seekToBeginningOfCurrentSubtitle.keys;if(!o)return function(){};var s=function(r){if(!t()){var o=a();if(o&&0!==o.length){var s=i._currentSubtitle(n(),o);void 0!==s&&s.start>=0&&s.end>=0&&e(r,s)}}};return Object(x.a)(o,{capture:r},s),function(){return x.a.unbind(o,s)}}},{key:"_currentSubtitle",value:function(e,t){for(var n,a=e,i=Number.MAX_SAFE_INTEGER,r=0;r<t.length;++r){var o=t[r];if(!(o.start<0||o.end<0)){var s=a-o.start;a>=o.start&&a<o.end&&s<i&&(n=o,i=s)}}return n}},{key:"bindSeekBackwardOrForward",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=function(n,a){t()||e(n,a)},i=this.keyBindSet.seekBackward.keys,r=this.keyBindSet.seekForward.keys,o=function(e){return a(e,!1)},s=function(e){return a(e,!0)};return i&&Object(x.a)(i,{capture:n},o),r&&Object(x.a)(r,{capture:n},s),function(){i&&x.a.unbind(i,o),r&&x.a.unbind(r,s)}}},{key:"bindOffsetToSubtitle",value:function(e,t,n,a){var i=this,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=function(r,o){if(!t()){var s=a();if(s&&0!==s.length){var c=n(),u=i._adjacentSubtitle(o,c,s);if(null!==u){var l=u.originalStart;e(r,c-l)}}}},s=this.keyBindSet.adjustOffsetToPreviousSubtitle.keys,c=this.keyBindSet.adjustOffsetToNextSubtitle.keys,u=function(e){return o(e,!1)},l=function(e){return o(e,!0)};return s&&Object(x.a)(s,{capture:r},u),c&&Object(x.a)(c,{capture:r},l),function(){s&&x.a.unbind(s,u),c&&x.a.unbind(c,l)}}},{key:"_adjacentSubtitle",value:function(e,t,n){for(var a=t,i=-1,r=Number.MAX_SAFE_INTEGER,o=0;o<n.length;++o){var s=n[o],c=e?s.start-a:a-s.start;r<=c||(e&&a<s.start?(r=c,i=o):!e&&a>s.start&&(r=c,i=a<s.end?Math.max(0,o-1):o))}return-1!==i?n[i]:null}},{key:"bindAdjustOffset",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=function(a,i){if(!t()){var r=n();if(r&&0!==r.length){var o=r[0].start-r[0].originalStart;e(a,o+(i?100:-100))}}},r=this.keyBindSet.decreaseOffset.keys,o=this.keyBindSet.increaseOffset.keys,s=function(e){return i(e,!1)},c=function(e){return i(e,!0)};return Object(x.a)(r,{capture:a},s),Object(x.a)(o,{capture:a},c),function(){x.a.unbind(r,s),x.a.unbind(o,c)}}},{key:"bindResetOffet",value:function(e,t,n){var a=this.keyBindSet.resetOffset.keys;if(!a)return function(){};var i=function(n){t()||e(n)};return Object(x.a)(a,{capture:n},i),function(){x.a.unbind(a,i)}}},{key:"bindAdjustPlaybackRate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=function(n,a){t()||e(n,a)},i=this.keyBindSet.increasePlaybackRate.keys,r=this.keyBindSet.decreasePlaybackRate.keys,o=function(e){return a(e,!1)},s=function(e){return a(e,!0)};return r&&Object(x.a)(r,{capture:n},o),i&&Object(x.a)(i,{capture:n},s),function(){r&&x.a.unbind(r,o),i&&x.a.unbind(i,s)}}},{key:"bindToggleSubtitles",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.toggleSubtitles.keys;if(!a)return function(){};var i=function(n){t()||e(n)};return Object(x.a)(a,{capture:n},i),function(){x.a.unbind(a,i)}}},{key:"bindToggleSubtitleTrackInVideo",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=[this.keyBindSet.toggleVideoSubtitleTrack1.keys,this.keyBindSet.toggleVideoSubtitleTrack2.keys].filter((function(e){return e}));if(0===a.length)return function(){};for(var i=function(n,a){t()||e(n,a)},r=[],o=function(e){var t=function(t){return i(t,e)};r.push(t),Object(x.a)(a[e],{capture:n},t)},s=0;s<a.length;++s)o(s);return function(){for(var e=0;e<a.length;++e){var t=r[e];x.a.unbind(a[e],t)}}}},{key:"bindToggleSubtitleTrackInList",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=[this.keyBindSet.toggleAsbplayerSubtitleTrack1.keys,this.keyBindSet.toggleAsbplayerSubtitleTrack2.keys].filter((function(e){return e}));if(0===a.length)return function(){};for(var i=function(n,a){t()||e(n,a)},r=[],o=function(e){var t=function(t){return i(t,e)};r.push(t),Object(x.a)(a[e],{capture:n},t)},s=0;s<9;++s)o(s);return function(){for(var e=0;e<9;++e){var t=r[e];x.a.unbind(a[e],t)}}}},{key:"bindPlay",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.togglePlay.keys;if(!a)return function(){};var i=function(n){t()||e(n)};return Object(x.a)(a,{capture:n},i),function(){x.a.unbind(a,i)}}},{key:"bindAutoPause",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.toggleAutoPause.keys;if(!a)return function(){};var i=function(n){t()||e(n)};return Object(x.a)(a,{capture:n},i),function(){x.a.unbind(a,i)}}},{key:"bindCondensedPlayback",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.keyBindSet.toggleCondensedPlayback.keys;if(!a)return function(){};var i=function(n){t()||e(n)};return Object(x.a)(a,{capture:n},i),function(){x.a.unbind(a,i)}}}]),e}(),C=function(){function e(){Object(k.a)(this,e)}return Object(y.a)(e,null,[{key:"encode",value:function(){var e=Object(s.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(d.a.mark((function e(a,i){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(r=new FileReader).onload=function(){var e=Object(s.a)(d.a.mark((function e(t){var r,o,s,c,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=new AudioContext,null!==t.target){e.next=5;break}return i(new Error("Could not obtain buffer to encode")),e.abrupt("return");case 5:return e.next=7,r.decodeAudioData(t.target.result);case 7:for(o=e.sent,s=[],c=0;c<o.numberOfChannels;++c)s.push(o.getChannelData(c));(u=n()).postMessage({command:"encode",audioBuffer:{channels:s,numberOfChannels:o.numberOfChannels,length:o.length,sampleRate:o.sampleRate}}),u.onmessage=function(e){a(new Blob(e.data.buffer,{type:"audio/mp3"})),u.terminate()},u.onerror=function(e){var t,n=null!==(t=null===e||void 0===e?void 0:e.error)&&void 0!==t?t:new Error("MP3 encoding failed: "+(null===e||void 0===e?void 0:e.message));i(n),u.terminate()},e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),i(e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t){return e.apply(this,arguments)}}(),r.readAsArrayBuffer(t);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function w(){return new Worker(n.p+"static/js/mp3-encoder.7f842300.worker.js")}var T,F=n(112),P=n.n(F);function R(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=Math.floor(e/1e3);t=n?Math.round(e/1e3%60*10)/10:a%60;var i=Math.floor(a/60)%60,r=Math.floor(a/3600);return r>0?r+"h"+String(i).padStart(2,"0")+"m"+String(t).padStart(2,"0")+"s":i+"m"+String(t).padStart(2,"0")+"s"}function E(e,t,n,a){for(var i=t,r=t;r>=0&&!_(e,i=r,t,n,a,T.backward);--r);for(var o=i,s=t;s<=e.length-1&&!_(e,o=s,t,n,a,T.forward);++s);return e.slice(i,o+1)}function M(e,t,n){var a=[e],i=e.start-e.originalStart;if(e.end<t){var r=Math.min(t,e.end+n);a.push({text:"",start:e.end,end:r,originalStart:e.end-i,originalEnd:r-i,track:e.track})}if(e.start>0){var o=Math.max(0,e.start-n);a.unshift({text:"",start:o,end:e.start,originalStart:o-i,originalEnd:e.start-i,track:e.track})}return a}function _(e,t,n,a,i,r){var o;return o=r==T.forward?t+1<e.length?e[t+1]:null:t-1>=0?e[t-1]:null,Math.abs(n-t)>=a&&(null===o||Math.abs(o.start-e[n].start)>=i)}function B(e,t){var n=Math.max(0,e.end-e.start);if(0===n)return!1;var a=Math.max(e.start,t[0]);return Math.min(e.end,t[1])-a>=n/2}function A(e){return e.filter((function(e){return""!==e.text.trim()})).map((function(e){return e.text})).join("\n")}function I(e,t){if(0===t.length)return e.text;var n=[e.start,e.end];return A(t.filter((function(e){return B(e,n)})))}function N(e,t){var n=window.URL.createObjectURL(e),a=document.createElement("a");document.body.appendChild(a),a.style.display="none",a.href=n,a.download=P()(t),a.click(),URL.revokeObjectURL(n),a.remove()}!function(e){e[e.forward=0]="forward",e[e.backward=1]="backward"}(T||(T={}));var D=function(){return new w},L=function(){function e(t,n,a,i,r,o){Object(k.a)(this,e),this._name=void 0,this._start=void 0,this._end=void 0,this.playbackRate=void 0,this._base64=void 0,this._extension=void 0,this.playingAudio=void 0,this.stopAudioTimeout=void 0,this.cachedBlob=void 0,this._name=t+"_"+Math.floor(n)+"_"+Math.floor(a),this._start=n,this._end=a,this.playbackRate=i,this._base64=r,this._extension=o}return Object(y.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return this._extension}},{key:"start",get:function(){return this._start}},{key:"end",get:function(){return this._end}},{key:"base64",value:function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._base64);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(s.a)(d.a.mark((function e(){var t,n,a=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.playingAudio){e.next=6;break}return this.stopAudio(this.playingAudio),clearTimeout(this.stopAudioTimeout),this.playingAudio=void 0,this.stopAudioTimeout=void 0,e.abrupt("return");case 6:return e.next=8,this._blob();case 8:return t=e.sent,(n=new Audio).src=URL.createObjectURL(t),n.preload="none",n.load(),this.playingAudio=n,e.next=16,n.play();case 16:this.stopAudioTimeout=setTimeout((function(){a.stopAudio(n),a.playingAudio=void 0,a.stopAudioTimeout=void 0}),(this._end-this._start)/this.playbackRate+100);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopAudio",value:function(e){e.pause();var t=e.src;e.src="",URL.revokeObjectURL(t)}},{key:"_blob",value:function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cachedBlob){e.next=6;break}return e.next=3,fetch("data:audio/"+this.extension+";base64,"+this._base64);case 3:return e.next=5,e.sent.blob();case 5:this.cachedBlob=e.sent;case 6:return e.abrupt("return",this.cachedBlob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"slice",value:function(e,t){return this}},{key:"isSliceable",value:function(){return!1}}]),e}(),W=function(){function e(t,n,a,i,r){Object(k.a)(this,e),this.file=void 0,this._name=void 0,this._start=void 0,this._end=void 0,this.playbackRate=void 0,this.trackId=void 0,this._extension=void 0,this.recorderMimeType=void 0,this.clippingAudio=void 0,this.clippingAudioReject=void 0,this.stopClippingTimeout=void 0,this.playingAudio=void 0,this.stopAudioTimeout=void 0,this._blob=void 0;var o=e._recorderConfiguration(),s=Object(c.a)(o,2),u=s[0],l=s[1];this.recorderMimeType=u,this.file=t,this._name=t.name+"_"+n+"_"+a,this._start=n,this._end=a,this.playbackRate=i,this.trackId=r,this._extension=l}return Object(y.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return this._extension}},{key:"start",get:function(){return this._start}},{key:"end",get:function(){return this._end}},{key:"base64",value:function(){var e=Object(s.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(d.a.mark((function e(n,a){var i,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new FileReader,e.next=3,t.blob();case 3:void 0===(r=e.sent)?a("Did not finish recording blob"):(i.readAsDataURL(r),i.onloadend=function(){var e=i.result,t=e.substring(e.indexOf(",")+1);n(t)});case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(s.a)(d.a.mark((function e(){var t,n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=5;break}return e.next=3,this._clipAudio();case 3:return this._blob=e.sent,e.abrupt("return");case 5:if(!this.playingAudio){e.next=11;break}return this.stopAudio(this.playingAudio),clearTimeout(this.stopAudioTimeout),this.playingAudio=void 0,this.stopAudioTimeout=void 0,e.abrupt("return");case 11:return e.next=13,this._audioElement(this._blob,!1);case 13:return(t=e.sent).currentTime=0,e.next=17,t.play();case 17:this.playingAudio=t,this.stopAudioTimeout=setTimeout((function(){n.stopAudio(t),n.stopAudioTimeout=void 0,n.playingAudio=void 0}),(this._end-this._start)/this.playbackRate+100);case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=4;break}return e.next=3,this._clipAudio();case 3:this._blob=e.sent;case 4:if(void 0!==this._blob){e.next=6;break}throw new Error("Did not finish recording blob");case 6:return e.abrupt("return",this._blob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_clipAudio",value:function(){var e=Object(s.a)(d.a.mark((function e(){var t,n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.clippingAudio){e.next=8;break}return this.stopAudio(this.clippingAudio),clearTimeout(this.stopClippingTimeout),null===(t=this.clippingAudioReject)||void 0===t||t.call(this,"Did not finish recording blob"),this.clippingAudio=void 0,this.stopClippingTimeout=void 0,this.clippingAudioReject=void 0,e.abrupt("return",void 0);case 8:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(d.a.mark((function e(t,a){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n._audioElement(n.file,!0);case 3:(r=e.sent).oncanplay=function(){var e=Object(s.a)(d.a.mark((function e(o){var s,c,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.play(),s=n._captureStream(r),c=new MediaRecorder(s,{mimeType:n.recorderMimeType}),u=[],c.ondataavailable=function(e){u.push(e.data)},l=!1,c.onstop=function(e){l&&t(new Blob(u,{type:n.recorderMimeType}))},c.start(),n.clippingAudioReject=a,n.clippingAudio=r,n.stopClippingTimeout=setTimeout((function(){n.stopAudio(r),n.clippingAudio=void 0,n.stopClippingTimeout=void 0,n.clippingAudioReject=void 0,l=!0,c.stop();var e,t=Object(i.a)(s.getAudioTracks());try{for(t.s();!(e=t.n()).done;){e.value.stop()}}catch(a){t.e(a)}finally{t.f()}}),(n._end-n._start)/n.playbackRate+100);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),a(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}()));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_audioElement",value:function(e,t){var n=this,a=new Audio;return a.src=URL.createObjectURL(e),new Promise((function(e,r){a.onloadedmetadata=function(r){if(t&&n.trackId&&a.audioTracks&&a.audioTracks.length>0){var o,s=Object(i.a)(a.audioTracks);try{for(s.s();!(o=s.n()).done;){var c=o.value;c.enabled=n.trackId===c.id}}catch(u){s.e(u)}finally{s.f()}}a.currentTime=n._start/1e3,a.playbackRate=n.playbackRate,e(a)}}))}},{key:"stopAudio",value:function(e){e.pause();var t=e.src;e.src="",URL.revokeObjectURL(t)}},{key:"_captureStream",value:function(e){var t;if("function"===typeof e.captureStream&&(t=e.captureStream()),"function"===typeof e.mozCaptureStream&&(t=e.mozCaptureStream()),void 0===t)throw new Error("Unable to capture stream from audio");var n,a=new MediaStream,r=Object(i.a)(t.getVideoTracks());try{for(r.s();!(n=r.n()).done;){n.value.stop()}}catch(u){r.e(u)}finally{r.f()}var o,s=Object(i.a)(t.getAudioTracks());try{for(s.s();!(o=s.n()).done;){var c=o.value;c.enabled&&a.addTrack(c)}}catch(u){s.e(u)}finally{s.f()}return a}},{key:"slice",value:function(t,n){return new e(this.file,t,n,this.playbackRate,this.trackId)}},{key:"isSliceable",value:function(){return!0}}],[{key:"_recorderConfiguration",value:function(){var e={"audio/ogg;codecs=opus":"ogg","audio/webm;codecs=opus":"webm"};return Object.keys(e).filter(MediaRecorder.isTypeSupported).map((function(t){return[t,e[t]]}))[0]}}]),e}(),U=function(){function e(t,n){Object(k.a)(this,e),this.data=void 0,this.workerFactory=void 0,this._blob=void 0,this.data=t,this.workerFactory=n}return Object(y.a)(e,[{key:"name",get:function(){return this.data.name}},{key:"extension",get:function(){return"mp3"}},{key:"start",get:function(){return this.data.start}},{key:"end",get:function(){return this.data.end}},{key:"base64",value:function(){var e=Object(s.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(d.a.mark((function e(n,a){var i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=new FileReader,e.t0=i,e.next=5,t.blob();case 5:e.t1=e.sent,e.t0.readAsDataURL.call(e.t0,e.t1),i.onloadend=function(){var e=i.result,t=e.substring(e.indexOf(",")+1);n(t)},e.next=13;break;case 10:e.prev=10,e.t2=e.catch(0),a(e.t2);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.play();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=9;break}return e.t0=C,e.next=4,this.data.blob();case 4:return e.t1=e.sent,e.t2=this.workerFactory,e.next=8,e.t0.encode.call(e.t0,e.t1,e.t2);case 8:this._blob=e.sent;case 9:return e.abrupt("return",this._blob);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"slice",value:function(t,n){return new e(this.data.slice(t,n),this.workerFactory)}},{key:"isSliceable",value:function(){return this.data.isSliceable()}}]),e}(),H=function(){function e(t){Object(k.a)(this,e),this.data=void 0,this.data=t}return Object(y.a)(e,[{key:"start",get:function(){return this.data.start}},{key:"end",get:function(){return this.data.end}},{key:"name",get:function(){return this.data.name+"."+this.data.extension}},{key:"play",value:function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.play();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"base64",value:function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.base64();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:N(e.sent,this.name);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toMp3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D;return this.data instanceof U||"mp3"===this.data.extension?this:new e(new U(this.data,t))}},{key:"slice",value:function(t,n){return new e(this.data.slice(t,n))}},{key:"isSliceable",value:function(){return this.data.isSliceable()}}],[{key:"fromBase64",value:function(t,n,a,i,r,o){return new e(new L(t.substring(0,t.lastIndexOf(".")),n,a,i,r,o))}},{key:"fromFile",value:function(t,n,a,i,r){return new e(new W(t,n,a,i,r))}}]),e}(),z=function(){function e(){Object(k.a)(this,e)}return Object(y.a)(e,[{key:"resize",value:function(e,t,n,a){return new Promise((function(i,r){var o=n<=0?1:n/e.width,s=a<=0?1:a/e.height,c=Math.min(1,Math.min(o,s));if(c<1){var u=e.width*c,l=e.height*c;createImageBitmap(e,{resizeWidth:u,resizeHeight:l,resizeQuality:"high"}).then((function(n){e.width=u,e.height=l,t.drawImage(n,0,0),i(e)})).catch((function(e){return r(e)}))}else i(e)}))}}]),e}(),V=function(){function e(t,n,a){Object(k.a)(this,e),this._name=void 0,this._base64=void 0,this._extension=void 0,this.cachedBlob=void 0,this._name=t,this._base64=n,this._extension=a}return Object(y.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return this._extension}},{key:"base64",value:function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._base64);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_blob",value:function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cachedBlob){e.next=6;break}return e.next=3,fetch(this._dataUrl());case 3:return e.next=5,e.sent.blob();case 5:this.cachedBlob=e.sent;case 6:return e.abrupt("return",this.cachedBlob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._dataUrl());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_dataUrl",value:function(){return"data:image/"+this.extension+";base64,"+this._base64}}]),e}(),q=function(){function e(t,n,a,i){Object(k.a)(this,e),this.file=void 0,this.timestamp=void 0,this.maxWidth=void 0,this.maxHeight=void 0,this._name=void 0,this.file=t,this._name=t.name+"_"+Math.floor(n)+".jpeg",this.timestamp=n,this.maxWidth=a,this.maxHeight=i}return Object(y.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return"jpeg"}},{key:"base64",value:function(){var e=Object(s.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(d.a.mark((function e(n,a){var i,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._canvas();case 2:i=e.sent,r=i.toDataURL("image/jpeg"),n(r.substring(r.indexOf(",")+1));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(s.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(d.a.mark((function e(n,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._canvas();case 2:e.sent.toBlob((function(e){null===e?a(new Error("Could not obtain blob")):n(e)}),"image/jpeg");case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(s.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canvas();case 2:return t=e.sent,e.abrupt("return",t.toDataURL());case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_canvas",value:function(){var e=Object(s.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(d.a.mark((function e(n,a){var i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(i=t._videoElement(t.file)).oncanplay=function(){var e=Object(s.a)(d.a.mark((function e(a){var r,o,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=document.createElement("canvas")).width=i.videoWidth,r.height=i.videoHeight,(o=r.getContext("2d")).drawImage(i,0,0,r.width,r.height),!(t.maxWidth>0||t.maxHeight>0)){e.next=12;break}return s=new z,e.next=9,s.resize(r,o,t.maxWidth,t.maxHeight);case 9:n(r),e.next=13;break;case 12:n(r);case 13:URL.revokeObjectURL(i.src);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_videoElement",value:function(e){var t=document.createElement("video");return t.src=URL.createObjectURL(e),t.preload="none",t.currentTime=this.timestamp/1e3,t.load(),t}}]),e}(),K=function(){function e(t){Object(k.a)(this,e),this.data=void 0,this.data=t}return Object(y.a)(e,[{key:"name",get:function(){return this.data.name}},{key:"extension",get:function(){return this.data.extension}},{key:"base64",value:function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.base64();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.dataUrl();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pngBlob",value:function(){var e=Object(s.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(d.a.mark((function e(n,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=createImageBitmap,e.next=4,t.blob();case 4:e.t1=e.sent,(0,e.t0)(e.t1).then((function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toBlob((function(e){e?n(e):a("Failed to convert to PNG")}),"image/png")})),e.next=11;break;case 8:e.prev=8,e.t2=e.catch(0),a(e.t2);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:N(e.sent,this.data.name);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"fromBase64",value:function(t,n,a,i){var r=t.substring(0,t.lastIndexOf("."))+"_"+Math.floor(n)+"."+i;return new e(new V(r,a,i))}},{key:"fromFile",value:function(t,n,a,i){return new e(new q(t,n,a,i))}}]),e}(),G=function(){function e(){Object(k.a)(this,e)}return Object(y.a)(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=Object(s.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"POST",body:JSON.stringify(n)});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}]),e}(),X=['"',"*","_","\\",":"];var J,Q,Y,Z=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new G;Object(k.a)(this,e),this.settingsProvider=void 0,this.fetcher=void 0,this.settingsProvider=t,this.fetcher=n}return Object(y.a)(e,[{key:"deckNames",value:function(){var e=Object(s.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("deckNames",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelNames",value:function(){var e=Object(s.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("modelNames",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelFieldNames",value:function(){var e=Object(s.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("modelFieldNames",{modelName:t},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findNotesWithWord",value:function(){var e=Object(s.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("findNotes",{query:this.settingsProvider.wordField+":"+this._escapeQuery(t)},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findNotesWithWordGui",value:function(){var e=Object(s.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("guiBrowse",{query:this.settingsProvider.wordField+":"+this._escapeQuery(t)},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_escapeQuery",value:function(e){for(var t="",n=0;n<e.length;++n){var a=e[n];X.includes(a)?t+="\\".concat(a):t+=a}return'"'.concat(t,'"')}},{key:"requestPermission",value:function(){var e=Object(s.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("requestPermission",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"export",value:function(){var e=Object(s.a)(d.a.mark((function e(t,n,a,i,r,o,s,c,u,l,b){var f,h,p,v,g,j,O,m,k,y,x,S,C,w,T,F,P;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f={},this._appendField(f,this.settingsProvider.sentenceField,t,!0),this._appendField(f,this.settingsProvider.definitionField,n,!0),this._appendField(f,this.settingsProvider.wordField,r,!1),this._appendField(f,this.settingsProvider.sourceField,o,!1),this._appendField(f,this.settingsProvider.urlField,s,!1),c)for(h=0,p=Object.keys(c);h<p.length;h++)v=p[h],this._appendField(f,this.settingsProvider.customAnkiFields[v],c[v],!0);if(g={note:{deckName:this.settingsProvider.deck,modelName:this.settingsProvider.noteType,tags:u,options:{allowDuplicate:!1,duplicateScope:"deck",duplicateScopeOptions:{deckName:this.settingsProvider.deck,checkChildren:!1}}}},j="gui"===l,O="updateLast"===l,!this.settingsProvider.audioField||!a){e.next=31;break}if(m=this._sanitizeFileName(a.name),!j&&!O){e.next=25;break}return e.t0=this,e.t1=m,e.next=17,a.base64();case 17:return e.t2=e.sent,e.t3=b,e.next=21,e.t0._storeMediaFile.call(e.t0,e.t1,e.t2,e.t3);case 21:k=e.sent.result,this._appendField(f,this.settingsProvider.audioField,"[sound:".concat(k,"]"),!1),e.next=31;break;case 25:return e.t4=m,e.next=28,a.base64();case 28:e.t5=e.sent,e.t6=[this.settingsProvider.audioField],g.note.audio={filename:e.t4,data:e.t5,fields:e.t6};case 31:if(!this.settingsProvider.imageField||!i){e.next=52;break}if(y=this._sanitizeFileName(i.name),!j&&!O){e.next=46;break}return e.t7=this,e.t8=y,e.next=38,i.base64();case 38:return e.t9=e.sent,e.t10=b,e.next=42,e.t7._storeMediaFile.call(e.t7,e.t8,e.t9,e.t10);case 42:x=e.sent.result,this._appendField(f,this.settingsProvider.imageField,'<div><img src="'.concat(x,'"></div>'),!1),e.next=52;break;case 46:return e.t11=y,e.next=49,i.base64();case 49:e.t12=e.sent,e.t13=[this.settingsProvider.imageField],g.note.picture={filename:e.t11,data:e.t12,fields:e.t13};case 52:g.note.fields=f,e.t14=l,e.next="gui"===e.t14?56:"updateLast"===e.t14?59:"default"===e.t14?81:84;break;case 56:return e.next=58,this._executeAction("guiAddCards",g,b);case 58:return e.abrupt("return",e.sent.result);case 59:return e.next=61,this._executeAction("findNotes",{query:"added:1"},b);case 61:if(0!==(S=e.sent.result.sort()).length){e.next=64;break}throw new Error("Could not find note to update");case 64:return C=S[S.length-1],g.note.id=C,e.next=68,this._executeAction("notesInfo",{notes:[C]});case 68:if(!((w=e.sent).result.length>0&&w.result[0].noteId===C)){e.next=80;break}return F=w.result[0],this.settingsProvider.sentenceField&&F.fields&&"string"===typeof(null===(T=F.fields[this.settingsProvider.sentenceField])||void 0===T?void 0:T.value)&&"string"===typeof g.note.fields[this.settingsProvider.sentenceField]&&(g.note.fields[this.settingsProvider.sentenceField]=this._inheritHtmlMarkup(g.note.fields[this.settingsProvider.sentenceField],F.fields[this.settingsProvider.sentenceField].value)),e.next=74,this._executeAction("updateNoteFields",g,b);case 74:if(this.settingsProvider.wordField&&F.fields){e.next=76;break}return e.abrupt("return",F.noteId);case 76:if((P=F.fields[this.settingsProvider.wordField])&&P.value){e.next=79;break}return e.abrupt("return",F.noteId);case 79:return e.abrupt("return",P.value);case 80:throw new Error("Could not update last card because the card info could not be fetched");case 81:return e.next=83,this._executeAction("addNote",g,b);case 83:return e.abrupt("return",e.sent.result);case 84:throw new Error("Unknown export mode: "+l);case 85:case"end":return e.stop()}}),e,this)})));return function(t,n,a,i,r,o,s,c,u,l,d){return e.apply(this,arguments)}}()},{key:"_appendField",value:function(e,t,n,a){if(t&&n){var i=a?n.split("\n").join("<br>"):n,r=e[t];r&&(i=r+"<br>"+i),e[t]=i}}},{key:"_sanitizeFileName",value:function(e){return P()(e,{replacement:"_"})}},{key:"_inheritHtmlMarkup",value:function(e,t){for(var n=RegExp("<[^>]*>(.*?)</[^>]*>","ig"),a=t.replace("<br>",""),i=e;;){var r=n.exec(a);if(null===r||r.length<2)break;i=i.replace(r[1],r[0])}return i}},{key:"_storeMediaFile",value:function(){var e=Object(s.a)(d.a.mark((function e(t,n,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAction("storeMediaFile",{filename:t,data:n},a));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"_executeAction",value:function(){var e=Object(s.a)(d.a.mark((function e(t,n,a){var i,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={action:t,version:6},n&&(i.params=n),e.next=4,this.fetcher.fetch(a||this.settingsProvider.ankiConnectUrl,i);case 4:if(!(r=e.sent).error){e.next=7;break}throw new Error(r.error);case 7:return e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()}]),e}();!function(e){e[e.none=0]="none",e[e.showAnkiDialog=1]="showAnkiDialog",e[e.updateLastCard=2]="updateLastCard"}(J||(J={})),function(e){e[e.atStart=1]="atStart",e[e.atEnd=2]="atEnd"}(Q||(Q={})),function(e){e[e.normal=1]="normal",e[e.condensed=2]="condensed",e[e.autoPause=3]="autoPause"}(Y||(Y={}));var $=n(148),ee=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Object(k.a)(this,e),this.tree=void 0,this.gapsTree=void 0,this.options=void 0,this.tree=new $.a,this.options=n,n.returnLastShown||n.returnNextToShow){var a;this.gapsTree=new $.a,t.length>0&&t[0].start>0&&this.gapsTree.insert([0,t[0].start-1],t[0]);var r,o=Object(i.a)(t);try{for(o.s();!(r=o.n()).done;){var s=r.value;this.tree.insert([s.start,s.end],s),void 0!==a&&a.end<s.start&&this.gapsTree.insert([a.end+1,s.start-1],a),a=s}}catch(d){o.e(d)}finally{o.f()}}else{var c,u=Object(i.a)(t);try{for(u.s();!(c=u.n()).done;){var l=c.value;this.tree.insert([l.start,l.end],l)}}catch(d){u.e(d)}finally{u.f()}}}return Object(y.a)(e,[{key:"subtitlesAt",value:function(e){var t,n,a,r,o=[e,e],s=this.tree.search(o);if(0===s.length){if(void 0!==this.gapsTree){var c=[];if(t=this.gapsTree.search(o,(function(e,t){return c.push(t),e})),t.length>0&&this.options.returnNextToShow){var u=c[0].high+1;n=this.tree.search([u,u])}}}else if(void 0!==this.options.showingCheckRadiusMs){var l,d=Object(i.a)(s);try{for(d.s();!(l=d.n()).done;){var b=l.value;if(void 0===r&&b.end<e+this.options.showingCheckRadiusMs&&(r=b),void 0===a&&e-this.options.showingCheckRadiusMs<b.start&&(a=b),void 0!==a&&void 0!==r)break}}catch(f){d.e(f)}finally{d.f()}}return{showing:s,lastShown:t,nextToShow:n,startedShowing:a,willStopShowing:r}}}],[{key:"empty",value:function(){return e.emptySubtitleCollection}}]),e}();ee.emptySubtitleCollection=new ee([]);var te=function(){function e(){Object(k.a)(this,e),this.lastStartedShowing=void 0,this.lastWillStopShowing=void 0,this.onStartedShowing=void 0,this.onWillStopShowing=void 0,this.onNextToShow=void 0}return Object(y.a)(e,[{key:"willStopShowing",value:function(e){var t,n;e.end!==(null===(t=this.lastWillStopShowing)||void 0===t?void 0:t.end)&&(null===(n=this.onWillStopShowing)||void 0===n||n.call(this),this.lastWillStopShowing=e)}},{key:"startedShowing",value:function(e){var t,n;e.start!==(null===(t=this.lastStartedShowing)||void 0===t?void 0:t.start)&&(null===(n=this.onStartedShowing)||void 0===n||n.call(this),this.lastStartedShowing=e)}},{key:"clear",value:function(){this.lastStartedShowing=void 0,this.lastWillStopShowing=void 0}}]),e}(),ne=n(451),ae=n(6),ie=n(450),re=n(371),oe=n(1),se=Object(v.a)({root:{display:"flex",justifyContent:"center",position:"fixed",top:80,width:"100%",pointerEvents:"none",zIndex:2e3}});function ce(e){var t=se();return Object(b.useEffect)((function(){if(e.open){var t=setTimeout(e.onClose,e.autoHideDuration);return function(){return clearTimeout(t)}}}),[e.open,e.autoHideDuration,e.onClose]),Object(oe.jsx)("div",{className:t.root,children:Object(oe.jsx)(re.a,{in:e.open,children:Object(oe.jsx)(ie.a,{severity:e.severity,children:e.children})})})}var ue=n(5),le=n(418),de=["tags","onTagsChange"];function be(e){var t=e.tags,n=e.onTagsChange,a=Object(ue.a)(e,de),r=Object(b.useState)(""),s=Object(c.a)(r,2),u=s[0],l=s[1];Object(b.useEffect)((function(){t.join(", ")!==u&&l(t.join(", "))}),[u,t]);var d=Object(b.useCallback)((function(e){var t=e.target.value;u.length>t.length&&u.includes(t)&&t.endsWith(",")&&(t=t.substring(0,t.length-1));var a=function(e){var t,n=e.split(" ").join("").split(","),a=[],r=Object(i.a)(n);try{for(r.s();!(t=r.n()).done;){var o=t.value;a.push(o.trim())}}catch(s){r.e(s)}finally{r.f()}return a}(t);l(a.join(", ")),n(a)}),[u,n]);return Object(oe.jsx)(le.a,Object(o.a)(Object(o.a)({},a),{},{value:u,onChange:d}))}var fe=n(240),he=n(423),pe=n(424),ve=n(422),ge=Object(fe.a)((function(e){return{image:function(e){return{width:e.width,height:e.height,backgroundSize:"contain"}}}}));function je(e){var t,n=e.open,a=e.image,i=e.onClose,r=Object(b.useState)(),o=Object(c.a)(r,2),u=o[0],l=o[1],f=Object(b.useState)(0),h=Object(c.a)(f,2),p=h[0],v=h[1],g=Object(b.useState)(0),j=Object(c.a)(g,2),O=j[0],m=j[1],k=function(){var e=Object(b.useState)([0,0]),t=Object(c.a)(e,2),n=t[0],a=t[1];return Object(b.useLayoutEffect)((function(){function e(){a([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),n}(),y=Object(c.a)(k,2),x=y[0],S=y[1];t=p>0&&O>0?Math.min(1,Math.min(x/(2*p),S/(2*O))):1;var C=ge({width:p*t,height:O*t});return Object(b.useEffect)((function(){function e(){return e=Object(s.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,a.dataUrl();case 4:t=e.sent,(n=new Image).onload=function(){v(n.width),m(n.height),l(t)},n.src=t;case 8:case"end":return e.stop()}}),e)}))),e.apply(this,arguments)}l(void 0),function(){e.apply(this,arguments)}()}),[a]),a&&u?Object(oe.jsx)(ve.a,{open:n,onClose:i,maxWidth:"lg",children:Object(oe.jsx)(he.a,{children:Object(oe.jsx)(pe.a,{className:C.image,image:u,title:a.name,style:{width:p*t,height:O*t}})})}):null}var Oe=n(149),me=n.n(Oe),ke=n(196),ye=n.n(ke),xe=n(431),Se=n(119),Ce=n.n(Se),we=n(430),Te=n(428),Fe=n(198),Pe=n.n(Fe),Re=n(197),Ee=n.n(Re),Me=n(429),_e=n(374),Be=n(426),Ae=n(125),Ie=n(200),Ne=n.n(Ie),De=n(199),Le=n.n(De),We=n(118),Ue=n.n(We),He=n(455),ze=n(427),Ve=n(453),qe=n(60),Ke=n(201),Ge=n.n(Ke),Xe=n(202),Je=n.n(Xe);function Qe(e){var t=e.subtitle,n=e.availableWidth,a=e.scale;if(void 0===t.textImage)return null;var i=a*n/t.textImage.screen.width*t.textImage.image.width;return Object(oe.jsx)("div",{style:{maxWidth:i},children:Object(oe.jsx)("img",{style:{width:"100%"},alt:"subtitle",src:t.textImage.dataUrl})})}var Ye=me()((function(e){return{root:{"& .MuiTextField-root":{marginBottom:e.spacing(1)}},title:{flexGrow:1},mediaField:{cursor:"pointer","& input":{cursor:"pointer"}},rangeSelectSlider:{"& .MuiSlider-markLabel":{transform:"translateX(-3%)"}}}}));function Ze(e,t){var n={};return e.subtitles.filter((function(e){return""!==e.text.trim()||void 0!==e.textImage})).map((function(e){return e.start in n?null:(n[e.start]=!0,{value:e.start,label:"".concat(e.text.trim().substring(0,Math.min(e.text.length,3)),"...")})})).filter((function(e){return null!==e})).filter((function(e){return e.value>=t[0]&&e.value<=t[1]}))}function $e(e){return R(e,!0)}function et(e){var t=e.children,n=e.open,a=e.value;return Object(oe.jsx)(Ve.a,{open:n,enterTouchDelay:0,placement:"top",title:a,children:t})}var tt=me()((function(e){return{root:{marginBottom:e.spacing(1),padding:e.spacing(1),backgroundColor:e.palette.action.disabledBackground}}}));function nt(e){var t=e.selectedSubtitles,n=e.width,a=tt();return 0===t.length||n<=0?null:Object(oe.jsx)(Ae.a,{elevation:0,className:a.root,children:t.map((function(e,t){return Object(oe.jsx)(Qe,{availableWidth:n,subtitle:e,scale:1},t)}))})}var at=ye()({root:{transform:"translateY(-8px)"}})(Be.a);function it(e){var t=e.open,n=e.disabled,a=e.text,r=e.onProceed,o=e.onRewind,u=e.onCancel,l=e.onViewImage,f=e.onOpenSettings,h=e.onRerecord,p=e.audioClip,v=e.image,g=e.source,j=e.url,O=e.sliderContext,m=e.customFields,k=e.settingsProvider,y=e.anki,x=e.definition,S=e.word,C=e.customFieldValues,w=e.timestampInterval,T=e.timestampBoundaryInterval,F=e.initialTimestampInterval,P=e.lastAppliedTimestampIntervalToText,R=e.lastAppliedTimestampIntervalToAudio,M=e.stateRef,_=Ye(),I=Object(b.useState)(""),N=Object(c.a)(I,2),D=N[0],L=N[1],W=Object(b.useState)(""),U=Object(c.a)(W,2),H=U[0],z=U[1],V=Object(b.useState)(""),q=Object(c.a)(V,2),K=q[0],G=q[1],X=Object(b.useState)(),J=Object(c.a)(X,2),Q=J[0],Y=J[1],Z=Object(b.useState)(null!==g&&void 0!==g?g:""),$=Object(c.a)(Z,2),ee=$[0],te=$[1],ne=Object(b.useState)(k.tags),ae=Object(c.a)(ne,2),ie=ae[0],re=ae[1],se=Object(b.useState)(null!==j&&void 0!==j?j:""),ce=Object(c.a)(se,2),ue=ce[0],de=ce[1],fe=Object(b.useState)([]),he=Object(c.a)(fe,2),pe=he[0],ge=he[1],je=Object(b.useState)(0),Oe=Object(c.a)(je,2),me=Oe[0],ke=Oe[1],ye=Object(b.useState)({}),Se=Object(c.a)(ye,2),Fe=Se[0],Re=Se[1],Ae=Object(b.useState)(),Ie=Object(c.a)(Ae,2),De=Ie[0],We=Ie[1],Ke=Object(b.useState)([]),Xe=Object(c.a)(Ke,2),Qe=Xe[0],tt=Xe[1],it=Object(b.useState)(),rt=Object(c.a)(it,2),ot=rt[0],st=rt[1],ct=Object(b.useState)(),ut=Object(c.a)(ct,2),lt=ut[0],dt=ut[1],bt=Object(b.useState)(),ft=Object(c.a)(bt,2),ht=ft[0],pt=ft[1],vt=Object(b.useState)(),gt=Object(c.a)(vt,2),jt=gt[0],Ot=gt[1],mt=Object(b.useState)(),kt=Object(c.a)(mt,2),yt=kt[0],xt=kt[1],St=Object(b.useState)(),Ct=Object(c.a)(St,2),wt=Ct[0],Tt=Ct[1],Ft=Object(b.useState)(0),Pt=Object(c.a)(Ft,2),Rt=Pt[0],Et=Pt[1],Mt=Object(b.useState)(),_t=Object(c.a)(Mt,2),Bt=_t[0],At=_t[1],It=Object(b.useCallback)((function(e){var t;Et(null!==(t=null===e||void 0===e?void 0:e.getBoundingClientRect().width)&&void 0!==t?t:0)}),[]);M&&(M.current={text:H,sliderContext:O,definition:D,word:K,source:ee,url:ue,customFieldValues:Fe,initialTimestampInterval:ot,timestampBoundaryInterval:ht,lastAppliedTimestampIntervalToText:yt,lastAppliedTimestampIntervalToAudio:wt,timestampInterval:De});var Nt=Object(b.useCallback)((function(e){return A(O.subtitles.filter((function(t){return B(t,e)})))}),[O]);Object(b.useEffect)((function(){z(null!==a&&void 0!==a?a:""),L(null!==x&&void 0!==x?x:""),G(null!==S&&void 0!==S?S:""),te(null!==g&&void 0!==g?g:""),de(null!==j&&void 0!==j?j:""),ge([]),Re(null!==C&&void 0!==C?C:{})}),[a,g,x,S,C,j]),Object(b.useEffect)((function(){re(k.tags)}),[k.tags]),Object(b.useEffect)((function(){var e=w||O&&[O.subtitleStart,O.subtitleEnd]||void 0,t=O&&function(e){var t=e.subtitles.findIndex((function(t){return t.start===e.subtitleStart}));t=-1===t?e.subtitles.length/2:t;var n,a=E(e.subtitles,t,1,5e3),r=null,o=null,s=Object(i.a)(a);try{for(s.s();!(n=s.n()).done;){var c=n.value;(null===r||c.start<r)&&(r=c.start),(null===o||c.end>o)&&(o=c.end)}}catch(u){s.e(u)}finally{s.f()}return null!==r&&null!==o&&[r,o]}(O)||void 0,n=O&&Ze(O,t)||void 0,r=void 0===O||void 0===e?[]:O.subtitles.filter((function(t){return B(t,e)}));z(null!==a&&void 0!==a?a:A(r)),We(e),tt(r),st(F||e),xt(P||e),Tt(R||e),pt(null!==T&&void 0!==T?T:t),dt(t),Ot(n)}),[O,F,w,T,P,R]),Object(b.useEffect)((function(){if(p){var e=p;k.preferMp3&&(e=e.toMp3()),wt&&(e=e.slice(Math.max(0,Math.round(wt[0])-k.audioPaddingStart),Math.round(wt[1])+k.audioPaddingEnd)),At(e)}else At(void 0)}),[p,k.preferMp3,wt,k.audioPaddingStart,k.audioPaddingEnd]),Object(b.useEffect)((function(){ke(Date.now())}),[K]),Object(b.useEffect)((function(){if(K&&k.wordField){var e=K.trim();if(""!==e&&e!==Q){var t=setTimeout(Object(s.a)(d.a.mark((function t(){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=ge,t.next=4,y.findNotesWithWord(e);case 4:t.t1=t.sent,(0,t.t0)(t.t1),Y(e),t.next=12;break;case 9:t.prev=9,t.t2=t.catch(0),console.error(t.t2);case 12:case"end":return t.stop()}}),t,null,[[0,9]])}))),500);return function(){return clearTimeout(t)}}}}),[K,me,Q,y,k.wordField]);var Dt,Lt=Object(b.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),Bt.play()}),[Bt]),Wt=Object(b.useCallback)((function(e,t){var n={};Object.assign(n,Fe),n[e]=t,Re(n)}),[Fe]);Dt=K&&K.trim()===Q&&k.wordField?pe.length>0?"Found ".concat(pe.length,' notes with word "').concat(K,'" in field "').concat(k.wordField,'"'):'No notes found with word "'.concat(K.trim(),'" in field "').concat(k.wordField,'"'):"";var Ut=Object(b.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),l(v)}),[v,l]),Ht=Object(b.useCallback)((function(){if(void 0!==De){var e=Nt(De);z(e),xt(De)}}),[Nt,De]),zt=Object(b.useCallback)((function(e,t){var n=t;We(n);var a=O.subtitles.filter((function(e){return B(e,n)}));if(tt(a),void 0!==yt){var i=Nt(yt);if(H.trim()===i.trim()){var r=Nt(n);z(r),xt(n)}}void 0===h&&!0===(null===Bt||void 0===Bt?void 0:Bt.isSliceable())&&Tt(n)}),[O,H,yt,Nt]),Vt=Object(b.useCallback)((function(e){h?(e.stopPropagation(),h()):Tt(De)}),[h,De]),qt=Object(b.useCallback)((function(){if(lt){var e=void 0===O||void 0===ot?[]:O.subtitles.filter((function(e){return B(e,ot)}));tt(e),We(ot),pt(lt),Ot(O&&Ze(O,lt))}}),[ot,lt,O]),Kt=Object(b.useCallback)((function(){if(ht&&De){var e=[(ht[0]+De[0])/2,(ht[1]+De[1])/2];pt(e),Ot(O&&Ze(O,e))}}),[ht,De,O]),Gt=Object(b.useCallback)((function(){if(ht&&De){var e=(ht[1]-ht[0])/4,t=[Math.max(0,Math.min(ht[0]-e,2*ht[0]-De[0])),Math.max(ht[1]+e,2*ht[1]-De[1])];pt(t),Ot(O&&Ze(O,t))}}),[ht,De,O]),Xt=Object(b.useCallback)(function(){var e=Object(s.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),v){e.next=3;break}return e.abrupt("return");case 3:return e.t0=navigator.clipboard,e.t1=ClipboardItem,e.next=7,v.pngBlob();case 7:e.t2=e.sent,e.t3={"image/png":e.t2},e.t4=new e.t1(e.t3),e.t5=[e.t4],e.t0.write.call(e.t0,e.t5);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[v]),Jt=!O||0===O.subtitles.filter((function(e){return""!==e.text.trim()})).length,Qt=void 0;return void 0!==h&&(Qt=Object(oe.jsx)(Ve.a,{title:"Apply Selection (rerecord)",children:Object(oe.jsx)("span",{children:Object(oe.jsx)(_e.a,{disabled:!De||!wt||De[0]===wt[0]&&De[1]===wt[1],onClick:Vt,edge:"end",children:Object(oe.jsx)(Ee.a,{})})})})),Object(oe.jsxs)(ve.a,{open:t,disableEnforceFocus:!0,fullWidth:!0,maxWidth:"sm",onClose:u,children:[Object(oe.jsxs)(ze.a,{children:[Object(oe.jsx)(qe.a,{variant:"h6",className:_.title,children:"Anki Export"}),f&&Object(oe.jsx)(_e.a,{edge:"end",onClick:function(){return f()},children:Object(oe.jsx)(Ue.a,{})})]}),Object(oe.jsx)(Te.a,{ref:It,children:Object(oe.jsxs)("form",{className:_.root,children:[O&&De&&Object(oe.jsx)(nt,{selectedSubtitles:Qe.filter((function(e){return void 0!==e.textImage})),width:Rt}),Object(oe.jsx)(le.a,{variant:"filled",color:"secondary",multiline:!0,fullWidth:!0,maxRows:8,label:"Sentence",value:H,onChange:function(e){return z(e.target.value)},InputProps:{endAdornment:De&&Object(oe.jsx)(at,{position:"end",children:Object(oe.jsx)(Ve.a,{title:"Apply Selection",children:Object(oe.jsx)("span",{children:Object(oe.jsx)(_e.a,{disabled:!De||!yt||De[0]===yt[0]&&De[1]===yt[1]||Jt,onClick:Ht,edge:"end",children:Object(oe.jsx)(Pe.a,{})})})})})}}),Object(oe.jsx)(le.a,{variant:"filled",color:"secondary",multiline:!0,fullWidth:!0,rows:8,label:"Definition",value:D,onChange:function(e){return L(e.target.value)}}),Object(oe.jsx)(le.a,{variant:"filled",color:"secondary",fullWidth:!0,label:"Word",value:K,onChange:function(e){return G(e.target.value)},helperText:Dt,InputProps:{endAdornment:Object(oe.jsx)(Be.a,{position:"end",children:Object(oe.jsx)(Ve.a,{title:"Search in Anki",children:Object(oe.jsx)("span",{children:Object(oe.jsx)(_e.a,{disabled:n||!k.wordField||!K||""===K.trim(),onClick:function(){return y.findNotesWithWordGui(K.trim())},edge:"end",children:Object(oe.jsx)(Le.a,{})})})})})}}),Object.keys(m).map((function(e){return Object(oe.jsx)(le.a,{variant:"filled",color:"secondary",fullWidth:!0,multiline:!0,maxRows:8,label:e,value:Fe[e]||"",onChange:function(t){return Wt(e,t.target.value)}},e)})),Bt&&Object(oe.jsx)("div",{className:_.mediaField,onClick:Lt,children:Object(oe.jsx)(le.a,{variant:"filled",color:"secondary",fullWidth:!0,value:Bt.name,label:"Audio",helperText:void 0===h&&!Bt.isSliceable()&&"Audio clip cannot be updated because it is pre-recorded",InputProps:{endAdornment:Qt&&De&&Object(oe.jsx)(Be.a,{position:"end",children:Qt})}})}),v&&Object(oe.jsx)("div",{className:_.mediaField,onClick:Ut,children:Object(oe.jsx)(le.a,{variant:"filled",color:"secondary",fullWidth:!0,value:v.name,label:"Image",InputProps:{endAdornment:Object(oe.jsx)(Be.a,{position:"end",children:Object(oe.jsx)(Ve.a,{title:"Copy to Clipboard",children:Object(oe.jsx)("span",{children:Object(oe.jsx)(_e.a,{onClick:Xt,edge:"end",children:Object(oe.jsx)(Ce.a,{})})})})})}})}),Object(oe.jsx)(le.a,{variant:"filled",color:"secondary",fullWidth:!0,label:"Source",value:ee,onChange:function(e){return te(e.target.value)}}),j&&Object(oe.jsx)(le.a,{variant:"filled",color:"secondary",fullWidth:!0,label:"URL",value:ue,onChange:function(e){return de(e.target.value)}}),k.tags.length>0&&Object(oe.jsx)(be,{variant:"filled",label:"Tags",helperText:"Comma-separated list of strings",fullWidth:!0,color:"secondary",tags:ie,onTagsChange:function(e){return re(e)}}),De&&ht&&jt&&Object(oe.jsxs)(Me.a,{container:!0,direction:"row",children:[Object(oe.jsx)(Me.a,{item:!0,style:{flexGrow:1},children:Object(oe.jsx)(He.a,{ValueLabelComponent:et,value:De,valueLabelFormat:$e,onChange:zt,min:ht[0],max:ht[1],marks:jt,step:1,valueLabelDisplay:"auto",className:_.rangeSelectSlider,color:"secondary"})}),Object(oe.jsx)(Me.a,{item:!0,children:Object(oe.jsx)(Ve.a,{title:"Reset",children:Object(oe.jsx)("span",{children:Object(oe.jsx)(_e.a,{edge:"end",style:{marginTop:-8},onClick:qt,children:Object(oe.jsx)(Ne.a,{})})})})}),Object(oe.jsx)(Me.a,{item:!0,children:Object(oe.jsx)(Ve.a,{title:"Zoom In",children:Object(oe.jsx)("span",{children:Object(oe.jsx)(_e.a,{edge:"end",style:{marginTop:-8},onClick:Kt,children:Object(oe.jsx)(Ge.a,{})})})})}),Object(oe.jsx)(Me.a,{item:!0,children:Object(oe.jsx)(Ve.a,{title:"Zoom Out",children:Object(oe.jsx)("span",{children:Object(oe.jsx)(_e.a,{edge:"end",style:{marginTop:-8},onClick:Gt,children:Object(oe.jsx)(Je.a,{})})})})})]})]})}),Object(oe.jsxs)(we.a,{children:[Object(oe.jsx)(xe.a,{disabled:n,onClick:function(){return u()},children:"Cancel"}),O&&Object(oe.jsx)(xe.a,{disabled:n,onClick:function(){return o()},children:"Rewind"}),Object(oe.jsx)(xe.a,{disabled:n,onClick:function(){return r(H,D,Bt,v,K,null!==ee&&void 0!==ee?ee:"",null!==ue&&void 0!==ue?ue:"",Fe,ie,"gui")},children:"Open in Anki"}),Object(oe.jsx)(xe.a,{disabled:n,onClick:function(){return r(H,D,Bt,v,K,null!==ee&&void 0!==ee?ee:"",null!==ue&&void 0!==ue?ue:"",Fe,ie,"updateLast")},children:"Update Last Card"}),Object(oe.jsx)(xe.a,{disabled:n,onClick:function(){return r(H,D,Bt,v,K,null!==ee&&void 0!==ee?ee:"",null!==ue&&void 0!==ue?ue:"",Fe,ie,"default")},children:"Export"})]})]})}var rt=n(448),ot=n(238),st=n.p+"static/media/background-colored.cbc50e45.png",ct=Object(fe.a)((function(e){return{root:function(e){var t=e.dragging;return{position:"absolute",height:e.appBarHidden?"100%":"calc(100% - 64px)",width:"100%",zIndex:101,pointerEvents:t?"auto":"none"}},transparentBackground:function(e){return{"&::before":{content:"' '",position:"absolute",height:e.appBarHidden?"100vh":"calc(100vh - 64px)",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",backgroundSize:"300px 300px",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundImage:"url(".concat(st,")"),backgroundBlendMode:"overlay",background:"rgba(0, 0, 0, .3)",filter:"drop-shadow(10px 10px 10px rgb(0, 0, 0, .4))"},width:"100%",height:"100%"}}}}));function ut(e){var t=e.dragging,n=e.appBarHidden,a=e.loading,i=ct({dragging:t,appBarHidden:n});return Object(oe.jsx)("div",{className:i.root,children:Object(oe.jsx)(ot.a,{in:t||a,children:Object(oe.jsx)("div",{className:i.transparentBackground})})})}var lt=n(449),dt=n(150),bt=n(151),ft=n(206),ht=n(207),pt=RegExp("</?([^>]*)>","ig"),vt=RegExp(/\\[nN]/,"ig"),gt=document.createElement("div"),jt=document.createElement("canvas"),Ot=function(){function e(t){Object(k.a)(this,e),this._textFilter=void 0,this.xmlParser=void 0,this._textFilter=t}return Object(y.a)(e,[{key:"subtitles",value:function(){var e=Object(s.a)(d.a.mark((function e(t,n){var a=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e,t){return a._subtitles(e,!0===n?0:t)})));case 2:return e.abrupt("return",e.sent.flatMap((function(e){return e})).sort((function(e,t){return e.start-t.start})));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_subtitles",value:function(){var e=Object(s.a)(d.a.mark((function e(t,n){var a,r,o,c,u,l,b,f,h,p,v,g,j,O,m,k,y,x,S,C,w,T,F=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.name.endsWith(".srt")){e.next=7;break}return e.t0=dt.a,e.next=4,t.text();case 4:return e.t1=e.sent,a=(0,e.t0)(e.t1),e.abrupt("return",a.filter((function(e){return"cue"===e.type})).map((function(e){var t=e.data;return{start:t.start,end:t.end,text:F._filterText(t.text).replace(pt,""),track:n}})));case 7:if(!t.name.endsWith(".vtt")&&!t.name.endsWith(".nfvtt")){e.next=9;break}return e.abrupt("return",new Promise(function(){var e=Object(s.a)(d.a.mark((function e(a,r){var o,s,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.name.endsWith(".nfvtt"),s=new bt.WebVTT.Parser(window,bt.WebVTT.StringDecoder()),c=[],s.oncue=function(e){if(e.text=F._filterText(e.text).replace(pt,""),o){var t,n=e.text.split("\n"),a=[],r=Object(i.a)(n);try{for(r.s();!(t=r.n()).done;){var s=t.value;a.push(F._fixRTL(s))}}catch(u){r.e(u)}finally{r.f()}e.text=a.join("\n")}c.push(e)},s.onflush=function(){return a(c.map((function(e){return{start:Math.floor(1e3*e.startTime),end:Math.floor(1e3*e.endTime),text:e.text,track:n}})))},e.t0=s,e.next=8,t.text();case 8:e.t1=e.sent,e.t0.parse.call(e.t0,e.t1),s.flush();case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 9:if(!t.name.endsWith(".ass")){e.next=17;break}return e.t2=lt.a,e.next=13,t.text();case 13:return e.t3=e.sent,e.t4={},r=(0,e.t2)(e.t3,e.t4),e.abrupt("return",r.dialogues.map((function(e){return{start:Math.round(1e3*e.start),end:Math.round(1e3*e.end),text:F._filterText(e.slices.flatMap((function(e){return e.fragments.map((function(e){return e.text}))})).join("")).replace(vt,"\n"),track:n}})));case 17:if(!t.name.endsWith(".ytxml")){e.next=37;break}return e.next=20,t.text();case 20:if(o=e.sent,c=this._xmlParser().parse(o),0!==Object.keys(c).length){e.next=24;break}return e.abrupt("return",[]);case 24:u=c.transcript.text,l=[],b=0,f=u.length;case 27:if(!(b<f)){e.next=36;break}if("#text"in(h=u[b])&&"@_dur"in h&&"@_start"in h){e.next=31;break}return e.abrupt("continue",33);case 31:p=parseFloat(h["@_start"]),l.push({start:Math.floor(1e3*p),end:Math.floor(1e3*(p+parseFloat(h["@_dur"]))),text:this._filterText(this._decodeHTML(String(h["#text"])).replace(pt,"")),track:n});case 33:b++,e.next=27;break;case 36:return e.abrupt("return",l);case 37:if(!t.name.endsWith(".sup")){e.next=42;break}return v=[],e.next=41,t.stream().pipeThrough(Object(ht.parseDisplaySets)()).pipeTo(this._displaySetsToSubtitles(v,n));case 41:return e.abrupt("return",v);case 42:if(!t.name.endsWith(".dfxp")&&!t.name.endsWith("ttml2")){e.next=62;break}return e.next=45,t.text();case 45:g=e.sent,j=new DOMParser,O=j.parseFromString(g,"application/xml"),m=this._xmlNodePath(O.documentElement,["body","div"]),k=[],y=0,x=m.length;case 51:if(!(y<x)){e.next=61;break}if(C=m[y],w=C.getAttribute("begin"),T=C.getAttribute("end"),null!==w&&null!==T){e.next=57;break}return e.abrupt("continue",58);case 57:k.push({text:this._filterText(null!==(S=C.textContent)&&void 0!==S?S:""),start:this._parseTtmlTimestamp(w),end:this._parseTtmlTimestamp(T),track:n});case 58:y++,e.next=51;break;case 61:return e.abrupt("return",k);case 62:throw new Error("Unsupported subtitle file format");case 63:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_parseTtmlTimestamp",value:function(e){var t=e.split(":");return Math.floor(1e3*parseFloat(t[t.length-1]))+6e4*(t.length<2?0:Number(t[t.length-2]))+36e5*(t.length<3?0:Number(t[t.length-3]))}},{key:"_xmlNodePath",value:function(e,t){if(0===t.length){for(var n=[],a=0;a<e.children.length;++a){var i=e.children[a];n.push(i)}return n}for(var r=0;r<e.children.length;++r){var o=e.children[r];if(this._dropTagNamespace(o.tagName)===t[0])return this._xmlNodePath(o,t.slice(1))}throw new Error("Failied to parse XML path")}},{key:"_dropTagNamespace",value:function(e){var t=e.lastIndexOf(":");return-1!==t?e.substring(t+1):e}},{key:"_displaySetsToSubtitles",value:function(e,t){var n,a;return new WritableStream({write:function(i,r){if(i.objectDefinitionSegments.length>0)void 0===a&&(a=i);else if(void 0!==a){var o,s=a.presentationCompositionSegment.width,c=a.presentationCompositionSegment.height;n=void 0===n||n.length<c*s*4?new Uint8ClampedArray(s*c*4):n;var u=a.imageData(n);jt.width=u.width,jt.height=u.height,jt.getContext("2d").putImageData(u,0,0),e.push({start:null!==(o=a.objectDefinitionSegments[0].header.presentationTimestamp/90)&&void 0!==o?o:0,end:i.endDefinitionSegment.header.presentationTimestamp/90,text:"",textImage:{dataUrl:jt.toDataURL("image/png"),image:{width:u.width,height:u.height},screen:{width:a.presentationCompositionSegment.width,height:a.presentationCompositionSegment.height}},track:t}),a=void 0}}})}},{key:"_fixRTL",value:function(e){var t=e.indexOf("&lrm;"),n=e.indexOf("&rlm;"),a="";return t>-1?(a=e.substring(0,t)+"\u202a"+e.substring(t+5)+"\u202c",this._fixRTL(a)):n>-1?(a=e.substring(0,n)+"\u202b"+e.substring(n+5)+"\u202c",this._fixRTL(a)):e}},{key:"_decodeHTML",value:function(e){var t;return gt.innerHTML=e,null!==(t=gt.textContent)&&void 0!==t?t:gt.innerText}},{key:"_xmlParser",value:function(){return void 0===this.xmlParser&&(this.xmlParser=new ft.XMLParser({ignoreAttributes:!1})),this.xmlParser}},{key:"_filterText",value:function(e){return void 0===this._textFilter?e:e.replace(this._textFilter.regex,this._textFilter.replacement)}},{key:"subtitlesToSrt",value:function(e){var t=e.map((function(e){return{type:"cue",data:{start:e.start,end:e.end,text:e.text}}}));return Object(dt.b)(t,{format:"SRT"})}},{key:"filesToSrt",value:function(){var e=Object(s.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this.subtitles(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.subtitlesToSrt.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),mt=n(432),kt=n(210),yt=n.n(kt),xt=n(209),St=n.n(xt),Ct=n(211),wt=n.n(Ct),Tt=n(208),Ft=n.n(Tt),Pt=n(212),Rt=n.n(Pt),Et=n(421),Mt=n(382),_t=n(419),Bt=["show"],At=Object(v.a)((function(e){return{title:{flexGrow:1},leftButton:{marginRight:e.spacing(1)},appBar:{transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{width:function(e){var t=e.drawerWidth;return"calc(100% - ".concat(t,"px)")},transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:function(e){return e.drawerWidth}},copyHistoryButton:{transform:"scaleX(1)",width:48,padding:12,transition:e.transitions.create(["transform","padding","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},copyHistoryButtonShift:{transform:"scaleX(0)",width:0,padding:5,transition:e.transitions.create(["transform","padding","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},hide:{display:"none"}}})),It=Object(v.a)((function(e){return{tooltip:function(e){return{display:e.show?"block":"none"}}}}));function Nt(e){var t=e.show,n=Object(ue.a)(e,Bt),a=It({show:t});return Object(oe.jsx)(Ve.a,Object(o.a)({classes:a},n))}function Dt(e){var t,n=e.drawerWidth,a=e.drawerOpen,i=e.hidden,r=e.title,o=e.subtitleFiles,s=e.onOpenSettings,l=e.onOpenCopyHistory,d=e.onFileSelector,f=e.onDownloadSubtitleFilesAsSrt,h=At({drawerWidth:n}),p=Object(b.useState)(!1),v=Object(c.a)(p,2),g=v[0],j=v[1],O=Object(b.useState)(),m=Object(c.a)(O,2),k=m[0],y=m[1],x=void 0!==o&&void 0!==o.find((function(e){return!e.name.endsWith(".sup")})),S=Object(b.useCallback)((function(e){x?(y(e.currentTarget),j(!0)):d()}),[d,x]),C=Object(b.useCallback)((function(){j(!1)}),[]),w=Object(b.useCallback)((function(){j(!1),d()}),[d]),T=Object(b.useCallback)((function(){j(!1),f()}),[f]);return Object(oe.jsxs)(oe.Fragment,{children:[x&&Object(oe.jsx)(_t.a,{open:g,anchorEl:k,onClose:C,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:Object(oe.jsxs)(Et.a,{children:[Object(oe.jsx)(Mt.a,{button:!0,onClick:w,children:"Open Files"}),Object(oe.jsx)(Mt.a,{button:!0,onClick:T,children:"Download Subtitles as SRT"})]})}),Object(oe.jsx)(mt.a,{position:"static",elevation:0,className:Object(ae.a)(h.appBar,(t={},Object(u.a)(t,h.appBarShift,a),Object(u.a)(t,h.hide,i),t)),children:Object(oe.jsxs)(ze.a,{children:[Object(oe.jsx)(Ve.a,{disableFocusListener:x,disableHoverListener:x,disableTouchListener:x,title:"Open Files",children:Object(oe.jsx)(_e.a,{edge:"start",color:"inherit",className:h.leftButton,onClick:S,children:Object(oe.jsx)(Ft.a,{})})}),Object(oe.jsx)(qe.a,{variant:"h6",className:h.title,children:r}),Object(oe.jsx)(Ve.a,{title:"Donate",children:Object(oe.jsx)(_e.a,{edge:"end",color:"inherit",component:"a",href:"https://github.com/killergerbah/asbplayer#supporters",target:"_blank",rel:"noreferrer",children:Object(oe.jsx)(St.a,{})})}),Object(oe.jsx)(Ve.a,{title:"Submit Issue",children:Object(oe.jsx)(_e.a,{edge:"end",color:"inherit",component:"a",href:"https://github.com/killergerbah/asbplayer/issues",target:"_blank",rel:"noreferrer",children:Object(oe.jsx)(yt.a,{})})}),Object(oe.jsx)(Ve.a,{title:"Help",children:Object(oe.jsx)(_e.a,{edge:"end",color:"inherit",component:"a",href:"https://github.com/killergerbah/asbplayer#usage",target:"_blank",rel:"noreferrer",children:Object(oe.jsx)(wt.a,{})})}),Object(oe.jsx)(Ve.a,{title:"Settings",children:Object(oe.jsx)(_e.a,{edge:"end",color:"inherit",onClick:s,children:Object(oe.jsx)(Ue.a,{})})}),Object(oe.jsx)(Nt,{title:"Mining History",show:!a,children:Object(oe.jsx)(_e.a,{edge:"end",color:"inherit","aria-label":"menu",className:Object(ae.a)(h.copyHistoryButton,Object(u.a)({},h.copyHistoryButtonShift,a)),onClick:l,children:Object(oe.jsx)(Rt.a,{})})})]})})]})}function Lt(e){var t=e.subtitleColor,n=e.subtitleSize,a=e.subtitleOutlineThickness,i=e.subtitleOutlineColor,r=e.subtitleBackgroundOpacity,o=e.subtitleBackgroundColor,s=e.subtitleFontFamily,c={color:t,fontSize:Number(n)};if(a>0){var u=a,l=i;c.textShadow="0 0 ".concat(u,"px ").concat(l,", 0 0 ").concat(u,"px ").concat(l,", 0 0 ").concat(u,"px ").concat(l,", 0 0 ").concat(u,"px ").concat(l)}if(r>0){var d=r,b=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}}(o),f=b.r,h=b.g,p=b.b;c.backgroundColor="rgba(".concat(f,", ").concat(h,", ").concat(p,", ").concat(d,")")}return s&&s.length>0&&(c.fontFamily=s),c}function Wt(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e<0)return Wt(0,t);var a=(e=Math.round(e))%1e3,i=(e=(e-a)/1e3)%60,r=(e=(e-i)/60)%60;if(t>=36e5){var o=(e-r)/60;return n?Ut(o)+":"+Ut(r)+":"+Ut(i)+"."+Ut(a,3):Ut(o)+":"+Ut(r)+":"+Ut(i)}return n?Ut(r)+":"+Ut(i)+"."+Ut(a,3):Ut(r)+":"+Ut(i)}function Ut(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(e).padStart(t,"0")}var Ht=n(434),zt=n(436),Vt=n(454),qt=n(216),Kt=n.n(qt),Gt=n(435),Xt=n(433),Jt=n(215),Qt=n.n(Jt),Yt=n(214),Zt=n.n(Yt),$t=n(213),en=n.n($t),tn=Object(v.a)((function(e){return{drawer:{width:function(e){return e.drawerWidth},flexShrink:0},drawerPaper:{width:function(e){return e.drawerWidth}},drawerHeader:Object(o.a)(Object(o.a)({display:"flex",alignItems:"center",position:"static",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-start"}),listContainer:{position:"relative",height:"100%",overflowY:"auto",overflowX:"hidden"},listItem:{"&:hover":{backgroundColor:e.palette.action.hover}},listItemGutters:{paddingLeft:5,paddingRight:5},listItemIconRoot:{minWidth:20},emptyState:{display:"flex",justifyContent:"center",flexDirection:"column",textAlign:"center",height:"100%",padding:15},text:{flexGrow:1},emptyText:{flexGrow:1,color:e.palette.text.secondary},timestamp:{paddingRight:15,paddingLeft:15,color:e.palette.text.secondary}}}));function nn(e){var t=e.open,n=e.anchorEl,a=e.onClose,i=e.onSelect,r=e.onClipAudio,o=e.onDownloadImage,s=e.onDelete,c=e.item,u=Object(b.useCallback)((function(){navigator.clipboard.writeText(c.text),a()}),[c,a]),l=Object(b.useCallback)((function(){i(c),a()}),[c,i,a]),d=Object(b.useCallback)((function(){r(c),a()}),[c,r,a]),f=Object(b.useCallback)((function(){o(c),a()}),[c,o,a]),h=Object(b.useCallback)((function(){s(c),a()}),[c,s,a]);return c?Object(oe.jsx)(_t.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:a,anchorOrigin:{vertical:"center",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"right"},children:Object(oe.jsxs)(Et.a,{children:[Object(oe.jsx)(Mt.a,{button:!0,onClick:u,children:Object(oe.jsx)(Xt.a,{primaryTypographyProps:{variant:"body2"},primary:"Copy"})}),Object(oe.jsx)(Mt.a,{button:!0,onClick:l,children:Object(oe.jsx)(Xt.a,{primaryTypographyProps:{variant:"body2"},primary:"Jump To"})}),(c.videoFile||c.audioFile||c.audio)&&Object(oe.jsx)(Mt.a,{button:!0,onClick:d,children:Object(oe.jsx)(Xt.a,{primaryTypographyProps:{variant:"body2"},primary:"Download Audio"})}),(c.videoFile||c.image)&&Object(oe.jsx)(Mt.a,{button:!0,onClick:f,children:Object(oe.jsx)(Xt.a,{primaryTypographyProps:{variant:"body2"},primary:"Download Image"})}),Object(oe.jsx)(Mt.a,{button:!0,onClick:h,children:Object(oe.jsx)(Xt.a,{primaryTypographyProps:{variant:"body2"},primary:"Delete"})})]})}):null}function an(e){var t,n=e.onDelete,a=tn(e),r=Object(b.useCallback)((function(e){e&&e.scrollIntoView()}),[]),o=Object(b.useState)(),s=Object(c.a)(o,2),u=s[0],l=s[1],d=Object(b.useState)(!1),h=Object(c.a)(d,2),p=h[0],v=h[1],g=Object(b.useState)(),j=Object(c.a)(g,2),O=j[0],m=j[1],k=Object(b.useCallback)((function(e,t){l(t),v(!0),m(e.currentTarget)}),[]),y=Object(b.useCallback)((function(){l(void 0),v(!1),m(void 0)}),[]),x=Object(b.useCallback)((function(e){n(e)}),[n]);return e.items.length>0?function(){var n,o,s=[],c=null,u=0,l={},d={},b=Object(i.a)(e.items);try{var f=function(){var t=o.value;if(null===c||c!==t.name){t.name in l?l[t.name]++:l[t.name]=0;var i=t.name+"-"+l[t.name];d[i]=[],c=t.name,n=i,s.push(Object(oe.jsxs)(Mt.a,{children:[Object(oe.jsx)(qe.a,{color:"textSecondary",children:t.name}),Object(oe.jsx)(Ht.a,{children:Object(oe.jsx)(Ve.a,{title:"Download as SRT",children:Object(oe.jsx)(_e.a,{onClick:function(){return e.onDownloadSectionAsSrt(t.name,d[i])},edge:"end",children:Object(oe.jsx)(en.a,{})})})})]},i))}d[n].push(t);var b=u===e.items.length-1?r:null;s.push(Object(oe.jsxs)(Mt.a,{ref:b,className:a.listItem,classes:{gutters:a.listItemGutters},children:[Object(oe.jsx)(Gt.a,{classes:{root:a.listItemIconRoot},children:Object(oe.jsx)(Ve.a,{title:"Export to Anki",children:Object(oe.jsx)(_e.a,{onClick:function(){return e.onAnki(t)},children:Object(oe.jsx)(Zt.a,{fontSize:"small"})})})}),Object(oe.jsx)(Gt.a,{classes:{root:a.listItemIconRoot},children:Object(oe.jsx)(_e.a,{onClick:function(e){return k(e,t)},children:Object(oe.jsx)(Qt.a,{fontSize:"small"})})}),Object(oe.jsx)(Xt.a,{primary:Object(oe.jsxs)(Me.a,{wrap:"nowrap",container:!0,children:[Object(oe.jsx)(Me.a,{item:!0,className:""===t.text?a.emptyText:a.text,children:""===t.text?"No text":t.text}),Object(oe.jsx)(Me.a,{item:!0,className:a.timestamp,children:Wt(t.start,t.start,!1)})]})})]},t.id)),++u};for(b.s();!(o=b.n()).done;)f()}catch(h){b.e(h)}finally{b.f()}t=Object(oe.jsx)("div",{className:a.listContainer,children:Object(oe.jsx)(Et.a,{children:s})})}():t=Object(oe.jsxs)("div",{className:a.emptyState,children:[Object(oe.jsx)(qe.a,{variant:"h6",children:"Mining history is empty."}),Object(oe.jsx)(qe.a,{variant:"caption",children:"See the help for keyboard shortcuts."})]}),Object(oe.jsxs)(f.a.Fragment,{children:[Object(oe.jsxs)(Vt.a,{variant:"persistent",anchor:"right",open:e.open,className:a.drawer,classes:{paper:a.drawerPaper},children:[Object(oe.jsx)("div",{className:a.drawerHeader,children:Object(oe.jsx)(_e.a,{onClick:e.onClose,children:Object(oe.jsx)(Kt.a,{})})}),Object(oe.jsx)(zt.a,{}),t]}),Object(oe.jsx)(nn,{open:e.open&&p,anchorEl:O,item:u,onClose:y,onSelect:e.onSelect,onClipAudio:e.onClipAudio,onDownloadImage:e.onDownloadImage,onDelete:x})]})}var rn=n(77),on=n.n(rn),sn=n(437),cn=Object(fe.a)((function(e){return{background:function(e){return{position:"absolute",height:e.appBarHidden?"100vh":"calc(100vh - 64px)",width:"100%",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center"}},browseLink:{cursor:"pointer"}}}));function un(e){var t=e.extension,n=e.latestExtensionVersion,a=e.extensionUrl,i=e.loading,r=e.dragging,o=e.appBarHidden,u=e.onFileSelector,l=cn({appBarHidden:o}),h=Object(b.useState)(),p=Object(c.a)(h,2),v=p[0],g=p[1];Object(b.useEffect)((function(){function e(){return(e=Object(s.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g(t.version);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t]);var j=v&&on()(n,v),O=!v;return Object(oe.jsx)(f.a.Fragment,{children:Object(oe.jsx)(ot.a,{in:!i&&!r,timeout:500,children:Object(oe.jsx)("div",{className:l.background,children:Object(oe.jsxs)(qe.a,{variant:"h6",children:["Drag and drop subtitle and media files, or"," ",Object(oe.jsx)(sn.a,{target:"#",className:l.browseLink,onClick:u,color:"secondary",component:"label",children:"browse"}),".",Object(oe.jsx)("br",{}),O&&Object(oe.jsxs)("span",{children:["Install the"," ",Object(oe.jsx)(sn.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:a,children:"Chrome extension"})," ","to sync subtitles with streaming video."]}),j&&Object(oe.jsxs)("span",{children:["An extension"," ",Object(oe.jsx)(sn.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:a,children:"update"})," ","is available."]})]})})})})}var ln=function(){function e(t){Object(k.a)(this,e),this.channel=void 0,this.onMessage=void 0,this.channel=new BroadcastChannel(t);var n=this;this.channel.onmessage=function(e){var t;null===(t=n.onMessage)||void 0===t||t.call(n,e)}}return Object(y.a)(e,[{key:"postMessage",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage(e)}},{key:"close",value:function(){var e;null===(e=this.channel)||void 0===e||e.close(),this.channel=void 0}}]),e}(),dn=function(){function e(t,n,a){var i=this;Object(k.a)(this,e),this.tabId=void 0,this.src=void 0,this.extension=void 0,this.listener=void 0,this.unsubscribeFromExtension=void 0,this.onMessage=void 0,this.tabId=t,this.src=n,this.listener=function(e){var a;e.tabId===t&&e.src===n&&(null===(a=i.onMessage)||void 0===a||a.call(i,{data:e.data}))},this.unsubscribeFromExtension=a.subscribe(this.listener),this.extension=a}return Object(y.a)(e,[{key:"postMessage",value:function(e){this.extension.sendMessage(e,this.tabId,this.src)}},{key:"close",value:function(){this.unsubscribeFromExtension()}}]),e}(),bn=function(){function e(){Object(k.a)(this,e),this.accumulated=void 0,this.started=void 0,this.startTime=void 0,this._rate=1,this.accumulated=0,this.started=!1}return Object(y.a)(e,[{key:"rate",get:function(){return this._rate},set:function(e){this.started&&(this.accumulated+=this._elapsed(),this.startTime=Date.now()),this._rate=e}},{key:"time",value:function(e){return this.started?Math.min(e,this.accumulated+this._elapsed()):Math.min(e,this.accumulated)}},{key:"stop",value:function(){this.started&&(this.started=!1,this.accumulated+=this._elapsed())}},{key:"_elapsed",value:function(){return(Date.now()-this.startTime)*this._rate}},{key:"start",value:function(){this.startTime=Date.now(),this.started=!0}},{key:"setTime",value:function(e){this.started?(this.startTime=Date.now(),this.accumulated=e):this.accumulated=e}},{key:"progress",value:function(e){return 0===e?0:Math.min(1,this.time(e)/e)}}]),e}(),fn=n(7),hn=n(219),pn=n.n(hn),vn=n(220),gn=n.n(vn),jn=n(226),On=n.n(jn),mn=n(217),kn=n.n(mn),yn=n(375),xn=n(229),Sn=n.n(xn),Cn=n(231),wn=n.n(Cn),Tn=n(218),Fn=n.n(Tn),Pn=n(230),Rn=n.n(Pn),En=n(221),Mn=n.n(En),_n=n(222),Bn=n.n(_n),An=n(227),In=n.n(An),Nn=n(228),Dn=n.n(Nn),Ln=n(225),Wn=n.n(Ln),Un=n(152),Hn=n.n(Un),zn=n(223),Vn=n.n(zn),qn=n(224),Kn=n.n(qn),Gn=Object(v.a)((function(e){return{container:{position:"absolute",left:"50%",width:"50%",bottom:0,pointerEvents:"none",color:"#fff"},buttonContainer:{flexDirection:"row"},timeDisplay:{color:"#fff",display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",cursor:"default",fontSize:20,marginLeft:10},numberInput:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",fontSize:20,marginLeft:10,width:100,color:"#fff",pointerEvents:"auto"},volumeInputContainerShown:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:5,pointerEvents:"auto"},volumeInputContainerHidden:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:0,pointerEvents:"auto"},volumeInputHidden:{transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),width:0,pointerEvents:"auto"},volumeInputShown:{transition:e.transitions.create("width",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),width:100,pointerEvents:"auto"},volumeInputThumbHidden:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),opacity:0,pointerEvents:"auto"},volumeInputThumbShown:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),opacity:1,pointerEvents:"auto"},subContainer:{background:"linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, .4) 40%, rgba(0, 0, 0, 0.7))",position:"relative",left:"-100%",width:"200%",zIndex:10},button:{pointerEvents:"auto"},inactiveButton:{color:"rgba(72, 72, 72, 0.7)",pointerEvents:"auto"},inactiveTopButton:{color:"rgba(255, 255, 255, 0.5)",pointerEvents:"auto"},progress:{margin:5},topButton:{pointerEvents:"auto",color:"#fff"},gridContainer:{pointerEvents:"auto",padding:2}}})),Xn=Object(v.a)((function(e){return{root:{height:10},container:{height:10,pointerEvents:"auto",display:"flex",justifyContent:"center",flexDirection:"column",position:"absolute",width:"calc(100% - 20px)",marginLeft:10},mouseEventListener:{zIndex:1,height:10,cursor:"pointer",pointerEvents:"auto",position:"absolute",width:"100%"},fillContainer:{background:"rgba(30,30,30,0.7)",width:"100%",height:5,position:"relative"},fillContainerThick:{transition:e.transitions.create("height",{easing:e.transitions.easing.easeInOut,duration:50}),height:8},fill:{background:"linear-gradient(to left, #ff1f62, #49007a)",height:"100%"},handleContainer:{position:"absolute",display:"flex",justifyContent:"center",flexDirection:"column",height:"100%",bottom:0},handle:{borderRadius:"50%",width:16,height:16,opacity:0,left:-8,background:"white",position:"absolute"},handleOn:{opacity:1,transition:e.transitions.create("opacity",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.shortest})}}})),Jn=Object(fn.a)((function(e){return{root:{color:"white",verticalAlign:"middle"},thumb:{backgroundColor:"white",color:"white","&:focus":{boxShadow:"inherit"},"&:hover, &$active":{boxShadow:"0px 0px 0px 8px rgba(255, 255, 255, 0.1)"}},active:{color:"white"}}}))(He.a);function Qn(e){var t=Math.floor(e/1e3),n=Math.floor(t/60),a=t%60;return String(n)+":"+String(a).padStart(2,"0")}function Yn(e){var t=e.onSeek,n=e.value,a=Xn(),i=Object(b.useState)(!1),r=Object(c.a)(i,2),o=r[0],s=r[1],u=Object(b.useRef)(null),l=Object(b.useCallback)((function(e){var n=e.currentTarget.getBoundingClientRect(),a=n.right-n.left-20,i=Math.min(1,Math.max(0,(e.pageX-n.left-10)/a));t(i)}),[t]),d=Object(b.useCallback)((function(){return s(!0)}),[]),f=Object(b.useCallback)((function(){return s(!1)}),[]),h=u.current?function(e){var t=e.getBoundingClientRect();return t.right-t.left}(u.current)*n/100:0,p={width:h},v={marginLeft:h},g=o?a.fillContainer+" "+a.fillContainerThick:a.fillContainer,j=o?a.handle+" "+a.handleOn:a.handle;return Object(oe.jsxs)("div",{className:a.root,children:[Object(oe.jsx)("div",{ref:u,className:a.container,children:Object(oe.jsxs)("div",{className:g,children:[Object(oe.jsx)("div",{className:a.fill,style:p}),Object(oe.jsx)("div",{className:a.handleContainer,children:Object(oe.jsx)("div",{className:j,style:v})})]})}),Object(oe.jsx)("div",{className:a.mouseEventListener,onClick:l,onMouseOver:d,onMouseOut:f})]})}function Zn(e){var t=e.open,n=e.anchorEl,a=e.audioTracks,i=e.selectedAudioTrack,r=e.onAudioTrackSelected,o=e.onClose;if(!a||0===a.length)return null;var s=a.map((function(e){return Object(oe.jsxs)(Mt.a,{selected:e.id===i,button:!0,onClick:function(){return r(e.id)},children:[e.language," ",e.label]},e.id)}));return Object(oe.jsx)("div",{children:Object(oe.jsx)(_t.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:o,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(oe.jsx)(Et.a,{children:s})})})}function $n(e){var t=e.open,n=e.anchorEl,a=e.onClose,i=e.tabs,r=e.selectedTab,o=e.onTabSelected;if(!i||0===i.length)return null;var s=i.map((function(e){return Object(oe.jsxs)(Mt.a,{selected:r&&e.id===r.id&&e.src===r.src,button:!0,onClick:function(){return o(e)},children:[e.id," ",e.title," ",e.src]},"".concat(e.id,":").concat(e.src))}));return Object(oe.jsx)("div",{children:Object(oe.jsx)(_t.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:a,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(oe.jsx)(Et.a,{children:s})})})}function ea(e){var t=e.open,n=e.anchorEl,a=e.onUnload,i=e.onClose,r=e.file;return Object(oe.jsx)("div",{children:Object(oe.jsx)(_t.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:i,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(oe.jsx)(Et.a,{children:Object(oe.jsxs)(Mt.a,{button:!0,onClick:function(e){return a()},children:["Unload ",r]})})})})}function ta(e){var t=e.open,n=e.anchorEl,a=e.selectedPlayMode,i=e.onPlayMode,r=e.onClose;return Object(oe.jsx)("div",{children:Object(oe.jsx)(_t.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:r,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(oe.jsxs)(Et.a,{children:[Object(oe.jsx)(Mt.a,{selected:a===Y.normal,button:!0,onClick:function(e){return i(Y.normal)},children:"Normal"}),Object(oe.jsx)(Mt.a,{selected:a===Y.condensed,button:!0,onClick:function(e){return i(Y.condensed)},children:"Condensed"}),Object(oe.jsx)(Mt.a,{selected:a===Y.autoPause,button:!0,onClick:function(e){return i(Y.autoPause)},children:"Auto-pause"})]})})})}function na(e){var t=e.clock,n=e.playing,a=e.length,i=e.offsetEnabled,r=e.displayLength,o=e.offset,s=e.playbackRate,u=e.playbackRateEnabled,l=e.onAudioTrackSelected,d=e.onSeek,h=e.mousePositionRef,p=e.onShow,v=e.onPause,g=e.onPlay,j=e.onTabSelected,O=e.onUnloadAudio,m=e.onUnloadVideo,k=e.onOffsetChange,y=e.onPlaybackRateChange,x=e.onVolumeChange,S=e.disableKeyEvents,C=e.playbackPreferences,w=e.closeEnabled,T=e.onClose,F=e.volumeEnabled,P=e.playMode,R=e.playModeEnabled,E=e.onPlayMode,M=e.subtitlesEnabled,_=e.subtitlesToggle,B=e.onSubtitlesToggle,A=e.videoFile,I=e.audioFile,N=e.audioTracks,D=e.selectedAudioTrack,L=e.tabs,W=e.selectedTab,U=e.popOutEnabled,H=e.popOut,z=e.onPopOutToggle,V=e.fullscreenEnabled,q=e.fullscreen,K=e.onFullscreenToggle,G=e.hideSubtitlePlayerToggleEnabled,X=e.subtitlePlayerHidden,J=e.onHideSubtitlePlayerToggle,Q=e.showOnMouseMovement,Y=e.theaterModeToggleEnabled,Z=e.theaterModeEnabled,$=e.onTheaterModeToggle,ee=Gn(),te=Object(b.useState)(!0),ne=Object(c.a)(te,2),ae=ne[0],ie=ne[1],re=Object(b.useState)(!1),se=Object(c.a)(re,2),ce=se[0],ue=se[1],le=Object(b.useState)(),de=Object(c.a)(le,2),be=de[0],fe=de[1],he=Object(b.useState)(!1),pe=Object(c.a)(he,2),ve=pe[0],ge=pe[1],je=Object(b.useState)(),Oe=Object(c.a)(je,2),me=Oe[0],ke=Oe[1],ye=Object(b.useState)(!1),xe=Object(c.a)(ye,2),Se=xe[0],Ce=xe[1],we=Object(b.useState)(),Te=Object(c.a)(we,2),Fe=Te[0],Pe=Te[1],Re=Object(b.useState)(!1),Ee=Object(c.a)(Re,2),Be=Ee[0],Ae=Ee[1],Ie=Object(b.useState)(),Ne=Object(c.a)(Ie,2),De=Ne[0],Le=Ne[1],We=Object(b.useState)(!1),Ue=Object(c.a)(We,2),He=Ue[0],ze=Ue[1],qe=Object(b.useState)(),Ke=Object(c.a)(qe,2),Ge=Ke[0],Xe=Ke[1],Je=Object(b.useState)(!1),Qe=Object(c.a)(Je,2),Ye=Qe[0],Ze=Qe[1],$e=Object(b.useState)(100),et=Object(c.a)($e,2),tt=et[0],nt=et[1],at=Object(b.useState)(100),it=Object(c.a)(at,2),rt=it[0],st=it[1],ct=Object(b.useRef)({x:0,y:0}),ut=Object(b.useRef)(Date.now()),lt=Object(b.useRef)(Date.now()),dt=Object(b.useRef)(!0),bt=Object(b.useRef)(!1),ft=Object(b.useState)(5),ht=Object(c.a)(ft,2),pt=ht[0],vt=ht[1],gt=Object(b.useState)(5),jt=Object(c.a)(gt,2),Ot=jt[0],mt=jt[1],kt=Object(b.useRef)(),yt=Object(b.useRef)(),xt=Object(b.useRef)(null),St=Object(b.useRef)(null),Ct=Object(b.useState)(),wt=Object(c.a)(Ct,2)[1],Tt=Object(b.useCallback)((function(){return wt({})}),[]),Ft=Object(b.useCallback)((function(e){d(e)}),[d]);function Pt(){bt.current=!0}function Rt(){bt.current=!1}Object(b.useEffect)((function(){var e=Number(C.volume);nt(e),x(e/100),e>0&&st(e)}),[C,x]),Object(b.useEffect)((function(){var e=setInterval((function(){var e,t;Q?e=Date.now()-ut.current<2e3||Math.pow(h.current.x-ct.current.x,2)+Math.pow(h.current.y-ct.current.y,2)>100:e=null!==(t=xt.current&&h.current.y>xt.current.offsetTop-20||St.current&&h.current.y<St.current.offsetHeight+20)&&void 0!==t&&t;(e=e||bt.current||kt.current===document.activeElement||yt.current===document.activeElement||Date.now()-lt.current<2e3)&&!dt.current?(ut.current=Date.now(),ie(e)):!e&&dt.current&&ie(e),dt.current=e,ct.current.x=h.current.x,ct.current.y=h.current.y}),100);return function(){return clearInterval(e)}}),[h,Q]),Object(b.useEffect)((function(){return null===p||void 0===p?void 0:p(ae)}),[p,ae]);var Et=Object(b.useCallback)((function(e){if(kt.current){if(0===e)kt.current.value="",vt(5);else{var t=e/1e3,n=t>=0?"+"+t.toFixed(2):String(t.toFixed(2));kt.current.value=n,lt.current=Date.now(),vt(n.length)}kt.current.blur()}}),[]),Mt=Object(b.useCallback)((function(e){if(yt.current){if(1===e)yt.current.value="",mt(5);else{var t="\xd7"+String(e.toFixed(2));yt.current.value=t,lt.current=Date.now(),mt(t.length)}yt.current.blur()}}),[]);Object(b.useEffect)((function(){if(!S)return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)};function e(e){if("Enter"===e.key)if(kt.current===document.activeElement){var t=Number(kt.current.value);if(t===o)return void Et(o);if(Number.isNaN(t))return;k(1e3*t)}else if(yt.current===document.activeElement){var n=Number(yt.current.value);if(s===n)return void Mt(s);if(Number.isNaN(n)||n<.1||n>5)return;y(n)}}}),[k,y,Et,Mt,o,s,S]);var _t=Object(b.useCallback)((function(e){var t,n=e.target;n.setSelectionRange(0,(null===(t=n.value)||void 0===t?void 0:t.length)||0)}),[]);Object(b.useEffect)((function(){var e=setInterval((function(){Tt()}),100);return function(){return clearInterval(e)}}),[Tt]),Object(b.useEffect)((function(){Et(o)}),[o,Et]),Object(b.useEffect)((function(){Mt(s)}),[s,Mt]);var Bt=Object(b.useCallback)((function(){fe(void 0),ue(!1)}),[]),At=Object(b.useCallback)((function(e){fe(e.currentTarget),ue(!0)}),[]),It=Object(b.useCallback)((function(e){l(e),fe(void 0),ue(!1)}),[l]),Nt=Object(b.useCallback)((function(){ke(void 0),ge(!1)}),[]),Dt=Object(b.useCallback)((function(e){ke(e.currentTarget),ge(!0)}),[]),Lt=Object(b.useCallback)((function(e){null===j||void 0===j||j(e),ke(void 0),ge(!1)}),[j]),Wt=Object(b.useCallback)((function(){Pe(void 0),Ce(!1)}),[]),Ut=Object(b.useCallback)((function(e){Pe(e.currentTarget),Ce(!0)}),[]),Ht=Object(b.useCallback)((function(){null===O||void 0===O||O(),Ce(!1)}),[O]),zt=Object(b.useCallback)((function(){Le(void 0),Ae(!1)}),[]),Vt=Object(b.useCallback)((function(e){Le(e.currentTarget),Ae(!0)}),[]),qt=Object(b.useCallback)((function(){null===m||void 0===m||m(),Ae(!1)}),[m]),Kt=Object(b.useCallback)((function(){Xe(void 0),ze(!1)}),[]),Gt=Object(b.useCallback)((function(e){Xe(e.currentTarget),ze(!0)}),[]),Xt=Object(b.useCallback)((function(e){null===E||void 0===E||E(e),Xe(void 0),ze(!1)}),[E]),Jt=Object(b.useCallback)((function(){return Ze(!1)}),[]),Qt=Object(b.useCallback)((function(){return Ze(!0)}),[]),Yt=Object(b.useCallback)((function(e,t){"number"===typeof t&&(nt(t),x(t/100))}),[x]),Zt=Object(b.useCallback)((function(e,t){"number"===typeof t&&(t>0&&st(t),C.volume=t)}),[C]),$t=Object(b.useCallback)((function(){nt((function(e){var t=e>0?0:rt;return x(t/100),t}))}),[x,rt]),en=t.progress(a);return Object(oe.jsxs)(f.a.Fragment,{children:[Object(oe.jsx)(ot.a,{in:ae,timeout:200,children:Object(oe.jsxs)(Me.a,{container:!0,style:{position:"absolute",top:0},children:[Object(oe.jsx)(Me.a,{item:!0,style:{flexGrow:1},children:w&&Object(oe.jsx)(_e.a,{ref:St,color:"inherit",className:ee.topButton,onClick:T,onMouseOver:Pt,onMouseOut:Rt,children:Object(oe.jsx)(kn.a,{})})}),Object(oe.jsxs)(Me.a,{item:!0,children:[Y&&Object(oe.jsx)(_e.a,{color:"inherit",className:Z?ee.topButton:ee.inactiveTopButton,onClick:$,onMouseOver:Pt,onMouseOut:Rt,children:Object(oe.jsx)(Fn.a,{})}),G&&Object(oe.jsx)(_e.a,{color:"inherit",className:ee.topButton,onClick:J,onMouseOver:Pt,onMouseOut:Rt,children:X?Object(oe.jsx)(pn.a,{}):Object(oe.jsx)(gn.a,{})})]})]})}),Object(oe.jsxs)("div",{ref:xt,className:ee.container,onMouseOver:Pt,onMouseOut:Rt,children:[Object(oe.jsx)(ot.a,{in:ae,timeout:200,children:Object(oe.jsxs)("div",{className:ee.subContainer,children:[Object(oe.jsx)(Yn,{onSeek:Ft,value:100*en}),Object(oe.jsxs)(Me.a,{container:!0,className:ee.gridContainer,direction:"row",children:[Object(oe.jsx)(Me.a,{item:!0,children:Object(oe.jsx)(_e.a,{color:"inherit",onClick:function(){return n?v():g()},children:n?Object(oe.jsx)(Mn.a,{className:ee.button}):Object(oe.jsx)(Bn.a,{className:ee.button})})}),F&&Object(oe.jsxs)(Me.a,{item:!0,onMouseOver:Qt,onMouseOut:Jt,className:Ye?ee.volumeInputContainerShown:ee.volumeInputContainerHidden,children:[Object(oe.jsx)(_e.a,{color:"inherit",onClick:$t,children:0===tt?Object(oe.jsx)(Vn.a,{}):Object(oe.jsx)(Kn.a,{})}),Object(oe.jsx)(Jn,{onChange:Yt,onChangeCommitted:Zt,value:tt,defaultValue:100,classes:{root:Ye?ee.volumeInputShown:ee.volumeInputHidden,thumb:Ye?ee.volumeInputThumbShown:ee.volumeInputThumbHidden}})]}),Object(oe.jsx)(Me.a,{item:!0,children:Object(oe.jsxs)("div",{className:ee.timeDisplay,children:[Qn(en*a)," / ",Qn(r||a)]})}),i&&Object(oe.jsx)(Me.a,{item:!0,children:Object(oe.jsx)(Ve.a,{title:"Subtitle Offset",children:Object(oe.jsx)(yn.a,{style:{width:"".concat(pt,"ch")},inputRef:kt,disableUnderline:!0,className:ee.numberInput,placeholder:"\xb1"+Number(0).toFixed(2),onClick:_t,onChange:function(e){return vt(Math.max(5,e.target.value.length))}})})}),u&&Object(oe.jsx)(Me.a,{item:!0,children:Object(oe.jsx)(Ve.a,{title:"Playback Rate",children:Object(oe.jsx)(yn.a,{style:{width:"".concat(Ot,"ch"),marginLeft:4},inputRef:yt,disableUnderline:!0,className:ee.numberInput,placeholder:"\xd7"+Number(1).toFixed(2),onClick:_t,onChange:function(e){return mt(Math.max(5,e.target.value.length))}})})}),Object(oe.jsx)(Me.a,{item:!0,style:{flexGrow:1}}),_&&Object(oe.jsx)(Me.a,{item:!0,children:Object(oe.jsx)(_e.a,{color:"inherit",onClick:B,children:Object(oe.jsx)(Wn.a,{className:M?ee.button:ee.inactiveButton})})}),A&&Object(oe.jsx)(Me.a,{item:!0,children:Object(oe.jsx)(_e.a,{color:"inherit",onClick:Vt,children:Object(oe.jsx)(Hn.a,{className:ee.button})})}),I&&Object(oe.jsx)(Me.a,{item:!0,children:Object(oe.jsx)(_e.a,{color:"inherit",onClick:Ut,children:Object(oe.jsx)(On.a,{className:ee.button})})}),N&&N.length>1&&Object(oe.jsx)(Me.a,{item:!0,children:Object(oe.jsx)(_e.a,{color:"inherit",onClick:At,children:Object(oe.jsx)(In.a,{className:ee.button})})}),L&&L.length>0&&Object(oe.jsx)(Me.a,{item:!0,children:Object(oe.jsx)(_e.a,{color:"inherit",onClick:Dt,children:Object(oe.jsx)(Hn.a,{className:W?ee.button:ee.inactiveButton})})}),R&&Object(oe.jsx)(Me.a,{item:!0,children:Object(oe.jsx)(_e.a,{color:"inherit",onClick:Gt,children:Object(oe.jsx)(Dn.a,{className:R?ee.button:ee.inactiveButton})})}),U&&Object(oe.jsx)(Me.a,{item:!0,children:Object(oe.jsx)(_e.a,{color:"inherit",onClick:z,children:Object(oe.jsx)(Sn.a,{className:ee.button,style:H?{transform:"rotateX(180deg)"}:{}})})}),V&&Object(oe.jsx)(Me.a,{item:!0,children:Object(oe.jsx)(_e.a,{color:"inherit",onClick:K,children:q?Object(oe.jsx)(Rn.a,{className:ee.button}):Object(oe.jsx)(wn.a,{className:ee.button})})})]})]})}),Object(oe.jsx)($n,{open:ve&&ae,anchorEl:me,tabs:L,selectedTab:W,onClose:Nt,onTabSelected:Lt}),Object(oe.jsx)(Zn,{open:ce&&ae,anchorEl:be,audioTracks:N,selectedAudioTrack:D,onClose:Bt,onAudioTrackSelected:It}),Object(oe.jsx)(ea,{open:Se,anchorEl:Fe,file:I,onClose:Wt,onUnload:Ht}),Object(oe.jsx)(ea,{open:Be,anchorEl:De,file:A,onClose:zt,onUnload:qt}),Object(oe.jsx)(ta,{open:He&&ae,anchorEl:Ge,selectedPlayMode:P,onClose:Kt,onPlayMode:Xt})]})]})}var aa=function(){function e(t){Object(k.a)(this,e),this.ref=void 0,this.readyResolves=void 0,this.ref=t,this.readyResolves=[]}return Object(y.a)(e,[{key:"seek",value:function(){var e=Object(s.a)(d.a.mark((function e(t){var n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){n.ref.current?(n.ref.current.currentTime=t,n._onMediaCanPlay((function(){return e(void 0)}))):e(void 0)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onReady",value:function(){var e=Object(s.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.ref.current?t._onMediaCanPlay((function(){return e(void 0)})):e(void 0)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_onMediaCanPlay",value:function(e){var t,n=this;4!==(null===(t=this.ref.current)||void 0===t?void 0:t.readyState)?(this.ref.current&&!this.ref.current.oncanplay&&(this.ref.current.oncanplay=function(e){var t,a=Object(i.a)(n.readyResolves);try{for(a.s();!(t=a.n()).done;){(0,t.value)()}}catch(r){a.e(r)}finally{a.f()}n.readyResolves.length=0,n.ref.current&&(n.ref.current.oncanplay=null)}),this.readyResolves.push(e)):e()}},{key:"play",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.play()}},{key:"pause",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.pause()}},{key:"playbackRate",value:function(e){this.ref.current&&(this.ref.current.playbackRate=e)}}]),e}(),ia=n(441),ra=n(442),oa=n(439),sa=n(440),ca=n(438),ua=["index","selected","subtitleRef","onClickSubtitle","onCopySubtitle","compressed","disabled","subtitle","copyButtonEnabled"],la=Object(v.a)((function(e){return{container:{height:function(e){return e.appBarHidden?"100vh":"calc(100vh - 64px)"},position:"relative",overflowX:"hidden",backgroundColor:e.palette.background.default,width:function(e){var t=e.compressed,n=e.windowWidth;return t?Math.max(350,.25*n):"100%"}},table:{backgroundColor:e.palette.background.default,marginBottom:75},noSubtitles:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center"}}})),da=Object(v.a)((function(e){return{subtitleRow:{"&:hover":{backgroundColor:e.palette.action.hover}},subtitle:{fontSize:20,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere",whiteSpace:"pre-wrap"},compressedSubtitle:{fontSize:16,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere",whiteSpace:"pre-wrap"},disabledSubtitle:{color:"transparent",backgroundColor:e.palette.action.disabledBackground,borderRadius:5},timestamp:{fontSize:14,color:"#aaaaaa",textAlign:"right",paddingRight:15,paddingLeft:5},copyButton:{textAlign:"right",padding:0}}})),ba=f.a.memo((function(e){var t=e.index,n=e.selected,a=e.subtitleRef,i=e.onClickSubtitle,r=e.onCopySubtitle,s=e.compressed,u=e.disabled,l=e.subtitle,d=e.copyButtonEnabled,f=Object(ue.a)(e,ua),h=da(),p=Object(b.useRef)(null),v=Object(b.useState)(!1),g=Object(c.a)(v,2),j=g[0],O=g[1],m=s?h.compressedSubtitle:h.subtitle,k=u?h.disabledSubtitle:"";if(l.start<0||l.end<0)return null;var y=l.textImage?Object(oe.jsx)(Qe,{availableWidth:window.screen.availWidth/2,subtitle:l,scale:1}):Object(oe.jsx)("span",{ref:p,className:k,children:l.text});return Object(oe.jsxs)(ca.a,Object(o.a)(Object(o.a)({onClick:function(){return!j&&i(t)},onMouseUp:function(){var e,t,n,a=document.getSelection(),i="Range"===(null===a||void 0===a?void 0:a.type)&&(null===(e=p.current)||void 0===e?void 0:e.isSameNode(null!==(t=null===(n=a.anchorNode)||void 0===n?void 0:n.parentNode)&&void 0!==t?t:null));O(null!==i&&void 0!==i&&i)},ref:a,className:h.subtitleRow,selected:n},f),{},{children:[Object(oe.jsx)(oa.a,{className:m,children:y}),d&&Object(oe.jsx)(oa.a,{className:h.copyButton,children:Object(oe.jsx)(_e.a,{onClick:function(e){return r(e,t)},children:Object(oe.jsx)(Ce.a,{fontSize:s?"small":"medium"})})}),Object(oe.jsx)(oa.a,{className:h.timestamp,children:Object(oe.jsx)("div",{children:"\n".concat(l.displayTime,"\n")})})]}))}));function fa(e){var t=e.clock,n=e.onSeek,a=e.onCopy,o=e.onOffsetChange,s=e.onToggleSubtitleTrack,u=e.onSubtitlesSelected,l=e.autoPauseContext,d=e.playing,f=e.subtitles,h=e.subtitleCollection,p=e.length,v=e.jumpToSubtitle,g=e.compressed,j=e.copyButtonEnabled,m=e.loading,k=e.drawerOpen,y=e.appBarHidden,x=e.displayHelp,S=e.disableKeyEvents,C=e.lastJumpToTopTimestamp,w=e.hidden,T=e.disabledSubtitleTracks,F=e.settingsProvider,P=e.keyBinder,R=Object(b.useRef)();R.current=d;var M=Object(b.useRef)(t);M.current=t,Object(b.useRef)().current=f;var _=Object(b.useMemo)((function(){return f?Array(f.length).fill(void 0).map((function(e){return Object(b.createRef)()})):[]}),[f]),B=Object(b.useRef)(ee.empty());B.current=null!==h&&void 0!==h?h:ee.empty();var A=Object(b.useRef)([]);A.current=_;var I=Object(b.useRef)();I.current=S;var N=Object(b.useState)({}),D=Object(c.a)(N,2),L=D[0],W=D[1],U=Object(b.useRef)({}),H=Object(b.useRef)(0);H.current=p;var z=Object(b.useRef)(!1);z.current=w;var V=Object(b.useRef)(0),q=Object(b.useRef)(),K=Object(b.useRef)();Object(b.useRef)().current=k;var G=O(!0),X=Object(c.a)(G,1)[0],Q=la({compressed:g,windowWidth:X,appBarHidden:y}),Y=Object(b.useRef)();Y.current=l;var Z=Object(b.useRef)();Z.current=u,Object(b.useEffect)((function(){return q.current=requestAnimationFrame((function e(){var t,n,a,r,o,s,c=A.current,u={},l=M.current.time(H.current),d=B.current.subtitlesAt(l),b=0===d.showing.length?null!==(t=d.lastShown)&&void 0!==t?t:[]:d.showing,f=Object(i.a)(b);try{for(f.s();!(a=f.n()).done;){var h=a.value;u[h.index]=!0,(void 0===n||h.index<n)&&(n=h.index)}}catch(g){f.e(g)}finally{f.f()}if(!function(e,t){for(var n in e)if(!(n in t))return!1;for(var a in t)if(!(a in e))return!1;return!0}(u,U.current)&&(U.current=u,W(u),null===(r=Z.current)||void 0===r||r.call(Z,b),void 0!==n)){var p=c[n],v=!z.current&&Date.now()-V.current>5e3;null!==p&&void 0!==p&&p.current&&v&&p.current.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}void 0!==d.startedShowing&&(null===(o=Y.current)||void 0===o||o.startedShowing(d.startedShowing));void 0!==d.willStopShowing&&(null===(s=Y.current)||void 0===s||s.willStopShowing(d.willStopShowing));q.current=requestAnimationFrame(e)})),function(){void 0!==q.current&&cancelAnimationFrame(q.current)}}),[]);var $=Object(b.useCallback)((function(){var e,t=U.current;if(t){var n=Object.keys(t);if(0!==n.length){var a=_[Number(n[0])];null===a||void 0===a||null===(e=a.current)||void 0===e||e.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}}),[_]);Object(b.useEffect)((function(){if(!w)return document.addEventListener("visibilitychange",e),function(){return document.removeEventListener("visibilitychange",e)};function e(){"visible"===document.visibilityState&&$()}}),[w,L,_,$]),Object(b.useEffect)((function(){w||$()}),[w,$]),Object(b.useEffect)((function(){var e;if(!z.current){var t=A.current;if(t&&0!==t.length){var n=t[0];null===n||void 0===n||null===(e=n.current)||void 0===e||e.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}}),[C]),Object(b.useEffect)((function(){return P.bindAdjustOffset((function(e,t){e.preventDefault(),e.stopPropagation(),o(t)}),(function(){return S}),(function(){return f}))}),[P,o,S,f]),Object(b.useEffect)((function(){return P.bindResetOffet((function(e){e.preventDefault(),e.stopPropagation(),o(0)}),(function(){return S}))}),[P,o,S]),Object(b.useEffect)((function(){return P.bindOffsetToSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),o(t)}),(function(){return S}),(function(){return t.time(p)}),(function(){return f}))}),[P,o,S,t,f,p]),Object(b.useEffect)((function(){return P.bindSeekToSubtitle((function(e,t){var a;e.preventDefault(),e.stopPropagation(),n(t.start,null!==(a=R.current)&&void 0!==a&&a)}),(function(){return S}),(function(){return t.time(p)}),(function(){return f}))}),[P,n,f,S,t,p]),Object(b.useEffect)((function(){return P.bindSeekToBeginningOfCurrentSubtitle((function(e,t){var a;e.preventDefault(),e.stopPropagation(),n(t.start,null!==(a=R.current)&&void 0!==a&&a)}),(function(){return S}),(function(){return t.time(p)}),(function(){return f}))}),[P,n,f,S,t,p]),Object(b.useEffect)((function(){return P.bindSeekBackwardOrForward((function(e,a){var i,r;(e.stopPropagation(),e.preventDefault(),a)?n(Math.min(p,t.time(p)+1e4),null!==(i=R.current)&&void 0!==i&&i):n(Math.max(0,t.time(p)-1e4),null!==(r=R.current)&&void 0!==r&&r)}),(function(){return S}))}),[P,t,p,S,n]),Object(b.useEffect)((function(){function e(){V.current=Date.now()}var t=K.current;return null===t||void 0===t||t.addEventListener("wheel",e),function(){return null===t||void 0===t?void 0:t.removeEventListener("wheel",e)}}),[K,V]),Object(b.useEffect)((function(){if(!w&&v&&f){var e,t,n,a=-1,r=0,o=Object(i.a)(f);try{for(o.s();!(e=o.n()).done;){var s=e.value;if(s.originalStart===v.originalStart&&s.text===v.text){a=r;break}++r}}catch(c){o.e(c)}finally{o.f()}if(-1!==a)null===(t=_[a])||void 0===t||null===(n=t.current)||void 0===n||n.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}),[w,v,f,_]);var te=Object(b.useCallback)((function(e){return U.current&&f?E(f,e,F.surroundingSubtitlesCountRadius,F.surroundingSubtitlesTimeRadius):[]}),[f,F.surroundingSubtitlesCountRadius,F.surroundingSubtitlesTimeRadius]),ne=Object(b.useCallback)((function(){if(!U.current)return[];var e=Math.min.apply(Math,Object(r.a)(Object.keys(U.current).map((function(e){return Number(e)}))));return te(e)}),[te]),ae=Object(b.useCallback)((function(){var e=Object.keys(U.current).map((function(e){return Number(e)}));if(f&&e&&0!==e.length){var t=Math.min.apply(Math,Object(r.a)(e));return f[t]}}),[f]);Object(b.useEffect)((function(){var e=P.bindCopy((function(e,t){e.preventDefault(),e.stopPropagation(),a(t,ne(),J.none,!1)}),(function(){var e;return null!==(e=I.current)&&void 0!==e&&e}),(function(){return ae()}));return function(){return e()}}),[P,ae,ne,a]),Object(b.useEffect)((function(){var e=P.bindToggleSubtitleTrackInList((function(e,t){e.preventDefault(),e.stopPropagation(),s(t)}),(function(){return S}));return function(){return e()}}),[P,S,s]),Object(b.useEffect)((function(){var e=P.bindAnkiExport((function(e){e.preventDefault(),e.stopPropagation();var t=Object.keys(U.current).map((function(e){return Number(e)}));if(f&&t&&t.length>0){var n=Math.min.apply(Math,Object(r.a)(t));a(f[n],te(n),J.showAnkiDialog,!0)}}),(function(){return!f||0===f.length||S}));return function(){return e()}}),[P,a,S,f,te]),Object(b.useEffect)((function(){var e=P.bindUpdateLastCard((function(e){e.preventDefault(),e.stopPropagation();var t=Object.keys(U.current).map((function(e){return Number(e)}));if(f&&t&&t.length>0){var n=Math.min.apply(Math,Object(r.a)(t));a(f[n],te(n),J.updateLastCard,!0)}}),(function(){return!f||0===f.length||S}));return function(){return e()}}),[P,a,S,f,te]);var ie=Object(b.useCallback)((function(e){if(f){var t=U.current||{};n(f[e].start,!R.current&&e in t)}}),[f,n]),re=Object(b.useCallback)((function(e,t){e.preventDefault(),e.stopPropagation(),f&&a(f[t],te(t),J.none,!1)}),[f,te,a]),se=null;return f&&0!==f.length?se=Object(oe.jsx)(sa.a,{className:Q.table,children:Object(oe.jsx)(ia.a,{children:Object(oe.jsx)(ra.a,{children:f.map((function(e,t){var n=t in L;return Object(oe.jsx)(ba,{index:t,compressed:g,selected:n,copyButtonEnabled:j,disabled:T[e.track],subtitle:f[t],subtitleRef:_[t],onClickSubtitle:ie,onCopySubtitle:re},t)}))})})}):!m&&x?se=!m&&x&&Object(oe.jsx)("div",{className:Q.noSubtitles,children:Object(oe.jsx)(qe.a,{variant:"h6",children:x})}):f&&0===f.length&&(se=Object(oe.jsx)("div",{className:Q.noSubtitles,children:Object(oe.jsx)(qe.a,{variant:"h6",children:"No subtitles"})})),Object(oe.jsx)(Ae.a,{square:!0,elevation:0,ref:K,className:Q.container,children:se})}var ha=function(){function e(t){var n=this;Object(k.a)(this,e),this.protocol=void 0,this.time=void 0,this.isReady=void 0,this.readyCallbacks=void 0,this.playCallbacks=void 0,this.pauseCallbacks=void 0,this.audioTrackSelectedCallbacks=void 0,this.currentTimeCallbacks=void 0,this.exitCallbacks=void 0,this.offsetCallbacks=void 0,this.playbackRateCallbacks=void 0,this.popOutToggleCallbacks=void 0,this.copyCallbacks=void 0,this.playModeCallbacks=void 0,this.hideSubtitlePlayerToggleCallbacks=void 0,this.appBarToggleCallbacks=void 0,this.fullscreenToggleCallbacks=void 0,this.ankiDialogRequestCallbacks=void 0,this.toggleSubtitleTrackInListCallbacks=void 0,this.readyState=void 0,this.oncanplay=null,this.audioTracks=void 0,this.selectedAudioTrack=void 0,this.duration=void 0,this._playbackRate=void 0,this.protocol=t,this.time=0,this.duration=0,this.isReady=!1,this.readyState=0,this._playbackRate=1,this.selectedAudioTrack=void 0,this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.playbackRateCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[],this.playModeCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.fullscreenToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.toggleSubtitleTrackInListCallbacks=[];var a=this;this.protocol.onMessage=function(e){switch(e.data.command){case"ready":var t=e.data;a.duration=t.duration,a.isReady=!0,a.audioTracks=t.audioTracks,a.selectedAudioTrack=t.selectedAudioTrack,a.readyState=4,a.time=t.currentTime,n._playbackRate=t.playbackRate;var r,o=Object(i.a)(a.readyCallbacks);try{for(o.s();!(r=o.n()).done;){(0,r.value)(t.paused)}}catch(Z){o.e(Z)}finally{o.f()}break;case"readyState":var s,c=e.data;if(a.readyState=c.value,4===a.readyState)null===(s=a.oncanplay)||void 0===s||s.call(a,new Event("canplay"));break;case"play":var u,l=e.data,d=Object(i.a)(a.playCallbacks);try{for(d.s();!(u=d.n()).done;){(0,u.value)(l.echo)}}catch(Z){d.e(Z)}finally{d.f()}break;case"pause":var b,f=e.data,h=Object(i.a)(a.pauseCallbacks);try{for(h.s();!(b=h.n()).done;){(0,b.value)(f.echo)}}catch(Z){h.e(Z)}finally{h.f()}break;case"audioTrackSelected":var p,v=e.data,g=Object(i.a)(a.audioTrackSelectedCallbacks);try{for(g.s();!(p=g.n()).done;){var j=p.value;a.selectedAudioTrack=v.id,j(v.id)}}catch(Z){g.e(Z)}finally{g.f()}break;case"currentTime":var O,m=e.data,k=Object(i.a)(a.currentTimeCallbacks);try{for(k.s();!(O=k.n()).done;){(0,O.value)(m.value,m.echo)}}catch(Z){k.e(Z)}finally{k.f()}break;case"exit":var y,x=Object(i.a)(a.exitCallbacks);try{for(x.s();!(y=x.n()).done;){(0,y.value)()}}catch(Z){x.e(Z)}finally{x.f()}break;case"offset":var S,C=e.data,w=Object(i.a)(a.offsetCallbacks);try{for(w.s();!(S=w.n()).done;){(0,S.value)(C.value)}}catch(Z){w.e(Z)}finally{w.f()}break;case"playbackRate":var T,F=e.data,P=Object(i.a)(a.playbackRateCallbacks);try{for(P.s();!(T=P.n()).done;){(0,T.value)(F.value,F.echo)}}catch(Z){P.e(Z)}finally{P.f()}break;case"popOutToggle":var R,E=Object(i.a)(a.popOutToggleCallbacks);try{for(E.s();!(R=E.n()).done;){(0,R.value)()}}catch(Z){E.e(Z)}finally{E.f()}break;case"copy":var M,_=Object(i.a)(a.copyCallbacks);try{for(_.s();!(M=_.n()).done;){var B,A,I=M.value,N=e.data;I(N.subtitle,N.surroundingSubtitles,N.audio,N.image,N.url,null!==(B=N.postMineAction)&&void 0!==B?B:J.none,null!==(A=N.preventDuplicate)&&void 0!==A&&A,N.id)}}catch(Z){_.e(Z)}finally{_.f()}break;case"playMode":var D,L=Object(i.a)(a.playModeCallbacks);try{for(L.s();!(D=L.n()).done;){(0,D.value)(e.data.playMode)}}catch(Z){L.e(Z)}finally{L.f()}break;case"hideSubtitlePlayerToggle":var W,U=Object(i.a)(a.hideSubtitlePlayerToggleCallbacks);try{for(U.s();!(W=U.n()).done;){(0,W.value)()}}catch(Z){U.e(Z)}finally{U.f()}break;case"appBarToggle":var H,z=Object(i.a)(a.appBarToggleCallbacks);try{for(z.s();!(H=z.n()).done;){(0,H.value)()}}catch(Z){z.e(Z)}finally{z.f()}break;case"fullscreenToggle":var V,q=Object(i.a)(n.fullscreenToggleCallbacks);try{for(q.s();!(V=q.n()).done;){(0,V.value)()}}catch(Z){q.e(Z)}finally{q.f()}break;case"sync":case"syncv2":break;case"ankiDialogRequest":var K,G=Object(i.a)(a.ankiDialogRequestCallbacks);try{for(G.s();!(K=G.n()).done;){(0,K.value)()}}catch(Z){G.e(Z)}finally{G.f()}break;case"toggleSubtitleTrackInList":var X,Q=e.data,Y=Object(i.a)(a.toggleSubtitleTrackInListCallbacks);try{for(Y.s();!(X=Y.n()).done;){(0,X.value)(Q.track)}}catch(Z){Y.e(Z)}finally{Y.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(y.a)(e,[{key:"currentTime",get:function(){return this.time},set:function(e){this.time=e,this.readyState=3;var t={command:"currentTime",value:this.time};this.protocol.postMessage(t)}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(e){var t={command:"playbackRate",value:e};this.protocol.postMessage(t)}},{key:"onReady",value:function(e){this.isReady&&e(!1),this.readyCallbacks.push(e)}},{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onExit",value:function(e){this.exitCallbacks.push(e)}},{key:"onOffset",value:function(e){this.offsetCallbacks.push(e)}},{key:"onPlaybackRate",value:function(e){this.playbackRateCallbacks.push(e)}},{key:"onPopOutToggle",value:function(e){this.popOutToggleCallbacks.push(e)}},{key:"onCopy",value:function(e){this.copyCallbacks.push(e)}},{key:"onPlayMode",value:function(e){this.playModeCallbacks.push(e)}},{key:"onHideSubtitlePlayerToggle",value:function(e){this.hideSubtitlePlayerToggleCallbacks.push(e)}},{key:"onAppBarToggle",value:function(e){this.appBarToggleCallbacks.push(e)}},{key:"onFullscreenToggle",value:function(e){this.fullscreenToggleCallbacks.push(e)}},{key:"onAnkiDialogRequest",value:function(e){this.ankiDialogRequestCallbacks.push(e)}},{key:"onToggleSubtitleTrackInList",value:function(e){this.toggleSubtitleTrackInListCallbacks.push(e)}},{key:"ready",value:function(e,t){var n={command:"ready",duration:e,videoFileName:t};this.protocol.postMessage(n)}},{key:"init",value:function(){this.protocol.postMessage({command:"init"})}},{key:"play",value:function(){return this.protocol.postMessage({command:"play"}),new Promise((function(e,t){return e()}))}},{key:"pause",value:function(){this.protocol.postMessage({command:"pause"})}},{key:"audioTrackSelected",value:function(e){var t={command:"audioTrackSelected",id:e};this.protocol.postMessage(t)}},{key:"subtitles",value:function(e,t){this.protocol.postMessage({command:"subtitles",value:e,name:t.length>0?t[0]:null,names:t})}},{key:"offset",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t={command:"offset",value:e};this.protocol.postMessage(t)}))},{key:"subtitleSettings",value:function(e){var t={command:"subtitleSettings",value:e};this.protocol.postMessage(t)}},{key:"playMode",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t={command:"playMode",playMode:e};this.protocol.postMessage(t)}))},{key:"hideSubtitlePlayerToggle",value:function(e){var t={command:"hideSubtitlePlayerToggle",value:e};this.protocol.postMessage(t)}},{key:"appBarToggle",value:function(e){var t={command:"appBarToggle",value:e};this.protocol.postMessage(t)}},{key:"fullscreenToggle",value:function(e){var t={command:"fullscreenToggle",value:e};this.protocol.postMessage(t)}},{key:"ankiSettings",value:function(e){var t={command:"ankiSettings",value:e};this.protocol.postMessage(t)}},{key:"miscSettings",value:function(e){var t={command:"miscSettings",value:e};this.protocol.postMessage(t)}},{key:"alert",value:function(e,t){var n={command:"alert",message:e,severity:t};this.protocol.postMessage(n)}},{key:"close",value:function(){this.protocol.postMessage({command:"close"}),this.protocol.close(),this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.playbackRateCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[],this.playModeCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.fullscreenToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.toggleSubtitleTrackInListCallbacks=[]}}]),e}(),pa=n(93),va=n.n(pa),ga=n(94),ja=n.n(ga),Oa=Object(v.a)({root:function(e){return{height:e.appBarHidden?"100vh":"calc(100vh - 64px)",position:"relative",overflowX:"hidden"}},container:{width:"100%",height:"100%"},videoFrame:{width:"100%",height:"100%",border:0,display:"block"}});function ma(e,t,n,a){var i;i=n&&n.length>0?a?n[n.length-1].end:n[n.length-1].originalEnd:0;var r=e.current&&e.current.duration?1e3*e.current.duration:0,o=t.current&&t.current.duration?1e3*t.current.duration:0;return Math.max(o,Math.max(i,r))}function ka(e){var t,n=e.sources,a=n.subtitleFiles,i=n.flattenSubtitleFiles,r=n.audioFile,u=n.audioFileUrl,l=n.videoFile,f=n.videoFileUrl,h=e.subtitleReader,p=e.settingsProvider,v=e.playbackPreferences,g=e.keyBinder,j=e.extension,O=e.videoFrameRef,m=e.videoChannelRef,k=e.drawerOpen,y=e.appBarHidden,x=e.videoFullscreen,S=e.hideSubtitlePlayer,C=e.videoPopOut,w=e.tab,T=e.availableTabs,F=e.ankiDialogRequested,P=e.ankiDialogFinishedRequest,R=e.onError,E=e.onUnloadAudio,_=e.onUnloadVideo,B=e.onCopy,A=e.onLoaded,I=e.onTabSelected,N=e.onAnkiDialogRequest,D=e.onAppBarToggle,L=e.onFullscreenToggle,W=e.onHideSubtitlePlayer,U=e.onVideoPopOut,H=e.onPlayModeChangedViaBind,z=e.disableKeyEvents,V=e.jumpToSubtitle,q=e.rewindSubtitle,K=Object(b.useState)(Y.normal),G=Object(c.a)(K,2),X=G[0],Z=G[1],$=Object(b.useRef)();$.current=X;var ae=Object(b.useState)(),ie=Object(c.a)(ae,2),re=ie[0],se=ie[1],ce=Object(b.useMemo)((function(){return new ee(null!==re&&void 0!==re?re:[],{returnLastShown:!0,returnNextToShow:X===Y.condensed,showingCheckRadiusMs:100})}),[re,X]),ue=Object(b.useRef)();ue.current=re;var le=re&&re.length>0&&Boolean(f||u),de=Object(b.useState)(!1),be=Object(c.a)(de,2),fe=be[0],he=be[1],pe=Object(b.useState)(!1),ve=Object(c.a)(pe,2),ge=ve[0],je=ve[1],Oe=Object(b.useState)(0),me=Object(c.a)(Oe,2),ke=me[0],ye=me[1],xe=Object(b.useState)(0),Se=Object(c.a)(xe,2),Ce=Se[0],we=Se[1],Te=Object(b.useState)(1),Fe=Object(c.a)(Te,2),Pe=Fe[0],Re=Fe[1],Ee=Object(b.useRef)();Ee.current=ge;var _e=Object(b.useState)(),Be=Object(c.a)(_e,2)[1],Ae=Object(b.useState)(),Ie=Object(c.a)(Ae,2),Ne=Ie[0],De=Ie[1],Le=Object(b.useState)(),We=Object(c.a)(Le,2),Ue=We[0],He=We[1],ze=Object(b.useState)(),Ve=Object(c.a)(ze,2),qe=Ve[0],Ke=Ve[1],Ge=Object(b.useState)(!1),Xe=Object(c.a)(Ge,2)[1],Je=Object(b.useRef)();Je.current=S;var Qe=Object(b.useState)({}),Ye=Object(c.a)(Qe,2),Ze=Ye[0],$e=Ye[1],et=Object(b.useCallback)((function(){return Be({})}),[]),tt=Object(b.useRef)({x:0,y:0}),nt=Object(b.useRef)(null),at=Object(b.useRef)(),it=Object(b.useMemo)((function(){return new aa(u?nt:f||w?at:{current:null})}),[u,f,w]),rt=Object(b.useMemo)((function(){return new bn}),[]),ot=Oa({appBarHidden:y}),st=Object(b.useRef)(0);st.current=ma(nt,at,re,!0);var ct=Object(b.useCallback)((function(){X!==Y.autoPause||p.autoPausePreference!==Q.atStart||f||vt(rt,it,!0)}),[X,rt,it,f,p]),ut=Object(b.useCallback)((function(){X!==Y.autoPause||p.autoPausePreference!==Q.atEnd||f||vt(rt,it,!0)}),[X,rt,it,f,p]),lt=Object(b.useMemo)((function(){var e=new te;return e.onStartedShowing=ct,e.onWillStopShowing=ut,e}),[ct,ut]),dt=Object(b.useRef)();dt.current=lt;var bt=Object(b.useCallback)(function(){var e=Object(s.a)(d.a.mark((function e(t,n,a){var i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.setTime(t),et(),!a){e.next=5;break}return e.next=5,it.seek(t/1e3);case 5:null===(i=dt.current)||void 0===i||i.clear();case 6:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),[et,it]),ft=Object(b.useCallback)((function(e,t){rt.rate=e,Re(e),t&&it.playbackRate(e)}),[rt,it]),ht=Object(b.useCallback)((function(e,t){we(e),se((function(n){if(n){var i=n.length>0?n[n.length-1].end+e:0,r=n.map((function(t,n){return{text:t.text,textImage:t.textImage,start:t.originalStart+e,originalStart:t.originalStart,end:t.originalEnd+e,originalEnd:t.originalEnd,displayTime:Wt(t.originalStart+e,i),track:t.track,index:n}}));return t&&at.current instanceof ha&&(at.current.offset(e),void 0!==w&&j.installed&&va()(j.version,"0.22.0")&&at.current.subtitles(r,a.map((function(e){return e.name})))),r}})),v.offset=e}),[a,j,v,w]);function pt(e,t,n){je(!0),e.start(),n&&t.play()}function vt(e,t,n){je(!1),e.stop(),n&&t.pause()}Object(b.useEffect)((function(){var e=void 0,t=!1;function n(){return n=Object(s.a)(d.a.mark((function n(){var c,b,g,O,k,y;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(at.current instanceof ha&&at.current.close(),at.current=void 0,m.current=null,rt.setTime(0),rt.stop(),c=v.offset,we(c),je(!1),De(void 0),He(void 0),Z(Y.normal),nt.current&&(nt.current.currentTime=0,nt.current.pause()),!(a.length>0)){n.next=33;break}return he(!0),n.prev=14,n.next=17,h.subtitles(a,i);case 17:g=n.sent,O=g.length>0?g[g.length-1].end+c:0,b=g.map((function(e,t){return{text:e.text,textImage:e.textImage,start:e.start+c,originalStart:e.start,end:e.end+c,originalEnd:e.end,displayTime:Wt(e.start+c,O),track:e.track,index:t}})),se(b),ye(Date.now()),n.next=28;break;case 24:n.prev=24,n.t0=n.catch(14),n.t0 instanceof Error?R(n.t0.message):R(String(n.t0)),se([]);case 28:return n.prev=28,he(!1),n.finish(28);case 31:n.next=34;break;case 33:b=void 0;case 34:if(!u){n.next=40;break}return n.next=37,it.onReady();case 37:et(),n.next=64;break;case 40:if(!f&&!w){n.next=64;break}if(!t){n.next=43;break}return n.abrupt("return");case 43:if(!f){n.next=49;break}k=Object(ne.a)(),e=new ha(new ln(k)),Ke(k),n.next=55;break;case 49:if(!w){n.next=54;break}(e=new ha(new dn(w.id,w.src,j))).init(),n.next=55;break;case 54:throw new Error("Unreachable code");case 55:at.current=e,m.current=e,y=!1,e.onExit((function(){return f&&_(f)})),e.onPopOutToggle((function(){return U()})),e.onHideSubtitlePlayerToggle((function(){W()})),e.onAppBarToggle((function(){D()})),e.onFullscreenToggle((function(){L()})),e.onReady((function(t){var n,c,u,b,f,h,v,g,j,O,m,k,x,S,C,w,T,F,P,R,E,M,_,A;(st.current=ma(nt,at,ue.current),null===(n=e)||void 0===n||n.ready(st.current,null===l||void 0===l?void 0:l.name),ue.current)&&(null===(m=e)||void 0===m||m.subtitleSettings(p.subtitleSettings),null===(k=e)||void 0===k||k.subtitles(ue.current,i?[a[0].name]:a.map((function(e){return e.name}))));(null===(c=e)||void 0===c||c.ankiSettings(p.ankiSettings),null===(u=e)||void 0===u||u.miscSettings(p.miscSettings),null===(b=e)||void 0===b||b.playMode($.current),null===(f=e)||void 0===f||f.hideSubtitlePlayerToggle(null!==(h=Je.current)&&void 0!==h&&h),null!==(v=e)&&void 0!==v&&v.audioTracks&&(null===(g=e)||void 0===g||null===(j=g.audioTracks)||void 0===j?void 0:j.length)>1)?(De(null===(x=e)||void 0===x?void 0:x.audioTracks),He(null===(S=e)||void 0===S?void 0:S.selectedAudioTrack)):(De(void 0),He(void 0));(at.current&&rt.setTime(1e3*at.current.currentTime),t?rt.stop():rt.start(),je(!t),null!==(O=e)&&void 0!==O&&O.playbackRate&&(rt.rate=e.playbackRate,Re(e.playbackRate)),y)||(null===(C=e)||void 0===C||C.onPlay((function(e){return pt(rt,it,e)})),null===(w=e)||void 0===w||w.onPause((function(e){return vt(rt,it,e)})),null===(T=e)||void 0===T||T.onOffset((function(e){var t;return ht(Math.max(null!==(t=-st.current)&&void 0!==t?t:0,e),!1)})),null===(F=e)||void 0===F||F.onPlaybackRate((function(e,t){return ft(e,t)})),null===(P=e)||void 0===P||P.onCopy((function(t,n,i,o,s,c,u,d){var b,f;return B(t,n,r,l,t?a[t.track]:void 0,rt.time(st.current),null===(b=e)||void 0===b?void 0:b.selectedAudioTrack,null===(f=e)||void 0===f?void 0:f.playbackRate,i,o,s,c,u,d)})),null===(R=e)||void 0===R||R.onPlayMode((function(t){var n;Z(t),null===(n=e)||void 0===n||n.playMode(t)})),null===(E=e)||void 0===E||E.onCurrentTime(function(){var e=Object(s.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ee.current&&rt.stop(),e.next=3,bt(1e3*t,rt,n);case 3:Ee.current&&rt.start();case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),null===(M=e)||void 0===M||M.onAudioTrackSelected(function(){var e=Object(s.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ee.current&&rt.stop(),e.next=3,it.onReady();case 3:Ee.current&&rt.start(),He(t);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),null===(_=e)||void 0===_||_.onAnkiDialogRequest((function(){return N()})),null===(A=e)||void 0===A||A.onToggleSubtitleTrackInList((function(e){return $e((function(t){var n=Object(o.a)({},t);return n[e]=!t[e],n}))})),y=!0)}));case 64:case"end":return n.stop()}}),n,null,[[14,24,28,31]])}))),n.apply(this,arguments)}return function(){return n.apply(this,arguments)}().then((function(){return A()})),function(){var n;null===(n=e)||void 0===n||n.close(),t=!0}}),[h,j,p,v,rt,it,bt,A,R,_,B,N,W,D,L,U,a,r,u,l,f,w,et,O,m,ht,ft,i]),Object(b.useEffect)((function(){P&&P.timestamp>0&&Xe((function(e){return e&&P.resume&&pt(rt,it,!0),!1}))}),[P,rt,it]),Object(b.useEffect)((function(){F&&Ee.current&&(vt(rt,it,!0),Xe(!0))}),[F,rt,it]),Object(b.useEffect)((function(){if(X===Y.condensed&&re&&0!==re.length){var e=!1,t=1e3,n=setInterval(Object(s.a)(d.a.mark((function n(){var a,i,r,o,s;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=st.current){n.next=3;break}return n.abrupt("return");case 3:if(i=rt.time(a),!((r=ce.subtitlesAt(i)).nextToShow&&r.nextToShow.length>0)){n.next=18;break}if(!((o=r.nextToShow[0]).start-i<t+500)){n.next=9;break}return n.abrupt("return");case 9:if(Ee.current&&rt.stop(),e){n.next=17;break}return e=!0,s=Date.now(),n.next=15,bt(o.start,rt,!0);case 15:t=Date.now()-s,e=!1;case 17:Ee.current&&rt.start();case 18:case"end":return n.stop()}}),n)}))),100);return function(){return clearInterval(n)}}}),[re,ce,X,rt,bt]),Object(b.useEffect)((function(){C&&qe&&f&&window.open("/asbplayer/?video="+encodeURIComponent(f)+"&channel="+qe+"&popout=true","asbplayer-video-"+f,"resizable,width=800,height=450"),ye(Date.now())}),[C,qe,f,O]);var gt=Object(b.useCallback)((function(){return pt(rt,it,!0)}),[rt,it]),jt=Object(b.useCallback)((function(){return vt(rt,it,!0)}),[rt,it]),Ot=Object(b.useCallback)(function(){var e=Object(s.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(st.current){e.next=2;break}return e.abrupt("return");case 2:return Ee.current&&rt.stop(),e.next=5,bt(t*st.current,rt,!0);case 5:Ee.current&&rt.start();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[rt,bt]),mt=Object(b.useCallback)(function(){var e=Object(s.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n||vt(rt,it,!0),Ee.current&&rt.stop(),e.next=4,bt(t,rt,!0);case 4:n&&!Ee.current&&pt(rt,it,!0);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[rt,bt,it]),kt=Object(b.useCallback)((function(e,t,n,i){B(e,t,r,l,a[e.track],rt.time(st.current),Ue,Pe,void 0,void 0,void 0,n,i,void 0)}),[rt,B,r,l,a,Ue,Pe]),yt=Object(b.useCallback)((function(e){tt.current.x=e.screenX,tt.current.y=e.screenY}),[]),xt=Object(b.useCallback)(function(){var e=Object(s.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return at.current instanceof ha&&at.current.audioTrackSelected(t),vt(rt,it,!0),e.next=4,bt(0,rt,!0);case 4:Ee.current&&pt(rt,it,!0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[rt,it,bt]),St=Object(b.useCallback)((function(e){var t;ht(Math.max(null!==(t=-st.current)&&void 0!==t?t:0,e),!0)}),[ht]),Ct=Object(b.useCallback)((function(e){nt.current instanceof HTMLMediaElement&&(nt.current.volume=e)}),[]),wt=Object(b.useCallback)((function(e){ft(e,!0)}),[ft]),Tt=Object(b.useCallback)((function(e){return Z(e)}),[]),Ft=Object(b.useCallback)((function(e){return $e((function(t){var n=Object(o.a)({},t);return n[e]=!t[e],n}))}),[]),Pt=Object(b.useCallback)((function(e){0!==e.length&&p.autoCopyCurrentSubtitle&&document.hasFocus()&&navigator.clipboard.writeText(e.map((function(e){return e.text})).join("\n")).catch((function(e){}))}),[p.autoCopyCurrentSubtitle]);Object(b.useEffect)((function(){if(!w){var e=setInterval(Object(s.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=st.current,!(rt.progress(t)>=1)){e.next=7;break}return vt(rt,it,!0),e.next=6,bt(0,rt,!0);case 6:ye(Date.now());case 7:case"end":return e.stop()}}),e)}))),1e3);return function(){return clearInterval(e)}}}),[rt,re,it,bt,w]),Object(b.useEffect)((function(){var e=g.bindPlay((function(e){e.preventDefault(),ge?vt(rt,it,!0):pt(rt,it,!0)}),(function(){return z}));return function(){return e()}}),[g,ge,rt,it,z]),Object(b.useEffect)((function(){return g.bindAdjustPlaybackRate((function(e,t){e.preventDefault(),ft(t?Math.min(5,Pe+.1):Math.max(.1,Pe-.1),!0)}),(function(){return z}))}),[ft,Pe,z,g]);var Rt=Object(b.useCallback)((function(e,t){if(le){e.preventDefault();var n=X===t?Y.normal:t;Z(n),H(X,n),at.current instanceof ha&&at.current.playMode(n)}}),[X,le,H]);Object(b.useEffect)((function(){return g.bindAutoPause((function(e){return Rt(e,Y.autoPause)}),(function(){return z}))}),[Rt,g,z]),Object(b.useEffect)((function(){return g.bindCondensedPlayback((function(e){return Rt(e,Y.condensed)}),(function(){return z}))}),[Rt,g,z]),Object(b.useEffect)((function(){if((r||l)&&(!re||0===re.length)){var e=g.bindCopy((function(e,t){e.preventDefault(),e.stopPropagation();var n=M(t,st.current,5e3);B(t,n,r,l,void 0,rt.time(st.current),Ue,Pe,void 0,void 0,void 0,void 0,void 0,void 0)}),(function(){return z}),(function(){if(st.current){var e=rt.time(st.current),t=Math.min(e+5e3,st.current);return{text:"",start:e,originalStart:e,end:t,originalEnd:t,track:0}}})),t=g.bindAnkiExport((function(e){e.preventDefault(),e.stopPropagation();var t=rt.time(st.current),n=Math.min(t+5e3,st.current),a={text:"",start:t,originalStart:t,end:n,originalEnd:n,track:0},i=M(a,st.current,5e3);B(a,i,r,l,void 0,t,Ue,Pe,void 0,void 0,void 0,J.showAnkiDialog,void 0,void 0)}),(function(){return!1}));return function(){e(),t()}}}),[g,r,l,re,rt,Pe,Ue,z,B,N]),Object(b.useEffect)((function(){at.current instanceof ha&&at.current.appBarToggle(y)}),[y]),Object(b.useEffect)((function(){at.current instanceof ha&&at.current.hideSubtitlePlayerToggle(S)}),[S]),Object(b.useEffect)((function(){at.current instanceof ha&&at.current.fullscreenToggle(x)}),[x]),Object(b.useEffect)((function(){q&&(Ee.current&&rt.stop(),mt(q.start,!1))}),[rt,q,mt]);var Et=st.current,Mt=u||f||re,_t=Boolean(Mt&&f&&!C);return Object(oe.jsxs)("div",{onMouseMove:yt,className:ot.root,children:[Object(oe.jsxs)(Me.a,{container:!0,direction:"row",wrap:"nowrap",className:ot.container,children:[_t&&Object(oe.jsx)(Me.a,{item:!0,style:{flexGrow:1,minWidth:600},children:Object(oe.jsx)("iframe",{ref:O,className:ot.videoFrame,src:"/asbplayer/?video="+encodeURIComponent(f)+"&channel="+qe+"&popout=false",title:"asbplayer"})}),(!_t||re&&(null===(t=re)||void 0===t?void 0:t.length)>0)&&Object(oe.jsxs)(Me.a,{item:!0,style:{flexGrow:_t?0:1,width:_t&&S?0:"auto"},children:[Mt&&!(f&&!C)&&Object(oe.jsx)(na,{mousePositionRef:tt,playing:ge,clock:rt,length:Et,displayLength:ma(nt,at,re,!1),audioTracks:Ne,selectedAudioTrack:Ue,tabs:!f&&!u&&T||void 0,selectedTab:w,audioFile:null===r||void 0===r?void 0:r.name,videoFile:null===l||void 0===l?void 0:l.name,offsetEnabled:!0,offset:Ce,playbackRate:Pe,playbackRateEnabled:!w||j.installed&&ja()(j.version,"0.24.0"),onPlaybackRateChange:wt,volumeEnabled:Boolean(u),playModeEnabled:le,playMode:X,onPlay:gt,onPause:jt,onSeek:Ot,onAudioTrackSelected:xt,onTabSelected:I,onUnloadAudio:function(){return u&&E(u)},onUnloadVideo:function(){return f&&_(f)},onOffsetChange:St,onVolumeChange:Ct,onPlayMode:Tt,disableKeyEvents:z,playbackPreferences:v,showOnMouseMovement:!0}),Object(oe.jsx)(fa,{playing:ge,subtitles:re,subtitleCollection:ce,clock:rt,length:Et,jumpToSubtitle:V,drawerOpen:k,appBarHidden:y,compressed:Boolean(f&&!C),copyButtonEnabled:void 0===w,loading:fe,displayHelp:(null===r||void 0===r?void 0:r.name)||C&&(null===l||void 0===l?void 0:l.name)||void 0,disableKeyEvents:z,lastJumpToTopTimestamp:ke,hidden:_t&&S,disabledSubtitleTracks:Ze,onSeek:mt,onCopy:kt,onOffsetChange:St,onToggleSubtitleTrack:Ft,onSubtitlesSelected:Pt,autoPauseContext:lt,settingsProvider:p,keyBinder:g})]})]}),Object(oe.jsx)("audio",{ref:nt,src:u})]})}var ya=n(443);function xa(e){var t=e.open,n=e.onProceed,a=e.onCancel,i=e.existingCustomFieldNames,o=Object(b.useState)(""),s=Object(c.a)(o,2),u=s[0],l=s[1];Object(b.useEffect)((function(){l("")}),[t]);var d=[].concat(Object(r.a)(i),["Sentence","Word","Definition","Source","Image","Audio"]).includes(u);return Object(oe.jsxs)(ve.a,{open:t,disableEnforceFocus:!0,fullWidth:!0,maxWidth:"xs",onClose:a,children:[Object(oe.jsx)(ya.a,{children:"New Custom Field"}),Object(oe.jsx)(Te.a,{children:Object(oe.jsx)("form",{children:Object(oe.jsx)(le.a,{error:d,helperText:d&&"Field ".concat(u," already exists"),variant:"filled",fullWidth:!0,label:"Field Name",value:u,color:"secondary",onChange:function(e){return l(e.target.value)}})})}),Object(oe.jsxs)(we.a,{children:[Object(oe.jsx)(xe.a,{onClick:function(){return a()},children:"Cancel"}),Object(oe.jsx)(xe.a,{disabled:d||""===u.trim(),onClick:function(){return n(u.trim())},children:"Create"})]})]})}var Sa=n(233),Ca=n.n(Sa),wa=n(235),Ta=n.n(wa),Fa=n(377),Pa=n(445),Ra=n(383),Ea=n(380),Ma=n(379),_a=n(378),Ba=n(444),Aa=n(232),Ia=n.n(Aa),Na=n(452),Da=n(234),La=n.n(Da),Wa=n(384),Ua=n(30),Ha=n(446),za=n(447),Va=Object(fe.a)((function(e){return{root:{"& .MuiTextField-root":{marginTop:e.spacing(1),marginBottom:e.spacing(1)}},subtitleSetting:{"& .MuiTextField-root":{marginTop:e.spacing(1),marginBottom:e.spacing(1)}},subtitlePreview:{backgroundImage:"linear-gradient(45deg, ".concat(e.palette.action.disabledBackground," 25%, transparent 25%), linear-gradient(-45deg, ").concat(e.palette.action.disabledBackground," 25%, transparent 25%), linear-gradient(45deg, transparent 75%, ").concat(e.palette.action.disabledBackground," 75%), linear-gradient(-45deg, transparent 75%,").concat(e.palette.action.disabledBackground," 75%)"),backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px",marginTop:e.spacing(1),marginBottom:e.spacing(1),maxWidth:"100%",padding:10},subtitlePreviewInput:{border:"none",width:"100%",textAlign:"center",backgroundColor:"rgba(0,0,0,0)","&:focus":{outline:"none"}},addFieldButton:{width:"100%"},switchLabel:{justifyContent:"space-between",marginLeft:0}}})),qa=Object(fe.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120},root:{display:"flex",flexDirection:"row",justifyContent:"end",alignItems:"flex-end"}}}));function Ka(e){var t=e.label,n=e.value,a=e.selections,i=e.removable,r=e.onChange,o=e.onSelectionChange,s=e.onRemoval,c=qa();return Object(oe.jsxs)("div",{className:c.root,children:[Object(oe.jsx)(le.a,{label:t,value:n,onChange:r,fullWidth:!0,color:"secondary",InputProps:{endAdornment:i&&Object(oe.jsx)(Be.a,{position:"end",children:Object(oe.jsx)(_e.a,{onClick:function(e){return null===s||void 0===s?void 0:s()},children:Object(oe.jsx)(Ia.a,{})})})}}),Object(oe.jsxs)(Fa.a,{className:c.formControl,children:[Object(oe.jsx)(_a.a,{}),Object(oe.jsx)(Wa.a,{value:n,disabled:!a,color:"secondary",onChange:o,children:a&&a.map((function(e){return Object(oe.jsx)(Ba.a,{value:e,children:e},e)}))})]})]})}var Ga={copySubtitle:{label:"Mine current subtitle",extensionOverridden:!0},ankiExport:{label:"Mine current subtitle and open Anki dialog",extensionOverridden:!0},updateLastCard:{label:"Update last-created Anki card with asbplayer-captured screenshot, audio, etc.",extensionOverridden:!0},togglePlay:{label:"Play/pause",extensionOverridden:!1},toggleAutoPause:{label:"Toggle auto-pause",extensionOverridden:!1},toggleCondensedPlayback:{label:"Toggle condensed playback",extensionOverridden:!1},toggleSubtitles:{label:"Toggle subtitles",extensionOverridden:!1},toggleVideoSubtitleTrack1:{label:"Toggle subtitle track 1 in video",extensionOverridden:!1},toggleVideoSubtitleTrack2:{label:"Toggle subtitle track 2 in video",extensionOverridden:!1},toggleAsbplayerSubtitleTrack1:{label:"Toggle subtitle track 1 in asbplayer",extensionOverridden:!1},toggleAsbplayerSubtitleTrack2:{label:"Toggle subtitle track 2 in asbplayer",extensionOverridden:!1},seekBackward:{label:"Seek backward 10 seconds",extensionOverridden:!1},seekForward:{label:"Seek forward 10 seconds",extensionOverridden:!1},seekToPreviousSubtitle:{label:"Seek to previous subtitle",extensionOverridden:!1},seekToNextSubtitle:{label:"Seek to next subtitle",extensionOverridden:!1},seekToBeginningOfCurrentSubtitle:{label:"Seek to beginning of current subtitle",extensionOverridden:!1},adjustOffsetToPreviousSubtitle:{label:"Adjust subtitle offset so that previous subtitle is at current timestamp",extensionOverridden:!1},adjustOffsetToNextSubtitle:{label:"Adjust subtitle offset so that next subtitle is at current timestamp",extensionOverridden:!1},increaseOffset:{label:"Adjust subtitle offset by +100ms",extensionOverridden:!1},decreaseOffset:{label:"Adjust subtitle offset by -100ms",extensionOverridden:!1},resetOffset:{label:"Reset subtitle offset",extensionOverridden:!1},increasePlaybackRate:{label:"Adjust playback rate by +0.1",extensionOverridden:!1},decreasePlaybackRate:{label:"Adjust playback rate by -0.1",extensionOverridden:!1}},Xa=Ua.isMacOs?{}:{"\u2303":"ctrl","\u21e7":"shift","\u2325":"alt"},Ja=["\u2303","\u21e7","\u2325","ctrl","shift","alt","option","control","command","\u2318"],Qa=Object(fe.a)((function(e){return{container:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},labelItem:{}}}));function Ya(e){var t=e.label,n=e.keys,a=e.extensionOverridden,i=e.onKeysChange,r=e.onOpenExtensionShortcuts,o=Qa(),s=Object(b.useState)(n),u=Object(c.a)(s,2),l=u[0],d=u[1],f=Object(b.useRef)();f.current=l;var h=Object(b.useRef)();h.current=i;var p=Object(b.useState)(!1),v=Object(c.a)(p,2),g=v[0],j=v[1];Object(b.useEffect)((function(){return d(n)}),[n]);var O,m=Object(b.useCallback)((function(e){0!==e.nativeEvent.detail&&(a?r():(d(""),j(!0)))}),[r,a]),k=Object(b.useRef)(null);return Object(b.useEffect)((function(){if(g){var e=function(e){if("keydown"===e.type){var t=x.a.getPressedKeyString();d(t.map((function(e){var t;return null!==(t=Xa[e])&&void 0!==t?t:e})).sort((function(e,t){var n=Ja.includes(e),a=Ja.includes(t);return n&&!a?-1:!n&&a?1:0})).join("+"))}else"keyup"===e.type&&(j(!1),f.current&&h.current(f.current))};return Object(x.a)("*",{keyup:!0},e),function(){return x.a.unbind("*",e)}}}),[g]),Object(b.useEffect)((function(){var e=function(e){var t;!g||null!==(t=k.current)&&void 0!==t&&t.contains(e.target)||(j(!1),d(""),i(""))};return window.document.addEventListener("click",e),function(){return window.document.removeEventListener("click",e)}}),[g,i]),O=g?"Recording":a?"Overridden":"Unbound",Object(oe.jsxs)(Me.a,{container:!0,className:o.container,wrap:"nowrap",spacing:1,children:[Object(oe.jsx)(Me.a,{item:!0,className:o.labelItem,xs:6,children:Object(oe.jsx)(qe.a,{children:t})}),Object(oe.jsx)(Me.a,{item:!0,xs:6,children:Object(oe.jsx)(le.a,{placeholder:O,size:"small",contentEditable:!1,disabled:a,helperText:a?"Extension shortcut":void 0,value:l,color:"secondary",InputProps:{endAdornment:Object(oe.jsx)(Be.a,{position:"end",children:Object(oe.jsx)(_e.a,{ref:k,onClick:m,children:Object(oe.jsx)(Ca.a,{})})})}})})]})}function Za(e){var t=e.anki,n=e.extension,a=e.open,i=e.settings,u=e.scrollToId,l=e.onClose,h=Va(),p=Object(b.useState)(i.ankiConnectUrl),v=Object(c.a)(p,2),g=v[0],j=v[1],O=Object(b.useState)(),m=Object(c.a)(O,2),k=m[0],y=m[1],x=Object(b.useState)(0),S=Object(c.a)(x,2),C=S[0],w=S[1],T=Object(b.useState)(i.deck||""),F=Object(c.a)(T,2),P=F[0],R=F[1],E=Object(b.useState)(),M=Object(c.a)(E,2),_=M[0],B=M[1],A=Object(b.useState)(i.noteType||""),I=Object(c.a)(A,2),N=I[0],D=I[1],L=Object(b.useState)(),W=Object(c.a)(L,2),U=W[0],H=W[1],z=Object(b.useState)(i.sentenceField||""),V=Object(c.a)(z,2),q=V[0],K=V[1],G=Object(b.useState)(i.definitionField||""),X=Object(c.a)(G,2),J=X[0],Y=X[1],Z=Object(b.useState)(i.audioField||""),$=Object(c.a)(Z,2),ee=$[0],te=$[1],ne=Object(b.useState)(i.imageField||""),ae=Object(c.a)(ne,2),ie=ae[0],re=ae[1],se=Object(b.useState)(i.wordField||""),ce=Object(c.a)(se,2),ue=ce[0],de=ce[1],fe=Object(b.useState)(i.sourceField||""),he=Object(c.a)(fe,2),pe=he[0],ge=he[1],je=Object(b.useState)(i.urlField||""),Oe=Object(c.a)(je,2),me=Oe[0],ke=Oe[1],ye=Object(b.useState)(i.customAnkiFields),Se=Object(c.a)(ye,2),Ce=Se[0],Fe=Se[1],Pe=Object(b.useState)(i.tags),Re=Object(c.a)(Pe,2),Ee=Re[0],Ae=Re[1],Ie=Object(b.useState)(i.preferMp3),Ne=Object(c.a)(Ie,2),De=Ne[0],Le=Ne[1],We=Object(b.useState)(),Ue=Object(c.a)(We,2),He=Ue[0],ze=Ue[1],qe=Object(b.useState)(!1),Ke=Object(c.a)(qe,2),Ge=Ke[0],Xe=Ke[1],Je=Object(b.useState)(i.audioPaddingStart),Qe=Object(c.a)(Je,2),Ye=Qe[0],Ze=Qe[1],$e=Object(b.useState)(i.audioPaddingEnd),et=Object(c.a)($e,2),tt=et[0],nt=et[1],at=Object(b.useState)(i.maxImageWidth),it=Object(c.a)(at,2),rt=it[0],ot=it[1],st=Object(b.useState)(i.maxImageHeight),ct=Object(c.a)(st,2),ut=ct[0],lt=ct[1],dt=Object(b.useState)(i.surroundingSubtitlesCountRadius),bt=Object(c.a)(dt,2),ft=bt[0],ht=bt[1],pt=Object(b.useState)(i.surroundingSubtitlesTimeRadius),vt=Object(c.a)(pt,2),gt=vt[0],jt=vt[1],Ot=Object(b.useState)(i.subtitleColor),mt=Object(c.a)(Ot,2),kt=mt[0],yt=mt[1],xt=Object(b.useState)(i.subtitleSize),St=Object(c.a)(xt,2),Ct=St[0],wt=St[1],Tt=Object(b.useState)(i.subtitleOutlineColor),Ft=Object(c.a)(Tt,2),Pt=Ft[0],Rt=Ft[1],Et=Object(b.useState)(i.subtitleOutlineThickness),Mt=Object(c.a)(Et,2),_t=Mt[0],Bt=Mt[1],At=Object(b.useState)(i.subtitleBackgroundColor),It=Object(c.a)(At,2),Nt=It[0],Dt=It[1],Wt=Object(b.useState)(i.subtitleBackgroundOpacity),Ut=Object(c.a)(Wt,2),Ht=Ut[0],zt=Ut[1],Vt=Object(b.useState)(i.subtitleFontFamily),qt=Object(c.a)(Vt,2),Kt=qt[0],Gt=qt[1],Xt=Object(b.useState)(i.imageBasedSubtitleScaleFactor),Jt=Object(c.a)(Xt,2),Qt=Jt[0],Yt=Jt[1],Zt=Object(b.useState)(i.subtitlePreview),$t=Object(c.a)(Zt,2),en=$t[0],tn=$t[1],nn=Object(b.useState)(i.themeType),an=Object(c.a)(nn,2),rn=an[0],on=an[1],cn=Object(b.useState)(i.copyToClipboardOnMine),un=Object(c.a)(cn,2),ln=un[0],dn=un[1],bn=Object(b.useState)(i.autoPausePreference),fn=Object(c.a)(bn,2),hn=fn[0],pn=fn[1],vn=Object(b.useState)(i.keyBindSet),gn=Object(c.a)(vn,2),jn=gn[0],On=gn[1],mn=Object(b.useState)(i.rememberSubtitleOffset),kn=Object(c.a)(mn,2),yn=kn[0],xn=kn[1],Sn=Object(b.useState)(i.autoCopyCurrentSubtitle),Cn=Object(c.a)(Sn,2),wn=Cn[0],Tn=Cn[1],Fn=Object(b.useState)(i.subtitleRegexFilter),Pn=Object(c.a)(Fn,2),Rn=Pn[0],En=Pn[1],Mn=Object(b.useState)(i.subtitleRegexFilterTextReplacement),_n=Object(c.a)(Mn,2),Bn=_n[0],An=_n[1],In=Object(b.useCallback)((function(e){j(e.target.value),w(Date.now())}),[]),Nn=Object(b.useCallback)((function(e){return w(Date.now())}),[]),Dn=Object(b.useCallback)((function(e){return R(e.target.value)}),[]),Ln=Object(b.useCallback)((function(e){return R(e.target.value)}),[]),Wn=Object(b.useCallback)((function(e){return D(e.target.value)}),[]),Un=Object(b.useCallback)((function(e){return D(e.target.value)}),[]),Hn=Object(b.useCallback)((function(e){return K(e.target.value)}),[]),zn=Object(b.useCallback)((function(e){return K(e.target.value)}),[]),Vn=Object(b.useCallback)((function(e){return Y(e.target.value)}),[]),qn=Object(b.useCallback)((function(e){return Y(e.target.value)}),[]),Kn=Object(b.useCallback)((function(e){return te(e.target.value)}),[]),Gn=Object(b.useCallback)((function(e){return te(e.target.value)}),[]),Xn=Object(b.useCallback)((function(e){return re(e.target.value)}),[]),Jn=Object(b.useCallback)((function(e){return re(e.target.value)}),[]),Qn=Object(b.useCallback)((function(e){return de(e.target.value)}),[]),Yn=Object(b.useCallback)((function(e){return de(e.target.value)}),[]),Zn=Object(b.useCallback)((function(e){return ge(e.target.value)}),[]),$n=Object(b.useCallback)((function(e){return ge(e.target.value)}),[]),ea=Object(b.useCallback)((function(e){return ke(e.target.value)}),[]),ta=Object(b.useCallback)((function(e){return ke(e.target.value)}),[]),na=Object(b.useCallback)((function(e){return Ze(Number(e.target.value))}),[]),aa=Object(b.useCallback)((function(e){return nt(Number(e.target.value))}),[]),ia=Object(b.useCallback)((function(e){return ot(Number(e.target.value))}),[]),ra=Object(b.useCallback)((function(e){return lt(Number(e.target.value))}),[]),oa=Object(b.useCallback)((function(e){return ht(Number(e.target.value))}),[]),sa=Object(b.useCallback)((function(e){return jt(Number(e.target.value))}),[]),ca=Object(b.useCallback)((function(e){return yt(e.target.value)}),[]),ua=Object(b.useCallback)((function(e){return wt(Number(e.target.value))}),[]),la=Object(b.useCallback)((function(e){return Rt(e.target.value)}),[]),da=Object(b.useCallback)((function(e){return Bt(Number(e.target.value))}),[]),ba=Object(b.useCallback)((function(e){return Dt(e.target.value)}),[]),fa=Object(b.useCallback)((function(e){return zt(Number(e.target.value))}),[]),ha=Object(b.useCallback)((function(e){return Gt(e.target.value)}),[]),pa=Object(b.useCallback)((function(e){return tn(e.target.value)}),[]),va=Object(b.useCallback)((function(e){return Yt(Number(e.target.value))}),[]),ga=Object(b.useCallback)((function(e){Fe((function(t){var n={};return Object.assign(n,t),n[e]="",n})),Xe(!1)}),[]),ja=Object(b.useCallback)((function(e,t){Fe((function(n){var a={};return Object.assign(a,n),a[e]=t,a}))}),[]),Oa=Object(b.useCallback)((function(e){return Fe((function(t){var n={};return Object.assign(n,t),delete n[e],n}))}),[]),ma=Object(b.useCallback)((function(e){Ae(e)}),[]),ka=Object(b.useCallback)((function(e){return Le(e.target.checked)}),[]),Sa=Object(b.useCallback)((function(e){if("dark"!==e.target.value&&"light"!==e.target.value)throw new Error("Invalid theme type ".concat(e.target.value));on(e.target.value)}),[]),Ca=Object(b.useCallback)((function(e){return dn(e.target.checked)}),[]),wa=Object(b.useCallback)((function(e){pn(Number(e.target.value))}),[]),Fa=Object(b.useCallback)((function(e,t){On((function(n){var a=Object(o.a)({},n);return a[t]={keys:e},a}))}),[]),_a=Object(b.useCallback)((function(e){return xn(e.target.checked)}),[]),Ba=Object(b.useCallback)((function(e){return Tn(e.target.checked)}),[]),Aa=Object(b.useCallback)((function(e){return En(e.target.value.trim())}),[]),Ia=Object(b.useCallback)((function(e){return An(e.target.value)}),[]),Da=Object(b.useMemo)((function(){return Lt({subtitleColor:kt,subtitleSize:Ct,subtitleOutlineThickness:_t,subtitleOutlineColor:Pt,subtitleBackgroundOpacity:Ht,subtitleBackgroundColor:Nt,subtitleFontFamily:Kt})}),[kt,Ct,_t,Pt,Ht,Nt,Kt]);Object(b.useEffect)((function(){var e=!1,n=setTimeout(Object(s.a)(d.a.mark((function n(){return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e){n.next=3;break}return n.abrupt("return");case 3:return n.next=5,t.requestPermission(g);case 5:return n.t0=B,n.next=8,t.deckNames(g);case 8:return n.t1=n.sent,(0,n.t0)(n.t1),n.t2=H,n.next=13,t.modelNames(g);case 13:n.t3=n.sent,(0,n.t2)(n.t3),y(void 0),n.next=26;break;case 18:if(n.prev=18,n.t4=n.catch(0),!e){n.next=22;break}return n.abrupt("return");case 22:console.error(n.t4),B(void 0),H(void 0),n.t4 instanceof Error?y(n.t4.message):"string"===typeof n.t4?y(n.t4):y(String(n.t4));case 26:case"end":return n.stop()}}),n,null,[[0,18]])}))),1e3);return function(){e=!0,clearTimeout(n)}}),[t,g,C]),Object(b.useEffect)((function(){if(N&&!k){var e=!1;return function(){n.apply(this,arguments)}(),function(){e=!0}}function n(){return(n=Object(s.a)(d.a.mark((function n(){return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e){n.next=3;break}return n.abrupt("return");case 3:return n.t0=ze,n.t1=[""],n.t2=r.a,n.next=8,t.modelFieldNames(N,g);case 8:n.t3=n.sent,n.t4=(0,n.t2)(n.t3),n.t5=n.t1.concat.call(n.t1,n.t4),(0,n.t0)(n.t5),y(void 0),n.next=22;break;case 15:if(n.prev=15,n.t6=n.catch(0),!e){n.next=19;break}return n.abrupt("return");case 19:console.error(n.t6),ze(void 0),n.t6 instanceof Error?y(n.t6.message):"string"===typeof n.t6?y(n.t6):y(String(n.t6));case 22:case"end":return n.stop()}}),n,null,[[0,15]])})))).apply(this,arguments)}}),[t,N,g,k,C]);var Wa=Object(b.useCallback)((function(){l({ankiConnectUrl:g,deck:P,noteType:N,sentenceField:q,definitionField:J,audioField:ee,imageField:ie,wordField:ue,sourceField:pe,urlField:me,tags:Ee.filter((function(e){return""!==e})),subtitleSize:Number(Ct),subtitleColor:kt,subtitleOutlineThickness:Number(_t),subtitleOutlineColor:Pt,subtitleBackgroundColor:Nt,subtitleBackgroundOpacity:Number(Ht),subtitleFontFamily:Kt,subtitlePreview:en,imageBasedSubtitleScaleFactor:Qt,customAnkiFields:Ce,preferMp3:De,themeType:rn,audioPaddingStart:Ye,audioPaddingEnd:tt,maxImageWidth:rt,maxImageHeight:ut,surroundingSubtitlesCountRadius:ft,surroundingSubtitlesTimeRadius:gt,copyToClipboardOnMine:ln,autoPausePreference:hn,keyBindSet:jn,rememberSubtitleOffset:yn,autoCopyCurrentSubtitle:wn,subtitleRegexFilter:Rn,subtitleRegexFilterTextReplacement:Bn})}),[l,g,P,N,q,J,ee,ie,ue,pe,me,Ce,Ee,De,Ct,kt,_t,Pt,Nt,Ht,Kt,en,Qt,rn,Ye,tt,rt,ut,ft,gt,ln,hn,jn,yn,wn,Rn,Bn]),Ua=Object.keys(Ce).map((function(e){return Object(oe.jsx)(Ka,{label:"".concat(e," Field"),value:Ce[e],selections:He,onChange:function(t){return ja(e,t.target.value)},onSelectionChange:function(t){return ja(e,t.target.value)},onRemoval:function(){return Oa(e)},removable:!0},e)}));Object(b.useEffect)((function(){u&&setTimeout((function(){var e;return null===(e=document.getElementById(u))||void 0===e?void 0:e.scrollIntoView({behavior:"smooth"})}),0)}),[u]);var qa=function(e){try{return new RegExp(e.trim()),!0}catch(t){return!1}}(Rn);return Object(oe.jsxs)(f.a.Fragment,{children:[Object(oe.jsx)(xa,{open:Ge,existingCustomFieldNames:Object.keys(Ce),onProceed:ga,onCancel:function(){return Xe(!1)}}),Object(oe.jsxs)(ve.a,{open:a,maxWidth:"xs",fullWidth:!0,onClose:Wa,children:[Object(oe.jsx)(ya.a,{children:"Settings"}),Object(oe.jsx)(Te.a,{children:Object(oe.jsxs)(Me.a,{container:!0,direction:"column",spacing:3,children:[Object(oe.jsxs)(Me.a,{item:!0,id:"anki-settings",children:[Object(oe.jsx)(Ma.a,{children:"Anki"}),Object(oe.jsxs)(Ra.a,{className:h.root,children:[Object(oe.jsx)(le.a,{label:"Anki Connect URL",value:g,error:Boolean(k),helperText:k,color:"secondary",onChange:In,InputProps:{endAdornment:Object(oe.jsx)(Be.a,{position:"end",children:Object(oe.jsx)(_e.a,{onClick:Nn,children:Object(oe.jsx)(La.a,{})})})}}),Object(oe.jsxs)(Ea.a,{children:["Ensure that ",window.location.protocol+"//"+window.location.hostname," is in the webCorsOriginList in your AnkiConnect settings as in this"," ",Object(oe.jsx)(sn.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://youtu.be/Mv7fEVb6PHo?t=44",children:"video"}),"."]}),Object(oe.jsx)(Ka,{label:"Deck",value:P,selections:_,onChange:Dn,onSelectionChange:Ln}),Object(oe.jsx)(Ka,{label:"Note Type",value:N,selections:U,onChange:Wn,onSelectionChange:Un}),Object(oe.jsx)(Ka,{label:"Sentence Field",value:q,selections:He,onChange:Hn,onSelectionChange:zn}),Object(oe.jsx)(Ka,{label:"Definition Field",value:J,selections:He,onChange:Vn,onSelectionChange:qn}),Object(oe.jsx)(Ka,{label:"Word Field",value:ue,selections:He,onChange:Qn,onSelectionChange:Yn}),Object(oe.jsx)(Ka,{label:"Audio Field",value:ee,selections:He,onChange:Kn,onSelectionChange:Gn}),Object(oe.jsx)(Ka,{label:"Image Field",value:ie,selections:He,onChange:Xn,onSelectionChange:Jn}),Object(oe.jsx)(Ka,{label:"Source Field",value:pe,selections:He,onChange:Zn,onSelectionChange:$n}),Object(oe.jsx)(Ka,{label:"URL Field",value:me,selections:He,onChange:ea,onSelectionChange:ta}),Ua,Object(oe.jsx)(xe.a,{className:h.addFieldButton,onClick:function(e){return Xe(!0)},children:"Add Custom Field"}),Object(oe.jsx)(be,{label:"Tags",helperText:"Comma-separated list of strings",fullWidth:!0,color:"secondary",tags:Ee,onTagsChange:ma})]})]}),Object(oe.jsxs)(Me.a,{item:!0,id:"mining-settings",children:[Object(oe.jsx)(Ma.a,{children:"Mining"}),Object(oe.jsxs)(Ra.a,{className:h.root,children:[Object(oe.jsx)(Pa.a,{control:Object(oe.jsx)(Ha.a,{checked:De,onChange:ka}),label:"Re-encode audio as mp3 (slower)",labelPlacement:"start",className:h.switchLabel}),Object(oe.jsx)(Pa.a,{control:Object(oe.jsx)(Ha.a,{checked:ln,onChange:Ca}),label:"Copy mined subtitles to clipboard",labelPlacement:"start",className:h.switchLabel}),Object(oe.jsx)(le.a,{type:"number",label:"Audio Padding Start",fullWidth:!0,value:Ye,color:"secondary",onChange:na,inputProps:{min:0,step:1},InputProps:{endAdornment:Object(oe.jsx)(Be.a,{position:"end",children:"ms"})}}),Object(oe.jsx)(le.a,{type:"number",label:"Audio Padding End",fullWidth:!0,value:tt,color:"secondary",onChange:aa,inputProps:{min:0,step:1},InputProps:{endAdornment:Object(oe.jsx)(Be.a,{position:"end",children:"ms"})}}),Object(oe.jsx)(le.a,{type:"number",label:"Max Image Width",fullWidth:!0,value:rt,color:"secondary",onChange:ia,inputProps:{min:0,step:1}}),Object(oe.jsx)(le.a,{type:"number",label:"Max Image Height",fullWidth:!0,value:ut,color:"secondary",onChange:ra,inputProps:{min:0,step:1}}),Object(oe.jsx)(le.a,{type:"number",label:"Surrounding Subtitles Count Radius",fullWidth:!0,value:ft,color:"secondary",onChange:oa,inputProps:{min:1,step:1}}),Object(oe.jsx)(le.a,{type:"number",label:"Surrounding Subtitles Time Radius",fullWidth:!0,value:gt,color:"secondary",onChange:sa,inputProps:{min:0,step:1},InputProps:{endAdornment:Object(oe.jsx)(Be.a,{position:"end",children:"ms"})}})]})]}),Object(oe.jsxs)(Me.a,{item:!0,id:"misc-settings",children:[Object(oe.jsx)(Ma.a,{children:"Misc"}),Object(oe.jsxs)(Ra.a,{className:h.root,children:[Object(oe.jsx)(Pa.a,{control:Object(oe.jsx)(Ha.a,{checked:yn,onChange:_a}),label:"Remember subtitle offset",labelPlacement:"start",className:h.switchLabel}),Object(oe.jsx)(Pa.a,{control:Object(oe.jsx)(Ha.a,{checked:wn,onChange:Ba}),label:"Auto-copy current subtitle to clipboard",labelPlacement:"start",className:h.switchLabel}),Object(oe.jsx)(le.a,{label:"Subtitle Regex Filter",fullWidth:!0,value:Rn,color:"secondary",error:!qa,helperText:qa?void 0:"Invalid regular expression",onChange:Aa}),Object(oe.jsx)(le.a,{label:"Subtitle Regex Filter Text Replacement",fullWidth:!0,value:Bn,color:"secondary",onChange:Ia})]})]}),Object(oe.jsxs)(Me.a,{item:!0,id:"auto-pause-settings",children:[Object(oe.jsxs)(Me.a,{container:!0,direction:"row",spacing:1,children:[Object(oe.jsx)(Me.a,{item:!0,children:Object(oe.jsx)(Ma.a,{children:"Auto-pause Preference"})}),Object(oe.jsx)(Me.a,{item:!0,children:Object(oe.jsx)(Ve.a,{title:"Does not enable auto-pause. Sets the preference for when to pause when auto-pause is enabled.",placement:"top",children:Object(oe.jsx)(Ta.a,{fontSize:"small"})})})]}),Object(oe.jsxs)(za.a,{row:!0,children:[Object(oe.jsx)(Pa.a,{control:Object(oe.jsx)(Na.a,{checked:hn===Q.atStart,value:Q.atStart,onChange:wa}),label:"At Subtitle Start"}),Object(oe.jsx)(Pa.a,{control:Object(oe.jsx)(Na.a,{checked:hn===Q.atEnd,value:Q.atEnd,onChange:wa}),label:"At Subtitle End"})]})]}),Object(oe.jsxs)(Me.a,{item:!0,id:"video-subtitle-appearance",children:[Object(oe.jsx)(Ma.a,{children:"Video Subtitle Appearance"}),Object(oe.jsxs)(Ra.a,{className:h.root,children:[Object(oe.jsx)("div",{className:h.subtitleSetting,children:Object(oe.jsx)(le.a,{type:"color",label:"Subtitle Color",fullWidth:!0,value:kt,color:"secondary",onChange:ca})}),Object(oe.jsx)("div",{className:h.subtitleSetting,children:Object(oe.jsx)(le.a,{type:"number",label:"Subtitle Size",fullWidth:!0,value:Ct,color:"secondary",onChange:ua,inputProps:{min:1,step:1}})}),Object(oe.jsx)("div",{className:h.subtitleSetting,children:Object(oe.jsx)(le.a,{type:"color",label:"Subtitle Outline Color",fullWidth:!0,value:Pt,color:"secondary",onChange:la})}),Object(oe.jsx)("div",{className:h.subtitleSetting,children:Object(oe.jsx)(le.a,{type:"number",label:"Subtitle Outline Thickness",fullWidth:!0,value:_t,onChange:da,inputProps:{min:0,step:1},color:"secondary"})}),Object(oe.jsx)("div",{className:h.subtitleSetting,children:Object(oe.jsx)(le.a,{type:"color",label:"Subtitle Background Color",fullWidth:!0,value:Nt,color:"secondary",onChange:ba})}),Object(oe.jsx)("div",{className:h.subtitleSetting,children:Object(oe.jsx)(le.a,{type:"number",label:"Subtitle Background Opacity",fullWidth:!0,inputProps:{min:0,max:1,step:.1},value:Ht,color:"secondary",onChange:fa})}),Object(oe.jsx)("div",{className:h.subtitleSetting,children:Object(oe.jsx)(le.a,{type:"text",label:"Subtitle Font Family",placeholder:"Inherited",fullWidth:!0,value:Kt,color:"secondary",onChange:ha})}),Object(oe.jsx)("div",{className:h.subtitleSetting,children:Object(oe.jsx)(le.a,{type:"number",label:"Image-based Subtitle Scale Factor",placeholder:"Inherited",fullWidth:!0,inputProps:{min:0,max:1,step:.1},value:Qt,color:"secondary",onChange:va})}),Object(oe.jsx)("div",{className:h.subtitlePreview,children:Object(oe.jsx)("input",{value:en,className:h.subtitlePreviewInput,onChange:pa,style:Da})})]})]}),Object(oe.jsxs)(Me.a,{item:!0,id:"theme-settings",children:[Object(oe.jsx)(Ma.a,{children:"Theme"}),Object(oe.jsxs)("div",{children:[Object(oe.jsx)(Pa.a,{control:Object(oe.jsx)(Na.a,{checked:"light"===rn,value:"light",onChange:Sa}),label:"Light"}),Object(oe.jsx)(Pa.a,{control:Object(oe.jsx)(Na.a,{checked:"dark"===rn,value:"dark",onChange:Sa}),label:"Dark"})]})]}),Object(oe.jsxs)(Me.a,{item:!0,id:"keyboard-shortcuts",children:[Object(oe.jsx)(Ma.a,{children:"Keyboard Shortcuts"}),Object(oe.jsx)(Ra.a,{children:Object.keys(Ga).map((function(e){var t,a=e,i=Ga[a];return Object(oe.jsx)(Ya,{label:i.label,keys:n.installed&&i.extensionOverridden?null!==(t=n.extensionCommands[a])&&void 0!==t?t:"":jn[a].keys,extensionOverridden:n.installed&&i.extensionOverridden,onKeysChange:function(e){return Fa(e,a)},onOpenExtensionShortcuts:function(){return n.openShortcuts()}},e)}))})]})]})}),Object(oe.jsx)(we.a,{children:Object(oe.jsx)(xe.a,{onClick:Wa,children:"OK"})})]})]})}var $a=function(){function e(){Object(k.a)(this,e),this._cache={}}return Object(y.a)(e,[{key:"get",value:function(e){var t=this._cache[e];if(void 0===t){var n=localStorage.getItem(e);return this._cache[e]=n,n}return t}},{key:"set",value:function(e,t){localStorage.setItem(e,t),this._cache[e]=t}},{key:"delete",value:function(e){delete this._cache[e],localStorage.removeItem(e)}}]),e}(),ei=Q.atEnd,ti={togglePlay:{keys:"space"},toggleAutoPause:{keys:Ua.isMacOs?"\u21e7+P":"shift+P"},toggleCondensedPlayback:{keys:Ua.isMacOs?"\u21e7+O":"shift+O"},toggleSubtitles:{keys:"S"},toggleVideoSubtitleTrack1:{keys:"1"},toggleVideoSubtitleTrack2:{keys:"2"},toggleAsbplayerSubtitleTrack1:{keys:"W+1"},toggleAsbplayerSubtitleTrack2:{keys:"W+2"},seekBackward:{keys:"A"},seekForward:{keys:"D"},seekToPreviousSubtitle:{keys:"left"},seekToNextSubtitle:{keys:"right"},seekToBeginningOfCurrentSubtitle:{keys:"down"},adjustOffsetToPreviousSubtitle:{keys:Ua.isMacOs?"\u21e7+left":"ctrl+left"},adjustOffsetToNextSubtitle:{keys:Ua.isMacOs?"\u21e7+right":"ctrl+right"},decreaseOffset:{keys:Ua.isMacOs?"\u21e7+\u2303+right":"ctrl+shift+right"},increaseOffset:{keys:Ua.isMacOs?"\u21e7+\u2303+left":"ctrl+shift+left"},resetOffset:{keys:Ua.isMacOs?"\u21e7+\u2303+down":"ctrl+shift+down"},copySubtitle:{keys:Ua.isMacOs?"\u21e7+\u2303+Z":"ctrl+shift+Z"},ankiExport:{keys:Ua.isMacOs?"\u21e7+\u2303+X":"ctrl+shift+X"},updateLastCard:{keys:Ua.isMacOs?"\u21e7+\u2303+U":"ctrl+shift+U"},decreasePlaybackRate:{keys:Ua.isMacOs?"\u21e7+\u2303+[":"ctrl+shift+["},increasePlaybackRate:{keys:Ua.isMacOs?"\u21e7+\u2303+]":"ctrl+shift+]"}},ni="ankiConnectUrl",ai="deck",ii="noteType",ri="sentenceField",oi="definitionField",si="audioField",ci="imageField",ui="wordField",li="sourceField",di="urlField",bi="customAnkiFields",fi="tags",hi="subtitleSize",pi="subtitleColor",vi="subtitleOutlineThickness",gi="subtitleOutlineColor",ji="subtitleBackgroundColor",Oi="subtitleBackgroundOpacity",mi="subtitleFontFamily",ki="subtitlePreview",yi="imageBasedSubtitleScaleFactor",xi="audioPaddingStart",Si="audioPaddingEnd",Ci="maxImageWidth",wi="maxImageHeight",Ti="surroundingSubtitlesCountRadius",Fi="surroundingSubtitlesTimeRadius",Pi="preferMp3",Ri="themeType",Ei="copyToClipboardOnMine",Mi="autoPausePreference",_i="keyBindSet",Bi="rememberSubtitleOffset",Ai="autoCopyCurrentSubtitle",Ii="subtitleRegexFilter",Ni="subtitleRegexFilterTextReplacement",Di=function(){function e(){Object(k.a)(this,e),this._tags=void 0,this._keyBindSet=void 0,this._storage=new $a,this._tags=this.tags,this._keyBindSet=this.keyBindSet}return Object(y.a)(e,[{key:"settings",get:function(){return{ankiConnectUrl:this.ankiConnectUrl,deck:this.deck,noteType:this.noteType,sentenceField:this.sentenceField,definitionField:this.definitionField,audioField:this.audioField,imageField:this.imageField,wordField:this.wordField,urlField:this.urlField,customAnkiFields:this.customAnkiFields,tags:this.tags,sourceField:this.sourceField,subtitleSize:this.subtitleSize,subtitleColor:this.subtitleColor,subtitleOutlineThickness:this.subtitleOutlineThickness,subtitleOutlineColor:this.subtitleOutlineColor,subtitleBackgroundColor:this.subtitleBackgroundColor,subtitleBackgroundOpacity:this.subtitleBackgroundOpacity,subtitleFontFamily:this.subtitleFontFamily,subtitlePreview:this.subtitlePreview,imageBasedSubtitleScaleFactor:this.imageBasedSubtitleScaleFactor,preferMp3:this.preferMp3,themeType:this.themeType,audioPaddingStart:this.audioPaddingStart,audioPaddingEnd:this.audioPaddingEnd,maxImageWidth:this.maxImageWidth,maxImageHeight:this.maxImageHeight,surroundingSubtitlesCountRadius:this.surroundingSubtitlesCountRadius,surroundingSubtitlesTimeRadius:this.surroundingSubtitlesTimeRadius,copyToClipboardOnMine:this.copyToClipboardOnMine,autoPausePreference:this.autoPausePreference,keyBindSet:this.keyBindSet,rememberSubtitleOffset:this.rememberSubtitleOffset,autoCopyCurrentSubtitle:this.autoCopyCurrentSubtitle,subtitleRegexFilter:this.subtitleRegexFilter,subtitleRegexFilterTextReplacement:this.subtitleRegexFilterTextReplacement}},set:function(e){this.ankiConnectUrl=e.ankiConnectUrl,this.deck=e.deck,this.noteType=e.noteType,this.sentenceField=e.sentenceField,this.definitionField=e.definitionField,this.audioField=e.audioField,this.imageField=e.imageField,this.wordField=e.wordField,this.sourceField=e.sourceField,this.urlField=e.urlField,this.tags=e.tags,this.subtitleSize=e.subtitleSize,this.subtitleColor=e.subtitleColor,this.subtitleOutlineThickness=e.subtitleOutlineThickness,this.subtitleOutlineColor=e.subtitleOutlineColor,this.subtitleBackgroundColor=e.subtitleBackgroundColor,this.subtitleBackgroundOpacity=e.subtitleBackgroundOpacity,this.subtitleFontFamily=e.subtitleFontFamily,this.subtitlePreview=e.subtitlePreview,this.imageBasedSubtitleScaleFactor=e.imageBasedSubtitleScaleFactor,this.customAnkiFields=e.customAnkiFields,this.preferMp3=e.preferMp3,this.themeType=e.themeType,this.audioPaddingStart=e.audioPaddingStart,this.audioPaddingEnd=e.audioPaddingEnd,this.maxImageWidth=e.maxImageWidth,this.maxImageHeight=e.maxImageHeight,this.surroundingSubtitlesCountRadius=e.surroundingSubtitlesCountRadius,this.surroundingSubtitlesTimeRadius=e.surroundingSubtitlesTimeRadius,this.copyToClipboardOnMine=e.copyToClipboardOnMine,this.autoPausePreference=e.autoPausePreference,this.keyBindSet=e.keyBindSet,this.rememberSubtitleOffset=e.rememberSubtitleOffset,this.autoCopyCurrentSubtitle=e.autoCopyCurrentSubtitle,this.subtitleRegexFilter=e.subtitleRegexFilter,this.subtitleRegexFilterTextReplacement=e.subtitleRegexFilterTextReplacement}},{key:"subtitleSettings",get:function(){return{subtitleSize:this.subtitleSize,subtitleColor:this.subtitleColor,subtitleOutlineThickness:this.subtitleOutlineThickness,subtitleOutlineColor:this.subtitleOutlineColor,subtitleBackgroundColor:this.subtitleBackgroundColor,subtitleBackgroundOpacity:this.subtitleBackgroundOpacity,subtitleFontFamily:this.subtitleFontFamily,imageBasedSubtitleScaleFactor:this.imageBasedSubtitleScaleFactor}}},{key:"ankiSettings",get:function(){return{ankiConnectUrl:this.ankiConnectUrl,deck:this.deck,noteType:this.noteType,sentenceField:this.sentenceField,definitionField:this.definitionField,audioField:this.audioField,imageField:this.imageField,wordField:this.wordField,sourceField:this.sourceField,urlField:this.urlField,customAnkiFields:this.customAnkiFields,tags:this.tags,preferMp3:this.preferMp3,audioPaddingStart:this.audioPaddingStart,audioPaddingEnd:this.audioPaddingEnd,maxImageWidth:this.maxImageWidth,maxImageHeight:this.maxImageHeight,surroundingSubtitlesCountRadius:this.surroundingSubtitlesCountRadius,surroundingSubtitlesTimeRadius:this.surroundingSubtitlesTimeRadius}}},{key:"miscSettings",get:function(){return{themeType:this.themeType,copyToClipboardOnMine:this.copyToClipboardOnMine,autoPausePreference:this.autoPausePreference,keyBindSet:this.keyBindSet,rememberSubtitleOffset:this.rememberSubtitleOffset,autoCopyCurrentSubtitle:this.autoCopyCurrentSubtitle,subtitleRegexFilter:this.subtitleRegexFilter,subtitleRegexFilterTextReplacement:this.subtitleRegexFilterTextReplacement}}},{key:"_getNumberItem",value:function(e,t){var n=this._storage.get(e);return null===n?t:Number(n)}},{key:"_setOptionalItem",value:function(e,t){"undefined"===typeof t?this._storage.delete(e):this._storage.set(e,t)}},{key:"ankiConnectUrl",get:function(){return this._storage.get(ni)||"http://127.0.0.1:8765"},set:function(e){this._storage.set(ni,e)}},{key:"deck",get:function(){var e;return null!==(e=this._storage.get(ai))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(ai,e)}},{key:"noteType",get:function(){var e;return null!==(e=this._storage.get(ii))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(ii,e)}},{key:"sentenceField",get:function(){var e;return null!==(e=this._storage.get(ri))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(ri,e)}},{key:"definitionField",get:function(){var e;return null!==(e=this._storage.get(oi))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(oi,e)}},{key:"audioField",get:function(){var e;return null!==(e=this._storage.get(si))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(si,e)}},{key:"imageField",get:function(){var e;return null!==(e=this._storage.get(ci))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(ci,e)}},{key:"wordField",get:function(){var e;return null!==(e=this._storage.get(ui))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(ui,e)}},{key:"sourceField",get:function(){var e;return null!==(e=this._storage.get(li))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(li,e)}},{key:"urlField",get:function(){var e;return null!==(e=this._storage.get(di))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(di,e)}},{key:"customAnkiFields",get:function(){var e=this._storage.get(bi);return e?JSON.parse(e):{}},set:function(e){this._storage.set(bi,JSON.stringify(e))}},{key:"tags",get:function(){if("undefined"!==typeof this._tags)return this._tags;var e=this._storage.get(fi);return e?(this._tags=JSON.parse(e),this._tags):[]},set:function(e){this._storage.set(fi,JSON.stringify(e)),this._tags=void 0}},{key:"subtitleColor",get:function(){return this._storage.get(pi)||"#ffffff"},set:function(e){this._storage.set(pi,e)}},{key:"subtitleSize",get:function(){return this._getNumberItem(hi,36)},set:function(e){this._storage.set(hi,String(e))}},{key:"subtitleOutlineColor",get:function(){return this._storage.get(gi)||"#000000"},set:function(e){this._storage.set(gi,e)}},{key:"subtitleOutlineThickness",get:function(){return this._getNumberItem(vi,0)},set:function(e){this._storage.set(vi,String(e))}},{key:"subtitleBackgroundColor",get:function(){return this._storage.get(ji)||"#000000"},set:function(e){this._storage.set(ji,e)}},{key:"subtitleBackgroundOpacity",get:function(){return this._getNumberItem(Oi,.5)},set:function(e){this._storage.set(Oi,String(e))}},{key:"subtitleFontFamily",get:function(){return this._storage.get(mi)||""},set:function(e){this._storage.set(mi,e)}},{key:"subtitlePreview",get:function(){return this._storage.get(ki)||"\u30a2\u3042\u5b89"},set:function(e){this._storage.set(ki,e)}},{key:"imageBasedSubtitleScaleFactor",get:function(){return this._getNumberItem(yi,1)},set:function(e){this._storage.set(yi,String(e))}},{key:"preferMp3",get:function(){var e=this._storage.get(Pi);return null===e||"true"===e},set:function(e){this._storage.set(Pi,String(e))}},{key:"themeType",get:function(){var e=this._storage.get(Ri);return null===e?"dark":e},set:function(e){this._storage.set(Ri,e)}},{key:"audioPaddingStart",get:function(){var e=this._storage.get(xi);return e?Number(e):0},set:function(e){this._storage.set(xi,String(e))}},{key:"audioPaddingEnd",get:function(){return this._getNumberItem(Si,500)},set:function(e){this._storage.set(Si,String(e))}},{key:"maxImageWidth",get:function(){var e=this._storage.get(Ci);return e?Number(e):0},set:function(e){this._storage.set(Ci,String(e))}},{key:"maxImageHeight",get:function(){return this._getNumberItem(wi,0)},set:function(e){this._storage.set(wi,String(e))}},{key:"surroundingSubtitlesCountRadius",get:function(){return this._getNumberItem(Ti,2)},set:function(e){this._storage.set(Ti,String(e))}},{key:"surroundingSubtitlesTimeRadius",get:function(){return this._getNumberItem(Fi,1e4)},set:function(e){this._storage.set(Fi,String(e))}},{key:"copyToClipboardOnMine",get:function(){return"true"===this._storage.get(Ei)||!1},set:function(e){this._storage.set(Ei,String(e))}},{key:"autoPausePreference",get:function(){return this._getNumberItem(Mi,ei)},set:function(e){this._storage.set(Mi,String(e))}},{key:"keyBindSet",get:function(){if(void 0!==this._keyBindSet)return this._keyBindSet;var e=this._storage.get(_i);if(null===e)return this._keyBindSet=ti,ti;for(var t=JSON.parse(e),n=0,a=Object.keys(ti);n<a.length;n++){var i=a[n];void 0===t[i]&&(t[i]=ti[i])}return this._keyBindSet=t,t},set:function(e){this._storage.set(_i,JSON.stringify(e)),this._keyBindSet=void 0}},{key:"rememberSubtitleOffset",get:function(){return"true"===this._storage.get(Bi)||!1},set:function(e){this._storage.set(Bi,String(e))}},{key:"autoCopyCurrentSubtitle",get:function(){return"true"===this._storage.get(Ai)||!1},set:function(e){this._storage.set(Ai,String(e))}},{key:"subtitleRegexFilter",get:function(){var e;return null!==(e=this._storage.get(Ii))&&void 0!==e?e:""},set:function(e){this._storage.set(Ii,e)}},{key:"subtitleRegexFilterTextReplacement",get:function(){var e;return null!==(e=this._storage.get(Ni))&&void 0!==e?e:""},set:function(e){this._storage.set(Ni,e)}}]),e}(),Li=function(){function e(t){Object(k.a)(this,e),this.channel=void 0,this.readyCallbacks=void 0,this.playCallbacks=void 0,this.pauseCallbacks=void 0,this.currentTimeCallbacks=void 0,this.audioTrackSelectedCallbacks=void 0,this.closeCallbacks=void 0,this.subtitlesCallbacks=void 0,this.offsetCallbacks=void 0,this.playbackRateCallbacks=void 0,this.playModeCallbacks=void 0,this.hideSubtitlePlayerToggleCallbacks=void 0,this.appBarToggleCallbacks=void 0,this.fullscreenToggleCallbacks=void 0,this.subtitleSettingsCallbacks=void 0,this.miscSettingsCallbacks=void 0,this.ankiSettingsCallbacks=void 0,this.alertCallbacks=void 0,this.channel=new BroadcastChannel(t),this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.closeCallbacks=[],this.readyCallbacks=[],this.subtitlesCallbacks=[],this.offsetCallbacks=[],this.playbackRateCallbacks=[],this.playModeCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.fullscreenToggleCallbacks=[],this.subtitleSettingsCallbacks=[],this.miscSettingsCallbacks=[],this.ankiSettingsCallbacks=[],this.alertCallbacks=[];var n=this;this.channel.onmessage=function(e){switch(e.data.command){case"init":break;case"ready":var t,a=e.data,r=Object(i.a)(n.readyCallbacks);try{for(r.s();!(t=r.n()).done;){(0,t.value)(a.duration,a.videoFileName)}}catch(Y){r.e(Y)}finally{r.f()}break;case"play":var o,s=Object(i.a)(n.playCallbacks);try{for(s.s();!(o=s.n()).done;){(0,o.value)()}}catch(Y){s.e(Y)}finally{s.f()}break;case"pause":var c,u=Object(i.a)(n.pauseCallbacks);try{for(u.s();!(c=u.n()).done;){(0,c.value)()}}catch(Y){u.e(Y)}finally{u.f()}break;case"currentTime":var l,d=e.data,b=Object(i.a)(n.currentTimeCallbacks);try{for(b.s();!(l=b.n()).done;){(0,l.value)(d.value)}}catch(Y){b.e(Y)}finally{b.f()}break;case"audioTrackSelected":var f,h=e.data,p=Object(i.a)(n.audioTrackSelectedCallbacks);try{for(p.s();!(f=p.n()).done;){(0,f.value)(h.id)}}catch(Y){p.e(Y)}finally{p.f()}break;case"close":var v,g=Object(i.a)(n.closeCallbacks);try{for(g.s();!(v=g.n()).done;){(0,v.value)()}}catch(Y){g.e(Y)}finally{g.f()}break;case"subtitles":var j,O=e.data,m=Object(i.a)(n.subtitlesCallbacks);try{for(m.s();!(j=m.n()).done;){(0,j.value)(O.value)}}catch(Y){m.e(Y)}finally{m.f()}break;case"offset":var k,y=e.data,x=Object(i.a)(n.offsetCallbacks);try{for(x.s();!(k=x.n()).done;){(0,k.value)(y.value)}}catch(Y){x.e(Y)}finally{x.f()}break;case"playbackRate":var S,C=e.data,w=Object(i.a)(n.playbackRateCallbacks);try{for(w.s();!(S=w.n()).done;){(0,S.value)(C.value)}}catch(Y){w.e(Y)}finally{w.f()}break;case"subtitleSettings":var T,F=e.data,P=Object(i.a)(n.subtitleSettingsCallbacks);try{for(P.s();!(T=P.n()).done;){(0,T.value)(F.value)}}catch(Y){P.e(Y)}finally{P.f()}break;case"playMode":var R,E=e.data,M=Object(i.a)(n.playModeCallbacks);try{for(M.s();!(R=M.n()).done;){(0,R.value)(E.playMode)}}catch(Y){M.e(Y)}finally{M.f()}break;case"hideSubtitlePlayerToggle":var _,B=e.data,A=Object(i.a)(n.hideSubtitlePlayerToggleCallbacks);try{for(A.s();!(_=A.n()).done;){(0,_.value)(B.value)}}catch(Y){A.e(Y)}finally{A.f()}break;case"appBarToggle":var I,N=e.data,D=Object(i.a)(n.appBarToggleCallbacks);try{for(D.s();!(I=D.n()).done;){(0,I.value)(N.value)}}catch(Y){D.e(Y)}finally{D.f()}break;case"fullscreenToggle":var L,W=e.data,U=Object(i.a)(n.fullscreenToggleCallbacks);try{for(U.s();!(L=U.n()).done;){(0,L.value)(W.value)}}catch(Y){U.e(Y)}finally{U.f()}break;case"ankiSettings":var H,z=e.data,V=Object(i.a)(n.ankiSettingsCallbacks);try{for(V.s();!(H=V.n()).done;){(0,H.value)(z.value)}}catch(Y){V.e(Y)}finally{V.f()}break;case"miscSettings":var q,K=e.data,G=Object(i.a)(n.miscSettingsCallbacks);try{for(G.s();!(q=G.n()).done;){(0,q.value)(K.value)}}catch(Y){G.e(Y)}finally{G.f()}break;case"alert":var X,J=e.data,Q=Object(i.a)(n.alertCallbacks);try{for(Q.s();!(X=Q.n()).done;){(0,X.value)(J.message,J.severity)}}catch(Y){Q.e(Y)}finally{Q.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(y.a)(e,[{key:"currentTime",set:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"currentTime",value:e,echo:!0})}},{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onClose",value:function(e){this.closeCallbacks.push(e)}},{key:"onReady",value:function(e){this.readyCallbacks.push(e)}},{key:"onSubtitles",value:function(e){this.subtitlesCallbacks.push(e)}},{key:"onOffset",value:function(e){this.offsetCallbacks.push(e)}},{key:"onPlaybackRate",value:function(e){this.playbackRateCallbacks.push(e)}},{key:"onPlayMode",value:function(e){this.playModeCallbacks.push(e)}},{key:"onHideSubtitlePlayerToggle",value:function(e){this.hideSubtitlePlayerToggleCallbacks.push(e)}},{key:"onAppBarToggle",value:function(e){this.appBarToggleCallbacks.push(e)}},{key:"onFullscreenToggle",value:function(e){this.fullscreenToggleCallbacks.push(e)}},{key:"onSubtitleSettings",value:function(e){this.subtitleSettingsCallbacks.push(e)}},{key:"onMiscSettings",value:function(e){this.miscSettingsCallbacks.push(e)}},{key:"onAnkiSettings",value:function(e){this.ankiSettingsCallbacks.push(e)}},{key:"onAlert",value:function(e){this.alertCallbacks.push(e)}},{key:"ready",value:function(e,t,n,a,i){var r,o={command:"ready",duration:e,paused:t,currentTime:0,audioTracks:a,selectedAudioTrack:i,playbackRate:n};null===(r=this.channel)||void 0===r||r.postMessage(o)}},{key:"readyState",value:function(e){var t,n={command:"readyState",value:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"play",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"play",echo:!0})}},{key:"pause",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"pause",echo:!0})}},{key:"audioTrackSelected",value:function(e){var t,n={command:"audioTrackSelected",id:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"offset",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t,n={command:"offset",value:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}))},{key:"playbackRate",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t,n={command:"playbackRate",value:e,echo:!0};null===(t=this.channel)||void 0===t||t.postMessage(n)}))},{key:"popOutToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"popOutToggle"})}},{key:"copy",value:function(e,t,n,a){var i,r={command:"copy",subtitle:e,surroundingSubtitles:t,preventDuplicate:a,postMineAction:n};null===(i=this.channel)||void 0===i||i.postMessage(r)}},{key:"playMode",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"playMode",playMode:e})}))},{key:"hideSubtitlePlayerToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"hideSubtitlePlayerToggle"})}},{key:"appBarToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"appBarToggle"})}},{key:"fullscreenToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"fullscreenToggle"})}},{key:"ankiDialogRequest",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"ankiDialogRequest"})}},{key:"toggleSubtitleTrackInList",value:function(e){var t,n={command:"toggleSubtitleTrackInList",track:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"close",value:function(){this.channel&&(this.channel.postMessage({command:"exit"}),this.channel.close(),this.channel=void 0,this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.closeCallbacks=[],this.readyCallbacks=[],this.subtitlesCallbacks=[],this.offsetCallbacks=[],this.playbackRateCallbacks=[],this.playModeCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.fullscreenToggleCallbacks=[],this.subtitleSettingsCallbacks=[],this.miscSettingsCallbacks=[],this.ankiSettingsCallbacks=[],this.alertCallbacks=[])}}]),e}(),Wi=function(){function e(t,n){var a=this;Object(k.a)(this,e),this.defaultKeyBinder=void 0,this.extension=void 0,this.copyHandlers=[],this.ankiExportHandlers=[],this.updateLastCardHandlers=[],this.onExtensionMessage=void 0,this.defaultKeyBinder=t,this.extension=n,this.onExtensionMessage=function(e){if("copy-subtitle"===e.data.command){var t,n=e.data;switch(n.postMineAction){case J.none:t=a.copyHandlers;break;case J.showAnkiDialog:t=a.ankiExportHandlers;break;case J.updateLastCard:t=a.updateLastCardHandlers;break;default:console.error("Unknown post mine action "+n.postMineAction)}var r,o=Object(i.a)(t);try{for(o.s();!(r=o.n()).done;){(0,r.value)(new KeyboardEvent("mock"))}}catch(s){o.e(s)}finally{o.f()}}},n.subscribe(this.onExtensionMessage)}return Object(y.a)(e,[{key:"bindCopy",value:function(e,t,n,a){var i=this;if(this.extension.installed){var r=this.defaultKeyBinder.copyHandler(e,t,n);return this.copyHandlers.push(r),function(){i._remove(r,i.copyHandlers)}}return this.defaultKeyBinder.bindCopy(e,t,n,a)}},{key:"bindAnkiExport",value:function(e,t,n){var a=this;if(this.extension.installed){var i=this.defaultKeyBinder.ankiExportHandler(e,t);return this.ankiExportHandlers.push(i),function(){a._remove(i,a.ankiExportHandlers)}}return this.defaultKeyBinder.bindAnkiExport(e,t,n)}},{key:"bindUpdateLastCard",value:function(e,t,n){var a=this;if(this.extension.installed){var i=this.defaultKeyBinder.updateLastCardHandler(e,t);return this.updateLastCardHandlers.push(i),function(){a._remove(i,a.updateLastCardHandlers)}}return this.defaultKeyBinder.bindUpdateLastCard(e,t,n)}},{key:"_remove",value:function(e,t){for(var n=t.length-1;n>=0;--n)if(e===t[n]){t.splice(n,1);break}}},{key:"bindSeekToSubtitle",value:function(e,t,n,a,i){return this.defaultKeyBinder.bindSeekToSubtitle(e,t,n,a,i)}},{key:"bindSeekToBeginningOfCurrentSubtitle",value:function(e,t,n,a,i){return this.defaultKeyBinder.bindSeekToBeginningOfCurrentSubtitle(e,t,n,a,i)}},{key:"bindSeekBackwardOrForward",value:function(e,t,n){return this.defaultKeyBinder.bindSeekBackwardOrForward(e,t,n)}},{key:"bindOffsetToSubtitle",value:function(e,t,n,a,i){return this.defaultKeyBinder.bindOffsetToSubtitle(e,t,n,a,i)}},{key:"bindAdjustOffset",value:function(e,t,n,a){return this.defaultKeyBinder.bindAdjustOffset(e,t,n,a)}},{key:"bindResetOffet",value:function(e,t,n){return this.defaultKeyBinder.bindResetOffet(e,t,n)}},{key:"bindAdjustPlaybackRate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.defaultKeyBinder.bindAdjustPlaybackRate(e,t,n)}},{key:"bindToggleSubtitles",value:function(e,t,n){return this.defaultKeyBinder.bindToggleSubtitles(e,t,n)}},{key:"bindToggleSubtitleTrackInVideo",value:function(e,t,n){return this.defaultKeyBinder.bindToggleSubtitleTrackInVideo(e,t,n)}},{key:"bindToggleSubtitleTrackInList",value:function(e,t,n){return this.defaultKeyBinder.bindToggleSubtitleTrackInList(e,t,n)}},{key:"bindPlay",value:function(e,t,n){return this.defaultKeyBinder.bindPlay(e,t,n)}},{key:"bindAutoPause",value:function(e,t,n){return this.defaultKeyBinder.bindAutoPause(e,t,n)}},{key:"bindCondensedPlayback",value:function(e,t,n){return this.defaultKeyBinder.bindCondensedPlayback(e,t,n)}}]),e}(),Ui=Object(v.a)({root:{position:"relative",backgroundColor:"black",height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},video:{margin:"auto"},cursorHidden:{cursor:"none"},subtitleContainer:{position:"absolute",paddingLeft:20,paddingRight:20,bottom:100,textAlign:"center",whiteSpace:"pre-wrap",lineHeight:"normal"}});function Hi(e,t,n,a){if(window.outerWidth&&e.videoWidth>0&&e.videoHeight>0){var r=window.screen.availWidth-(window.outerWidth-window.innerWidth),o=window.screen.availHeight-(window.outerHeight-window.innerHeight),s=Math.min(1,Math.min(r/e.videoWidth,o/e.videoHeight));window.resizeTo(s*e.videoWidth+(window.outerWidth-window.innerWidth),s*e.videoHeight+(window.outerHeight-window.innerHeight))}var c,u;if(e.audioTracks){c=[];var l,d=Object(i.a)(e.audioTracks);try{for(d.s();!(l=d.n()).done;){var b=l.value;c.push({id:b.id,label:b.label,language:b.language}),b.enabled&&(u=b.id)}}catch(f){d.e(f)}finally{d.f()}}else c=void 0,u=void 0;n(c),a(u),t.ready(e.duration,e.paused,e.playbackRate,c,u)}function zi(e){var t=e.settingsProvider,n=e.playbackPreferences,a=e.extension,r=e.videoFile,u=e.channel,l=e.popOut,h=e.ankiDialogFinishedRequest,p=e.onAnkiDialogRequest,v=e.onError,g=e.onPlayModeChangedViaBind,j=Ui(),m=Object(b.useRef)(),k=Object(b.useRef)(),y=O(!0),x=Object(c.a)(y,2),C=x[0],w=x[1];k.current&&(k.current.width=C,k.current.height=w);var T=Object(b.useMemo)((function(){return new Li(u)}),[u]),F=Object(b.useState)(!1),P=Object(c.a)(F,2),R=P[0],_=P[1],B=Object(b.useState)(!1),A=Object(c.a)(B,2),I=A[0],N=A[1],D=Object(b.useRef)();D.current=R;var L=Object(b.useState)(0),W=Object(c.a)(L,2),U=W[0],H=W[1],z=Object(b.useState)(),V=Object(c.a)(z,2),q=V[0],K=V[1],G=Object(b.useState)(0),X=Object(c.a)(G,2),Z=X[0],$=X[1],ne=Object(b.useState)(1),ae=Object(c.a)(ne,2),ie=ae[0],re=ae[1],se=Object(b.useState)(),ue=Object(c.a)(se,2),le=ue[0],de=ue[1],be=Object(b.useState)(),fe=Object(c.a)(be,2),he=fe[0],pe=fe[1],ve=Object(b.useState)(!1),ge=Object(c.a)(ve,2)[1],je=Object(b.useState)([]),Oe=Object(c.a)(je,2),me=Oe[0],ke=Oe[1],ye=Object(b.useMemo)((function(){return new ee(me,{returnLastShown:!1,showingCheckRadiusMs:150})}),[me]),xe=Object(b.useState)([]),Se=Object(c.a)(xe,2),Ce=Se[0],we=Se[1],Te=Object(b.useState)(!0),Fe=Object(c.a)(Te,2),Pe=Fe[0],Re=Fe[1],Ee=Object(b.useState)({}),Me=Object(c.a)(Ee,2),_e=Me[0],Be=Me[1],Ae=Object(b.useState)(Y.normal),Ie=Object(c.a)(Ae,2),Ne=Ie[0],De=Ie[1],Le=Object(b.useState)(!1),We=Object(c.a)(Le,2),Ue=We[0],He=We[1],ze=Object(b.useState)(n.theaterMode),Ve=Object(c.a)(ze,2),qe=Ve[0],Ke=Ve[1],Ge=Object(b.useRef)([]);Ge.current=Ce;var Xe=Object(b.useMemo)((function(){return new bn}),[]),Je=Object(b.useRef)({x:0,y:0}),Ye=Object(b.useState)(!1),Ze=Object(c.a)(Ye,2),$e=Ze[0],et=Ze[1],tt=Object(b.useRef)(0),nt=Object(b.useRef)(null),at=Object(b.useState)(t.miscSettings),it=Object(c.a)(at,2),rt=it[0],ot=it[1],st=Object(b.useState)(t.subtitleSettings),ct=Object(c.a)(st,2),ut=ct[0],lt=ct[1],dt=Object(b.useState)(t.ankiSettings),bt=Object(c.a)(dt,2),ft=bt[0],ht=bt[1],pt=Object(b.useState)(!1),vt=Object(c.a)(pt,2),gt=vt[0],jt=vt[1],Ot=Object(b.useState)(""),mt=Object(c.a)(Ot,2),kt=mt[0],yt=mt[1],xt=Object(b.useState)("info"),St=Object(c.a)(xt,2),Ct=St[0],wt=St[1],Tt=Object(b.useMemo)((function(){var e=new te;return e.onStartedShowing=function(){Ne===Y.autoPause&&rt.autoPausePreference===Q.atStart&&T.pause()},e.onWillStopShowing=function(){Ne===Y.autoPause&&rt.autoPausePreference===Q.atEnd&&T.pause()},e}),[T,rt,Ne]),Ft=Object(b.useRef)();Ft.current=Tt;var Pt=Object(b.useMemo)((function(){return new Wi(new S(rt.keyBindSet),a)}),[rt.keyBindSet,a]),Rt=Object(b.useCallback)((function(e){if(e){var t=e;k.current=t,4===t.readyState?Hi(t,T,de,pe):t.onloadeddata=function(e){Hi(t,T,de,pe)},t.oncanplay=function(e){T.readyState(4),D.current&&Xe.start()},t.ontimeupdate=function(t){return Xe.setTime(1e3*e.currentTime)},t.onerror=function(t){return v(function(e){var t,n,a;switch(null===(t=e.error)||void 0===t?void 0:t.code){case 1:a="Aborted";break;case 2:a="Network error";break;case 3:a="Decoding error";break;case 4:a="Source not supported";break;default:a="Unknown error"}return a+": "+((null===(n=e.error)||void 0===n?void 0:n.message)||"<details missing>")}(e))}}}),[Xe,T,v]);function Et(e){var t,n=null===(t=k.current)||void 0===t?void 0:t.audioTracks;if(n){var a,r=Object(i.a)(n);try{for(r.s();!(a=r.n()).done;){var o=a.value;o.id===e?o.enabled=!0:o.enabled=!1}}catch(s){r.e(s)}finally{r.f()}}}var Mt=Object(b.useCallback)((function(e){$(e),ke((function(t){return t.map((function(t,n){return{text:t.text,textImage:t.textImage,start:t.originalStart+e,originalStart:t.originalStart,end:t.originalEnd+e,originalEnd:t.originalEnd,track:t.track,index:n}}))}))}),[]),_t=Object(b.useCallback)((function(e,t){k.current&&(k.current.playbackRate=e,Xe.rate=e,re(e),t&&T.playbackRate(e))}),[T,Xe]);Object(b.useEffect)((function(){return T.onReady((function(e,t){H(e),K(t)})),T.onPlay(Object(s.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=k.current)||void 0===t?void 0:t.play();case 2:Xe.start(),_(!0);case 4:case"end":return e.stop()}}),e)})))),T.onPause((function(){var e;null===(e=k.current)||void 0===e||e.pause(),Xe.stop(),_(!1)})),T.onCurrentTime((function(e){var t,n;k.current&&(k.current.currentTime=e),4===(null===(t=k.current)||void 0===t?void 0:t.readyState)&&T.readyState(4),Xe.stop(),Xe.setTime(1e3*e),null===(n=Ft.current)||void 0===n||n.clear()})),T.onAudioTrackSelected((function(e){Et(e),pe(e),T.audioTrackSelected(e)})),T.onClose((function(){T.close(),window.close()})),T.onSubtitles((function(e){var t;if(ke(e.map((function(e,t){return Object(o.a)(Object(o.a)({},e),{},{index:t})}))),e&&e.length>0){var n=e[0],a=n.start-n.originalStart;$(a)}null===(t=Ft.current)||void 0===t||t.clear()})),T.onPlayMode((function(e){return De(e)})),T.onHideSubtitlePlayerToggle((function(e){return He(e)})),T.onAppBarToggle((function(e){return Ke(e)})),T.onFullscreenToggle((function(e){return N(e)})),T.onSubtitleSettings(lt),T.onMiscSettings(ot),T.onAnkiSettings(ht),T.onOffset(Mt),T.onPlaybackRate((function(e){_t(e,!1)})),T.onAlert((function(e,t){l&&(jt(!0),yt(e),wt(t))})),window.onbeforeunload=function(e){m.current||T.close()},function(){return T.close()}}),[Xe,T,Mt,_t,l]);var Bt=Object(b.useCallback)((function(){k.current&&T.play()}),[T]),At=Object(b.useCallback)((function(){return T.pause()}),[T]),It=Object(b.useCallback)((function(e){D.current&&Xe.stop();var t=e*U;T.currentTime=t/1e3}),[U,Xe,T]);var Nt=Object(b.useCallback)((function(e){D.current&&(Xe.stop(),T.pause()),Et(e),pe(e),T.currentTime=0,T.audioTrackSelected(e)}),[T,Xe]);Object(b.useEffect)((function(){if(me&&0!==me.length){var e=setInterval((function(){var e,t=Xe.time(U),n=[],a=ye.subtitlesAt(t),r=Object(i.a)(a.showing);try{for(r.s();!(e=r.n()).done;){var o=e.value;_e[o.track]||n.push(o)}}catch(s){r.e(s)}finally{r.f()}a.startedShowing&&!_e[a.startedShowing.track]&&Tt.startedShowing(a.startedShowing),a.willStopShowing&&!_e[a.willStopShowing.track]&&Tt.willStopShowing(a.willStopShowing),function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};if(e.length!==t.length)return!1;for(var a=0;a<e.length;++a)if(!n(e[a],t[a]))return!1;return!0}(n=n.sort((function(e,t){return e.track-t.track})),Ge.current,(function(e,t){return e.index===t.index}))||(we(n),n.length>0&&rt.autoCopyCurrentSubtitle&&document.hasFocus()&&navigator.clipboard.writeText(n.map((function(e){return e.text})).join("\n")).catch((function(e){})))}),100);return function(){return clearTimeout(e)}}}),[ye,T,me,_e,Xe,U,Tt,rt]);var Dt=Object(b.useCallback)((function(e){Mt(e),T.offset(e)}),[T,Mt]),Wt=Object(b.useCallback)((function(e){_t(e,!0)}),[_t]);Object(b.useEffect)((function(){return Pt.bindSeekToSubtitle((function(e,t){e.stopPropagation(),e.preventDefault(),T.currentTime=t.start/1e3}),(function(){return!k.current}),(function(){return Xe.time(U)}),(function(){return me}))}),[Pt,T,me,U,Xe]),Object(b.useEffect)((function(){return Pt.bindSeekToBeginningOfCurrentSubtitle((function(e,t){e.stopPropagation(),e.preventDefault(),T.currentTime=t.start/1e3}),(function(){return!k.current}),(function(){return Xe.time(U)}),(function(){return me}))}),[Pt,T,me,U,Xe]),Object(b.useEffect)((function(){return Pt.bindSeekBackwardOrForward((function(e,t){e.stopPropagation(),e.preventDefault();var n=Xe.time(U);T.currentTime=t?Math.min(U/1e3,(n+1e4)/1e3):Math.max(0,(n-1e4)/1e3)}),(function(){return!k.current}))}),[Pt,T,U,Xe]);var Ut=Object(b.useCallback)((function(e){return E(me,e,ft.surroundingSubtitlesCountRadius,ft.surroundingSubtitlesTimeRadius)}),[me,ft.surroundingSubtitlesCountRadius,ft.surroundingSubtitlesTimeRadius]);Object(b.useEffect)((function(){return Pt.bindCopy((function(e,t){e.stopPropagation(),e.preventDefault();var n=!me||0===me.length;T.copy(t,n?M(t,U,5e3):Ut(t.index),J.none)}),(function(){return!1}),(function(){if(!me||0===me.length){var e=Xe.time(U),t=Math.min(e+5e3,U);return{text:"",start:e,originalStart:e,end:t,originalEnd:t,track:0,index:0}}if(Ge.current&&0!==Ge.current.length)return Ge.current[0]}))}),[Pt,T,Xe,U,me,Ut]),Object(b.useEffect)((function(){return Pt.bindAdjustOffset((function(e,t){e.preventDefault(),e.stopPropagation(),Dt(t)}),(function(){return!1}),(function(){return me}))}),[Pt,Dt,me]),Object(b.useEffect)((function(){return Pt.bindResetOffet((function(e){e.preventDefault(),e.stopPropagation(),Dt(0)}),(function(){return!1}))}),[Pt,Dt]),Object(b.useEffect)((function(){return Pt.bindAdjustPlaybackRate((function(e,t){e.preventDefault(),_t(t?Math.min(5,ie+.1):Math.max(.1,ie-.1),!0)}),(function(){return!1}))}),[_t,ie,Pt]),Object(b.useEffect)((function(){return Pt.bindToggleSubtitles((function(e){e.preventDefault(),e.stopPropagation(),Re((function(e){return!e}))}),(function(){return!1}))}),[Pt]),Object(b.useEffect)((function(){return Pt.bindToggleSubtitleTrackInVideo((function(e,t){e.preventDefault(),e.stopPropagation(),Be((function(e){var n=Object(o.a)({},e);return n[t]=!e[t],n}))}),(function(){return!1}))}),[Pt]),Object(b.useEffect)((function(){return Pt.bindToggleSubtitleTrackInList((function(e,t){e.preventDefault(),e.stopPropagation(),T.toggleSubtitleTrackInList(t)}),(function(){return!1}))}),[Pt,T]),Object(b.useEffect)((function(){return Pt.bindOffsetToSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),Dt(t)}),(function(){return!1}),(function(){return Xe.time(U)}),(function(){return me}))}),[Pt,Dt,me,Xe,U]);var Ht=Object(b.useCallback)((function(e,t){if(me&&0!==me.length){if(Ge.current&&Ge.current.length>0){var n=Ge.current[0];t(n,Ut(n.index))}}else{var a=Xe.time(U),i=Math.min(a+5e3,U),r={text:"",start:a,originalStart:a,end:i,originalEnd:i,track:0};e(r,M(r,U,5e3))}}),[me,Ut,U,Xe]);Object(b.useEffect)((function(){return Pt.bindAnkiExport((function(e){e.preventDefault(),e.stopPropagation(),l?(Ht((function(e,t){T.copy(e,t,J.none,!1),p(r,null!==q&&void 0!==q?q:"",he,ie,e,t,Xe.time(U))}),(function(e,t){T.copy(e,t,J.none,!0),p(r,null!==q&&void 0!==q?q:"",he,ie,e,t,Xe.time(U))})),R&&(T.pause(),ge(!0))):Ht((function(e,t){return T.copy(e,t,J.showAnkiDialog,!1)}),(function(e,t){return T.copy(e,t,J.showAnkiDialog,!0)}))}),(function(){return!1}))}),[Pt,T,Ht,Xe,U,r,q,he,ie,p,l,R]),Object(b.useEffect)((function(){h&&h.timestamp>0&&ge((function(e){return e&&h.resume&&T.play(),!1}))}),[h,T]),Object(b.useEffect)((function(){return Pt.bindUpdateLastCard((function(e){e.preventDefault(),e.stopPropagation(),Ht((function(e,t){return T.copy(e,t,J.updateLastCard,!1)}),(function(e,t){return T.copy(e,t,J.updateLastCard,!0)}))}),(function(){return!1}))}),[Pt,T,Ht]),Object(b.useEffect)((function(){return Pt.bindPlay((function(e){e.preventDefault(),R?T.pause():T.play()}),(function(){return!1}))}),[Pt,R,T]);var zt=Object(b.useCallback)((function(e,t){e.preventDefault();var n=Ne===t?Y.normal:t;T.playMode(n),g(Ne,n)}),[Ne,T,g]);Object(b.useEffect)((function(){return Pt.bindAutoPause((function(e){return zt(e,Y.autoPause)}),(function(){return!1}))}),[Pt,zt]),Object(b.useEffect)((function(){return Pt.bindCondensedPlayback((function(e){return zt(e,Y.condensed)}),(function(){return!1}))}),[Pt,zt]);var Vt=Object(b.useCallback)((function(){return Re((function(e){return!e}))}),[]),qt=Object(b.useCallback)((function(){l?N((function(e){return e?document.exitFullscreen():document.documentElement.requestFullscreen(),!e})):T.fullscreenToggle()}),[T,l]),Kt=Object(b.useCallback)((function(e){k.current&&(k.current.volume=e)}),[]),Gt=Object(b.useCallback)((function(){T.popOutToggle(),l&&(m.current=!0,window.close())}),[T,l]),Xt=Object(b.useCallback)((function(e){T.playMode(e)}),[T]),Jt=Object(b.useCallback)((function(){T.close(),window.close()}),[T]),Qt=Object(b.useCallback)((function(){T.hideSubtitlePlayerToggle()}),[T]),Yt=Object(b.useCallback)((function(){T.appBarToggle()}),[T]),Zt=Object(b.useCallback)((function(){R?T.pause():T.play()}),[T,R]),$t=Object(b.useCallback)((function(){return qt()}),[qt]),en=ut.subtitleSize,tn=ut.subtitleColor,nn=ut.subtitleOutlineThickness,an=ut.subtitleOutlineColor,rn=ut.subtitleBackgroundColor,on=ut.subtitleBackgroundOpacity,sn=ut.subtitleFontFamily,cn=ut.imageBasedSubtitleScaleFactor,un=Object(b.useMemo)((function(){return Lt({subtitleSize:en,subtitleColor:tn,subtitleOutlineThickness:nn,subtitleOutlineColor:an,subtitleBackgroundColor:rn,subtitleBackgroundOpacity:on,subtitleFontFamily:sn})}),[en,tn,nn,an,rn,on,sn]);Object(b.useEffect)((function(){var e=setInterval((function(){Date.now()-tt.current>300?$e&&et(!1):$e||et(!0)}),100);return function(){return clearInterval(e)}}),[$e]);var ln=Object(b.useCallback)((function(){return jt(!1)}),[]);return Object(oe.jsxs)("div",{ref:nt,onMouseMove:function(e){if(tt.current=Date.now(),nt.current){var t=nt.current.getBoundingClientRect();Je.current.x=e.clientX-t.left,Je.current.y=e.clientY-t.top}},className:j.root,children:[Object(oe.jsx)(ce,{open:gt,onClose:ln,autoHideDuration:3e3,severity:Ct,children:kt}),Object(oe.jsx)("video",{preload:"auto",controls:!1,onClick:Zt,onDoubleClick:$t,className:$e?j.video:"".concat(j.cursorHidden," ").concat(j.video),ref:Rt,src:r}),Pe&&Object(oe.jsx)("div",{className:j.subtitleContainer,children:Ce.map((function(e,t){var n,a,i;e.textImage?n=Object(oe.jsx)(Qe,{availableWidth:null!==(a=null===(i=k.current)||void 0===i?void 0:i.width)&&void 0!==a?a:window.screen.availWidth,subtitle:e,scale:cn}):n=Object(oe.jsx)("span",{style:un,children:e.text});return t<Ce.length-1?Object(oe.jsxs)(f.a.Fragment,{children:[n,Object(oe.jsx)("br",{})]},e.index):Object(oe.jsx)(f.a.Fragment,{children:n},e.index)}))}),Object(oe.jsx)(na,{mousePositionRef:Je,playing:R,clock:Xe,length:U,audioTracks:le,selectedAudioTrack:he,subtitlesToggle:me&&me.length>0,subtitlesEnabled:Pe,offsetEnabled:!0,offset:Z,playbackRate:ie,playbackRateEnabled:!0,fullscreenEnabled:!0,fullscreen:I,closeEnabled:!l,popOut:l,volumeEnabled:!0,popOutEnabled:!Ua.isMobile,playModeEnabled:me&&me.length>0,playMode:Ne,hideSubtitlePlayerToggleEnabled:(null===me||void 0===me?void 0:me.length)>0&&!l&&!I,subtitlePlayerHidden:Ue,onPlay:Bt,onPause:At,onSeek:It,onAudioTrackSelected:Nt,onSubtitlesToggle:Vt,onFullscreenToggle:qt,onVolumeChange:Kt,onOffsetChange:Dt,onPlaybackRateChange:Wt,onPopOutToggle:Gt,onPlayMode:Xt,onClose:Jt,onHideSubtitlePlayerToggle:Qt,playbackPreferences:n,showOnMouseMovement:!1,theaterModeToggleEnabled:!l&&!I,theaterModeEnabled:qe,onTheaterModeToggle:Yt})]})}var Vi=n(236),qi=Object(ne.a)(),Ki=function(){function e(t,n){var a=this;Object(k.a)(this,e),this.version=void 0,this.extensionCommands=void 0,this.tabs=void 0,this.installed=void 0,this.windowEventListener=void 0,this.onMessageCallbacks=void 0,this.onTabsCallbacks=void 0,this.heartbeatStarted=!1,this.onMessageCallbacks=[],this.onTabsCallbacks=[],this.tabs=[],this.installed=void 0!==t,this.version=null!==t&&void 0!==t?t:"",this.extensionCommands=null!==n&&void 0!==n?n:{},this.windowEventListener=function(e){if(e.source===window&&"asbplayer-extension-to-player"===e.data.sender&&e.data.message)if("tabs"===e.data.message.command){var t=e.data;a.tabs=t.message.tabs;var n,r=Object(i.a)(a.onTabsCallbacks);try{for(r.s();!(n=r.n()).done;){(0,n.value)(a.tabs)}}catch(u){r.e(u)}finally{r.f()}t.message.ackRequested&&window.postMessage({sender:"asbplayerv2",message:{command:"ackTabs",id:qi,receivedTabs:a.tabs}},"*")}else{var o,s=e.data,c=Object(i.a)(a.onMessageCallbacks);try{for(c.s();!(o=c.n()).done;){(0,o.value)({data:s.message,tabId:s.tabId,src:s.src})}}catch(u){c.e(u)}finally{c.f()}}},window.addEventListener("message",this.windowEventListener)}return Object(y.a)(e,[{key:"startHeartbeat",value:function(e){var t=this;this.installed&&(this.heartbeatStarted||(e?Object(Vi.gt)(this.version,"0.23.0")&&setInterval((function(){return t._sendHeartbeat(!0)}),1e3):setInterval((function(){return t._sendHeartbeat(!1)}),1e3),this.heartbeatStarted=!0))}},{key:"_sendHeartbeat",value:function(e){window.postMessage({sender:"asbplayerv2",message:{command:"heartbeat",id:qi,receivedTabs:e?[]:this.tabs,videoPlayer:e}},"*")}},{key:"openShortcuts",value:function(){window.postMessage({sender:"asbplayerv2",message:{command:"open-extension-shortcuts"}})}},{key:"sendMessage",value:function(e,t,n){var a={sender:"asbplayerv2",message:e,tabId:t,src:n};window.postMessage(a,"*")}},{key:"publishMessage",value:function(e){var t,n=Object(i.a)(this.tabs);try{for(n.s();!(t=n.n()).done;){var a=t.value,r={sender:"asbplayerv2",message:e,tabId:a.id,src:a.src};window.postMessage(r,"*")}}catch(o){n.e(o)}finally{n.f()}}},{key:"subscribeTabs",value:function(e){var t=this;return this.onTabsCallbacks.push(e),function(){return t._remove(e,t.onTabsCallbacks)}}},{key:"subscribe",value:function(e){var t=this;return this.onMessageCallbacks.push(e),function(){return t._remove(e,t.onMessageCallbacks)}}},{key:"_remove",value:function(e,t){for(var n=t.length-1;n>=0;--n)if(e===t[n]){t.splice(n,1);break}}},{key:"unbind",value:function(){window.removeEventListener("message",this.windowEventListener),this.onMessageCallbacks=[],this.onTabsCallbacks=[]}}]),e}(),Gi={"copy-subtitle":"copySubtitle","copy-subtitle-with-dialog":"ankiExport","update-last-card":"updateLastCard"},Xi=function(){function e(){var t=this;Object(k.a)(this,e),this.extension=new Ki,this.callbacks=[];window.addEventListener("message",(function e(n){if(n.source===window&&"asbplayer-extension-to-player"===n.data.sender&&"version"===n.data.message.command){var a,r=n.data.message,o=Object(i.a)(t.callbacks);try{for(o.s();!(a=o.n()).done;){var s,c=a.value;t.extension.unbind();for(var u={},l=null!==(s=r.extensionCommands)&&void 0!==s?s:{},d=0,b=Object.keys(l);d<b.length;d++){var f=b[d];u[Gi[f]]=l[f]}t.extension=new Ki(r.version,u),c(t.extension)}}catch(h){o.e(h)}finally{o.f()}window.removeEventListener("message",e)}}))}return Object(y.a)(e,[{key:"onChromeExtension",value:function(e){this.callbacks.push(e),e(this.extension)}}]),e}(),Ji="volume",Qi="theaterMode",Yi="offset",Zi=function(){function e(t){Object(k.a)(this,e),this.settingsProvider=void 0,this.settingsProvider=t}return Object(y.a)(e,[{key:"volume",get:function(){var e=localStorage.getItem(Ji);return null===e?100:Number(e)},set:function(e){localStorage.setItem(Ji,String(e))}},{key:"theaterMode",get:function(){return"true"===localStorage.getItem(Qi)||!1},set:function(e){localStorage.setItem(Qi,String(e))}},{key:"offset",get:function(){if(!this.settingsProvider.rememberSubtitleOffset)return 0;var e=localStorage.getItem(Yi);return null===e?0:Number(e)},set:function(e){localStorage.setItem(Yi,String(e))}}]),e}(),$i=Object(v.a)((function(e){return{content:{flexGrow:1,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginRight:0},contentShift:function(t){var n=t.drawerWidth;return{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:n}}}}));function er(e,t,n,a){if(e.audio){var i,r,o,s,c,u=null!==(i=e.audio.start)&&void 0!==i?i:e.start,l=null!==(r=e.audio.end)&&void 0!==r?r:e.end;return H.fromBase64(e.subtitleFile.name,Math.max(0,u-(null!==(o=e.audio.paddingStart)&&void 0!==o?o:0)),l+(null!==(s=e.audio.paddingEnd)&&void 0!==s?s:0),null!==(c=e.audio.playbackRate)&&void 0!==c?c:1,e.audio.base64,e.audio.extension)}var d,b,f;if(e.audioFile||e.videoFile)return t?(b=t.subtitleStart,f=t.subtitleEnd):(b=e.start,f=e.end),H.fromFile(e.audioFile||e.videoFile,Math.max(0,b-n),f+a,null!==(d=e.filePlaybackRate)&&void 0!==d?d:1,e.audioTrack)}function tr(e,t,n){return e.image?K.fromBase64(e.subtitleFile.name,e.start,e.image.base64,e.image.extension):e.videoFile?K.fromFile(e.videoFile,null!==(a=e.mediaTimestamp)&&void 0!==a?a:e.start,t,n):void 0;var a}function nr(e){var t,n,a,i,r;if(e){var o=null!==(t=null!==(n=null===(a=e.subtitleFile)||void 0===a?void 0:a.name)&&void 0!==n?n:null===(i=e.audioFile)||void 0===i?void 0:i.name)&&void 0!==t?t:null===(r=e.videoFile)||void 0===r?void 0:r.name;if(o)return"".concat(o," (").concat(R(e.start),")")}}function ar(e){var t=e.searchParams,n=t.get("video"),a=t.get("channel"),i=t.get("popout");return Object(oe.jsx)(h.a,{to:"/video?video="+encodeURIComponent(n)+"&channel="+a+"&popout="+i})}function ir(e){var t=e.searchParams,n=e.settingsProvider,a=e.playbackPreferences,i=e.extension,r=e.ankiDialogFinishedRequest,o=e.onAnkiDialogRequest,s=e.onError,c=e.onPlayModeChangedViaBind,u=t.get("video"),l=t.get("channel"),d="true"===t.get("popout");return Object(oe.jsx)(zi,{settingsProvider:n,playbackPreferences:a,extension:i,videoFile:u,popOut:d,channel:l,ankiDialogFinishedRequest:r,onAnkiDialogRequest:o,onError:s,onPlayModeChangedViaBind:c})}function rr(e){var t=$i(e);return Object(oe.jsx)("main",{className:Object(ae.a)(t.content,Object(u.a)({},t.contentShift,e.drawerOpen)),children:e.children})}var or=function(){var e=Object(b.useMemo)((function(){return new Di}),[]),t=Object(b.useMemo)((function(){var t;try{t=""===e.subtitleRegexFilter.trim()?void 0:new RegExp(e.subtitleRegexFilter)}catch(n){t=void 0}return void 0!==t?new Ot({regex:t,replacement:e.subtitleRegexFilterTextReplacement}):new Ot}),[e.subtitleRegexFilter,e.subtitleRegexFilterTextReplacement]),n=Object(b.useMemo)((function(){return new Zi(e)}),[e]),a=Object(b.useMemo)((function(){return Object(g.a)({palette:{primary:{main:"#49007a"},secondary:{main:"#ff1f62"},error:{main:m.a.A400},type:e.themeType}})}),[e.themeType]),u=Object(b.useMemo)((function(){return new Z(e)}),[e]),l=Object(h.f)(),f=Object(p.b)(),v=Object(c.a)(f,1)[0],k="/video"===l.pathname||null!==v.get("video"),y=Object(b.useMemo)((function(){return new Xi}),[]),x=Object(b.useState)(y.extension),C=Object(c.a)(x,2),w=C[0],T=C[1],F=Object(b.useState)(!1),P=Object(c.a)(F,2),E=P[0],M=P[1];Object(b.useEffect)((function(){return y.onChromeExtension(T)}),[y]);var _=Object(b.useMemo)((function(){return new Wi(new S(e.keyBindSet),w)}),[e.keyBindSet,w]),B=Object(b.useRef)(null),A=Object(b.useRef)(null),D=O(!k),L=Object(c.a)(D,1)[0],W=B.current?.2:.3,U=B.current?150:300,H=Math.max(U,L*W),z=Object(b.useState)([]),V=Object(c.a)(z,2),q=V[0],K=V[1],G=Object(b.useRef)([]);G.current=q;var X=Object(b.useState)(!1),Q=Object(c.a)(X,2),$=Q[0],ee=Q[1],te=Object(b.useState)(n.theaterMode),ae=Object(c.a)(te,2),ie=ae[0],re=ae[1],se=Object(b.useState)(!1),ue=Object(c.a)(se,2),le=ue[0],de=ue[1],be=Object(b.useState)(!1),fe=Object(c.a)(be,2),he=fe[0],pe=fe[1],ve=Object(b.useState)(),ge=Object(c.a)(ve,2),Oe=ge[0],me=ge[1],ke=Object(b.useState)(!1),ye=Object(c.a)(ke,2),xe=ye[0],Se=ye[1],Ce=Object(b.useState)(),we=Object(c.a)(Ce,2),Te=we[0],Fe=we[1],Pe=Object(b.useState)(),Re=Object(c.a)(Pe,2),Ee=Re[0],Me=Re[1],_e=Object(b.useState)(),Be=Object(c.a)(_e,2),Ae=Be[0],Ie=Be[1],Ne=Object(b.useState)({subtitleFiles:[]}),De=Object(c.a)(Ne,2),Le=De[0],We=De[1],Ue=Object(b.useState)(!1),He=Object(c.a)(Ue,2),ze=He[0],Ve=He[1],qe=Object(b.useState)(!1),Ke=Object(c.a)(qe,2),Ge=Ke[0],Xe=Ke[1],Je=Object(b.useRef)(null),Qe=Object(b.useState)(),Ye=Object(c.a)(Qe,2),Ze=Ye[0],$e=Ye[1],et=Object(b.useState)(!1),tt=Object(c.a)(et,2),nt=tt[0],at=tt[1],ot=Object(b.useState)(!1),st=Object(c.a)(ot,2),ct=st[0],lt=st[1],dt=Object(b.useState)(),bt=Object(c.a)(dt,2),ft=bt[0],ht=bt[1],pt=Object(b.useMemo)((function(){return ft&&function(e){if(e)return{subtitleStart:e.start,subtitleEnd:e.end,subtitles:e.surroundingSubtitles||[{start:e.start,end:e.end,text:e.text,track:e.track}]}}(ft)}),[ft]),vt=Object(b.useMemo)((function(){return ft&&er(ft,pt,e.audioPaddingStart,e.audioPaddingEnd)}),[ft,pt,e.audioPaddingStart,e.audioPaddingEnd]),gt=Object(b.useMemo)((function(){return ft&&tr(ft,e.maxImageWidth,e.maxImageHeight)}),[ft,e.maxImageWidth,e.maxImageHeight]),jt=Object(b.useState)(!1),mt=Object(c.a)(jt,2),kt=mt[0],yt=mt[1],xt=Object(b.useState)({timestamp:0,resume:!1}),St=Object(c.a)(xt,2),Ct=St[0],wt=St[1],Tt=Object(b.useState)(!1),Ft=Object(c.a)(Tt,2),Pt=Ft[0],Rt=Ft[1],Et=Object(b.useState)(),Mt=Object(c.a)(Et,2),_t=Mt[0],Bt=Mt[1],At=Object(b.useState)(!1),It=Object(c.a)(At,2),Nt=It[0],Lt=It[1],Wt=Object(b.useState)(!1),Ut=Object(c.a)(Wt,2),Ht=Ut[0],zt=Ut[1],Vt=Object(b.useState)(),qt=Object(c.a)(Vt,2),Kt=qt[0],Gt=qt[1],Xt=Object(b.useState)(),Jt=Object(c.a)(Xt,2),Qt=Jt[0],Yt=Jt[1],Zt=Object(b.useState)([]),$t=Object(c.a)(Zt,2),en=$t[0],tn=$t[1],nn=Object(b.useRef)(null),rn=Object(b.useRef)(!1);rn.current=kt;var on=Le.subtitleFiles,sn=Object(b.useCallback)((function(e){Fe("error"),me(e),Se(!0)}),[]),cn=Object(b.useCallback)((function(e){if(e||0!==G.current.length){var t=null!==e&&void 0!==e?e:G.current[G.current.length-1];ht(t),at(!0),lt(!1),zt(!0),yt(!0)}}),[]),ln=Object(b.useCallback)(function(){var e=Object(s.a)(d.a.mark((function e(t,n,a,i,r,s,c){var u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=o.a,e.t1=Object(o.a)({},r),e.t2={},e.t3=s,e.t4=Date.now(),e.t5=Object(ne.a)(),e.t6=n,e.t7=c,e.next=10,fetch(t).then((function(e){return e.blob()})).then((function(e){return new File([e],n)}));case 10:e.t8=e.sent,e.t9=a,e.t10=i,e.t11={surroundingSubtitles:e.t3,timestamp:e.t4,id:e.t5,name:e.t6,mediaTimestamp:e.t7,videoFile:e.t8,selectedAudioTrack:e.t9,filePlaybackRate:e.t10},u=(0,e.t0)(e.t1,e.t2,e.t11),cn(u);case 16:case"end":return e.stop()}}),e)})));return function(t,n,a,i,r,o,s){return e.apply(this,arguments)}}(),[cn]),dn=Object(b.useCallback)(function(){var e=Object(s.a)(d.a.mark((function e(t,n,a,i,r,o,s,c,l,b){var f;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return lt(!0),e.prev=1,e.next=4,u.export(t,n,a,i,r,o,s,c,l,b);case 4:f=e.sent,"gui"!==b&&("default"===b?(Fe("success"),me("Exported card: "+f),Se(!0)):"updateLast"===b&&(Fe("success"),me("Updated card: "+f),Se(!0)),at(!1),rn.current&&(wt({timestamp:Date.now(),resume:!0}),yt(!1))),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.t0 instanceof Error?sn(e.t0.message):sn(String(e.t0));case 12:return e.prev=12,lt(!1),zt(!1),e.finish(12);case 16:case"end":return e.stop()}}),e,null,[[1,8,12,16]])})));return function(t,n,a,i,r,o,s,c,u,l){return e.apply(this,arguments)}}(),[u,sn]),bn=Object(b.useCallback)((function(t,n,a,i,s,c,u,l,d,b,f,h,p,v){var g;t&&e.copyToClipboardOnMine&&navigator.clipboard.writeText(t.text);var j=Object(o.a)(Object(o.a)({},t),{},{surroundingSubtitles:n,timestamp:Date.now(),id:v||Object(ne.a)(),name:Ze,subtitleFile:s,audioFile:a,videoFile:i,filePlaybackRate:l,mediaTimestamp:c,audioTrack:u,audio:d,image:b,url:f});switch(K((function(e){if(p&&e.length>0){var n,a=e[e.length-1];if(t.start===a.start&&t.end===a.end&&t.text===a.text&&(null===s||void 0===s?void 0:s.name)===(null===(n=a.subtitleFile)||void 0===n?void 0:n.name)){if(void 0!==c&&c!==a.mediaTimestamp){var i=Object(r.a)(e);return i[i.length-1]=j,i}return e}}return[].concat(Object(r.a)(e),[j])})),null!==h&&void 0!==h?h:J.none){case J.none:break;case J.showAnkiDialog:cn(j);break;case J.updateLastCard:yt(!0);var O=er(j,void 0,e.audioPaddingStart,e.audioPaddingEnd);O&&e.preferMp3&&(O=O.toMp3()),dn(I(t,n),"",O,tr(j,e.maxImageWidth,e.maxImageHeight),"",null!==(g=nr(j))&&void 0!==g?g:"","",{},e.tags,"updateLast");break;default:throw new Error("Unknown post mine action: "+h)}t&&(Fe("success"),me(""===t.text?"Saved ".concat(R(t.start)):'Copied: "'.concat(t.text,'"')),Se(!0))}),[Ze,e,dn,cn]),fn=Object(b.useCallback)((function(){ee((function(e){return!e})),M(!1)}),[]),hn=Object(b.useCallback)((function(){return ee(!1)}),[]),pn=Object(b.useCallback)((function(){var e=!n.theaterMode;n.theaterMode=e,re(e),M(!1)}),[n]),vn=Object(b.useCallback)((function(){M((function(e){return!e}))}),[]);Object(b.useEffect)((function(){E?document.fullscreenElement||document.documentElement.requestFullscreen():document.fullscreenElement&&document.exitFullscreen()}),[E]),Object(b.useEffect)((function(){var e=function(){document.fullscreenElement||M(!1)};return document.addEventListener("fullscreenchange",e),function(){return document.removeEventListener("fullscreenchange",e)}}),[]);var gn=Object(b.useCallback)((function(){de((function(e){return!e}))}),[]),jn=Object(b.useCallback)((function(){pe((function(e){return!e}))}),[]),On=Object(b.useCallback)((function(){zt(!0),Rt(!0)}),[]),mn=Object(b.useCallback)((function(){return Se(!1)}),[]),kn=Object(b.useCallback)((function(){return Lt(!1)}),[]),yn=Object(b.useCallback)((function(t){var n,a,i;e.settings=t,Rt(!1),Bt(void 0),zt(nt),null===(n=A.current)||void 0===n||n.subtitleSettings(e.subtitleSettings),null===(a=A.current)||void 0===a||a.ankiSettings(e.ankiSettings),null===(i=A.current)||void 0===i||i.miscSettings(e.miscSettings)}),[e,nt]),xn=Object(b.useCallback)((function(e){var t,n=[],a=Object(i.a)(q);try{for(a.s();!(t=a.n()).done;){var r=t.value;e.id!==r.id&&n.push(r)}}catch(o){a.e(o)}finally{a.f()}K(n)}),[q]),Sn=Object(b.useCallback)((function(e){e===Le.audioFileUrl&&We((function(t){return URL.revokeObjectURL(e),{subtitleFiles:t.subtitleFiles,audioFile:void 0,audioFileUrl:void 0,videoFile:t.videoFile,videoFileUrl:t.videoFileUrl}}))}),[Le]),Cn=Object(b.useCallback)((function(e){e===Le.videoFileUrl&&(We((function(t){return URL.revokeObjectURL(e),{subtitleFiles:t.subtitleFiles,audioFile:t.audioFile,audioFileUrl:t.audioFileUrl,videoFile:void 0,videoFileUrl:void 0}})),M(!1))}),[Le]),wn=Object(b.useCallback)(function(){var t=Object(s.a)(d.a.mark((function t(n){var a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,er(n,void 0,e.audioPaddingStart,e.audioPaddingEnd);case 3:a=t.sent,e.preferMp3?a.toMp3().download():a.download(),t.next=11;break;case 7:t.prev=7,t.t0=t.catch(0),console.error(t.t0),t.t0 instanceof Error?sn(t.t0.message):sn(String(t.t0));case 11:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}(),[sn,e]),Tn=Object(b.useCallback)(function(){var t=Object(s.a)(d.a.mark((function t(n){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,tr(n,e.maxImageWidth,e.maxImageHeight);case 3:t.sent.download(),t.next=10;break;case 6:t.prev=6,t.t0=t.catch(0),console.error(t.t0),t.t0 instanceof Error?sn(t.t0.message):sn(String(t.t0));case 10:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e){return t.apply(this,arguments)}}(),[sn,e]),Fn=Object(b.useCallback)((function(e,n){var a,r=[],o=Object(i.a)(n);try{var s=function(){var e=a.value;void 0===r.find((function(t){return t.start===e.start&&t.end===e.end&&t.text===e.text}))&&r.push(e)};for(o.s();!(a=o.n()).done;)s()}catch(c){o.e(c)}finally{o.f()}N(new Blob([t.subtitlesToSrt(r)],{type:"text/plain"}),"".concat(e,"_MiningHistory_").concat((new Date).toISOString(),".srt"))}),[t]),Pn=Object(b.useCallback)((function(e){var t;on.find((function(t){var n;return t.name===(null===(n=e.subtitleFile)||void 0===n?void 0:n.name)}))?Me({text:e.text,start:e.start,end:e.end,originalStart:e.originalStart,originalEnd:e.originalEnd,track:e.track}):sn("Subtitle file "+(null===(t=e.subtitleFile)||void 0===t?void 0:t.name)+" is not open.")}),[on,sn]),Rn=Object(b.useCallback)((function(e){ht(e),at(!0),lt(!1),zt(!0)}),[]),En=Object(b.useCallback)((function(){at(!1),lt(!1),zt(!1),kt&&(wt({timestamp:Date.now(),resume:!0}),yt(!1))}),[kt]),Mn=Object(b.useCallback)((function(){if(ft)if(on.find((function(e){var t;return e.name===(null===(t=ft.subtitleFile)||void 0===t?void 0:t.name)}))){var e={text:ft.text,start:ft.start,end:ft.end,originalStart:ft.originalStart,originalEnd:ft.originalEnd,track:ft.track};Ie(e),Me(e),En()}else{var t;sn("Subtitle file "+(null===(t=ft.subtitleFile)||void 0===t?void 0:t.name)+" is not open.")}}),[ft,on,En,sn]),_n=Object(b.useCallback)((function(e){Gt(e),Lt(!0)}),[]);Object(b.useEffect)((function(){return w.subscribeTabs((function(e){if(e.length!==en.length)tn(e);else{for(var t=!1,n=0;n<en.length;++n){var a=en[n],i=e[n];if(a.id!==i.id||a.title!==i.title||a.src!==i.src){t=!0;break}}t&&tn(e)}Qt&&0===e.filter((function(e){return e.id===Qt.id&&e.src===Qt.src})).length&&(Yt(void 0),sn("Lost connection with tab "+Qt.id+" "+Qt.title))}))}),[en,Qt,w,sn]);var Bn=Object(b.useCallback)((function(e){return Yt(e)}),[]),An=Object(b.useCallback)((function(e){try{var t=function(e){for(var t=[],n=void 0,a=void 0,i=0;i<e.length;++i){var r=e[i],o=r.name.lastIndexOf(".");if(-1===o)throw new Error("Unable to determine extension of "+r.name);var s=r.name.substring(o+1,r.name.length);switch(s){case"ass":case"srt":case"vtt":case"nfvtt":case"sup":case"ytxml":case"dfxp":case"ttml2":t.push(r);break;case"mkv":case"mp4":case"avi":if(a)throw new Error("Cannot open two video files simultaneously");a=r;break;case"mp3":case"m4a":case"aac":case"flac":case"ogg":case"wav":case"opus":if(n)throw new Error("Cannot open two audio files simultaneously");n=r;break;default:throw new Error("Unsupported extension "+s)}}if(a&&n)throw new Error("Cannot load both an audio and video file simultaneously");return{subtitleFiles:t,audioFile:n,videoFile:a}}(e),n=t.subtitleFiles,a=t.audioFile,i=t.videoFile;if(We((function(e){Ve(!0);var t=void 0,r=void 0;return i||a?(!function(e){e.audioFileUrl&&URL.revokeObjectURL(e.audioFileUrl),e.videoFileUrl&&URL.revokeObjectURL(e.videoFileUrl)}(e),i?t=URL.createObjectURL(i):a&&(r=URL.createObjectURL(a)),Yt(void 0)):(i=e.videoFile,t=e.videoFileUrl,a=e.audioFile,r=e.audioFileUrl),{subtitleFiles:0===n.length?e.subtitleFiles:n,audioFile:a,audioFileUrl:r,videoFile:i,videoFileUrl:t}})),n.length>0){var r=n[0].name;$e(r.substring(0,r.lastIndexOf(".")))}}catch(o){console.error(o),o instanceof Error?sn(o.message):sn(String(o))}}),[sn]),In=Object(b.useCallback)(function(){var e=Object(s.a)(d.a.mark((function e(t){var n,a,r,o,s,c,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1===t.length){e.next=3;break}return sn("Cannot load more than one directory at a time"),e.abrupt("return");case 3:if((n=t[0].webkitGetAsEntry())&&n.isDirectory){e.next=7;break}return sn("Failed to load directory"),e.abrupt("return");case 7:return a=n,e.prev=8,e.next=11,new Promise((function(e,t){return a.createReader().readEntries(e,t)}));case 11:if(!(r=e.sent).find((function(e){return e.isDirectory}))){e.next=15;break}return sn("Cannot load a directory with subdirectories"),e.abrupt("return");case 15:o=r.map((function(e){return new Promise((function(t,n){return e.file(t,n)}))})),s=[],c=Object(i.a)(o),e.prev=18,c.s();case 20:if((u=c.n()).done){e.next=29;break}return l=u.value,e.t0=s,e.next=25,l;case 25:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 27:e.next=20;break;case 29:e.next=34;break;case 31:e.prev=31,e.t2=e.catch(18),c.e(e.t2);case 34:return e.prev=34,c.f(),e.finish(34);case 37:An(s),e.next=44;break;case 40:e.prev=40,e.t3=e.catch(8),console.error(e.t3),e.t3 instanceof Error?sn(e.t3.message):sn(String(e.t3));case 44:case"end":return e.stop()}}),e,null,[[8,40],[18,31,34,37]])})));return function(t){return e.apply(this,arguments)}}(),[sn,An]);Object(b.useEffect)((function(){if(!k){var e=w.subscribe((function(e){return t.apply(this,arguments)}));return w.startHeartbeat(!1),e}function t(){return t=Object(s.a)(d.a.mark((function e(t){var n,a,i,r,o,c,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("sync"!==t.data.command&&"syncv2"!==t.data.command){e.next=37;break}if(0!==(n=w.tabs.filter((function(e){return e.id===t.tabId&&(!t.src||e.src===t.src)}))).length){e.next=5;break}return t.src?console.error("Received sync request but the requesting tab ID "+t.tabId+" with src "+t.src+" was not found"):console.error("Received sync request but the requesting tab ID "+t.tabId+" was not found"),e.abrupt("return");case 5:if(a=n[0],r=!1,"sync"!==t.data.command){e.next=21;break}return o=t.data,e.t0=File,e.next=12,fetch("data:text/plain;base64,"+o.subtitles.base64);case 12:return e.next=14,e.sent.blob();case 14:e.t1=e.sent,e.t2=[e.t1],e.t3=o.subtitles.name,e.t4=new e.t0(e.t2,e.t3),i=[e.t4],e.next=31;break;case 21:if("syncv2"!==t.data.command){e.next=29;break}return u=t.data,e.next=25,Promise.all(u.subtitles.map(function(){var e=Object(s.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=File,e.next=3,fetch("data:text/plain;base64,"+t.base64);case 3:return e.next=5,e.sent.blob();case 5:return e.t1=e.sent,e.t2=[e.t1],e.t3=t.name,e.abrupt("return",new e.t0(e.t2,e.t3));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 25:i=e.sent,r=null!==(c=u.flatten)&&void 0!==c&&c,e.next=31;break;case 29:return console.error("Unknown message "+t.data.command),e.abrupt("return");case 31:l=i[0].name,$e(l.substring(0,l.lastIndexOf("."))),We({subtitleFiles:i,flattenSubtitleFiles:r,audioFile:void 0,audioFileUrl:void 0,videoFile:void 0,videoFileUrl:void 0}),Yt(a),e.next=38;break;case 37:"edit-keyboard-shortcuts"===t.data.command?(Rt(!0),Bt("keyboard-shortcuts")):"open-asbplayer-settings"===t.data.command&&Rt(!0);case 38:case"end":return e.stop()}}),e)}))),t.apply(this,arguments)}w.startHeartbeat(!0)}),[w,k]);var Nn=Object(b.useCallback)((function(e,t){switch(t){case Y.autoPause:me("Auto-pause: On");break;case Y.condensed:me("Condensed playback: On");break;case Y.normal:e===Y.autoPause?me("Auto-pause: Off"):e===Y.condensed&&me("Condensed playback: Off")}Fe("info"),Se(!0)}),[]),Dn=Object(b.useCallback)((function(e){nt||(e.preventDefault(),k?sn("Video player cannot receive dropped files. Drop outside of the video frame instead."):(Xe(!1),Je.current=null,e.dataTransfer.items&&e.dataTransfer.items.length>0&&function(e){for(var t=0;t<e.length;++t){var n;if(null===(n=e[t].webkitGetAsEntry())||void 0===n||!n.isDirectory)return!1}return!0}(e.dataTransfer.items)?In(e.dataTransfer.items):e.dataTransfer.files&&e.dataTransfer.files.length>0&&An(e.dataTransfer.files)))}),[k,sn,An,In,nt]),Ln=Object(b.useCallback)((function(){var e,t=null===(e=nn.current)||void 0===e?void 0:e.files;t&&t.length>0&&An(t)}),[An]),Wn=Object(b.useCallback)((function(){var e;return null===(e=nn.current)||void 0===e?void 0:e.click()}),[]),Un=Object(b.useCallback)(Object(s.a)(d.a.mark((function e(){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==Le.subtitleFiles){e.next=2;break}return e.abrupt("return");case 2:if(0!==(n=Le.subtitleFiles.filter((function(e){return!e.name.endsWith(".sup")}))).length){e.next=5;break}return e.abrupt("return");case 5:return e.t0=N,e.t1=Blob,e.next=9,t.filesToSrt(n);case 9:e.t2=e.sent,e.t3=[e.t2],e.t4={type:"text/plain"},e.t5=new e.t1(e.t3,e.t4),e.t6="".concat(Ze,".srt"),(0,e.t0)(e.t5,e.t6);case 15:case"end":return e.stop()}}),e)}))),[Ze,Le.subtitleFiles,t]),Hn=Object(b.useCallback)((function(e){nt||e.preventDefault()}),[nt]),zn=Object(b.useCallback)((function(e){nt||(e.preventDefault(),e.stopPropagation(),k||(Je.current=e.target,Xe(!0)))}),[k,nt]),Vn=Object(b.useCallback)((function(e){e.nativeEvent.preventDefault(),e.nativeEvent.stopPropagation(),k||Je.current!==e.target||Xe(!1)}),[k]),qn=Object(b.useCallback)((function(){return Ve(!1)}),[]);if(Object(b.useEffect)((function(){if("settings"===v.get("view")&&(Rt(!0),l.hash&&l.hash.startsWith("#"))){var e=l.hash.substring(1,l.hash.length);Bt(e)}}),[v,l]),Object(b.useEffect)((function(){var e;xe&&Oe&&Te&&(null===(e=A.current)||void 0===e||e.alert(Oe,Te))}),[Oe,Te,xe]),"/"===l.pathname&&v.get("video"))return Object(oe.jsx)(ar,{searchParams:v});var Kn=ze&&!B.current||0===Le.subtitleFiles.length&&!Le.audioFile&&!Le.videoFile,Gn=void 0!==Le.videoFile&&(ie&&!he||E),Xn=$&&!E;return Object(oe.jsxs)(j.a,{theme:a,children:[Object(oe.jsx)(rt.a,{}),Object(oe.jsxs)("div",{onDrop:Dn,onDragOver:Hn,onDragEnter:zn,onDragLeave:Vn,children:[Object(oe.jsx)(ce,{open:xe,onClose:mn,autoHideDuration:3e3,severity:Te,children:Oe}),Object(oe.jsxs)(h.d,{children:[Object(oe.jsx)(h.b,{path:"/video",element:Object(oe.jsxs)(oe.Fragment,{children:[Object(oe.jsx)(ir,{searchParams:v,settingsProvider:e,playbackPreferences:n,extension:w,ankiDialogFinishedRequest:Ct,onAnkiDialogRequest:ln,onError:sn,onPlayModeChangedViaBind:Nn}),Object(oe.jsx)(it,{open:nt,disabled:ct,audioClip:vt,image:gt,source:nr(ft),url:null===ft||void 0===ft?void 0:ft.url,sliderContext:pt,customFields:e.customAnkiFields,anki:u,settingsProvider:e,onCancel:En,onRewind:Mn,onProceed:dn,onViewImage:_n}),Object(oe.jsx)(je,{open:Nt,image:Kt,onClose:kn})]})}),Object(oe.jsx)(h.b,{path:"/",element:Object(oe.jsxs)("div",{children:[Object(oe.jsx)(an,{items:q,open:Xn,drawerWidth:H,onClose:hn,onDelete:xn,onClipAudio:wn,onDownloadImage:Tn,onDownloadSectionAsSrt:Fn,onSelect:Pn,onAnki:Rn}),Object(oe.jsx)(it,{open:nt,disabled:ct,audioClip:vt,image:gt,source:nr(ft),url:null===ft||void 0===ft?void 0:ft.url,sliderContext:pt,customFields:e.customAnkiFields,anki:u,settingsProvider:e,onCancel:En,onRewind:Mn,onProceed:dn,onViewImage:_n,onOpenSettings:On}),Object(oe.jsx)(je,{open:Nt,image:Kt,onClose:kn}),Object(oe.jsx)(Za,{anki:u,extension:w,open:Pt,onClose:yn,settings:e.settings,scrollToId:_t}),Object(oe.jsx)(Dt,{title:Ze||"asbplayer",drawerWidth:H,drawerOpen:Xn,hidden:Gn,subtitleFiles:Le.subtitleFiles,onOpenCopyHistory:fn,onDownloadSubtitleFilesAsSrt:Un,onOpenSettings:On,onFileSelector:Wn}),Object(oe.jsx)("input",{ref:nn,onChange:Ln,type:"file",accept:".srt,.ass,.vtt,.sup,.mp3,.m4a,.aac,.flac,.ogg,.wav,.opus,.mkv,.mp4,.avi",multiple:!0,hidden:!0}),Object(oe.jsxs)(rr,{drawerWidth:H,drawerOpen:Xn,children:[Kn&&Object(oe.jsx)(un,{latestExtensionVersion:"0.26.0",extensionUrl:"https://github.com/killergerbah/asbplayer/releases/latest",extension:w,loading:ze,dragging:Ge,appBarHidden:Gn,onFileSelector:Wn}),Object(oe.jsx)(ut,{dragging:Ge,appBarHidden:Gn,loading:ze}),Object(oe.jsx)(ka,{subtitleReader:t,settingsProvider:e,playbackPreferences:n,onCopy:bn,onError:sn,onUnloadAudio:Sn,onUnloadVideo:Cn,onLoaded:qn,onTabSelected:Bn,onAnkiDialogRequest:cn,onAppBarToggle:pn,onFullscreenToggle:vn,onHideSubtitlePlayer:gn,onVideoPopOut:jn,onPlayModeChangedViaBind:Nn,tab:Qt,availableTabs:en,sources:Le,jumpToSubtitle:Ee,rewindSubtitle:Ae,videoFrameRef:B,videoChannelRef:A,extension:w,drawerOpen:Xn,appBarHidden:Gn,videoFullscreen:E,hideSubtitlePlayer:le||E,videoPopOut:he,disableKeyEvents:Ht,ankiDialogRequested:kt,ankiDialogFinishedRequest:Ct,keyBinder:_})]})]})})]})]})]})},sr=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,456)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,r=t.getLCP,o=t.getTTFB;n(e),a(e),i(e),r(e),o(e)}))};Object(a.createRoot)(document.querySelector("#root")).render(Object(oe.jsx)(p.a,{basename:"/asbplayer",children:Object(oe.jsx)(or,{})})),sr()}},[[369,1,2]]]);
//# sourceMappingURL=main.297ee3f0.chunk.js.map