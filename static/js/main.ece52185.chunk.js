(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{206:function(e,t){},208:function(e,t){},227:function(e,t){},229:function(e,t){},237:function(e,t){},239:function(e,t){},251:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n(0),c=n.n(r),i=n(16),o=n.n(i),s=n(329),u=n(328),l=n(5),d=n.n(l),b=n(9),f=n(49),h=n(46),j=n(6),p=n(48),O=n(12),v=n(24),m=n(294);function g(e){var t=Object(r.useState)([0,0]),n=Object(j.a)(t,2),a=n[0],c=n[1];return Object(r.useLayoutEffect)((function(){function t(){e&&c([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",t),t(),function(){return window.removeEventListener("resize",t)}}),[e]),a}var k=n(4),x=n(333),y=n(252),w=Object(m.a)({root:{display:"flex",justifyContent:"center",position:"fixed",top:80,width:"100%",pointerEvents:"none",zIndex:2e3}});function C(e){var t=w();return Object(r.useEffect)((function(){if(e.open){var t=setTimeout(e.onClose,e.autoHideDuration);return function(){return clearTimeout(t)}}return null}),[e.open,e.autoHideDuration,e.onClose]),Object(a.jsx)("div",{className:t.root,children:Object(a.jsx)(y.a,{in:e.open,children:Object(a.jsx)(x.a,{severity:e.severity,children:e.children})})})}var S=n(17),T=n(18),F=function(){function e(t){Object(S.a)(this,e),this.settingsProvider=t}return Object(T.a)(e,[{key:"deckNames",value:function(){var e=Object(b.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction(t,"deckNames");case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelNames",value:function(){var e=Object(b.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction(t,"modelNames");case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelFieldNames",value:function(){var e=Object(b.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction(t,"modelFieldNames",{modelName:n});case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"export",value:function(){var e=Object(b.a)(d.a.mark((function e(t,n,a,r,c,i,o){var s,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s={},this.settingsProvider.sentenceField&&n&&(s[this.settingsProvider.sentenceField]=n?n.split("\n").join("<br>"):n),this.settingsProvider.definitionField&&a&&(s[this.settingsProvider.definitionField]=a?a.split("\n").join("<br>"):a),this.settingsProvider.wordField&&i&&(s[this.settingsProvider.wordField]=i),this.settingsProvider.sourceField&&o&&(s[this.settingsProvider.sourceField]=o),u={note:{deckName:this.settingsProvider.deck,modelName:this.settingsProvider.noteType,fields:s,options:{allowDuplicate:!1,duplicateScope:"deck",duplicateScopeOptions:{deckName:this.settingsProvider.deck,checkChildren:!1}}}},!this.settingsProvider.audioField||!r){e.next=13;break}return e.t0=r.name,e.next=10,r.base64();case 10:e.t1=e.sent,e.t2=[this.settingsProvider.audioField],u.note.audio={filename:e.t0,data:e.t1,fields:e.t2};case 13:if(!this.settingsProvider.imageField||!c){e.next=20;break}return e.t3=c.name,e.next=17,c.base64();case 17:e.t4=e.sent,e.t5=[this.settingsProvider.imageField],u.note.picture={filename:e.t3,data:e.t4,fields:e.t5};case 20:return e.next=22,this._executeAction(t,"addNote",u);case 22:return l=e.sent,e.abrupt("return",l.result);case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r,c,i,o){return e.apply(this,arguments)}}()},{key:"_executeAction",value:function(){var e=Object(b.a)(d.a.mark((function e(t,n,a){var r,c,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={action:n,version:6},a&&(r.params=a),e.next=4,fetch(t,{method:"POST",body:JSON.stringify(r)});case 4:return c=e.sent,e.next=7,c.json();case 7:if(!(i=e.sent).error){e.next=10;break}throw new Error(i.error);case 10:return e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}()}]),e}(),E=n(255),I=n(309),M=n(334),R=n(299),U=n(308),N=n(302),A=n(301),P=Object(E.a)((function(e){return{root:{"& .MuiTextField-root":{marginBottom:e.spacing(1)}},mediaField:{cursor:"pointer","& input":{cursor:"pointer"}}}}));function L(e){var t=P(),n=e.open,c=e.disabled,i=e.text,o=e.onProceed,s=e.onCancel,u=e.onViewImage,l=e.audioClip,d=e.image,b=e.source,f=Object(r.useState)(""),h=Object(j.a)(f,2),p=h[0],O=h[1],v=Object(r.useState)(),m=Object(j.a)(v,2),g=m[0],k=m[1],x=Object(r.useState)(),y=Object(j.a)(x,2),w=y[0],C=y[1];Object(r.useEffect)((function(){k(i)}),[i]),Object(r.useEffect)((function(){n&&(O(""),C(""))}),[n]);var S=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),l.play()}),[l]),T=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),u(d)}),[d,u]);return Object(a.jsxs)(R.a,{open:n,disableEnforceFocus:!0,fullWidth:!0,maxWidth:"sm",onBackdropClick:function(){return s()},children:[Object(a.jsx)(A.a,{children:"Anki Export"}),Object(a.jsx)(N.a,{children:Object(a.jsxs)("form",{className:t.root,children:[Object(a.jsx)(M.a,{variant:"filled",multiline:!0,fullWidth:!0,rowsMax:8,label:"Sentence",value:g,onChange:function(e){return k(e.target.value)}}),Object(a.jsx)(M.a,{variant:"filled",multiline:!0,fullWidth:!0,rows:8,label:"Definition",value:p,onChange:function(e){return O(e.target.value)}}),Object(a.jsx)(M.a,{variant:"filled",fullWidth:!0,label:"Word",value:w,onChange:function(e){return C(e.target.value)}}),l&&Object(a.jsx)("div",{className:t.mediaField,onClick:S,children:Object(a.jsx)(M.a,{variant:"filled",fullWidth:!0,value:l.name,label:"Audio"})}),d&&Object(a.jsx)("div",{className:t.mediaField,onClick:T,children:Object(a.jsx)(M.a,{variant:"filled",fullWidth:!0,value:d.name,label:"Image"})}),Object(a.jsx)(M.a,{variant:"filled",fullWidth:!0,label:"Source",value:b})]})}),Object(a.jsxs)(U.a,{children:[Object(a.jsx)(I.a,{disabled:c,onClick:function(){return s()},children:"Cancel"}),Object(a.jsx)(I.a,{disabled:c,onClick:function(){return o(g,p,l,d,w,b)},children:"Export"})]})]})}var B={"audio/ogg;codecs=opus":"ogg","audio/webm;codecs=opus":"webm"},_=Object(j.a)(Object.keys(B).filter(MediaRecorder.isTypeSupported).map((function(e){return[e,B[e]]}))[0],2),D=_[0],z=_[1],W=function(){function e(t,n,a,r,c){Object(S.a)(this,e),this.name=t,this.start=n,this.end=a,this._base64=r,this.extension=c}return Object(T.a)(e,[{key:"base64",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._base64);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t,n,a=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return t=e.sent,(n=new Audio).src=URL.createObjectURL(t),n.preload="none",n.load(),e.next=9,n.play();case 9:return e.abrupt("return",new Promise((function(e,t){setTimeout((function(){n.pause();var t=n.src;n.src=null,URL.revokeObjectURL(t),e()}),a.end-a.start+1e3)})));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_blob",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cachedBlob){e.next=6;break}return e.next=3,fetch("data:audio/"+this.extension+";base64,"+this._base64);case 3:return e.next=5,e.sent.blob();case 5:this.cachedBlob=e.sent;case 6:return e.abrupt("return",this.cachedBlob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),H=function(){function e(t,n,a,r){Object(S.a)(this,e),this.file=t,this.name=t.name+"_"+n+"_"+a+"."+z,this.start=n,this.end=a,this.trackId=r,this.extension=z}return Object(T.a)(e,[{key:"base64",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(b.a)(d.a.mark((function e(n,a){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new FileReader,e.t0=r,e.next=4,t.blob();case 4:e.t1=e.sent,e.t0.readAsDataURL.call(e.t0,e.t1),r.onloadend=function(){var e=r.result,t=e.substr(e.indexOf(",")+1);n(t)};case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=5;break}return e.next=3,this._clipAudio();case 3:return this._blob=e.sent,e.abrupt("return");case 5:return t=this._audioElement(this._blob),e.next=8,t.play();case 8:return e.next=10,this._stopAudio(t);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=4;break}return e.next=3,this._clipAudio();case 3:this._blob=e.sent;case 4:return e.abrupt("return",this._blob);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_clipAudio",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var a=t._audioElement(t.file);a.oncanplay=function(){var n=Object(b.a)(d.a.mark((function n(r){var c,i,o,s,u;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a.play(),c=t._captureStream(a),i=Object(O.a)(c.getVideoTracks());try{for(i.s();!(o=i.n()).done;)o.value.stop()}catch(r){i.e(r)}finally{i.f()}return s=new MediaRecorder(c,{mimeType:D}),u=[],s.ondataavailable=function(e){u.push(e.data)},s.onstop=function(t){e(new Blob(u))},s.start(),n.next=11,t._stopAudio(a);case 11:s.stop();case 12:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_audioElement",value:function(e){var t=new Audio;if(t.src=URL.createObjectURL(e),t.preload="none",this.trackId&&t.audioTracks&&t.audioTracks.length>0){var n,a=Object(O.a)(t.audioTracks);try{for(a.s();!(n=a.n()).done;){var r=n.value;r.enabled=this.trackId===r.id}}catch(c){a.e(c)}finally{a.f()}}return t.currentTime=this.start/1e3,t.load(),t}},{key:"_captureStream",value:function(e){if("function"===typeof e.captureStream)return e.captureStream();if("function"===typeof e.mozCaptureStream)return e.mozCaptureStream();throw new Error("Unable to capture stream from audio")}},{key:"_stopAudio",value:function(){var e=Object(b.a)(d.a.mark((function e(t){var n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){setTimeout((function(){t.pause();var n=t.src;t.src=null,URL.revokeObjectURL(n),e()}),n.end-n.start+100)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),V=function(){function e(t){Object(S.a)(this,e),this.data=t}return Object(T.a)(e,[{key:"play",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.play();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"base64",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.base64();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t,n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:t=e.sent,n=window.URL.createObjectURL(t),a=document.createElement("a"),document.body.appendChild(a),a.style="display: none",a.href=n,a.download=this.data.name,a.click(),URL.revokeObjectURL(n),a.remove();case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"name",get:function(){return this.data.name}}],[{key:"fromBase64",value:function(t,n,a,r,c){var i=t.name.substring(0,t.name.lastIndexOf("."))+"_"+n+"_"+a+"."+c;return new e(new W(i,n,a,r,c))}},{key:"fromFile",value:function(t,n,a,r){return new e(new H(t,n,a,r))}}]),e}(),X=n(310),G=n(95),K=n.n(G),q=n(94),J=n.n(q),Y=n(312),$=n(313),Q=n(311),Z=n(315),ee=n(314),te=n(63),ne=n(81),ae=n.n(ne),re=Object(E.a)((function(e){return{inlineIcon:{maxWidth:"80%",height:20,display:"inline-flex",flexDirection:"column",flexWrap:"wrap",alignItems:"start",textAlign:"left"}}}));function ce(e){var t=re(),n=e.open,r=e.extensionUrl,c=e.onClose;return Object(a.jsxs)(R.a,{open:n,onBackdropClick:function(){return c()},children:[Object(a.jsxs)(N.a,{children:[Object(a.jsx)(te.a,{variant:"h6",children:"Loading files"}),Object(a.jsxs)(te.a,{component:"ul",children:[Object(a.jsx)("li",{children:"Drag and drop mkv, srt, ass, or mp3 files into the player."}),Object(a.jsx)("li",{children:"Multiple files can be dragged and dropped simultaneously e.g. mkv+srt, mp3+ass, etc."})]}),Object(a.jsx)("br",{}),Object(a.jsx)(te.a,{variant:"h6",children:"Syncing with streaming video in another tab"}),Object(a.jsxs)(te.a,{component:"ol",children:[Object(a.jsxs)("li",{children:["Install the Chrome ",Object(a.jsx)(X.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:r,children:"extension"}),"."]}),Object(a.jsx)("li",{children:"Load a subtitle file."}),Object(a.jsx)("li",{children:Object(a.jsxs)("div",{className:t.inlineIcon,children:["Use the \xa0",Object(a.jsx)(ae.a,{fontSize:"small"}),"\xa0 button in the bottom right."]})}),Object(a.jsx)("li",{children:"If the icon does not appear try refreshing the video in the other tab."})]}),Object(a.jsx)("br",{}),Object(a.jsx)(te.a,{variant:"h6",children:"Anki"}),Object(a.jsxs)(te.a,{component:"ul",children:[Object(a.jsx)("li",{children:Object(a.jsxs)("div",{className:t.inlineIcon,children:["Use the \xa0",Object(a.jsx)(J.a,{fontSize:"small"}),"\xa0 button in the copy history."]})}),Object(a.jsx)("li",{children:"Audio/image will be exported only if an audio/image source was available when the subtitle was copied."}),Object(a.jsx)("li",{children:"Configure Anki settings with the settings button in the top right."})]}),Object(a.jsx)("br",{}),Object(a.jsx)(te.a,{variant:"h6",children:"Changing subtitle offset"}),Object(a.jsxs)(te.a,{component:"ol",children:[Object(a.jsx)("li",{children:"Click on the subtitle offset input field in the controls."}),Object(a.jsx)("li",{children:"Type in a number and hit enter."})]}),Object(a.jsx)("br",{}),Object(a.jsx)(te.a,{variant:"h6",children:"Condensed playback of local media files"}),Object(a.jsxs)(te.a,{component:"ol",children:[Object(a.jsx)("li",{children:"Load an audio/video file with a subtitle file."}),Object(a.jsx)("li",{children:Object(a.jsxs)("div",{className:t.inlineIcon,children:["Use the \xa0",Object(a.jsx)(K.a,{fontSize:"small"}),"\xa0 button in the bottom right."]})})]}),Object(a.jsx)("br",{}),Object(a.jsx)(te.a,{variant:"h6",children:"Keyboard shortcuts"}),Object(a.jsx)(Q.a,{children:Object(a.jsx)(Y.a,{size:"small",children:Object(a.jsxs)($.a,{children:[Object(a.jsxs)(ee.a,{children:[Object(a.jsx)(Z.a,{children:Object(a.jsx)(te.a,{children:"Left/Right"})}),Object(a.jsx)(Z.a,{children:Object(a.jsx)(te.a,{children:"Previous/next subtitle"})})]}),Object(a.jsxs)(ee.a,{children:[Object(a.jsx)(Z.a,{children:Object(a.jsx)(te.a,{children:"Space"})}),Object(a.jsx)(Z.a,{children:Object(a.jsx)(te.a,{children:"Play/pause"})})]}),Object(a.jsxs)(ee.a,{children:[Object(a.jsx)(Z.a,{children:Object(a.jsx)(te.a,{children:"Ctrl+Shift+A"})}),Object(a.jsx)(Z.a,{children:Object(a.jsx)(te.a,{children:"Copy current subtitle"})})]}),Object(a.jsxs)(ee.a,{children:[Object(a.jsx)(Z.a,{children:Object(a.jsx)(te.a,{children:"Ctrl+Shift+Z"})}),Object(a.jsx)(Z.a,{children:Object(a.jsx)(te.a,{children:"Copy current subtitle (streaming video in another tab)"})})]})]})})}),Object(a.jsx)("br",{}),Object(a.jsx)(te.a,{variant:"h6",children:"Demos"}),Object(a.jsxs)(te.a,{component:"ul",children:[Object(a.jsx)("li",{children:Object(a.jsx)(X.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://www.youtube.com/watch?v=7v0Hly_Q_Bs",children:"Sentence mining video files"})}),Object(a.jsx)("li",{children:Object(a.jsx)(X.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://www.youtube.com/watch?v=m55HbFJMilk",children:"Sentence mining streaming video"})})]}),Object(a.jsx)("br",{}),Object(a.jsx)(te.a,{variant:"h6",children:"Guides"}),Object(a.jsx)(te.a,{component:"ul",children:Object(a.jsx)("li",{children:Object(a.jsx)(X.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://learnjapanese.moe/streamworkflow/",children:"Sentence mining streaming workflow"})})})]}),Object(a.jsx)(U.a,{children:Object(a.jsx)(I.a,{onClick:function(){return c()},children:"OK"})})]})}var ie=n(316),oe=n(317);function se(e){var t,n=e.open,c=e.image,i=e.onClose,o=Object(r.useState)(),s=Object(j.a)(o,2),u=s[0],l=s[1],f=Object(r.useState)(),h=Object(j.a)(f,2),p=h[0],O=h[1],v=Object(r.useState)(),m=Object(j.a)(v,2),k=m[0],x=m[1],y=g(!0),w=Object(j.a)(y,2),C=w[0],S=w[1],T=function(e,t){return Object(E.a)((function(n){return{image:{width:e,height:t,backgroundSize:"contain"}}}))}(p*(t=p>0&&k>0?Math.min(1,Math.min(C/(2*p),S/(2*k))):1),k*t);return Object(r.useEffect)((function(){function e(){return(e=Object(b.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.dataUrl();case 2:t=e.sent,(n=new Image).onload=function(){O(n.width),x(n.height),l(t)},n.src=t;case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}c&&function(){e.apply(this,arguments)}()}),[c]),Object(r.useEffect)((function(){n||(O(0),x(0),l(null))}),[n]),c?Object(a.jsx)(R.a,{open:n,onBackdropClick:function(){return i()},maxWidth:"lg",children:Object(a.jsx)(ie.a,{children:Object(a.jsx)(oe.a,{className:T.image,image:u,title:c.name,style:{width:p*t,height:k*t}})})}):null}var ue=n(150),le=n(330),de=n(114),be=function(){function e(){Object(S.a)(this,e)}return Object(T.a)(e,[{key:"subtitles",value:function(){var e=Object(b.a)(d.a.mark((function e(t){var n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.name.endsWith(".srt")){e.next=7;break}return e.t0=ue.a,e.next=4,t.text();case 4:return e.t1=e.sent,n=(0,e.t0)(e.t1),e.abrupt("return",n.map((function(e){return e.data})).sort((function(e,t){return e.start-t.start})));case 7:if(!t.name.endsWith(".vtt")){e.next=9;break}return e.abrupt("return",new Promise(function(){var e=Object(b.a)(d.a.mark((function e(n,a){var r,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new de.WebVTT.Parser(window,de.WebVTT.StringDecoder()),c=[],r.oncue=function(e){return c.push(e)},r.onflush=function(){return n(c.map((function(e){return{start:Math.floor(1e3*e.startTime),end:Math.floor(1e3*e.endTime),text:e.text}})).sort((function(e,t){return e.start-t.start})))},e.t0=r,e.next=7,t.text();case 7:e.t1=e.sent,e.t0.parse.call(e.t0,e.t1),r.flush();case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 9:if(!t.name.endsWith(".ass")){e.next=16;break}return e.t2=le.a,e.next=13,t.text();case 13:return e.t3=e.sent,a=(0,e.t2)(e.t3),e.abrupt("return",a.events.dialogue.map((function(e){return{start:Math.round(1e3*e.Start),end:Math.round(1e3*e.End),text:e.Text.combined}})).sort((function(e,t){return e.start-t.start})));case 16:throw new Error("Unsupported subtitle file format");case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),fe=n(318),he=n(155),je=n.n(he),pe=n(298),Oe=n(157),ve=n.n(Oe),me=n(156),ge=n.n(me),ke=n(319),xe=n(336);function ye(e){var t,n=(t=e.drawerWidth,Object(m.a)((function(e){return{title:{flexGrow:1},appBar:{transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{width:"calc(100% - ".concat(t,"px)"),transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:t},copyHistoryButton:{transform:"scaleX(1)",width:48,padding:12,transition:e.transitions.create(["transform","padding","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},copyHistoryButtonShift:{transform:"scaleX(0)",width:0,padding:5,transition:e.transitions.create(["transform","padding","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},hide:{display:"none"}}})))();return Object(a.jsx)(fe.a,{position:"static",className:Object(k.a)(n.appBar,Object(p.a)({},n.appBarShift,e.drawerOpen)),children:Object(a.jsxs)(ke.a,{children:[Object(a.jsx)(te.a,{variant:"h6",className:n.title,children:e.title}),Object(a.jsx)(xe.a,{title:"Help",children:Object(a.jsx)(pe.a,{edge:"end",onClick:e.onOpenHelp,children:Object(a.jsx)(je.a,{})})}),Object(a.jsx)(xe.a,{title:"Settings",children:Object(a.jsx)(pe.a,{edge:"end",onClick:e.onOpenSettings,children:Object(a.jsx)(ge.a,{})})}),Object(a.jsx)(xe.a,{title:"Copy history",children:Object(a.jsx)(pe.a,{edge:"end",color:"inherit","aria-label":"menu",onClick:e.onOpenCopyHistory,className:Object(k.a)(n.copyHistoryButton,Object(p.a)({},n.copyHistoryButtonShift,e.drawerOpen)),children:Object(a.jsx)(ve.a,{})})})]})})}var we=function(){function e(){var t=this;Object(S.a)(this,e),this.onMessageCallbacks=[],this.tabs=[],this.versionPromise=new Promise((function(e,n){t.versionResolve=e})),window.addEventListener("message",(function(e){if(e.source===window&&"asbplayer-extension-to-player"===e.data.sender&&e.data.message){if("tabs"===e.data.message.command)return void(t.tabs=e.data.message.tabs);if("version"===e.data.message.command)return void t.versionResolve(e.data.message.version);var n,a=Object(O.a)(t.onMessageCallbacks);try{for(a.s();!(n=a.n()).done;){(0,n.value)({data:e.data.message,tabId:e.data.tabId})}}catch(r){a.e(r)}finally{a.f()}}}))}return Object(T.a)(e,[{key:"installedVersion",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.versionPromise;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(e,t){window.postMessage({sender:"asbplayer",message:e,tabId:t},"*")}},{key:"publishMessage",value:function(e){var t,n=Object(O.a)(this.tabs);try{for(n.s();!(t=n.n()).done;){var a=t.value;window.postMessage({sender:"asbplayer",message:e,tabId:a.id},"*")}}catch(r){n.e(r)}finally{n.f()}}},{key:"subscribe",value:function(e){this.onMessageCallbacks.push(e)}},{key:"unsubscribe",value:function(e){for(var t=this.onMessageCallbacks.length-1;t>=0;--t)if(e===this.onMessageCallbacks[t]){this.onMessageCallbacks.splice(t,1);break}}}]),e}(),Ce=n(323),Se=n(337),Te=n(160),Fe=n.n(Te),Ee=n(159),Ie=n.n(Ee),Me=n(307),Re=n(254),Ue=n(322),Ne=n(320),Ae=n(321),Pe=n(306),Le=n(158),Be=n.n(Le);function _e(e){var t=e.open,n=e.anchorEl,c=e.onClose,i=e.onSelect,o=e.onClipAudio,s=e.onDownloadImage,u=e.item,l=Object(r.useCallback)((function(){navigator.clipboard.writeText(u.text),c()}),[u,c]),d=Object(r.useCallback)((function(){i(u),c()}),[u,i,c]),b=Object(r.useCallback)((function(){o(u),c()}),[u,o,c]),f=Object(r.useCallback)((function(){s(u),c()}),[u,s,c]);return u?Object(a.jsx)(Pe.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:c,anchorOrigin:{vertical:"center",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"right"},children:Object(a.jsxs)(Me.a,{children:[Object(a.jsx)(Re.a,{button:!0,onClick:l,children:Object(a.jsx)(Ne.a,{primaryTypographyProps:{variant:"body2"},primary:"Copy"})}),Object(a.jsx)(Re.a,{button:!0,onClick:d,children:Object(a.jsx)(Ne.a,{primaryTypographyProps:{variant:"body2"},primary:"Jump To"})}),(u.videoFile||u.audioFile||u.audio)&&Object(a.jsx)(Re.a,{button:!0,onClick:b,children:Object(a.jsx)(Ne.a,{primaryTypographyProps:{variant:"body2"},primary:"Download Audio"})}),(u.videoFile||u.image)&&Object(a.jsx)(Re.a,{button:!0,onClick:f,children:Object(a.jsx)(Ne.a,{primaryTypographyProps:{variant:"body2"},primary:"Download Image"})})]})}):null}function De(e){var t,n=(t=e.drawerWidth,Object(m.a)((function(e){return{drawer:{width:t,flexShrink:0},drawerPaper:{width:t},drawerHeader:Object(f.a)(Object(f.a)({display:"flex",alignItems:"center",position:"static",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-start"}),listContainer:{position:"relative",height:"100%",overflowY:"auto",overflowX:"hidden"},listItem:{"&:hover":{backgroundColor:e.palette.action.hover}},listItemGutters:{paddingLeft:5,paddingRight:5},listItemIconRoot:{minWidth:20}}})))(),i=Object(r.useCallback)((function(e){e&&e.scrollIntoView()}),[]),o=Object(r.useState)(),s=Object(j.a)(o,2),u=s[0],l=s[1],d=Object(r.useState)(!1),b=Object(j.a)(d,2),h=b[0],p=b[1],v=Object(r.useState)(),g=Object(j.a)(v,2),k=g[0],x=g[1],y=Object(r.useCallback)((function(e,t){l(t),p(!0),x(e.currentTarget)}),[]),w=Object(r.useCallback)((function(e,t){l(null),p(!1),x(null)}),[]),C=Object(r.useCallback)((function(t){e.onDelete(t)}),[e]),S=null;if(e.items.length>0){S=[];var T,F=null,E=0,I=Object(O.a)(e.items);try{var M=function(){var t=T.value;null!==F&&F===t.name||(F=t.name,S.push(Object(a.jsx)(Ae.a,{disableSticky:!0,children:t.name},t.name)));var r=E===e.items.length-1?i:null;S.push(Object(a.jsxs)(Re.a,{ref:r,className:n.listItem,classes:{gutters:n.listItemGutters},children:[Object(a.jsx)(Ue.a,{classes:{root:n.listItemIconRoot},children:Object(a.jsx)(xe.a,{title:"Export to Anki",children:Object(a.jsx)(pe.a,{onClick:function(){return e.onAnki(t)},children:Object(a.jsx)(J.a,{fontSize:"small"})})})}),Object(a.jsx)(Ue.a,{classes:{root:n.listItemIconRoot},children:Object(a.jsx)(pe.a,{onClick:function(e){return y(e,t)},children:Object(a.jsx)(Be.a,{fontSize:"small"})})}),Object(a.jsx)(Ne.a,{children:t.text}),Object(a.jsx)(Ue.a,{classes:{root:n.listItemIconRoot},children:Object(a.jsx)(pe.a,{onClick:function(){return C(t)},children:Object(a.jsx)(Ie.a,{fontSize:"small"})})})]},t.timestamp)),++E};for(I.s();!(T=I.n()).done;)M()}catch(U){I.e(U)}finally{I.f()}}else S=Object(a.jsx)(Re.a,{children:"Copy history is empty."});var R=Object(a.jsx)(Me.a,{children:S});return Object(a.jsxs)(c.a.Fragment,{children:[Object(a.jsxs)(Se.a,{variant:"persistent",anchor:"right",open:e.open,className:n.drawer,classes:{paper:n.drawerPaper},children:[Object(a.jsx)("div",{className:n.drawerHeader,children:Object(a.jsx)(pe.a,{onClick:e.onClose,children:Object(a.jsx)(Fe.a,{})})}),Object(a.jsx)(Ce.a,{}),Object(a.jsx)("div",{className:n.listContainer,children:R})]}),Object(a.jsx)(_e,{open:e.open&&h,anchorEl:k,item:u,onClose:w,onSelect:e.onSelect,onClipAudio:e.onClipAudio,onDownloadImage:e.onDownloadImage})]})}var ze=function(){function e(t,n,a){Object(S.a)(this,e),this.name=t,this._base64=n,this.extension=a}return Object(T.a)(e,[{key:"base64",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._base64);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_blob",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cachedBlob){e.next=6;break}return e.next=3,fetch(this._dataUrl());case 3:return e.next=5,e.sent.blob();case 5:this.cachedBlob=e.sent;case 6:return e.abrupt("return",this.cachedBlob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._dataUrl());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_dataUrl",value:function(){return"data:image/"+this.extension+";base64,"+this._base64}}]),e}(),We=function(){function e(t,n){Object(S.a)(this,e),this.file=t,this.name=t.name+"_"+n+".jpeg",this.timestamp=n}return Object(T.a)(e,[{key:"base64",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(b.a)(d.a.mark((function e(n,a){var r,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._canvas();case 2:r=e.sent,c=r.toDataURL("image/jpeg"),n(c.substr(c.indexOf(",")+1));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(b.a)(d.a.mark((function e(n,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._canvas();case 2:e.sent.toBlob((function(e){t._blob=e,n(e)}),"image/jpeg");case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canvas();case 2:return t=e.sent,e.abrupt("return",t.toDataURL());case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_canvas",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var a=t._videoElement(t.file);a.oncanplay=function(){var t=Object(b.a)(d.a.mark((function t(n){var r;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(r=document.createElement("canvas")).width=a.videoWidth,r.height=a.videoHeight,r.getContext("2d").drawImage(a,0,0,r.width,r.height),e(r),URL.revokeObjectURL(a.src);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_videoElement",value:function(e){var t=document.createElement("video");return t.src=URL.createObjectURL(e),t.preload="none",t.currentTime=this.timestamp/1e3,t.load(),t}}]),e}(),He=function(){function e(t){Object(S.a)(this,e),this.data=t}return Object(T.a)(e,[{key:"base64",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.base64();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.dataUrl();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t,n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:t=e.sent,n=window.URL.createObjectURL(t),a=document.createElement("a"),document.body.appendChild(a),a.style="display: none",a.href=n,a.download=this.data.name,a.click(),URL.revokeObjectURL(n),a.remove();case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"name",get:function(){return this.data.name}}],[{key:"fromBase64",value:function(t,n,a,r){var c=t.name.substring(0,t.name.lastIndexOf("."))+"_"+n+"."+r;return new e(new ze(c,a,r))}},{key:"fromFile",value:function(t,n){return new e(new We(t,n))}}]),e}(),Ve=n(176),Xe=n.p+"static/media/background.aa598bb3.png",Ge=n.p+"static/media/background-colored.8c5dbfe0.png",Ke=Object(E.a)((function(e){return{background:{position:"absolute",height:"calc(100vh - 64px)",width:"100%",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center",backgroundSize:"500px 500px",backgroundRepeat:"no-repeat",backgroundPosition:"center"},defaultBackground:{backgroundImage:"url(".concat(Xe,")")},coloredBackground:{backgroundImage:"url(".concat(Ge,")")}}}));function qe(e){var t=Ke(),n=e.extension,i=e.latestExtensionVersion,o=e.extensionUrl,s=e.loading,u=Object(r.useState)(),l=Object(j.a)(u,2),f=l[0],h=l[1];Object(r.useEffect)((function(){function e(){return(e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=h,e.next=3,n.installedVersion();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[n]);var p=i>f,O=!f;return Object(a.jsxs)(c.a.Fragment,{children:[Object(a.jsx)("div",{className:"".concat(t.background," ").concat(t.defaultBackground),children:Object(a.jsx)(Ve.a,{in:!s,timeout:500,children:Object(a.jsxs)(te.a,{children:["Drag and drop srt, ass, vtt, mp3, m4a, and mkv files. ",Object(a.jsx)("br",{}),O&&Object(a.jsxs)("span",{children:["Install the ",Object(a.jsx)(X.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:o,children:"extension"})," to sync subtitles with videos in other tabs."]}),p&&Object(a.jsxs)("span",{children:["An extension ",Object(a.jsx)(X.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:o,children:"update"})," is available."]})]})})}),Object(a.jsx)(Ve.a,{in:s,timeout:5e3,children:Object(a.jsx)("div",{className:"".concat(t.background," ").concat(t.coloredBackground)})})]})}var Je=function(){function e(t){Object(S.a)(this,e),this.channel=new BroadcastChannel(t);var n=this;this.channel.onmessage=function(e){var t;null===(t=n.onMessage)||void 0===t||t.call(n,e)}}return Object(T.a)(e,[{key:"postMessage",value:function(e){this.channel.postMessage(e)}},{key:"close",value:function(){this.channel.close()}}]),e}(),Ye=function(){function e(t,n){var a=this;Object(S.a)(this,e),this.tabId=t,this.listener=function(e){var n;e.tabId===t&&(null===(n=a.onMessage)||void 0===n||n.call(a,{data:e.data}))},n.subscribe(this.listener),this.extension=n}return Object(T.a)(e,[{key:"postMessage",value:function(e){this.extension.sendMessage(e,this.tabId)}},{key:"close",value:function(){this.extension.unsubscribe(this.listener)}}]),e}(),$e=function(){function e(){Object(S.a)(this,e),this.accumulated=0,this.started=!1}return Object(T.a)(e,[{key:"time",value:function(e){return this.started?Math.min(e,this.accumulated+Date.now()-this.startTime):Math.min(e,this.accumulated)}},{key:"stop",value:function(){this.started&&(this.started=!1,this.accumulated+=Date.now()-this.startTime)}},{key:"start",value:function(){this.startTime=Date.now(),this.started=!0}},{key:"setTime",value:function(e){this.started?(this.startTime=Date.now(),this.accumulated=e):this.accumulated=e}},{key:"progress",value:function(e){return 0===e?0:Math.min(1,this.time(e)/e)}}]),e}(),Qe=n(7),Ze=n(167),et=n.n(Ze),tt=n(161),nt=n.n(tt),at=n(324),rt=n(303),ct=n(169),it=n.n(ct),ot=n(171),st=n.n(ot),ut=n(170),lt=n.n(ut),dt=n(162),bt=n.n(dt),ft=n(163),ht=n.n(ft),jt=n(168),pt=n.n(jt),Ot=n(338),vt=n(166),mt=n.n(vt),gt=n(164),kt=n.n(gt),xt=n(165),yt=n.n(xt),wt=Object(m.a)((function(e){return{container:{position:"absolute",left:"50%",width:"50%",bottom:0},buttonContainer:{flexDirection:"row"},timeDisplay:{color:e.palette.action.active,display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",cursor:"default",fontSize:20,marginLeft:10},offsetInput:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",fontSize:20,marginLeft:10,width:200,color:e.palette.text.secondary},volumeInputContainerShown:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:5},volumeInputContainerHidden:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:0},volumeInputHidden:{transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),width:0},volumeInputShown:{transition:e.transitions.create("width",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),width:100},volumeInputThumbHidden:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),opacity:0},volumeInputThumbShown:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),opacity:1},subContainer:{background:"linear-gradient(to bottom, rgba(0,0,0,0), rgba(0,0,0,0.7))",position:"relative",left:"-100%",width:"200%",zIndex:10,padding:10},button:{color:e.palette.action.active},inactiveButton:{color:e.palette.action.disabled},progress:{margin:5},closeButton:{position:"absolute",top:0,right:0}}})),Ct=Object(m.a)((function(e){return{container:{background:"rgba(30,30,30,0.7)",height:5,margin:"0 10px 5px 10px",cursor:"pointer"},fillContainer:{width:"100%"},fill:{background:"linear-gradient(to left, #e21e4a, #a92fff)",height:"100%"},handleContainer:{position:"relative",width:0,height:0},handle:{borderRadius:"50%",width:15,height:15,background:"white",position:"absolute",top:5,left:12,filter:"drop-shadow(3px 3px 3px rgba(0,0,0,0.3))"}}})),St=Object(Qe.a)((function(e){return{root:{color:e.palette.text.secondary,verticalAlign:"middle"},thumb:{backgroundColor:"white",color:e.palette.text.secondary,"&:focus":{boxShadow:"inherit"},"&:hover, &$active":{boxShadow:"0px 0px 0px 8px rgba(255, 255, 255, 0.1)"}},active:{color:e.palette.text.secondary}}}))(Ot.a);function Tt(e){var t=Math.floor(e/1e3),n=Math.floor(t/60),a=t%60;return String(n)+":"+String(a).padStart(2,"0")}function Ft(e){var t=e.getBoundingClientRect();return t.right-t.left}function Et(e){var t=Ct(),n=Object(r.useRef)(null);var c={width:e.value+"%"},i={marginLeft:n.current?Ft(n.current)*e.value/100:0};return Object(a.jsxs)("div",{ref:n,onClick:function(t){var n=t.currentTarget.getBoundingClientRect(),a=n.right-n.left,r=Math.min(1,Math.max(0,(t.pageX-n.left)/a));e.onSeek(r)},className:t.container,children:[Object(a.jsx)("div",{className:t.fill,style:c}),Object(a.jsx)("div",{className:t.handleAnchor,children:Object(a.jsx)("div",{className:t.handle,style:i})})]})}function It(e){if(!e.audioTracks||0===e.audioTracks.length)return null;var t=e.audioTracks.map((function(t){return Object(a.jsxs)(Re.a,{selected:t.id===e.selectedAudioTrack,button:!0,onClick:function(){return e.onAudioTrackSelected(t.id)},children:[t.language," ",t.label]},t.id)}));return Object(a.jsx)("div",{children:Object(a.jsx)(Pe.a,{disableEnforceFocus:!0,open:e.open,anchorEl:e.anchorEl,onClose:e.onClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(a.jsx)(Me.a,{children:t})})})}function Mt(e){if(!e.tabs||0===e.tabs.length)return null;var t=e.tabs.map((function(t){return Object(a.jsxs)(Re.a,{selected:t.id===e.selectedTab,button:!0,onClick:function(){return e.onTabSelected(t.id)},children:[t.id," ",t.title," ",t.src]},t.id)}));return Object(a.jsx)("div",{children:Object(a.jsx)(Pe.a,{disableEnforceFocus:!0,open:e.open,anchorEl:e.anchorEl,onClose:e.onClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(a.jsx)(Me.a,{children:t})})})}function Rt(e){return Object(a.jsx)("div",{children:Object(a.jsx)(Pe.a,{disableEnforceFocus:!0,open:e.open,anchorEl:e.anchorEl,onClose:e.onClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(a.jsx)(Me.a,{children:Object(a.jsxs)(Re.a,{button:!0,onClick:function(t){return e.onUnload()},children:["Unload ",e.file]})})})})}function Ut(e){var t=wt(),n=e.playing,i=e.length,o=e.offsetEnabled,s=e.displayLength,u=e.offset,l=e.onAudioTrackSelected,d=e.onSeek,b=e.mousePositionRef,f=e.onPause,h=e.onPlay,p=e.onTabSelected,O=e.onUnloadAudio,v=e.onUnloadVideo,m=e.onOffsetChange,g=e.onVolumeChange,k=e.disableKeyEvents,x=e.settingsProvider,y=Object(r.useState)(!0),w=Object(j.a)(y,2),C=w[0],S=w[1],T=Object(r.useState)(!1),F=Object(j.a)(T,2),E=F[0],I=F[1],M=Object(r.useState)(),R=Object(j.a)(M,2),U=R[0],N=R[1],A=Object(r.useState)(!1),P=Object(j.a)(A,2),L=P[0],B=P[1],_=Object(r.useState)(),D=Object(j.a)(_,2),z=D[0],W=D[1],H=Object(r.useState)(!1),V=Object(j.a)(H,2),X=V[0],G=V[1],q=Object(r.useState)(),J=Object(j.a)(q,2),Y=J[0],$=J[1],Q=Object(r.useState)(!1),Z=Object(j.a)(Q,2),ee=Z[0],te=Z[1],ne=Object(r.useState)(),re=Object(j.a)(ne,2),ce=re[0],ie=re[1],oe=Object(r.useState)(!1),se=Object(j.a)(oe,2),ue=se[0],le=se[1],de=Object(r.useState)(100),be=Object(j.a)(de,2),fe=be[0],he=be[1],je=Object(r.useState)(100),Oe=Object(j.a)(je,2),ve=Oe[0],me=Oe[1],ge=Object(r.useRef)({x:0,y:0}),ke=Object(r.useRef)(Date.now()),ye=Object(r.useRef)(!0),we=Object(r.useRef)(!1),Ce=Object(r.useRef)(),Se=Object(r.useState)(),Te=Object(j.a)(Se,2)[1],Fe=Object(r.useCallback)((function(){return Te({})}),[]),Ee=Object(r.useCallback)((function(e){d(e)}),[d]);Object(r.useEffect)((function(){var e=Number(x.volume);he(e),g(e/100),e>0&&me(e)}),[x,g]),Object(r.useEffect)((function(){var e=setInterval((function(){var e=Date.now()-ke.current<2e3||Math.pow(b.current.x-ge.current.x,2)+Math.pow(b.current.y-ge.current.y,2)>100||we.current||Ce.current===document.activeElement;e&&!ye.current?(ke.current=Date.now(),S(e)):!e&&ye.current&&S(e),ye.current=e,ge.current.x=b.current.x,ge.current.y=b.current.y}),100);return function(){return clearInterval(e)}}),[b,S,C]),Object(r.useEffect)((function(){if(!k)return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)};function e(e){if(32===e.keyCode)e.preventDefault(),n?f():h();else if(13===e.keyCode&&Ce.current===document.activeElement){var t=Number(Ce.current.value);if(Number.isNaN(t))return;m(1e3*t),Ce.current.blur()}}}),[n,f,h,m,k]);var Ie=Object(r.useCallback)((function(e){var t;return e.target.setSelectionRange(0,(null===(t=e.target.value)||void 0===t?void 0:t.length)||0)}),[]);Object(r.useEffect)((function(){var e=setInterval((function(){Fe()}),100);return function(){return clearInterval(e)}}),[Fe]),Object(r.useEffect)((function(){if(Ce.current)if(0===u)Ce.current.value=null;else{var e=u/1e3,t=e>=0?"+"+e.toFixed(2):String(e.toFixed(2));Ce.current.value=t}}),[u]);var Me=Object(r.useCallback)((function(){N(null),I(!1)}),[]),Re=Object(r.useCallback)((function(e){N(e.currentTarget),I(!0)}),[]),Ue=Object(r.useCallback)((function(e){l(e),N(null),I(!1)}),[l]),Ne=Object(r.useCallback)((function(){W(null),B(!1)}),[]),Ae=Object(r.useCallback)((function(e){W(e.currentTarget),B(!0)}),[]),Pe=Object(r.useCallback)((function(e){p(e),W(null),B(!1)}),[p]),Le=Object(r.useCallback)((function(){$(null),G(!1)}),[]),Be=Object(r.useCallback)((function(e){$(e.currentTarget),G(!0)}),[]),_e=Object(r.useCallback)((function(){O(),G(!1)}),[O]),De=Object(r.useCallback)((function(e){ie(null),te(!1)}),[]),ze=Object(r.useCallback)((function(e){ie(e.currentTarget),te(!0)}),[]),We=Object(r.useCallback)((function(){v(),te(!1)}),[v]),He=Object(r.useCallback)((function(){return le(!1)}),[]),Xe=Object(r.useCallback)((function(){return le(!0)}),[]),Ge=Object(r.useCallback)((function(e,t){he(t),g(t/100)}),[g]),Ke=Object(r.useCallback)((function(e,t){t>0&&me(t),x.volume=t}),[x]),qe=Object(r.useCallback)((function(e,t){he((function(e){var t=e>0?0:ve;return g(t/100),t}))}),[g,ve]),Je=e.clock.progress(i);return Object(a.jsxs)(c.a.Fragment,{children:[e.closeEnabled&&Object(a.jsx)(Ve.a,{in:C,timeout:200,children:Object(a.jsx)(pe.a,{className:t.closeButton,onClick:function(){return e.onClose()},children:Object(a.jsx)(nt.a,{})})}),Object(a.jsxs)("div",{className:t.container,onMouseOver:function(e){we.current=!0},onMouseOut:function(e){we.current=!1},children:[Object(a.jsx)(Ve.a,{in:C,timeout:200,children:Object(a.jsxs)("div",{className:t.subContainer,children:[Object(a.jsx)(Et,{onSeek:Ee,value:100*Je}),Object(a.jsxs)(at.a,{container:!0,direction:"row",children:[Object(a.jsx)(at.a,{item:!0,children:Object(a.jsx)(pe.a,{onClick:function(){return n?f():h()},children:n?Object(a.jsx)(bt.a,{className:t.button}):Object(a.jsx)(ht.a,{className:t.button})})}),e.volumeEnabled&&Object(a.jsxs)(at.a,{item:!0,onMouseOver:Xe,onMouseOut:He,className:ue?t.volumeInputContainerShown:t.volumeInputContainerHidden,children:[Object(a.jsx)(pe.a,{onClick:qe,children:0===fe?Object(a.jsx)(kt.a,{}):Object(a.jsx)(yt.a,{})}),Object(a.jsx)(St,{onChange:Ge,onChangeCommitted:Ke,value:fe,defaultValue:100,classes:{root:ue?t.volumeInputShown:t.volumeInputHidden,thumb:ue?t.volumeInputThumbShown:t.volumeInputThumbHidden}})]}),Object(a.jsx)(at.a,{item:!0,children:Object(a.jsxs)("div",{className:t.timeDisplay,children:[Tt(Je*i)," / ",Tt(s||i)]})}),o&&Object(a.jsx)(at.a,{item:!0,children:Object(a.jsx)(rt.a,{inputRef:Ce,disableUnderline:!0,className:t.offsetInput,placeholder:"\xb1"+Number(0).toFixed(2)+" subtitle offset",onClick:Ie})}),Object(a.jsx)(at.a,{style:{flexGrow:1},item:!0}),e.condensedModeToggleEnabled&&Object(a.jsx)(at.a,{item:!0,children:Object(a.jsx)(xe.a,{title:"Condensed Mode",children:Object(a.jsx)(pe.a,{onClick:function(t){return e.onCondensedModeToggle()},children:Object(a.jsx)(K.a,{className:e.condensedModeEnabled?t.button:t.inactiveButton})})})}),e.subtitlesToggle&&Object(a.jsx)(at.a,{item:!0,children:Object(a.jsx)(pe.a,{onClick:function(t){return e.onSubtitlesToggle()},children:Object(a.jsx)(mt.a,{className:e.subtitlesEnabled?t.button:t.inactiveButton})})}),e.videoFile&&Object(a.jsx)(at.a,{item:!0,children:Object(a.jsx)(pe.a,{onClick:ze,children:Object(a.jsx)(ae.a,{className:t.button})})}),e.audioFile&&Object(a.jsx)(at.a,{item:!0,children:Object(a.jsx)(pe.a,{onClick:Be,children:Object(a.jsx)(et.a,{className:t.button})})}),e.audioTracks&&e.audioTracks.length>1&&Object(a.jsx)(at.a,{item:!0,children:Object(a.jsx)(pe.a,{onClick:Re,children:Object(a.jsx)(pt.a,{className:t.button})})}),e.tabs&&e.tabs.length>0&&Object(a.jsx)(at.a,{item:!0,children:Object(a.jsx)(pe.a,{onClick:Ae,children:Object(a.jsx)(ae.a,{className:e.selectedTab?t.button:t.inactiveButton})})}),e.popOutEnabled&&Object(a.jsx)(at.a,{item:!0,children:Object(a.jsx)(pe.a,{onClick:function(){return e.onPopOutToggle()},children:Object(a.jsx)(it.a,{style:e.popOut?{transform:"rotateX(180deg)"}:{}})})}),e.fullscreenEnabled&&Object(a.jsx)(at.a,{item:!0,children:Object(a.jsx)(pe.a,{onClick:function(){return e.onFullscreenToggle()},children:e.fullscreen?Object(a.jsx)(lt.a,{}):Object(a.jsx)(st.a,{})})})]})]})}),Object(a.jsx)(Mt,{open:L&&C,anchorEl:z,tabs:e.tabs,selectedTab:e.selectedTab,onClose:Ne,onTabSelected:Pe}),Object(a.jsx)(It,{open:E&&C,anchorEl:U,audioTracks:e.audioTracks,selectedAudioTrack:e.selectedAudioTrack,onClose:Me,onAudioTrackSelected:Ue}),Object(a.jsx)(Rt,{open:X,anchorEl:Y,file:e.audioFile,onClose:Le,onUnload:_e}),Object(a.jsx)(Rt,{open:ee,anchorEl:ce,file:e.videoFile,onClose:De,onUnload:We})]})]})}var Nt=function(){function e(t){Object(S.a)(this,e),this.ref=t,this.readyResolves=[]}return Object(T.a)(e,[{key:"seek",value:function(){var e=Object(b.a)(d.a.mark((function e(t){var n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){n.ref.current?(n.ref.current.currentTime=t,n._onMediaCanPlay((function(){return e()}))):e()})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onReady",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.ref.current?t._onMediaCanPlay((function(){return e()})):e()})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_onMediaCanPlay",value:function(e){var t=this;4!==this.ref.readyState?(this.ref.current&&!this.ref.current.oncanplay&&(this.ref.current.oncanplay=function(e){var n,a=Object(O.a)(t.readyResolves);try{for(a.s();!(n=a.n()).done;){(0,n.value)()}}catch(r){a.e(r)}finally{a.f()}t.readyResolves.length=0,t.ref.current.oncanplay=null}),this.readyResolves.push(e)):e()}},{key:"play",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.play()}},{key:"pause",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.pause()}}]),e}();function At(e){return e.ctrlKey&&e.shiftKey&&65===e.keyCode}var Pt=n(172),Lt=n.n(Pt),Bt=n(99);function _t(e){var t=e.clock,n=e.onSeek,c=e.onCopy,i=e.playing,o=e.subtitles,s=e.length,u=e.jumpToSubtitle,l=e.compressed,d=e.loading,b=e.displayHelp,f=e.disableKeyEvents,p=Object(r.useRef)();p.current=t;var v=Object(r.useRef)();v.current=o;var k=Object(r.useMemo)((function(){return o?Array(o.length).fill().map((function(e,t){return Object(r.createRef)()})):[]}),[o]),x=Object(r.useRef)();x.current=k;var y=Object(r.useState)({}),w=Object(j.a)(y,2),C=w[0],S=w[1],T=Object(r.useRef)({}),F=Object(r.useRef)();F.current=e.length;var E=Object(r.useRef)(0),I=Object(r.useRef)(),M=Object(r.useRef)();Object(r.useRef)().current=e.drawerOpen;var R=g(!0),U=Object(j.a)(R,1)[0],N=function(e,t){return Object(m.a)((function(n){return{container:{height:"calc(100vh - 64px)",position:"relative",overflowX:"hidden",backgroundColor:n.palette.background.default,width:e?Math.max(350,.25*t):"100%"},table:{backgroundColor:n.palette.background.default,marginBottom:75},noSubtitles:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center"},subtitleRow:{"&:hover":{backgroundColor:n.palette.action.hover}},subtitle:{fontSize:20,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere"},compressedSubtitle:{fontSize:16,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere"},timestamp:{fontSize:14,color:"#aaaaaa",textAlign:"right",paddingRight:15,paddingLeft:5},copyButton:{textAlign:"right",padding:0}}}))}(l,U)();Object(r.useEffect)((function(){return I.current=requestAnimationFrame((function e(t){for(var n=v.current||[],a=x.current,r=F.current,c=p.current.progress(F.current),i=Number.MAX_SAFE_INTEGER,o=-1,s={},u=n.length-1;u>=0;--u){var l=n[u],d=l.start/r,b=l.end/r;if(c>=d)c<b&&(i=u<i?u:i,s[u]=!0),-1===o&&(o=u);else if(i!==Number.MAX_SAFE_INTEGER)break}if(i===Number.MAX_SAFE_INTEGER&&-1!==o&&(s[o]=!0),!function(e,t){for(var n in e)if(!(n in t))return!1;for(var a in t)if(!(a in e))return!1;return!0}(s,T.current)&&(T.current=s,S(s),i!==Number.MAX_SAFE_INTEGER)){var f=a[i],h=Date.now()-E.current>5e3;(null===f||void 0===f?void 0:f.current)&&h&&f.current.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}I.current=requestAnimationFrame(e)})),function(){return cancelAnimationFrame(I.current)}}),[]),Object(r.useEffect)((function(){function e(e){if(!f&&o&&0!==o.length){var t;if(37===e.keyCode){var a=Object.keys(C);t=a.length>0?Math.max(0,Math.min.apply(Math,Object(h.a)(a))-1):-1}else{if(39!==e.keyCode)return;var r=Object.keys(C);t=r.length>0?Math.min(o.length-1,Math.max.apply(Math,Object(h.a)(r))+1):-1}if(-1!==t){e.preventDefault();var c=o[t].start/s;n(c,!1)}}}return window.addEventListener("keydown",e),function(){return window.removeEventListener("keydown",e)}}),[n,C,o,s,f]),Object(r.useEffect)((function(){function e(e){E.current=Date.now()}var t=M.current;return null===t||void 0===t||t.addEventListener("wheel",e),function(){return null===t||void 0===t?void 0:t.removeEventListener("wheel",e)}}),[M,E]),Object(r.useEffect)((function(){if(u&&o){var e,t=-1,n=0,a=Object(O.a)(o);try{for(a.s();!(e=a.n()).done;){var r=e.value;if(r.originalStart===u.originalStart&&r.text===u.text){t=n;break}++n}}catch(c){a.e(c)}finally{a.f()}-1!==t&&k[t].current.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}),[u,o,k]);var A,P=Object(r.useCallback)((function(e){var t=o[e].start/s;n(t,!i&&e in C)}),[o,s,i,n,C]),L=Object(r.useCallback)((function(e,t){e.stopPropagation();var n=o[t],a=n.text;navigator.clipboard.writeText(a),c(n)}),[o,c]);return Object(r.useEffect)((function(){function e(e){var t=Object.keys(T.current);if(0!==t.length&&At(e)){var n=Math.min.apply(Math,Object(h.a)(t));L(e,n)}}return window.addEventListener("keydown",e),function(){return window.removeEventListener("keydown",e)}}),[L]),A=o&&0!==o.length?Object(a.jsx)(Q.a,{className:N.table,children:Object(a.jsx)(Y.a,{children:Object(a.jsx)($.a,{children:o.map((function(e,t){var n=t in C,r=l?N.compressedSubtitle:N.subtitle;return e.start<0&&e.end<0?null:Object(a.jsxs)(ee.a,{onClick:function(e){return P(t)},ref:k[t],selected:n,className:N.subtitleRow,children:[Object(a.jsx)(Z.a,{className:r,children:e.text}),Object(a.jsx)(Z.a,{className:N.copyButton,children:Object(a.jsx)(pe.a,{onClick:function(e){return L(e,t)},children:Object(a.jsx)(Lt.a,{fontSize:l?"small":"default"})})}),Object(a.jsx)(Z.a,{className:N.timestamp,children:e.displayTime})]},t)}))})})}):!d&&b&&Object(a.jsx)("div",{className:N.noSubtitles,children:Object(a.jsx)(te.a,{children:"No subtitles loaded. Drag and drop to load."})}),Object(a.jsx)(Bt.a,{square:!0,elevation:0,ref:M,className:N.container,children:A})}var Dt=function(){function e(t){Object(S.a)(this,e),this.protocol=t,this.time=0,this.duration=0,this.isReady=!1,this.readyState=0,this.selectedAudioTrack=null,this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[],this.condensedModeToggleCallbacks=[];var n=this;this.protocol.onMessage=function(e){switch(e.data.command){case"ready":n.duration=e.data.duration,n.isReady=!0,n.audioTracks=e.data.audioTracks,n.selectedAudioTrack=e.data.selectedAudioTrack,n.readyState=4,n.time=e.data.currentTime;var t,a=Object(O.a)(n.readyCallbacks);try{for(a.s();!(t=a.n()).done;){(0,t.value)(e.data.paused)}}catch(C){a.e(C)}finally{a.f()}break;case"readyState":var r;if(n.readyState=e.data.value,4===n.readyState)null===(r=n.oncanplay)||void 0===r||r.call(n);break;case"play":var c,i=Object(O.a)(n.playCallbacks);try{for(i.s();!(c=i.n()).done;){(0,c.value)(e.data.echo)}}catch(C){i.e(C)}finally{i.f()}break;case"pause":var o,s=Object(O.a)(n.pauseCallbacks);try{for(s.s();!(o=s.n()).done;){(0,o.value)(e.data.echo)}}catch(C){s.e(C)}finally{s.f()}break;case"audioTrackSelected":var u,l=Object(O.a)(n.audioTrackSelectedCallbacks);try{for(l.s();!(u=l.n()).done;){var d=u.value;n.selectedAudioTrack=e.data.id,d(e.data.id)}}catch(C){l.e(C)}finally{l.f()}break;case"currentTime":var b,f=Object(O.a)(n.currentTimeCallbacks);try{for(f.s();!(b=f.n()).done;){(0,b.value)(e.data.value,e.data.echo)}}catch(C){f.e(C)}finally{f.f()}break;case"exit":var h,j=Object(O.a)(n.exitCallbacks);try{for(j.s();!(h=j.n()).done;){(0,h.value)()}}catch(C){j.e(C)}finally{j.f()}break;case"offset":var p,v=Object(O.a)(n.offsetCallbacks);try{for(v.s();!(p=v.n()).done;){(0,p.value)(e.data.value)}}catch(C){v.e(C)}finally{v.f()}break;case"popOutToggle":var m,g=Object(O.a)(n.popOutToggleCallbacks);try{for(g.s();!(m=g.n()).done;){(0,m.value)()}}catch(C){g.e(C)}finally{g.f()}break;case"copy":var k,x=Object(O.a)(n.copyCallbacks);try{for(x.s();!(k=x.n()).done;){(0,k.value)(e.data.subtitle,e.data.audio,e.data.image)}}catch(C){x.e(C)}finally{x.f()}break;case"condensedModeToggle":var y,w=Object(O.a)(n.condensedModeToggleCallbacks);try{for(w.s();!(y=w.n()).done;){(0,y.value)()}}catch(C){w.e(C)}finally{w.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(T.a)(e,[{key:"onReady",value:function(e){this.isReady&&e(),this.readyCallbacks.push(e)}},{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onExit",value:function(e){this.exitCallbacks.push(e)}},{key:"onOffset",value:function(e){this.offsetCallbacks.push(e)}},{key:"onPopOutToggle",value:function(e){this.popOutToggleCallbacks.push(e)}},{key:"onCopy",value:function(e){this.copyCallbacks.push(e)}},{key:"onCondensedModeToggle",value:function(e){this.condensedModeToggleCallbacks.push(e)}},{key:"ready",value:function(e){this.protocol.postMessage({command:"ready",duration:e})}},{key:"init",value:function(){this.protocol.postMessage({command:"init"})}},{key:"play",value:function(){this.protocol.postMessage({command:"play"})}},{key:"pause",value:function(){this.protocol.postMessage({command:"pause"})}},{key:"audioTrackSelected",value:function(e){this.protocol.postMessage({command:"audioTrackSelected",id:e})}},{key:"subtitles",value:function(e){this.protocol.postMessage({command:"subtitles",value:e})}},{key:"subtitleSettings",value:function(e){this.protocol.postMessage({command:"subtitleSettings",value:e})}},{key:"condensedModeToggle",value:function(e){this.protocol.postMessage({command:"condensedModeToggle",value:e})}},{key:"close",value:function(){this.protocol.postMessage({command:"close"}),this.protocol.close()}},{key:"currentTime",get:function(){return this.time},set:function(e){this.time=e,this.readyState=3,this.protocol.postMessage({command:"currentTime",value:this.time})}}]),e}(),zt=Object(m.a)({root:{maxHeight:"calc(100vh - 64px)",position:"relative",overflowX:"hidden"},videoFrame:{width:"100%",height:"100%",border:0}});function Wt(e,t){if(e<0)return Wt(0,t);var n=e%1e3,a=(e=(e-n)/1e3)%60,r=(e=(e-a)/60)%60;return t>=36e5?Ht((e-r)/60)+":"+Ht(r)+":"+Ht(a)+"."+Vt(n):Ht(r)+":"+Ht(a)+"."+Vt(n)}function Ht(e){return String(e).padStart(2,"0")}function Vt(e){return String(e).padEnd(3,"0")}function Xt(e,t,n,a){var r;r=n&&n.length>0?a?n[n.length-1].end:n[n.length-1].originalEnd:0;var c=e.current&&e.current.duration?1e3*e.current.duration:0,i=t.current&&t.current.duration?1e3*t.current.duration:0;return Math.max(i,Math.max(r,c))}function Gt(e){var t=e.subtitleReader,n=e.settingsProvider,c=e.extension,i=e.offsetRef,o=e.videoFrameRef,s=e.drawerOpen,u=e.onError,l=e.onUnloadVideo,f=e.onCopy,h=e.onLoaded,p=e.disableKeyEvents,O=e.sources,v=O.subtitleFile,m=O.audioFile,g=O.audioFileUrl,k=O.videoFile,x=O.videoFileUrl,y=Object(r.useState)(),w=Object(j.a)(y,2),C=w[0],S=w[1],T=Object(r.useState)(),F=Object(j.a)(T,2),E=F[0],I=F[1],M=Object(r.useRef)();M.current=E;var R=Object(r.useState)(!1),U=Object(j.a)(R,2),N=U[0],A=U[1],P=Object(r.useState)(!1),L=Object(j.a)(P,2),B=L[0],_=L[1],D=Object(r.useRef)();D.current=B;var z=Object(r.useState)(),W=Object(j.a)(z,2)[1],H=Object(r.useState)(),V=Object(j.a)(H,2),X=V[0],G=V[1],K=Object(r.useState)(),q=Object(j.a)(K,2),J=q[0],Y=q[1],$=Object(r.useState)(0),Q=Object(j.a)($,2),Z=Q[0],ee=Q[1],te=Object(r.useState)(),ne=Object(j.a)(te,2),ae=ne[0],re=ne[1],ce=Object(r.useState)(!1),ie=Object(j.a)(ce,2),oe=ie[0],se=ie[1],ue=Object(r.useState)(!1),le=Object(j.a)(ue,2),de=le[0],be=le[1],fe=Object(r.useRef)();fe.current=de;var he=Object(r.useCallback)((function(){return W({})}),[]),je=Object(r.useRef)({x:0,y:0}),pe=Object(r.useRef)(),Oe=Object(r.useRef)(),ve=Object(r.useMemo)((function(){return new Nt(g?pe:x||C?Oe:{})}),[g,x,C]),me=Object(r.useMemo)((function(){return new $e}),[]),ge=zt(),ke=Object(r.useState)([]),xe=Object(j.a)(ke,2),ye=xe[0],we=xe[1],Ce=Object(r.useRef)(0);Ce.current=Xt(pe,Oe,E,!0);var Se=Object(r.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(t,n,a){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t*Ce.current,n.setTime(r),he(),!a){e.next=6;break}return e.next=6,ve.seek(r/1e3);case 6:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),[he,ve]);function Te(e,t,n){_(!0),e.start(),n&&t.play()}function Fe(e,t,n){_(!1),e.stop(),n&&t.pause()}Object(r.useEffect)((function(){function e(){return(e=Object(b.a)(d.a.mark((function e(){var a,r,i,o,s,h,j;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(a=Oe.current)||void 0===a||a.close(),Oe.current=null,me.setTime(0),me.stop(),_(!1),G(null),Y(null),ee(0),be(!1),pe.current.currentTime=0,pe.current.pause(),!v){e.next=30;break}return A(!0),e.prev=13,e.next=16,t.subtitles(v);case 16:i=e.sent,o=i.length>0?i[i.length-1].end:0,r=i.map((function(e){return{text:e.text,start:e.start,originalStart:e.start,end:e.end,originalEnd:e.end,displayTime:Wt(e.start,o)}})),I(r),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(13),u(e.t0.message);case 25:return e.prev=25,A(!1),e.finish(25);case 28:e.next=31;break;case 30:r=null;case 31:if(!g){e.next=37;break}return e.next=34,ve.onReady();case 34:he(),e.next=38;break;case 37:(x||C)&&(x?(h=String(Date.now()),s=new Dt(new Je(h)),re(h)):C&&(s=new Dt(new Ye(C.id,c))).init(),Oe.current=s,j=!1,s.onReady((function(e){Ce.current=Xt(pe,Oe,M.current),s.ready(Ce.current),M.current&&(s.subtitleSettings(n.subtitleSettings),s.subtitles(M.current)),s.condensedModeToggle(fe.current),s.audioTracks&&s.audioTracks.length>1?(G(Oe.current.audioTracks),Y(Oe.current.selectedAudioTrack)):(G(null),Y(null)),me.setTime(1e3*Oe.current.currentTime),e?me.stop():me.start(),_(!e),j||(s.onPlay((function(e){return Te(me,ve,e)})),s.onPause((function(e){return Fe(me,ve,e)})),s.onExit((function(){return l(x)})),s.onOffset((function(e){var t;return ee(Math.max(null!==(t=-Ce.current)&&void 0!==t?t:0,e))})),s.onPopOutToggle((function(){return se((function(e){return!e}))})),s.onCopy((function(e,t,n){return f(e,m,k,v,s.selectedAudioTrack,t,n)})),s.onCondensedModeToggle((function(){return be((function(e){var t=!e;return s.condensedModeToggle(t),t}))})),s.onCurrentTime(function(){var e=Object(b.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=1e3*t/Ce.current,D.current&&me.stop(),e.next=4,Se(a,me,n);case 4:D.current&&me.start();case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),s.onAudioTrackSelected(function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D.current&&me.stop(),e.next=3,ve.onReady();case 3:D.current&&me.start(),Y(t);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),j=!0)})));case 38:case"end":return e.stop()}}),e,null,[[13,22,25,28]])})))).apply(this,arguments)}(function(){return e.apply(this,arguments)})().then((function(){return h()}))}),[t,c,n,me,ve,Se,h,u,l,f,v,m,g,k,x,C,he,o]),Object(r.useEffect)((function(){if(de&&E&&0!==E.length){var e=!1,t=1e3,n=setInterval(Object(b.a)(d.a.mark((function n(){var a,r,c,i,o,s,u,l,b,f;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=Ce.current){n.next=3;break}return n.abrupt("return");case 3:r=me.progress(a),c=0,i=-1,o=E.length-1;case 7:if(!(o>=0)){n.next=17;break}if(s=E[o],u=s.start/a,l=s.end/a,!(r>=u)){n.next=14;break}return r<l?(i=o,c=o):c=Math.min(E.length-1,o+1),n.abrupt("break",17);case 14:--o,n.next=7;break;case 17:if(i===c){n.next=30;break}if(!((b=E[c]).start-r*a<t+500)){n.next=21;break}return n.abrupt("return");case 21:if(D.current&&me.stop(),e){n.next=29;break}return e=!0,f=Date.now(),n.next=27,Se(b.start/a,me,!0);case 27:t=Date.now()-f,e=!1;case 29:D.current&&me.start();case 30:case"end":return n.stop()}}),n)}))),100);return function(){return clearInterval(n)}}}),[E,de,me,Se]),Object(r.useEffect)((function(){oe&&ae&&x&&window.open("/asbplayer/?video="+encodeURIComponent(x)+"&channel="+ae+"&popout=true","asbplayer-video-"+x,"resizable,width=800,height=450")}),[oe,ae,x,o]);var Ee=Object(r.useCallback)((function(){return Te(me,ve,!0)}),[me,ve]),Ie=Object(r.useCallback)((function(){return Fe(me,ve,!0)}),[me,ve]),Me=Object(r.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D.current&&me.stop(),e.next=3,Se(t,me,!0);case 3:D.current&&me.start();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[me,Se]),Re=Object(r.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n||Fe(me,ve,!0),D.current&&me.stop(),e.next=4,Se(t,me,!0);case 4:n&&!D.current&&Te(me,ve,!0);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[me,Se,ve]),Ue=Object(r.useCallback)((function(e,t){f(e,m,k,v,J)}),[f,m,k,v,J]);var Ne=Object(r.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Oe.current&&Oe.current.audioTrackSelected(t),Fe(me,ve,!0),e.next=4,Se(0,me,!0);case 4:D.current&&Te(me,ve,!0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[me,ve,Se]),Ae=Object(r.useCallback)((function(e){var t=ye.filter((function(t){return t.id===e}))[0];S(t)}),[ye]),Pe=Object(r.useCallback)((function(e){var t;ee(Math.max(null!==(t=-Ce.current)&&void 0!==t?t:0,e))}),[]);Object(r.useEffect)((function(){i&&(i.current=Z),I((function(e){var t;if(e){var n=e.length>0?e[e.length-1].end+Z:0,a=e.map((function(e){return{text:e.text,start:e.originalStart+Z,originalStart:e.originalStart,end:e.originalEnd+Z,originalEnd:e.originalEnd,displayTime:Wt(e.originalStart+Z,n)}}));return null===(t=Oe.current)||void 0===t||t.subtitles(a),a}}))}),[Z,i]);var Le=Object(r.useCallback)((function(e){pe.current&&(pe.current.volume=e)}),[]),Be=Object(r.useCallback)((function(){return be((function(e){return!e}))}),[]);Object(r.useEffect)((function(){var e=setInterval((function(){var e=Ce.current;me.progress(e)>=1&&(me.setTime(0),me.stop(),ve.pause(),_(!1))}),1e3);return function(){return clearInterval(e)}}),[me,E,ve]),Object(r.useEffect)((function(){var t=setInterval((function(){if(e.extension.tabs.length!==ye.length)we(e.extension.tabs);else{for(var t=!1,n=0;n<ye.length;++n){var a=ye[n],r=e.extension.tabs[n];if(a.id!==r.id||a.title!==r.title||a.src!==r.src){t=!0;break}}t&&we(e.extension.tabs)}C&&0===e.extension.tabs.filter((function(e){return e.id===C.id&&e.src===C.src})).length&&(S(null),e.onError("Lost connection with tab "+C.id+" "+C.title))}),1e3);return function(){return clearInterval(t)}}),[ye,C,e]),Object(r.useEffect)((function(){S(null)}),[m,k]);var _e=Ce.current,De=g||x||E,ze=De&&x&&ae&&!oe;return Object(a.jsxs)("div",{onMouseMove:function(e){je.current.x=e.screenX,je.current.y=e.screenY},className:ge.root,children:[Object(a.jsxs)(at.a,{container:!0,direction:"row",wrap:"nowrap",children:[ze&&Object(a.jsx)(at.a,{item:!0,style:{flexGrow:1,minWidth:600},children:Object(a.jsx)("iframe",{ref:o,className:ge.videoFrame,src:"/asbplayer/?video="+encodeURIComponent(x)+"&channel="+ae+"&popout=false",title:"asbplayer"})}),Object(a.jsxs)(at.a,{item:!0,style:{flexGrow:ze?0:1},children:[De&&!(x&&!oe)&&Object(a.jsx)(Ut,{mousePositionRef:je,playing:B,clock:me,length:_e,displayLength:Xt(pe,Oe,E,!1),audioTracks:X,selectedAudioTrack:J,tabs:!x&&!g&&ye,selectedTab:C&&C.id,audioFile:null===m||void 0===m?void 0:m.name,videoFile:null===k||void 0===k?void 0:k.name,offsetEnabled:!0,offset:Z,volumeEnabled:Boolean(g),condensedModeToggleEnabled:Boolean(g),condensedModeEnabled:de,onPlay:Ee,onPause:Ie,onSeek:Me,onAudioTrackSelected:Ne,onTabSelected:Ae,onUnloadAudio:function(){return e.onUnloadAudio(g)},onUnloadVideo:function(){return e.onUnloadVideo(x)},onOffsetChange:Pe,onVolumeChange:Le,onCondensedModeToggle:Be,disableKeyEvents:p,settingsProvider:n}),Object(a.jsx)(_t,{playing:B,subtitles:E,clock:me,length:_e,jumpToSubtitle:e.jumpToSubtitle,drawerOpen:s,compressed:x&&!oe,loading:N,displayHelp:Boolean(x||g),disableKeyEvents:p,onSeek:Re,onCopy:Ue})]})]}),Object(a.jsx)("audio",{ref:pe,src:g})]})}var Kt=n(327),qt=n(305),Jt=n(335),Yt=n(325),$t=n(332),Qt=n(326),Zt=n(331),en=Object(E.a)((function(e){return{root:{"& .MuiTextField-root":{marginTop:e.spacing(1),marginBottom:e.spacing(1)}},subtitleSetting:{"& .MuiTextField-root":{marginTop:e.spacing(1),marginBottom:e.spacing(1),width:320}}}})),tn=Object(E.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120}}}));function nn(e){var t=tn(),n=e.label,r=e.value,c=e.selections,i=e.onChange,o=e.onSelectionChange;return Object(a.jsxs)("div",{children:[Object(a.jsx)(M.a,{label:n,value:r,onChange:i}),Object(a.jsxs)(qt.a,{className:t.formControl,children:[Object(a.jsx)(Jt.a,{}),Object(a.jsx)($t.a,{value:r,disabled:!c,onChange:o,children:c&&c.map((function(e){return Object(a.jsx)(Yt.a,{value:e,children:e},e)}))})]})]})}function an(e){return Object(a.jsx)(at.a,{container:!0,spacing:0,direction:"row",alignItems:"center",justify:"center",children:Object(a.jsx)(at.a,{item:!0,children:e.children})})}function rn(e){var t=e.anki,n=e.open,c=e.settings,i=e.onClose,o=en(),s=Object(r.useState)(0),u=Object(j.a)(s,2),l=u[0],f=u[1],p=Object(r.useState)(c.ankiConnectUrl),O=Object(j.a)(p,2),v=O[0],m=O[1],g=Object(r.useState)(),k=Object(j.a)(g,2),x=k[0],y=k[1],w=Object(r.useState)(0),C=Object(j.a)(w,2),S=C[0],T=C[1],F=Object(r.useState)(c.deck||""),E=Object(j.a)(F,2),A=E[0],P=E[1],L=Object(r.useState)(),B=Object(j.a)(L,2),_=B[0],D=B[1],z=Object(r.useState)(c.noteType||""),W=Object(j.a)(z,2),H=W[0],V=W[1],X=Object(r.useState)(),G=Object(j.a)(X,2),K=G[0],q=G[1],J=Object(r.useState)(c.sentenceField||""),Y=Object(j.a)(J,2),$=Y[0],Q=Y[1],Z=Object(r.useState)(c.definitionField||""),ee=Object(j.a)(Z,2),te=ee[0],ne=ee[1],ae=Object(r.useState)(c.audioField||""),re=Object(j.a)(ae,2),ce=re[0],ie=re[1],oe=Object(r.useState)(c.imageField||""),se=Object(j.a)(oe,2),ue=se[0],le=se[1],de=Object(r.useState)(c.wordField||""),be=Object(j.a)(de,2),fe=be[0],he=be[1],je=Object(r.useState)(c.sourceField||""),pe=Object(j.a)(je,2),Oe=pe[0],ve=pe[1],me=Object(r.useState)(),ge=Object(j.a)(me,2),ke=ge[0],xe=ge[1],ye=Object(r.useState)(c.subtitleColor),we=Object(j.a)(ye,2),Ce=we[0],Se=we[1],Te=Object(r.useState)(c.subtitleSize),Fe=Object(j.a)(Te,2),Ee=Fe[0],Ie=Fe[1],Me=Object(r.useState)(c.subtitleOutlineColor),Re=Object(j.a)(Me,2),Ue=Re[0],Ne=Re[1],Ae=Object(r.useState)(c.subtitleOutlineThickness),Pe=Object(j.a)(Ae,2),Le=Pe[0],Be=Pe[1],_e=Object(r.useState)(c.subtitleBackgroundColor),De=Object(j.a)(_e,2),ze=De[0],We=De[1],He=Object(r.useState)(c.subtitleBackgroundOpacity),Ve=Object(j.a)(He,2),Xe=Ve[0],Ge=Ve[1],Ke=Object(r.useCallback)((function(e){m(e.target.value),T(Date.now())}),[]),qe=Object(r.useCallback)((function(e){return T(Date.now())}),[]),Je=Object(r.useCallback)((function(e){return P(e.target.value)}),[]),Ye=Object(r.useCallback)((function(e){return P(e.target.value)}),[]),$e=Object(r.useCallback)((function(e){return V(e.target.value)}),[]),Qe=Object(r.useCallback)((function(e){return V(e.target.value)}),[]),Ze=Object(r.useCallback)((function(e){return Q(e.target.value)}),[]),et=Object(r.useCallback)((function(e){return Q(e.target.value)}),[]),tt=Object(r.useCallback)((function(e){return ne(e.target.value)}),[]),nt=Object(r.useCallback)((function(e){return ne(e.target.value)}),[]),at=Object(r.useCallback)((function(e){return ie(e.target.value)}),[]),rt=Object(r.useCallback)((function(e){return ie(e.target.value)}),[]),ct=Object(r.useCallback)((function(e){return le(e.target.value)}),[]),it=Object(r.useCallback)((function(e){return le(e.target.value)}),[]),ot=Object(r.useCallback)((function(e){return he(e.target.value)}),[]),st=Object(r.useCallback)((function(e){return he(e.target.value)}),[]),ut=Object(r.useCallback)((function(e){return ve(e.target.value)}),[]),lt=Object(r.useCallback)((function(e){return ve(e.target.value)}),[]),dt=Object(r.useCallback)((function(e){return Se(e.target.value)}),[]),bt=Object(r.useCallback)((function(e){return Ie(e.target.value)}),[]),ft=Object(r.useCallback)((function(e){return Ne(e.target.value)}),[]),ht=Object(r.useCallback)((function(e){return Be(e.target.value)}),[]),jt=Object(r.useCallback)((function(e){return We(e.target.value)}),[]),pt=Object(r.useCallback)((function(e){return Ge(e.target.value)}),[]);Object(r.useEffect)((function(){var e=!1,n=setTimeout(Object(b.a)(d.a.mark((function n(){return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e){n.next=3;break}return n.abrupt("return");case 3:return n.t0=D,n.next=6,t.deckNames(v);case 6:return n.t1=n.sent,(0,n.t0)(n.t1),n.t2=q,n.next=11,t.modelNames(v);case 11:n.t3=n.sent,(0,n.t2)(n.t3),y(null),n.next=23;break;case 16:if(n.prev=16,n.t4=n.catch(0),!e){n.next=20;break}return n.abrupt("return");case 20:console.error(n.t4),D(null),y(n.t4.message);case 23:case"end":return n.stop()}}),n,null,[[0,16]])}))),1e3);return function(){e=!0,clearTimeout(n)}}),[t,v,S]),Object(r.useEffect)((function(){if(H&&!x){var e=!1;return function(){n.apply(this,arguments)}(),function(){return e=!0}}function n(){return(n=Object(b.a)(d.a.mark((function n(){return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e){n.next=3;break}return n.abrupt("return");case 3:return n.t0=xe,n.t1=[""],n.t2=h.a,n.next=8,t.modelFieldNames(v,H);case 8:n.t3=n.sent,n.t4=(0,n.t2)(n.t3),n.t5=n.t1.concat.call(n.t1,n.t4),(0,n.t0)(n.t5),y(null),n.next=22;break;case 15:if(n.prev=15,n.t6=n.catch(0),!e){n.next=19;break}return n.abrupt("return");case 19:console.error(n.t6),xe(null),y(n.t6.message);case 22:case"end":return n.stop()}}),n,null,[[0,15]])})))).apply(this,arguments)}}),[t,H,v,x,S]);var Ot=Object(r.useCallback)((function(){i({ankiConnectUrl:v,deck:A,noteType:H,sentenceField:$,definitionField:te,audioField:ce,imageField:ue,wordField:fe,sourceField:Oe,subtitleSize:Number(Ee),subtitleColor:Ce,subtitleOutlineThickness:Number(Le),subtitleOutlineColor:Ue,subtitleBackgroundColor:ze,subtitleBackgroundOpacity:Number(Xe)})}),[i,v,A,H,$,te,ce,ue,fe,Oe,Ee,Ce,Le,Ue,ze,Xe]);return Object(a.jsxs)(R.a,{open:n,maxWidth:"xs",fullWidth:!0,onBackdropClick:Ot,children:[Object(a.jsxs)(Zt.a,{value:l,variant:"fullWidth",onChange:function(e,t){return f(t)},children:[Object(a.jsx)(Qt.a,{label:"Anki"}),Object(a.jsx)(Qt.a,{label:"In-Video Subtitles"})]}),0===l&&Object(a.jsxs)(N.a,{children:[Object(a.jsxs)(Kt.a,{children:["Ensure that ",window.location.protocol+"//"+window.location.hostname," is in the webCorsOriginList in your AnkiConnect settings. Leaving a field blank is fine."]}),Object(a.jsx)(an,{children:Object(a.jsxs)("form",{className:o.root,children:[Object(a.jsx)("div",{children:Object(a.jsx)(M.a,{label:"Anki Connect URL",value:v,error:Boolean(x),helperText:x,onChange:Ke})}),Object(a.jsx)(nn,{label:"Deck",value:A,selections:_,onChange:Ye,onSelectionChange:Je}),Object(a.jsx)(nn,{label:"Note Type",value:H,selections:K,onChange:Qe,onSelectionChange:$e}),Object(a.jsx)(nn,{label:"Sentence Field",value:$,selections:ke,onChange:Ze,onSelectionChange:et}),Object(a.jsx)(nn,{label:"Definition Field",value:te,selections:ke,onChange:tt,onSelectionChange:nt}),Object(a.jsx)(nn,{label:"Word Field",value:fe,selections:ke,onChange:ot,onSelectionChange:st}),Object(a.jsx)(nn,{label:"Audio Field",value:ce,selections:ke,onChange:at,onSelectionChange:rt}),Object(a.jsx)(nn,{label:"Image Field",value:ue,selections:ke,onChange:ct,onSelectionChange:it}),Object(a.jsx)(nn,{label:"Source Field",value:Oe,selections:ke,onChange:ut,onSelectionChange:lt})]})})]}),1===l&&Object(a.jsx)(N.a,{children:Object(a.jsx)(an,{children:Object(a.jsxs)("form",{className:o.root,children:[Object(a.jsx)("div",{className:o.subtitleSetting,children:Object(a.jsx)(M.a,{type:"color",label:"Subtitle Color",value:Ce,onChange:dt})}),Object(a.jsx)("div",{className:o.subtitleSetting,children:Object(a.jsx)(M.a,{type:"number",label:"Subtitle Size",value:Ee,onChange:bt})}),Object(a.jsx)("div",{className:o.subtitleSetting,children:Object(a.jsx)(M.a,{type:"color",label:"Subtitle Outline Color",value:Ue,onChange:ft})}),Object(a.jsx)("div",{className:o.subtitleSetting,children:Object(a.jsx)(M.a,{type:"number",label:"Subtitle Outline Thickness",value:Le,onChange:ht})}),Object(a.jsx)("div",{className:o.subtitleSetting,children:Object(a.jsx)(M.a,{type:"color",label:"Subtitle Background Color",value:ze,onChange:jt})}),Object(a.jsx)("div",{className:o.subtitleSetting,children:Object(a.jsx)(M.a,{type:"number",label:"Subtitle Background Opacity",inputProps:{min:0,max:1,step:.1},value:Xe,onChange:pt})})]})})}),Object(a.jsxs)(U.a,{children:[0===l&&Object(a.jsx)(I.a,{onClick:qe,children:"Retry Anki URL"}),Object(a.jsx)(I.a,{onClick:Ot,children:"OK"})]})]})}var cn="http://127.0.0.1:8765",on="#ffffff",sn="#000000",un="#000000",ln="ankiConnectUrl",dn="deck",bn="noteType",fn="sentenceField",hn="definitionField",jn="audioField",pn="imageField",On="wordField",vn="sourceField",mn="subtitleSize",gn="subtitleColor",kn="subtitleOutlineThickness",xn="subtitleOutlineColor",yn="subtitleBackgroundColor",wn="subtitleBackgroundOpacity",Cn="volume",Sn=function(){function e(){Object(S.a)(this,e)}return Object(T.a)(e,[{key:"settings",get:function(){return{ankiConnectUrl:localStorage.getItem(ln)||cn,deck:localStorage.getItem(dn),noteType:localStorage.getItem(bn),sentenceField:localStorage.getItem(fn),definitionField:localStorage.getItem(hn),audioField:localStorage.getItem(jn),imageField:localStorage.getItem(pn),wordField:localStorage.getItem(On),sourceField:localStorage.getItem(vn),subtitleSize:localStorage.getItem(mn)||36,subtitleColor:localStorage.getItem(gn)||on,subtitleOutlineThickness:localStorage.getItem(kn)||0,subtitleOutlineColor:localStorage.getItem(xn)||sn,subtitleBackgroundColor:localStorage.getItem(yn)||un,subtitleBackgroundOpacity:localStorage.getItem(wn)||.5}}},{key:"subtitleSettings",get:function(){return{subtitleSize:localStorage.getItem(mn)||36,subtitleColor:localStorage.getItem(gn)||on,subtitleOutlineThickness:localStorage.getItem(kn)||0,subtitleOutlineColor:localStorage.getItem(xn)||sn,subtitleBackgroundColor:localStorage.getItem(yn)||un,subtitleBackgroundOpacity:localStorage.getItem(wn)||.5}}},{key:"ankiConnectUrl",get:function(){return localStorage.getItem(ln)||cn},set:function(e){localStorage.setItem(ln,e)}},{key:"deck",get:function(){return localStorage.getItem(dn)},set:function(e){localStorage.setItem(dn,e)}},{key:"noteType",get:function(){return localStorage.getItem(bn)},set:function(e){localStorage.setItem(bn,e)}},{key:"sentenceField",get:function(){return localStorage.getItem(fn)},set:function(e){localStorage.setItem(fn,e)}},{key:"definitionField",get:function(){return localStorage.getItem(hn)},set:function(e){localStorage.setItem(hn,e)}},{key:"audioField",get:function(){return localStorage.getItem(jn)},set:function(e){localStorage.setItem(jn,e)}},{key:"imageField",get:function(){return localStorage.getItem(pn)},set:function(e){localStorage.setItem(pn,e)}},{key:"wordField",get:function(){return localStorage.getItem(On)},set:function(e){localStorage.setItem(On,e)}},{key:"sourceField",get:function(){return localStorage.getItem(vn)},set:function(e){localStorage.setItem(vn,e)}},{key:"subtitleColor",get:function(){return localStorage.getItem(gn)||on},set:function(e){localStorage.setItem(gn,e)}},{key:"subtitleSize",get:function(){return localStorage.getItem(mn)||36},set:function(e){localStorage.setItem(mn,e)}},{key:"subtitleOutlineColor",get:function(){return localStorage.getItem(xn)||sn},set:function(e){localStorage.setItem(xn,e)}},{key:"subtitleOutlineThickness",get:function(){return localStorage.getItem(kn)||0},set:function(e){localStorage.setItem(kn,e)}},{key:"subtitleBackgroundColor",get:function(){return localStorage.getItem(yn)||un},set:function(e){localStorage.setItem(yn,e)}},{key:"subtitleBackgroundOpacity",get:function(){return localStorage.getItem(wn)||.5},set:function(e){localStorage.setItem(wn,e)}},{key:"volume",get:function(){return localStorage.getItem(Cn)||100},set:function(e){localStorage.setItem(Cn,e)}}]),e}(),Tn=function(){function e(t){Object(S.a)(this,e),this.channel=new BroadcastChannel(t),this.time=0,this.duration=0,this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.closeCallbacks=[],this.readyCallbacks=[],this.subtitlesCallbacks=[],this.condensedModeToggleCallbacks=[];var n=this;this.channel.onmessage=function(e){switch(e.data.command){case"init":break;case"ready":var t,a=Object(O.a)(n.readyCallbacks);try{for(a.s();!(t=a.n()).done;){(0,t.value)(e.data.duration)}}catch(m){a.e(m)}finally{a.f()}break;case"play":var r,c=Object(O.a)(n.playCallbacks);try{for(c.s();!(r=c.n()).done;){(0,r.value)()}}catch(m){c.e(m)}finally{c.f()}break;case"pause":var i,o=Object(O.a)(n.pauseCallbacks);try{for(o.s();!(i=o.n()).done;){(0,i.value)()}}catch(m){o.e(m)}finally{o.f()}break;case"currentTime":var s,u=Object(O.a)(n.currentTimeCallbacks);try{for(u.s();!(s=u.n()).done;){(0,s.value)(e.data.value)}}catch(m){u.e(m)}finally{u.f()}break;case"audioTrackSelected":var l,d=Object(O.a)(n.audioTrackSelectedCallbacks);try{for(d.s();!(l=d.n()).done;){(0,l.value)(e.data.id)}}catch(m){d.e(m)}finally{d.f()}break;case"close":var b,f=Object(O.a)(n.closeCallbacks);try{for(f.s();!(b=f.n()).done;){(0,b.value)()}}catch(m){f.e(m)}finally{f.f()}break;case"subtitles":var h,j=Object(O.a)(n.subtitlesCallbacks);try{for(j.s();!(h=j.n()).done;){(0,h.value)(e.data.value)}}catch(m){j.e(m)}finally{j.f()}break;case"subtitleSettings":break;case"condensedModeToggle":var p,v=Object(O.a)(n.condensedModeToggleCallbacks);try{for(v.s();!(p=v.n()).done;){(0,p.value)(e.data.value)}}catch(m){v.e(m)}finally{v.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(T.a)(e,[{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onClose",value:function(e){this.closeCallbacks.push(e)}},{key:"onReady",value:function(e){this.readyCallbacks.push(e)}},{key:"onSubtitles",value:function(e){this.subtitlesCallbacks.push(e)}},{key:"onCondensedModeToggle",value:function(e){this.condensedModeToggleCallbacks.push(e)}},{key:"ready",value:function(e,t,n,a){this.channel.postMessage({command:"ready",duration:e,paused:t,currentTime:0,audioTracks:n,selectedAudioTrack:a})}},{key:"readyState",value:function(e){this.channel.postMessage({command:"readyState",value:e})}},{key:"play",value:function(){this.channel.postMessage({command:"play",echo:!0})}},{key:"pause",value:function(){this.channel.postMessage({command:"pause",echo:!0})}},{key:"audioTrackSelected",value:function(e){this.channel.postMessage({command:"audioTrackSelected",id:e})}},{key:"offset",value:function(e){this.channel.postMessage({command:"offset",value:e})}},{key:"popOutToggle",value:function(){this.channel.postMessage({command:"popOutToggle"})}},{key:"copy",value:function(e){this.channel.postMessage({command:"copy",subtitle:e})}},{key:"condensedModeToggle",value:function(){this.channel.postMessage({command:"condensedModeToggle"})}},{key:"close",value:function(){this.channel&&(this.channel.postMessage({command:"exit"}),this.channel.close(),this.channel=null)}},{key:"currentTime",get:function(){return this.time},set:function(e){this.time=e,this.channel.postMessage({command:"currentTime",value:this.time,echo:!0})}}]),e}(),Fn=Object(m.a)({root:{position:"relative",backgroundColor:"black",height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},video:{margin:"auto"}});function En(e,t,n,a,r,c){var i={position:"absolute",paddingLeft:20,paddingRight:20,bottom:100,textAlign:"center",color:t,fontSize:Number(e)};if(n>0){var o=n,s=a;i.textShadow="0 0 ".concat(o,"px ").concat(s,", 0 0 ").concat(o,"px ").concat(s,", 0 0 ").concat(o,"px ").concat(s,", 0 0 ").concat(o,"px ").concat(s)}if(c>0){var u=c,l=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}}(r),d=l.r,b=l.g,f=l.b;i.backgroundColor="rgba(".concat(d,", ").concat(b,", ").concat(f,", ").concat(u,")")}return i}function In(e,t,n,a){if(window.outerWidth&&e.videoWidth>0&&e.videoHeight>0){var r=window.screen.availWidth-(window.outerWidth-window.innerWidth),c=window.screen.availHeight-(window.outerHeight-window.innerHeight),i=Math.min(1,Math.min(r/e.videoWidth,c/e.videoHeight));window.resizeTo(i*e.videoWidth+(window.outerWidth-window.innerWidth),i*e.videoHeight+(window.outerHeight-window.innerHeight))}var o,s;if(e.audioTracks){o=[];var u,l=Object(O.a)(e.audioTracks);try{for(l.s();!(u=l.n()).done;){var d=u.value;o.push({id:d.id,label:d.label,language:d.language}),d.enabled&&(s=d.id)}}catch(b){l.e(b)}finally{l.f()}}else o=null,s=null;n(o),a(s),t.ready(e.duration,e.paused,o,s)}function Mn(e){var t=Fn(),n=e.settingsProvider,i=e.videoFile,o=e.channel,s=e.popOut,u=e.onError,l=Object(r.useRef)(),d=Object(r.useRef)(),b=g(!0),h=Object(j.a)(b,2),p=h[0],v=h[1];d.current&&(d.current.width=p,d.current.height=v);var m=Object(r.useMemo)((function(){return new Tn(o)}),[o]),k=Object(r.useState)(!1),x=Object(j.a)(k,2),y=x[0],w=x[1],S=function(){var e=Object(r.useState)(Boolean(document.fullscreenElement)),t=Object(j.a)(e,2),n=t[0],a=t[1];return Object(r.useEffect)((function(){var e=function(){return a(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",e),function(){return document.removeEventListener("fullscreenchange",e)}}),[]),n}(),T=Object(r.useRef)();T.current=y;var F=Object(r.useState)(0),E=Object(j.a)(F,2),I=E[0],M=E[1],R=Object(r.useState)(0),U=Object(j.a)(R,2),N=U[0],A=U[1],P=Object(r.useState)(),L=Object(j.a)(P,2),B=L[0],_=L[1],D=Object(r.useState)(),z=Object(j.a)(D,2),W=z[0],H=z[1],V=Object(r.useState)([]),X=Object(j.a)(V,2),G=X[0],K=X[1],q=Object(r.useState)([]),J=Object(j.a)(q,2),Y=J[0],$=J[1],Q=Object(r.useState)(!0),Z=Object(j.a)(Q,2),ee=Z[0],te=Z[1],ne=Object(r.useState)(!1),ae=Object(j.a)(ne,2),re=ae[0],ce=ae[1],ie=Object(r.useRef)([]);ie.current=Y;var oe=Object(r.useMemo)((function(){return new $e}),[]),se=Object(r.useRef)({x:0,y:0}),ue=Object(r.useRef)(),le=Object(r.useState)(),de=Object(j.a)(le,2),be=de[0],fe=de[1],he=Object(r.useState)(!1),je=Object(j.a)(he,2),pe=je[0],Oe=je[1],ve=Object(r.useCallback)((function(e){e&&(d.current=e,4===e.readyState?In(e,m,_,H):e.onloadeddata=function(t){In(e,m,_,H)},e.oncanplay=function(e){m.readyState(4),T.current&&oe.start()},e.onerror=function(t){return u(function(e){var t;switch(e.error.code){case 1:t="Aborted";break;case 2:t="Network error";break;case 3:t="Decoding error";break;case 4:t="Source not supported";break;default:t="Unknown error"}return t+": "+(e.error.message||"<details missing>")}(e))})}),[oe,m,u]);function me(e){var t,n=Object(O.a)(d.current.audioTracks);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.id===e?a.enabled=!0:a.enabled=!1}}catch(r){n.e(r)}finally{n.f()}}Object(r.useEffect)((function(){return m.onReady((function(e){return M(e)})),m.onPlay((function(){d.current.play(),oe.start(),w(!0)})),m.onPause((function(){d.current.pause(),oe.stop(),w(!1)})),m.onCurrentTime((function(e){var t;d.current&&(d.current.currentTime=e),4===(null===(t=d.current)||void 0===t?void 0:t.readyState)&&m.readyState(4),oe.stop(),oe.setTime(1e3*e)})),m.onAudioTrackSelected((function(e){me(e),m.audioTrackSelected(e)})),m.onClose((function(){m.close(),window.close()})),m.onSubtitles((function(e){if(K(e),e&&e.length>0){var t=e[0],n=t.start-t.originalStart;A(n)}})),m.onCondensedModeToggle((function(e){return ce(e)})),window.onbeforeunload=function(e){l.current||m.close()},function(){return m.close()}}),[oe,m]);var ge=Object(r.useCallback)((function(){d.current&&m.play()}),[m]),ke=Object(r.useCallback)((function(){return m.pause()}),[m]),xe=Object(r.useCallback)((function(e){T.current&&oe.stop();var t=e*I;m.currentTime=t/1e3}),[I,oe,m]);var ye=Object(r.useCallback)((function(e){T.current&&(oe.stop(),m.pause()),me(e),H(e),m.currentTime=0,m.audioTrackSelected(e)}),[m,oe]);Object(r.useEffect)((function(){if(G&&0!==G.length){var e=setInterval((function(){for(var e=1e3*d.current.currentTime,t=[],n=0;n<G.length;++n){var a=G[n];if(e>=a.start&&e<a.end&&t.push(Object(f.a)(Object(f.a)({},a),{},{index:n})),e<a.start)break}(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};if(e.length!==t.length)return!1;for(var a=0;a<e.length;++a)if(!n(e[a],t[a]))return!1;return!0})(t,ie.current,(function(e,t){return e.index===t.index}))||$(t)}),10);return function(){return clearTimeout(e)}}}),[G]),Object(r.useEffect)((function(){function e(e){if(d.current&&G&&0!==G.length){var t;if(37===e.keyCode)t=!1;else{if(39!==e.keyCode)return;t=!0}var n=Math.round(1e3*d.current.currentTime),a=-1;if(t)for(var r=Number.MAX_SAFE_INTEGER,c=0;c<G.length;++c){var i=G[c],o=i.start-n;r<=o||n<i.start&&(r=o,a=c)}else for(var s=Number.MAX_SAFE_INTEGER,u=0;u<G.length;++u){var l=G[u],b=n-l.start;s<=b||n>l.start&&(s=b,a=n<l.end?Math.max(0,u-1):u)}-1!==a&&(e.preventDefault(),m.currentTime=G[a].start/1e3)}}return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[m,oe,G,I]),Object(r.useEffect)((function(){function e(e){if(ie.current&&0!==ie.current.length&&At(e)){e.stopPropagation(),e.preventDefault();var t=ie.current[0];m.copy(t),S&&(fe("Copied "+t.text),Oe(!0))}}return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[m,S]);var we=Object(r.useCallback)((function(){return te((function(e){return!e}))}),[]),Ce=Object(r.useCallback)((function(){var e;S?document.exitFullscreen():null===(e=ue.current)||void 0===e||e.requestFullscreen()}),[S]),Se=Object(r.useCallback)((function(e){d.current&&(d.current.volume=e)}),[]),Te=Object(r.useCallback)((function(e){return m.offset(e)}),[m]),Fe=Object(r.useCallback)((function(){m.popOutToggle(),s&&(l.current=!0,window.close())}),[m,s]),Ee=Object(r.useCallback)((function(){m.condensedModeToggle()}),[m]),Ie=Object(r.useCallback)((function(){m.close(),window.close()}),[m]),Me=Object(r.useCallback)((function(){y?m.pause():m.play()}),[m,y]),Re=Object(r.useCallback)((function(){return Oe(!1)}),[]),Ue=n.subtitleSettings,Ne=Ue.subtitleSize,Ae=Ue.subtitleColor,Pe=Ue.subtitleOutlineThickness,Le=Ue.subtitleOutlineColor,Be=Ue.subtitleBackgroundColor,_e=Ue.subtitleBackgroundOpacity,De=Object(r.useMemo)((function(){return En(Ne,Ae,Pe,Le,Be,_e)}),[Ne,Ae,Pe,Le,Be,_e]);return Object(a.jsxs)("div",{ref:ue,onMouseMove:function(e){se.current.x=e.screenX,se.current.y=e.screenY},className:t.root,children:[Object(a.jsx)("video",{preload:"auto",nocontrols:1,onClick:Me,className:t.video,ref:ve,src:i}),ee&&Object(a.jsx)("div",{style:De,children:Y.map((function(e){return Object(a.jsxs)(c.a.Fragment,{children:[e.text,Object(a.jsx)("br",{})]},e.index)}))}),S&&Object(a.jsx)(C,{open:pe,onClose:Re,autoHideDuration:3e3,severity:"success",children:be}),Object(a.jsx)(Ut,{mousePositionRef:se,playing:y,clock:oe,length:I,audioTracks:B,selectedAudioTrack:W,subtitlesToggle:G&&G.length>0,subtitlesEnabled:ee,offsetEnabled:!0,offset:N,fullscreenEnabled:!0,fullscreen:S,closeEnabled:!s,popOut:s,volumeEnabled:!0,popOutEnabled:!0,condensedModeToggleEnabled:!0,condensedModeEnabled:re,onPlay:ge,onPause:ke,onSeek:xe,onAudioTrackSelected:ye,onSubtitlesToggle:we,onFullscreenToggle:Ce,onVolumeChange:Se,onOffsetChange:Te,onPopOutToggle:Fe,onCondensedModeToggle:Ee,onClose:Ie,settingsProvider:n})]})}var Rn="https://github.com/killergerbah/asbplayer/releases/latest";function Un(e,t){return e.audio?V.fromBase64(e.subtitleFile,e.start,e.end,e.audio.base64,e.audio.extension):e.audioFile||e.videoFile?V.fromFile(e.audioFile||e.videoFile,e.originalStart+t,e.originalEnd+t,e.audioTrack):null}function Nn(e,t){return e.image?He.fromBase64(e.subtitleFile,e.start,e.image.base64,e.image.extension):e.videoFile?He.fromFile(e.videoFile,e.originalStart+t):null}function An(e){var t,n=(t=e.drawerWidth,Object(m.a)((function(e){return{content:{flexGrow:1,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginRight:0},contentShift:{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:t}}})))();return Object(a.jsx)("main",{className:Object(k.a)(n.content,Object(p.a)({},n.contentShift,e.drawerOpen)),children:e.children})}var Pn=function(){var e=Object(r.useMemo)((function(){return new be}),[]),t=Object(r.useMemo)((function(){return new Sn}),[]),n=Object(r.useMemo)((function(){return new F(t)}),[t]),c=Object(r.useMemo)((function(){return new we}),[]),i=Object(v.g)(),o=Object(r.useRef)(),s="/video"===i.pathname,u=g(!s),l=Object(j.a)(u,1)[0],p=o.current?.2:.3,m=o.current?150:300,k=Math.max(m,l*p),x=Object(r.useState)([]),y=Object(j.a)(x,2),w=y[0],S=y[1],T=Object(r.useState)(!1),E=Object(j.a)(T,2),I=E[0],M=E[1],R=Object(r.useState)(),U=Object(j.a)(R,2),N=U[0],A=U[1],P=Object(r.useState)(!1),B=Object(j.a)(P,2),_=B[0],D=B[1],z=Object(r.useState)(),W=Object(j.a)(z,2),H=W[0],V=W[1],X=Object(r.useState)(),G=Object(j.a)(X,2),K=G[0],q=G[1],J=Object(r.useState)({}),Y=Object(j.a)(J,2),$=Y[0],Q=Y[1],Z=Object(r.useState)(!1),ee=Object(j.a)(Z,2),te=ee[0],ne=ee[1],ae=Object(r.useState)(),re=Object(j.a)(ae,2),ie=re[0],oe=re[1],ue=Object(r.useState)(!1),le=Object(j.a)(ue,2),de=le[0],fe=le[1],he=Object(r.useState)(!1),je=Object(j.a)(he,2),pe=je[0],Oe=je[1],ve=Object(r.useState)(),me=Object(j.a)(ve,2),ge=me[0],ke=me[1],xe=Object(r.useState)(!1),Ce=Object(j.a)(xe,2),Se=Ce[0],Te=Ce[1],Fe=Object(r.useState)(!1),Ee=Object(j.a)(Fe,2),Ie=Ee[0],Me=Ee[1],Re=Object(r.useState)(!1),Ue=Object(j.a)(Re,2),Ne=Ue[0],Ae=Ue[1],Pe=Object(r.useState)(!1),Le=Object(j.a)(Pe,2),Be=Le[0],_e=Le[1],ze=Object(r.useState)(),We=Object(j.a)(ze,2),He=We[0],Ve=We[1],Xe=Object(r.useRef)(),Ge=$.subtitleFile,Ke=Object(r.useCallback)((function(e,t,n,a,r,c,i){S((function(o){return[].concat(Object(h.a)(o),[Object(f.a)(Object(f.a)({},e),{},{timestamp:Date.now(),name:ie,subtitleFile:a,audioFile:t,videoFile:n,audioTrack:r,audio:c,image:i})])})),V("success"),A("Copied "+e.text),D(!0)}),[ie]),Je=Object(r.useCallback)((function(){return M((function(e){return!e}))}),[]),Ye=Object(r.useCallback)((function(){return M(!1)}),[]),$e=Object(r.useCallback)((function(){return Te(!0)}),[]),Qe=Object(r.useCallback)((function(){return Me(!0)}),[]),Ze=Object(r.useCallback)((function(){return Me(!1)}),[]),et=Object(r.useCallback)((function(){return D(!1)}),[]),tt=Object(r.useCallback)((function(){return Ae(!1)}),[]),nt=Object(r.useCallback)((function(e){t.ankiConnectUrl=e.ankiConnectUrl,t.deck=e.deck,t.noteType=e.noteType,t.modelNames=e.modelNames,t.sentenceField=e.sentenceField,t.definitionField=e.definitionField,t.audioField=e.audioField,t.imageField=e.imageField,t.wordField=e.wordField,t.sourceField=e.sourceField,t.subtitleSize=e.subtitleSize,t.subtitleColor=e.subtitleColor,t.subtitleOutlineThickness=e.subtitleOutlineThickness,t.subtitleOutlineColor=e.subtitleOutlineColor,t.subtitleBackgroundColor=e.subtitleBackgroundColor,t.subtitleBackgroundOpacity=e.subtitleBackgroundOpacity,Te(!1),c.publishMessage({command:"subtitleSettings",value:t.subtitleSettings})}),[c,t]),at=Object(r.useCallback)((function(e){var t,n=[],a=Object(O.a)(w);try{for(a.s();!(t=a.n()).done;){var r=t.value;e.timestamp!==r.timestamp&&n.push(r)}}catch(c){a.e(c)}finally{a.f()}S(n)}),[w]),rt=Object(r.useCallback)((function(e){V("error"),A(e),D(!0)}),[]),ct=Object(r.useCallback)((function(e){e===$.audioFileUrl&&Q((function(t){return URL.revokeObjectURL(e),{subtitleFile:t.subtitleFile,audioFile:null,audioFileUrl:null,videoFile:t.videoFile,videoFileUrl:t.videoFileUrl}}))}),[$]),it=Object(r.useCallback)((function(e){e===$.videoFileUrl&&Q((function(t){return URL.revokeObjectURL(e),{subtitleFile:t.subtitleFile,audioFile:t.audioFile,audioFileUrl:t.audioFileUrl,videoFile:null,videoFileUrl:null}}))}),[$]),ot=Object(r.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Un(t,Xe.current||0).download();case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0),rt(e.t0.message);case 9:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),[rt]),st=Object(r.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Nn(t,Xe.current||0).download();case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0),rt(e.t0.message);case 9:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),[rt]),ut=Object(r.useCallback)((function(e){Ge.name===e.subtitleFile.name?q({text:e.text,originalStart:e.originalStart}):rt("Subtitle file "+e.subtitleFile.name+" is not open.")}),[Ge,rt]),lt=Object(r.useCallback)((function(e){ke(e),fe(!0),Oe(!1),_e(!0)}),[]),dt=Object(r.useCallback)((function(){fe(!1),Oe(!1),_e(!1)}),[]),bt=Object(r.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(a,r,c,i,o,s){var u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Oe(!0),e.prev=1,e.next=4,n.export(t.ankiConnectUrl,a,r,c,i,o,s);case 4:u=e.sent,V("success"),A("Export succeeded: "+u),D(!0),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error(e.t0),rt(e.t0.message);case 14:return e.prev=14,fe(!1),Oe(!1),_e(!1),e.finish(14);case 19:case"end":return e.stop()}}),e,null,[[1,10,14,19]])})));return function(t,n,a,r,c,i){return e.apply(this,arguments)}}(),[n,t,rt]),ft=Object(r.useCallback)((function(e){Ve(e),Ae(!0)}),[]),ht=Object(r.useCallback)((function(e){if(e.preventDefault(),s)rt("Video player cannot receive dropped files. Drop into the subtitle section instead.");else if(e.dataTransfer.files&&0!==e.dataTransfer.files.length)try{var t=function(e){var t,n=null,a=null,r=null,c=Object(O.a)(e);try{for(c.s();!(t=c.n()).done;){var i=t.value,o=i.name.lastIndexOf(".");if(-1===o)throw new Error("Unable to determine extension of "+i.name);var s=i.name.substring(o+1,i.name.length);switch(s){case"ass":case"srt":case"vtt":if(n)throw new Error("Cannot open two subtitle files simultaneously");n=i;break;case"mkv":if(r)throw new Error("Cannot open two video files simultaneously");r=i;break;case"mp3":case"m4a":if(a)throw new Error("Cannot open two audio files simultaneously");a=i;break;default:throw new Error("Unsupported extension "+s)}}}catch(u){c.e(u)}finally{c.f()}if(r&&a)throw new Error("Cannot load both an audio and video file simultaneously");return{subtitleFile:n,audioFile:a,videoFile:r}}(e.dataTransfer.files),n=t.subtitleFile,a=t.audioFile,r=t.videoFile;Q((function(e){e.subtitleFile||ne(!0);var t=null,c=null;return r||a?(!function(e){e.audioFileUrl&&URL.revokeObjectURL(e.audioFileUrl),e.videoFileUrl&&URL.revokeObjectURL(e.videoFileUrl)}(e),r?t=URL.createObjectURL(r):a&&(c=URL.createObjectURL(a))):(r=e.videoFile,t=e.videoFileUrl,a=e.audioFile,c=e.audioFileUrl),{subtitleFile:n||e.subtitleFile,audioFile:a,audioFileUrl:c,videoFile:r,videoFileUrl:t}})),n&&oe(n.name)}catch(e){console.error(e),rt(e.message)}}),[s,rt]),jt=Object(r.useCallback)((function(){return ne(!1)}),[]),pt=te&&!o.current||!$.subtitleFile&&!$.audioFile&&!$.videoFile;return Object(a.jsxs)("div",{onDrop:ht,onDragOver:function(e){return e.preventDefault()},children:[Object(a.jsx)(C,{open:_,onClose:et,autoHideDuration:3e3,severity:H,children:N}),Object(a.jsxs)(v.d,{children:[Object(a.jsx)(v.b,{exact:!0,path:"/",render:function(){var r,i=new URLSearchParams(window.location.search),s=i.get("video"),u=i.get("channel"),l=i.get("popout");return s&&u?Object(a.jsx)(v.a,{to:"/video?video="+encodeURIComponent(s)+"&channel="+u+"&popout="+l}):Object(a.jsxs)("div",{children:[Object(a.jsx)(De,{items:w,open:I,drawerWidth:k,onClose:Ye,onDelete:at,onClipAudio:ot,onDownloadImage:st,onSelect:ut,onAnki:lt}),Object(a.jsx)(L,{open:de,disabled:pe,text:null===ge||void 0===ge?void 0:ge.text,audioClip:ge&&Un(ge,Xe.current||0),image:ge&&Nn(ge,Xe.current||0),source:null===ge||void 0===ge||null===(r=ge.subtitleFile)||void 0===r?void 0:r.name,onCancel:dt,onProceed:bt,onViewImage:ft}),Object(a.jsx)(se,{open:Ne,image:He,onClose:tt}),Object(a.jsx)(rn,{anki:n,open:Se,onClose:nt,settings:t.settings}),Object(a.jsx)(ce,{open:Ie,extensionUrl:Rn,onClose:Ze}),Object(a.jsx)(ye,{title:ie||"asbplayer",drawerWidth:k,drawerOpen:I,onOpenCopyHistory:Je,onOpenSettings:$e,onOpenHelp:Qe}),Object(a.jsxs)(An,{drawerWidth:k,drawerOpen:I,children:[pt&&Object(a.jsx)(qe,{latestExtensionVersion:"0.6.0",extensionUrl:Rn,extension:c,loading:te}),Object(a.jsx)(Gt,{subtitleReader:e,settingsProvider:t,onCopy:Ke,onError:rt,onUnloadAudio:ct,onUnloadVideo:it,onLoaded:jt,offsetRef:Xe,sources:$,jumpToSubtitle:K,videoFrameRef:o,extension:c,drawerOpen:I,disableKeyEvents:Be})]})]})}}),Object(a.jsx)(v.b,{exact:!0,path:"/video",render:function(){var e=new URLSearchParams(window.location.search),n=e.get("video"),r=e.get("channel"),c="true"===e.get("popout");return Object(a.jsx)(Mn,{settingsProvider:t,videoFile:n,popOut:c,channel:r,onError:rt})}})]})]})},Ln=n(98),Bn=n(173),_n=Object(Bn.a)({palette:{primary:{main:"#49007a"},secondary:{main:"#ff1f62"},error:{main:Ln.a.A400},type:"dark"}}),Dn=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,340)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),c(e),i(e)}))},zn=n(113);n(250);o.a.render(Object(a.jsx)(zn.a,{basename:"/asbplayer",forceRefresh:!1,children:Object(a.jsxs)(u.a,{theme:_n,children:[Object(a.jsx)(s.a,{}),Object(a.jsx)(Pn,{})]})}),document.querySelector("#root")),Dn()}},[[251,1,2]]]);
//# sourceMappingURL=main.ece52185.chunk.js.map