(this["webpackJsonp@project/client"]=this["webpackJsonp@project/client"]||[]).push([[0],{217:function(e,t){},219:function(e,t){},237:function(e,t){},239:function(e,t){},260:function(e,t,n){"use strict";n.r(t);n(202);var a=n(0),r=n.n(a),i=n(21),c=n.n(i),o=n(3),s=n.n(o),u=n(8),l=n(17),d=n(4),b=n(50),f=n(11),h=n(25),j=n(307),p=n(178),v=n(339);function g(e){var t=Object(a.useState)([0,0]),n=Object(d.a)(t,2),r=n[0],i=n[1];return Object(a.useLayoutEffect)((function(){function t(){e&&i([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",t),t(),function(){return window.removeEventListener("resize",t)}}),[e]),r}var O=n(96),m=n(13),k=n(14),x=function(){function e(){Object(m.a)(this,e)}return Object(k.a)(e,null,[{key:"detectCopy",value:function(e){return e.ctrlKey&&e.shiftKey&&65===e.keyCode}},{key:"detectDecreaseOffset",value:function(e){return e.ctrlKey&&e.shiftKey&&39===e.keyCode}},{key:"detectAnkiExport",value:function(e){return e.ctrlKey&&e.shiftKey&&81===e.keyCode}},{key:"detectIncreaseOffset",value:function(e){return e.ctrlKey&&e.shiftKey&&37===e.keyCode}},{key:"detectDecreaseOffsetToNextSubtitle",value:function(t){return!e.detectDecreaseOffset(t)&&(t.ctrlKey||t.shiftKey)&&39===t.keyCode}},{key:"detectIncreaseOffsetToPreviousSubtitle",value:function(t){return!e.detectIncreaseOffset(t)&&(t.ctrlKey||t.shiftKey)&&37===t.keyCode}},{key:"detectPreviousSubtitle",value:function(t){return!e.detectIncreaseOffset(t)&&!e.detectIncreaseOffsetToPreviousSubtitle(t)&&37===t.keyCode}},{key:"detectNextSubtitle",value:function(t){return!e.detectDecreaseOffset(t)&&!e.detectDecreaseOffsetToNextSubtitle(t)&&39===t.keyCode}},{key:"detectPlay",value:function(e){return 32===e.keyCode}}]),e}(),y=function(){function e(t){var n=t.up,a=t.holding,r=t.canceledBy,i=t.map;Object(m.a)(this,e),this.up=n||[],this.holding=a||[],this.canceledBy=r||[],this.map=i||function(){return!0},this.currentlyHolding={},this.canceled=!1}return Object(k.a)(e,[{key:"reset",value:function(){this.currentlyHolding={},this.canceled=!1}},{key:"accept",value:function(e){var t=0,n=null;return"keydown"===e.type&&(this.holding.includes(e.keyCode)&&(this.currentlyHolding[e.keyCode]=!0,this.canceled=!1,t=2),this.canceledBy.includes(e.keyCode)&&(this.canceled=!0,t=1),this.up.includes(e.keyCode)&&(this.canceled=!1,t=2)),"keyup"===e.type&&(delete this.currentlyHolding[e.keyCode],this.up.includes(e.keyCode)&&this._holdingAll()&&!this.canceled&&(n=this.map(e),t=3)),{result:t,extra:n}}},{key:"_holdingAll",value:function(){var e,t=Object(f.a)(this.holding);try{for(t.s();!(e=t.n()).done;){if(!(e.value in this.currentlyHolding))return!1}}catch(n){t.e(n)}finally{t.f()}return!0}}],[{key:"REJECTED",get:function(){return 0}},{key:"CANCELED",get:function(){return 1}},{key:"ADVANCED",get:function(){return 2}},{key:"COMPLETE",get:function(){return 3}}]),e}(),C=function(){function e(){Object(m.a)(this,e)}return Object(k.a)(e,null,[{key:"toggleSubtitles",value:function(){return new y({up:[83],canceledBy:[49,50,51,52,53,54,55,56,57]})}},{key:"toggleSubtitleTrack",value:function(){return new y({holding:[83],up:[49,50,51,52,53,54,55,56,57],map:function(e){return e.keyCode-49}})}},{key:"toggleSubtitleTrackInList",value:function(){return new y({holding:[68],up:[49,50,51,52,53,54,55,56,57],map:function(e){return e.keyCode-49}})}}]),e}(),w=function(){function e(){Object(m.a)(this,e)}return Object(k.a)(e,null,[{key:"bindCopy",value:function(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return e._bindDown((function(e){if(!n()&&x.detectCopy(e)){var r=a();r&&t(e,r)}}),r)}},{key:"bindAnkiExport",value:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e._bindDown((function(e){n()||x.detectAnkiExport(e)&&t(e)}),a)}},{key:"bindSeekToSubtitle",value:function(t,n,a,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return e._bindDown((function(i){if(!n()){var c=r();if(c&&0!==c.length){var o;if(x.detectPreviousSubtitle(i))o=!1;else{if(!x.detectNextSubtitle(i))return;o=!0}var s=e._adjacentSubtitle(o,a(),c);null!==s&&s.start>=0&&s.end>=0&&t(i,s)}}}),i)}},{key:"bindOffsetToSubtitle",value:function(t,n,a,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return e._bindDown((function(i){if(!n()){var c=r();if(c&&0!==c.length){var o;if(x.detectIncreaseOffsetToPreviousSubtitle(i))o=!1;else{if(!x.detectDecreaseOffsetToNextSubtitle(i))return;o=!0}var s=a(),u=e._adjacentSubtitle(o,s,c);if(null!==u){var l=u.originalStart;t(i,s-l)}}}}),i)}},{key:"_adjacentSubtitle",value:function(e,t,n){for(var a=t,r=-1,i=Number.MAX_SAFE_INTEGER,c=0;c<n.length;++c){var o=n[c],s=e?o.start-a:a-o.start;i<=s||(e&&a<o.start?(i=s,r=c):!e&&a>o.start&&(i=s,r=a<o.end?Math.max(0,c-1):c))}return-1!==r?n[r]:null}},{key:"bindAdjustOffset",value:function(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return e._bindDown((function(e){if(!n()){var r=a();if(r&&0!==r.length){var i;if(x.detectDecreaseOffset(e))i=!1;else{if(!x.detectIncreaseOffset(e))return;i=!0}var c=r[0].start-r[0].originalStart;t(e,c+(i?100:-100))}}}),r)}},{key:"bindToggleSubtitles",value:function(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=C.toggleSubtitles(),c=function(e){if(a())i.reset();else{var r=i.accept(e);r.result===y.ADVANCED?n():r.result===y.COMPLETE&&t(e)}},o=e._bindDown(c,r),s=e._bindUp(c,r);return function(){o(),s()}}},{key:"bindToggleSubtitleTrackInVideo",value:function(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=C.toggleSubtitleTrack(),c=function(e){if(a())i.reset();else{var r=i.accept(e);r.result===y.ADVANCED?n():r.result===y.COMPLETE&&t(e,r.extra)}},o=e._bindDown(c,r),s=e._bindUp(c,r);return function(){o(),s()}}},{key:"bindToggleSubtitleTrackInList",value:function(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=C.toggleSubtitleTrackInList(),c=function(e){if(a())i.reset();else{var r=i.accept(e);r.result===y.ADVANCED?n():r.result===y.COMPLETE&&t(e,r.extra)}},o=e._bindDown(c,r),s=e._bindUp(c,r);return function(){o(),s()}}},{key:"bindPlay",value:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e._bindDown((function(e){n()||x.detectPlay(e)&&t(e)}),a)}},{key:"_bindDown",value:function(e,t){return window.addEventListener("keydown",e,t),function(){return window.removeEventListener("keydown",e,t)}}},{key:"_bindUp",value:function(e,t){return window.addEventListener("keyup",e,t),function(){return window.removeEventListener("keyup",e,t)}}}]),e}(),S=function(){function e(){Object(m.a)(this,e)}return Object(k.a)(e,null,[{key:"encode",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(u.a)(s.a.mark((function e(a,r){var i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(i=new FileReader).onload=function(){var e=Object(u.a)(s.a.mark((function e(t){var i,c,o,u,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=new AudioContext,e.next=4,i.decodeAudioData(t.target.result);case 4:for(c=e.sent,o=[],u=0;u<c.numberOfChannels;++u)o.push(c.getChannelData(u));(l=n()).postMessage({command:"encode",audioBuffer:{channels:o,numberOfChannels:c.numberOfChannels,length:c.length,sampleRate:c.sampleRate}}),l.onmessage=function(e){a(new Blob(e.data.buffer,{type:"audio/mp3"})),l.terminate()},l.onerror=function(){r(new Error("MP3 encoding failed")),l.terminate()},e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),r(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),i.readAsArrayBuffer(t);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function T(){return new Worker(n.p+"static/js/mp3-encoder.04720f9c.worker.js")}var F={"audio/ogg;codecs=opus":"ogg","audio/webm;codecs=opus":"webm"},E=Object(d.a)(Object.keys(F).filter(MediaRecorder.isTypeSupported).map((function(e){return[e,F[e]]}))[0],2),I=E[0],M=E[1],P=function(){return new T},R=function(){function e(t,n,a,r,i){Object(m.a)(this,e),this.name=t+"_"+Math.floor(n)+"_"+Math.floor(a),this.start=n,this.end=a,this._base64=r,this.extension=i}return Object(k.a)(e,[{key:"base64",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._base64);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,a=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return t=e.sent,(n=new Audio).src=URL.createObjectURL(t),n.preload="none",n.load(),e.next=9,n.play();case 9:return e.abrupt("return",new Promise((function(e,t){setTimeout((function(){n.pause();var t=n.src;n.src=null,URL.revokeObjectURL(t),e()}),a.end-a.start+1e3)})));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_blob",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cachedBlob){e.next=6;break}return e.next=3,fetch("data:audio/"+this.extension+";base64,"+this._base64);case 3:return e.next=5,e.sent.blob();case 5:this.cachedBlob=e.sent;case 6:return e.abrupt("return",this.cachedBlob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"slice",value:function(e,t){return this}},{key:"isSliceable",value:function(e,t){return!1}}]),e}(),D=function(){function e(t,n,a,r){Object(m.a)(this,e),this.file=t,this.name=t.name+"_"+n+"_"+a,this.start=n,this.end=a,this.trackId=r,this.extension=M}return Object(k.a)(e,[{key:"base64",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(u.a)(s.a.mark((function e(n,a){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new FileReader,e.t0=r,e.next=4,t.blob();case 4:e.t1=e.sent,e.t0.readAsDataURL.call(e.t0,e.t1),r.onloadend=function(){var e=r.result,t=e.substr(e.indexOf(",")+1);n(t)};case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=5;break}return e.next=3,this._clipAudio();case 3:return this._blob=e.sent,e.abrupt("return");case 5:return(t=this._audioElement(this._blob)).currentTime=0,e.next=9,t.play();case 9:return e.next=11,this._stopAudio(t);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=4;break}return e.next=3,this._clipAudio();case 3:this._blob=e.sent;case 4:return e.abrupt("return",this._blob);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_clipAudio",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var a=t._audioElement(t.file);a.oncanplay=function(){var n=Object(u.a)(s.a.mark((function n(r){var i,c,o,u,l;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a.play(),i=t._captureStream(a),c=Object(f.a)(i.getVideoTracks());try{for(c.s();!(o=c.n()).done;)o.value.stop()}catch(r){c.e(r)}finally{c.f()}return u=new MediaRecorder(i,{mimeType:I}),l=[],u.ondataavailable=function(e){l.push(e.data)},u.onstop=function(t){e(new Blob(l))},u.start(),n.next=11,t._stopAudio(a);case 11:u.stop();case 12:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_audioElement",value:function(e){var t=new Audio;if(t.src=URL.createObjectURL(e),t.preload="none",this.trackId&&t.audioTracks&&t.audioTracks.length>0){var n,a=Object(f.a)(t.audioTracks);try{for(a.s();!(n=a.n()).done;){var r=n.value;r.enabled=this.trackId===r.id}}catch(i){a.e(i)}finally{a.f()}}return t.currentTime=this.start/1e3,t.load(),t}},{key:"_captureStream",value:function(e){if("function"===typeof e.captureStream)return e.captureStream();if("function"===typeof e.mozCaptureStream)return e.mozCaptureStream();throw new Error("Unable to capture stream from audio")}},{key:"_stopAudio",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){setTimeout((function(){t.pause();var n=t.src;t.src=null,URL.revokeObjectURL(n),e()}),n.end-n.start+100)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"slice",value:function(t,n){return new e(this.file,t,n,this.trackId)}},{key:"isSliceable",value:function(e,t){return!0}}]),e}(),A=function(){function e(t,n){Object(m.a)(this,e),this.data=t,this.workerFactory=n}return Object(k.a)(e,[{key:"name",get:function(){return this.data.name}},{key:"extension",get:function(){return"mp3"}},{key:"base64",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(u.a)(s.a.mark((function e(n,a){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new FileReader,e.t0=r,e.next=5,t.blob();case 5:e.t1=e.sent,e.t0.readAsDataURL.call(e.t0,e.t1),r.onloadend=function(){var e=r.result,t=e.substr(e.indexOf(",")+1);n(t)},e.next=13;break;case 10:e.prev=10,e.t2=e.catch(0),a(e.t2);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.play();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=9;break}return e.t0=S,e.next=4,this.data.blob();case 4:return e.t1=e.sent,e.t2=this.workerFactory,e.next=8,e.t0.encode.call(e.t0,e.t1,e.t2);case 8:this._blob=e.sent;case 9:return e.abrupt("return",this._blob);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"slice",value:function(t,n){return new e(this.data.slice(t,n),this.workerFactory)}},{key:"isSliceable",value:function(e,t){return this.data.isSliceable(e,t)}}]),e}(),N=function(){function e(t){Object(m.a)(this,e),this.data=t}return Object(k.a)(e,[{key:"name",get:function(){return this.data.name+"."+this.data.extension}},{key:"play",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.play();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"base64",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.base64();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:t=e.sent,n=window.URL.createObjectURL(t),a=document.createElement("a"),document.body.appendChild(a),a.style="display: none",a.href=n,a.download=this.name,a.click(),URL.revokeObjectURL(n),a.remove();case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toMp3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P;return new e(new A(this.data,t))}},{key:"slice",value:function(t,n){return new e(this.data.slice(t,n))}},{key:"isSliceable",value:function(e,t){return this.data.isSliceable(e,t)}}],[{key:"fromBase64",value:function(t,n,a,r,i){return new e(new R(t.substring(0,t.lastIndexOf(".")),n,a,r,i))}},{key:"fromFile",value:function(t,n,a,r){return new e(new D(t,n,a,r))}}]),e}(),_=function(){function e(){Object(m.a)(this,e)}return Object(k.a)(e,[{key:"resize",value:function(e,t,n,a){return new Promise((function(r,i){var c=n<=0?1:n/e.width,o=a<=0?1:a/e.height,s=Math.min(1,Math.min(c,o));if(s<1){var u=e.width*s,l=e.height*s;createImageBitmap(e,{resizeWidth:u,resizeHeight:l}).then((function(n){e.width=u,e.height=l,t.drawImage(n,0,0),r(e)})).catch((function(e){return i(e)}))}else r(e)}))}}]),e}(),U=function(){function e(t,n,a){Object(m.a)(this,e),this.name=t,this._base64=n,this.extension=a}return Object(k.a)(e,[{key:"base64",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._base64);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_blob",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cachedBlob){e.next=6;break}return e.next=3,fetch(this._dataUrl());case 3:return e.next=5,e.sent.blob();case 5:this.cachedBlob=e.sent;case 6:return e.abrupt("return",this.cachedBlob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._dataUrl());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_dataUrl",value:function(){return"data:image/"+this.extension+";base64,"+this._base64}}]),e}(),L=function(){function e(t,n,a,r){Object(m.a)(this,e),this.file=t,this.name=t.name+"_"+Math.floor(n)+".jpeg",this.timestamp=n,this.maxWidth=a,this.maxHeight=r}return Object(k.a)(e,[{key:"base64",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(u.a)(s.a.mark((function e(n,a){var r,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._canvas();case 2:r=e.sent,i=r.toDataURL("image/jpeg"),n(i.substr(i.indexOf(",")+1));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(u.a)(s.a.mark((function e(n,a){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._canvas();case 2:e.sent.toBlob((function(e){t._blob=e,n(e)}),"image/jpeg");case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canvas();case 2:return t=e.sent,e.abrupt("return",t.toDataURL());case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_canvas",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(u.a)(s.a.mark((function e(n,a){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(r=t._videoElement(t.file)).oncanplay=function(){var e=Object(u.a)(s.a.mark((function e(a){var i,c,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=document.createElement("canvas")).width=r.videoWidth,i.height=r.videoHeight,(c=i.getContext("2d")).drawImage(r,0,0,i.width,i.height),!(t.maxWidth>0||t.maxHeight>0)){e.next=12;break}return o=new _,e.next=9,o.resize(i,c,t.maxWidth,t.maxHeight);case 9:n(i),e.next=13;break;case 12:n(i);case 13:URL.revokeObjectURL(r.src);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_videoElement",value:function(e){var t=document.createElement("video");return t.src=URL.createObjectURL(e),t.preload="none",t.currentTime=this.timestamp/1e3,t.load(),t}}]),e}(),B=function(){function e(t){Object(m.a)(this,e),this.data=t}return Object(k.a)(e,[{key:"name",get:function(){return this.data.name}},{key:"base64",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.base64();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.dataUrl();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:t=e.sent,n=window.URL.createObjectURL(t),a=document.createElement("a"),document.body.appendChild(a),a.style="display: none",a.href=n,a.download=this.data.name,a.click(),URL.revokeObjectURL(n),a.remove();case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"fromBase64",value:function(t,n,a,r){var i=t.substring(0,t.lastIndexOf("."))+"_"+Math.floor(n)+"."+r;return new e(new U(i,a,r))}},{key:"fromFile",value:function(t,n,a,r){return new e(new L(t,n,a,r))}}]),e}(),W=function(){function e(){Object(m.a)(this,e)}return Object(k.a)(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=Object(u.a)(s.a.mark((function e(t,n){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"POST",body:JSON.stringify(n)});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}]),e}(),H=['"',"*","_","\\",":"],z=[":","/","\\","<",">",'"',"|","?","*","^"],q=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new W;Object(m.a)(this,e),this.settingsProvider=t,this.fetcher=n}return Object(k.a)(e,[{key:"deckNames",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("deckNames",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelNames",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("modelNames",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelFieldNames",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("modelFieldNames",{modelName:t},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findNotesWithWord",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("findNotes",{query:this.settingsProvider.wordField+":"+this._escapeQuery(t)},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findNotesWithWordGui",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("guiBrowse",{query:this.settingsProvider.wordField+":"+this._escapeQuery(t)},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_escapeQuery",value:function(e){for(var t="",n=0;n<e.length;++n){var a=e[n];H.includes(a)?t+="\\".concat(a):t+=a}return'"'.concat(t,'"')}},{key:"requestPermission",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("requestPermission",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"export",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n,a,r,i,c,o,u,l){var d,b,f,h,j,p,v,g,O,m,k,x;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d={},this._appendField(d,this.settingsProvider.sentenceField,t,!0),this._appendField(d,this.settingsProvider.definitionField,n,!0),this._appendField(d,this.settingsProvider.wordField,i,!1),this._appendField(d,this.settingsProvider.sourceField,c,!1),o)for(b=0,f=Object.keys(o);b<f.length;b++)h=f[b],this._appendField(d,this.settingsProvider.customAnkiFields[h],o[h],!1);if(j={note:{deckName:this.settingsProvider.deck,modelName:this.settingsProvider.noteType,options:{allowDuplicate:!1,duplicateScope:"deck",duplicateScopeOptions:{deckName:this.settingsProvider.deck,checkChildren:!1}}}},p="gui"===u,!this.settingsProvider.audioField||!a){e.next=29;break}if(v=this._sanitizeFileName(a.name),!p){e.next=23;break}return e.t0=this,e.t1=v,e.next=15,a.base64();case 15:return e.t2=e.sent,e.t3=l,e.next=19,e.t0._storeMediaFile.call(e.t0,e.t1,e.t2,e.t3);case 19:g=e.sent.result,this._appendField(d,this.settingsProvider.audioField,"[sound:".concat(g,"]"),!1),e.next=29;break;case 23:return e.t4=v,e.next=26,a.base64();case 26:e.t5=e.sent,e.t6=[this.settingsProvider.audioField],j.note.audio={filename:e.t4,data:e.t5,fields:e.t6};case 29:if(!this.settingsProvider.imageField||!r){e.next=50;break}if(O=this._sanitizeFileName(r.name),!p){e.next=44;break}return e.t7=this,e.t8=O,e.next=36,r.base64();case 36:return e.t9=e.sent,e.t10=l,e.next=40,e.t7._storeMediaFile.call(e.t7,e.t8,e.t9,e.t10);case 40:m=e.sent.result,this._appendField(d,this.settingsProvider.imageField,'<div><img src="'.concat(m,'"></div>'),!1),e.next=50;break;case 44:return e.t11=O,e.next=47,r.base64();case 47:e.t12=e.sent,e.t13=[this.settingsProvider.imageField],j.note.picture={filename:e.t11,data:e.t12,fields:e.t13};case 50:j.note.fields=d,e.t14=u,e.next="gui"===e.t14?54:"updateLast"===e.t14?57:"default"===e.t14?67:70;break;case 54:return e.next=56,this._executeAction("guiAddCards",j,l);case 56:return e.abrupt("return",e.sent.result);case 57:return e.next=59,this._executeAction("findNotes",{query:"added:1"},l);case 59:if(0!==(k=e.sent.result.sort()).length){e.next=62;break}throw new Error("Could not find note to update");case 62:return x=k[k.length-1],j.note.id=x,e.next=66,this._executeAction("updateNoteFields",j,l);case 66:return e.abrupt("return",x);case 67:return e.next=69,this._executeAction("addNote",j,l);case 69:return e.abrupt("return",e.sent.result);case 70:throw new Error("Unknown export mode: "+u);case 71:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r,i,c,o,s,u){return e.apply(this,arguments)}}()},{key:"_appendField",value:function(e,t,n,a){if(t&&n){var r=a?n.split("\n").join("<br>"):n,i=e[t];i&&(r=i+"<br>"+r),e[t]=r}}},{key:"_sanitizeFileName",value:function(e){for(var t="",n=0;n<e.length;++n){var a=e[n];z.includes(a)?t+="_":t+=a}return t}},{key:"_storeMediaFile",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n,a){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAction("storeMediaFile",{filename:t,data:n},a));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"_executeAction",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n,a){var r,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={action:t,version:6},n&&(r.params=n),e.next=4,this.fetcher.fetch(a||this.settingsProvider.ankiConnectUrl,r);case 4:if(!(i=e.sent).error){e.next=7;break}throw new Error(i.error);case 7:return e.abrupt("return",i);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()}]),e}();function V(e){var t=Math.floor(e/1e3),n=t%60,a=Math.floor(t/60)%60,r=Math.floor(t/3600);return r>0?r+"h"+String(a).padStart(2,"0")+"m"+String(n).padStart(2,"0")+"s":a+"m"+String(n).padStart(2,"0")+"s"}function K(e,t,n,a){for(var r,i,c=t;c>=0&&!G(e,r=c,t,n,a,!1);--c);for(var o=t;o<=e.length-1&&!G(e,i=o,t,n,a,!0);++o);return e.slice(r,i+1)}function X(e,t,n){var a=[e];if(e.end<t){var r=Math.min(t,e.end+n);a.push({text:"",start:e.end,end:r,track:0})}if(e.start>0){var i=Math.max(0,e.start-n);a.unshift({text:"",start:i,end:e.start,track:0})}return a}function G(e,t,n,a,r,i){var c;return c=i?t+1<e.length?e[t+1]:null:t-1>=0?e[t-1]:null,Math.abs(n-t)>=a&&(null===c||Math.abs(c.start-e[n].start)>=r)}var J=n(344),Q=n(6),Y=n(342),Z=n(261),$=n(1),ee=Object(j.a)({root:{display:"flex",justifyContent:"center",position:"fixed",top:80,width:"100%",pointerEvents:"none",zIndex:2e3}});function te(e){var t=ee();return Object(a.useEffect)((function(){if(e.open){var t=setTimeout(e.onClose,e.autoHideDuration);return function(){return clearTimeout(t)}}return null}),[e.open,e.autoHideDuration,e.onClose]),Object($.jsx)("div",{className:t.root,children:Object($.jsx)(Z.a,{in:e.open,children:Object($.jsx)(Y.a,{severity:e.severity,children:e.children})})})}var ne=n(271),ae=n(321),re=n(315),ie=n(311),ce=n(320),oe=n(314),se=n(111),ue=n.n(se),le=n(319),de=n(262),be=n(318),fe=n(148),he=n.n(fe),je=n(147),pe=n.n(je),ve=n(89),ge=n.n(ve),Oe=n(347),me=n(313),ke=n(346),xe=n(55),ye=n(149),Ce=n.n(ye),we=Object(ne.a)((function(e){return{root:{"& .MuiTextField-root":{marginBottom:e.spacing(1)}},title:{flexGrow:1},mediaField:{cursor:"pointer","& input":{cursor:"pointer"}},rangeSelectSlider:{"& .MuiSlider-markLabel":{transform:"translateX(-3%)"}}}}));function Se(e,t){var n={};return e.subtitles.filter((function(e){return""!==e.text.trim()})).map((function(e){return e.start in n?null:(n[e.start]=!0,{value:e.start,label:"".concat(e.text.trim().substring(0,Math.min(e.text.length,3)),"...")})})).filter((function(e){return null!==e})).filter((function(e){return e.value>=t[0]&&e.value<=t[1]}))}function Te(e){var t=e.open,n=e.disabled,r=e.text,i=e.onProceed,c=e.onCancel,o=e.onViewImage,l=e.onOpenSettings,b=e.audioClip,h=e.image,j=e.source,p=e.sliderContext,v=e.customFields,g=e.settingsProvider,O=e.anki,m=we(),k=Object(a.useState)(""),x=Object(d.a)(k,2),y=x[0],C=x[1],w=Object(a.useState)(),S=Object(d.a)(w,2),T=S[0],F=S[1],E=Object(a.useState)(),I=Object(d.a)(E,2),M=I[0],P=I[1],R=Object(a.useState)(),D=Object(d.a)(R,2),A=D[0],N=D[1],_=Object(a.useState)(j),U=Object(d.a)(_,2),L=U[0],B=U[1],W=Object(a.useState)([]),H=Object(d.a)(W,2),z=H[0],q=H[1],V=Object(a.useState)(0),K=Object(d.a)(V,2),X=K[0],G=K[1],J=Object(a.useState)({}),Q=Object(d.a)(J,2),Y=Q[0],Z=Q[1],ee=Object(a.useState)(),te=Object(d.a)(ee,2),ne=te[0],se=te[1],fe=Object(a.useState)(),je=Object(d.a)(fe,2),ve=je[0],ye=je[1],Te=Object(a.useState)(),Fe=Object(d.a)(Te,2),Ee=Fe[0],Ie=Fe[1],Me=Object(a.useState)(),Pe=Object(d.a)(Me,2),Re=Pe[0],De=Pe[1],Ae=Object(a.useState)(),Ne=Object(d.a)(Ae,2),_e=Ne[0],Ue=Ne[1],Le=Object(a.useState)(),Be=Object(d.a)(Le,2),We=Be[0],He=Be[1],ze=Object(a.useState)(),qe=Object(d.a)(ze,2),Ve=qe[0],Ke=qe[1],Xe=Object(a.useState)(),Ge=Object(d.a)(Xe,2),Je=Ge[0],Qe=Ge[1];Object(a.useEffect)((function(){F(r),C(""),P(""),B(j),q([]),Z({})}),[r,j]),Object(a.useEffect)((function(){var e=p&&[p.subtitleStart,p.subtitleEnd],t=p&&function(e){var t,n=null,a=null,r=Object(f.a)(e.subtitles);try{for(r.s();!(t=r.n()).done;){var i=t.value;(null===n||i.start<n)&&(n=i.start),(null===a||i.end>a)&&(a=i.end)}}catch(c){r.e(c)}finally{r.f()}return null!==n&&null!==a&&[n,a]}(p);se(e),ye(e),He(e),Ke(e),De(t),Ie(t),Ue(p&&Se(p,t))}),[p]),Object(a.useEffect)((function(){if(b){var e=b;g.preferMp3&&(e=e.toMp3()),Ve&&(e=e.slice(Math.max(0,Math.round(Ve[0])-g.audioPaddingStart),Math.round(Ve[1])+g.audioPaddingEnd)),Qe(e)}else Qe(null)}),[b,g.preferMp3,Ve,g.audioPaddingStart,g.audioPaddingEnd]),Object(a.useEffect)((function(){G(Date.now())}),[M]),Object(a.useEffect)((function(){if(M&&g.wordField){var e=M.trim();if(""!==e&&e!==A){var t=setTimeout(Object(u.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=q,t.next=4,O.findNotesWithWord(e);case 4:t.t1=t.sent,(0,t.t0)(t.t1),N(e),t.next=12;break;case 9:t.prev=9,t.t2=t.catch(0),console.error(t.t2);case 12:case"end":return t.stop()}}),t,null,[[0,9]])}))),500);return function(){return clearTimeout(t)}}}}),[M,X,A,O,g.wordField]);var Ye,Ze=Object(a.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),Je.play()}),[Je]),$e=Object(a.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),o(h)}),[h,o]),et=Object(a.useCallback)((function(e,t){se(t)}),[]),tt=Object(a.useCallback)((function(){var e,t=[],n=Object(f.a)(p.subtitles);try{for(n.s();!(e=n.n()).done;){var a=e.value;(a.start>=ne[0]&&a.start<=ne[1]||a.end>=ne[0]&&a.end<=ne[1]||ne[0]>=a.start&&ne[0]<=a.end||ne[1]>=a.start&&ne[1]<=a.end)&&t.push(a.text)}}catch(r){n.e(r)}finally{n.f()}F(t.join("\n")),He(ne)}),[ne,p]),nt=Object(a.useCallback)((function(e){e.stopPropagation(),Ke(ne)}),[ne]),at=Object(a.useCallback)((function(){se(ve),De(Ee),Ue(p&&Se(p,Ee))}),[ve,Ee,p]),rt=Object(a.useCallback)((function(){var e=[(Re[0]+ne[0])/2,(Re[1]+ne[1])/2];De(e),Ue(p&&Se(p,e))}),[Re,ne,p]),it=Object(a.useCallback)((function(e,t){var n={};Object.assign(n,Y),n[e]=t,Z(n)}),[Y]);Ye=M&&M.trim()===A&&g.wordField?z.length>0?"Found ".concat(z.length,' notes with word "').concat(M,'" in field "').concat(g.wordField,'"'):'No notes found with word "'.concat(M.trim(),'" in field "').concat(g.wordField,'"'):"";var ct=!p||0===p.subtitles.filter((function(e){return""!==e.text.trim()})).length;return Object($.jsxs)(ie.a,{open:t,disableEnforceFocus:!0,fullWidth:!0,maxWidth:"sm",onBackdropClick:c,onEscapeKeyDown:c,children:[Object($.jsxs)(me.a,{children:[Object($.jsx)(xe.a,{variant:"h6",className:m.title,children:"Anki Export"}),Object($.jsx)(de.a,{edge:"end",onClick:function(){return l()},children:Object($.jsx)(ge.a,{})})]}),Object($.jsx)(oe.a,{children:Object($.jsxs)("form",{className:m.root,children:[Object($.jsx)(re.a,{variant:"filled",color:"secondary",multiline:!0,fullWidth:!0,rowsMax:8,label:"Sentence",value:T,onChange:function(e){return F(e.target.value)},InputProps:{endAdornment:ne&&Object($.jsx)(be.a,{position:"end",children:Object($.jsx)(ke.a,{title:"Apply Selection",children:Object($.jsx)("span",{children:Object($.jsx)(de.a,{disabled:ne[0]===We[0]&&ne[1]===We[1]||ct,onClick:tt,edge:"end",children:Object($.jsx)(ue.a,{})})})})})}}),Object($.jsx)(re.a,{variant:"filled",color:"secondary",multiline:!0,fullWidth:!0,rows:8,label:"Definition",value:y,onChange:function(e){return C(e.target.value)}}),Object($.jsx)(re.a,{variant:"filled",color:"secondary",fullWidth:!0,label:"Word",value:M,onChange:function(e){return P(e.target.value)},helperText:Ye,InputProps:{endAdornment:Object($.jsx)(be.a,{position:"end",children:Object($.jsx)(ke.a,{title:"Search in Anki",children:Object($.jsx)("span",{children:Object($.jsx)(de.a,{disabled:n||!g.wordField||!M||""===M.trim(),onClick:function(){return O.findNotesWithWordGui(M.trim())},edge:"end",children:Object($.jsx)(pe.a,{})})})})})}}),Object.keys(v).map((function(e){return Object($.jsx)(re.a,{variant:"filled",color:"secondary",fullWidth:!0,multiline:!0,rowsMax:8,label:e,value:Y[e]||"",onChange:function(t){return it(e,t.target.value)}},e)})),Je&&Object($.jsx)("div",{className:m.mediaField,onClick:Ze,children:Object($.jsx)(re.a,{variant:"filled",color:"secondary",fullWidth:!0,value:Je.name,label:"Audio",InputProps:{endAdornment:ne&&Object($.jsx)(be.a,{position:"end",children:Object($.jsx)(ke.a,{title:"Apply Selection",children:Object($.jsx)("span",{children:Object($.jsx)(de.a,{disabled:ne[0]===Ve[0]&&ne[1]===Ve[1]||!Je.isSliceable(ne[0],ne[1]),onClick:nt,edge:"end",children:Object($.jsx)(ue.a,{})})})})})}})}),h&&Object($.jsx)("div",{className:m.mediaField,onClick:$e,children:Object($.jsx)(re.a,{variant:"filled",color:"secondary",fullWidth:!0,value:h.name,label:"Image"})}),Object($.jsx)(re.a,{variant:"filled",color:"secondary",fullWidth:!0,label:"Source",value:L,onChange:function(e){return B(e.target.value)}}),ne&&Re&&_e&&Object($.jsxs)(le.a,{container:!0,direction:"row",children:[Object($.jsx)(le.a,{item:!0,style:{flexGrow:1},children:Object($.jsx)(Oe.a,{value:ne,onChange:et,min:Re[0],max:Re[1],marks:_e,step:1,valueLabelDisplay:"off",className:m.rangeSelectSlider,color:"secondary"})}),Object($.jsx)(le.a,{item:!0,children:Object($.jsx)(ke.a,{title:"Reset",children:Object($.jsx)("span",{children:Object($.jsx)(de.a,{edge:"end",style:{marginTop:-8},onClick:at,children:Object($.jsx)(he.a,{})})})})}),Object($.jsx)(le.a,{item:!0,children:Object($.jsx)(ke.a,{title:"Zoom In",children:Object($.jsx)("span",{children:Object($.jsx)(de.a,{edge:"end",style:{marginTop:-8},onClick:rt,children:Object($.jsx)(Ce.a,{})})})})})]})]})}),Object($.jsxs)(ce.a,{children:[Object($.jsx)(ae.a,{disabled:n,onClick:function(){return c()},children:"Cancel"}),Object($.jsx)(ae.a,{disabled:n,onClick:function(){return i(T,y,Je,h,M,L,Y,"gui")},children:"Open in Anki"}),Object($.jsx)(ae.a,{disabled:n,onClick:function(){return i(T,y,Je,h,M,L,Y,"updateLast")},children:"Update Last Card"}),Object($.jsx)(ae.a,{disabled:n,onClick:function(){return i(T,y,Je,h,M,L,Y,"default")},children:"Export"})]})]})}var Fe=n(340),Ee=n(181),Ie=n.p+"static/media/background-colored.b54dc59d.png",Me=Object(ne.a)((function(e){return{root:function(e){return{position:"absolute",height:"calc(100% - 64px)",width:"100%",zIndex:101,pointerEvents:e.dragging?"auto":"none"}},transparentBackground:{"&::before":{content:"' '",position:"absolute",height:"calc(100vh - 64px)",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",backgroundSize:"350px 450px",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundImage:"url(".concat(Ie,")"),backgroundBlendMode:"overlay",background:"rgba(0, 0, 0, .3)",filter:"drop-shadow(10px 10px 10px rgb(0, 0, 0, .4))"},width:"100%",height:"100%"}}}));function Pe(e){var t=e.dragging,n=e.loading,a=Me({dragging:t});return Object($.jsx)("div",{className:a.root,children:Object($.jsx)(Ee.a,{in:t||n,children:Object($.jsx)("div",{className:a.transparentBackground})})})}var Re=n(322),De=n(91),Ae=n.n(De),Ne=n(90),_e=n.n(Ne),Ue=n(324),Le=n(325),Be=n(323),We=n(327),He=n(326),ze=Object(ne.a)((function(e){return{inlineIcon:{maxWidth:"80%",height:20,display:"inline-flex",flexDirection:"column",flexWrap:"wrap",alignItems:"start",textAlign:"left"}}}));function qe(e){var t=ze(),n=e.open,a=e.extensionUrl,r=e.onClose;return Object($.jsxs)(ie.a,{open:n,onBackdropClick:r,onEscapeKeyDown:r,children:[Object($.jsxs)(oe.a,{children:[Object($.jsx)(xe.a,{variant:"h6",children:"Loading files"}),Object($.jsxs)(xe.a,{component:"ul",children:[Object($.jsx)("li",{children:"Drag and drop mkv, srt, ass, or mp3 files into the player."}),Object($.jsx)("li",{children:"Multiple files can be dragged and dropped simultaneously e.g. mkv+srt, mp3+ass etc."}),Object($.jsx)("li",{children:"Multiple subtitle files can loaded simultaneously. When multiple subtitle files are loaded, they can be toggled on and off in-video using S+1, S+2, etc."})]}),Object($.jsx)("br",{}),Object($.jsx)(xe.a,{variant:"h6",children:"Syncing with streaming video in another tab"}),Object($.jsxs)(xe.a,{component:"ul",children:[Object($.jsxs)("li",{children:["Install the Chrome ",Object($.jsx)(Re.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:a,children:"extension"}),"."]}),Object($.jsx)("li",{children:"Drag-and-drop a subtitle file into the video element you want to sync."}),Object($.jsx)("li",{children:"Or, load a subtitle file into asbplayer and use the camera button in the bottom right."}),Object($.jsx)("li",{children:"It is recommended to use the extension keyboard shortcut (Ctrl+Shift+X by default) to mine subtitles since that will include audio/screenshots."})]}),Object($.jsx)("br",{}),Object($.jsx)(xe.a,{variant:"h6",children:"Anki"}),Object($.jsxs)(xe.a,{component:"ul",children:[Object($.jsx)("li",{children:"Synchronous workflow:"}),Object($.jsxs)("ul",{children:[Object($.jsx)("li",{children:"For synced streaming video, open the Anki dialog during playback by using Ctrl+Shift+X."}),Object($.jsx)("li",{children:"For local file playback, open the Anki dialog during playback by using Ctrl+Shift+Q."})]}),Object($.jsx)("li",{children:"Asynchronous workflow:"}),Object($.jsxs)("ul",{children:[Object($.jsx)("li",{children:"For synced streaming video, copy the current subtitle by using Ctrl+Shift+Z."}),Object($.jsx)("li",{children:"For local file playback, copy the current subtitle by using Ctrl+Shift+A."}),Object($.jsx)("li",{children:Object($.jsxs)("div",{className:t.inlineIcon,children:["Use the \xa0",Object($.jsx)(_e.a,{fontSize:"small"}),"\xa0 button in the copy history."]})})]}),Object($.jsx)("li",{children:"For synced streaming video, an audio/image will only be available if an extension keyboard shortcut was used (Ctrl+Shift+X or Ctrl+Shift+Z by default)."}),Object($.jsxs)("li",{children:["Configure Anki settings with the settings button in the top right. See this ",Object($.jsx)(Re.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://youtu.be/Mv7fEVb6PHo?t=44",children:"video"})," for how to configure AnkiConnect so that asbplayer can connect to Anki."]})]}),Object($.jsx)("br",{}),Object($.jsx)(xe.a,{variant:"h6",children:"Changing subtitle offset"}),Object($.jsxs)(xe.a,{component:"ul",children:[Object($.jsx)("li",{children:"Use Ctrl+Left/Right to cause the previous/next subtitle to appear at the current timestamp."}),Object($.jsx)("li",{children:"Use Ctrl+Shift+Left/Right to adjust timing further by 100 ms increments."}),Object($.jsx)("li",{children:"Or, click on the subtitle offset input field in the controls, type a number, and hit Enter."})]}),Object($.jsx)("br",{}),Object($.jsx)(xe.a,{variant:"h6",children:"Condensed playback of local media files"}),Object($.jsxs)(xe.a,{component:"ul",children:[Object($.jsx)("li",{children:"Load an audio/video file with a subtitle file."}),Object($.jsx)("li",{children:Object($.jsxs)("div",{className:t.inlineIcon,children:["Use the \xa0",Object($.jsx)(Ae.a,{fontSize:"small"}),"\xa0 button in the bottom right."]})})]}),Object($.jsx)("br",{}),Object($.jsx)(xe.a,{variant:"h6",children:"Keyboard shortcuts"}),Object($.jsx)(Be.a,{children:Object($.jsx)(Ue.a,{size:"small",children:Object($.jsxs)(Le.a,{children:[Object($.jsxs)(He.a,{children:[Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Ctrl+Shift+A"})}),Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Copy current subtitle"})})]}),Object($.jsxs)(He.a,{children:[Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Ctrl+Shift+Q"})}),Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Copy current subtitle and open Anki export dialog"})})]}),Object($.jsxs)(He.a,{children:[Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Ctrl+Shift+Z"})}),Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Copy current subtitle (streaming video in another tab)"})})]}),Object($.jsxs)(He.a,{children:[Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Ctrl+Shift+X"})}),Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Copy current subtitle and open Anki export dialog (streaming video in another tab)"})})]}),Object($.jsxs)(He.a,{children:[Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Space"})}),Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Play/pause"})})]}),Object($.jsxs)(He.a,{children:[Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"S"})}),Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Toggle subtitles"})})]}),Object($.jsxs)(He.a,{children:[Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"S+1, S+2..."})}),Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Toggle subtitle track 1, 2... in video"})})]}),Object($.jsxs)(He.a,{children:[Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"D+1, D+2..."})}),Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Toggle subtitle track 1, 2... in asbplayer"})})]}),Object($.jsxs)(He.a,{children:[Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Left/Right"})}),Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Seek to previous/next subtitle"})})]}),Object($.jsxs)(He.a,{children:[Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Ctrl+Left/Right or Shift+Left/Right"})}),Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Adjust offset to previous/next subtitle"})})]}),Object($.jsxs)(He.a,{children:[Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Ctrl+Shift+Left/Right"})}),Object($.jsx)(We.a,{children:Object($.jsx)(xe.a,{children:"Adjust offset by +/- 100 ms"})})]})]})})}),Object($.jsx)("br",{}),Object($.jsx)(xe.a,{variant:"h6",children:"Common issues"}),Object($.jsxs)(xe.a,{component:"ul",children:[Object($.jsx)("li",{children:"asbplayer isn't detecting streaming video."}),Object($.jsxs)("ul",{children:[Object($.jsx)("li",{children:"Try refreshing both the asbplayer tab and the video in the other tab."}),Object($.jsx)("li",{children:"Make sure that in the extension details, the extension has access to all sites. A lot of video players are loaded inside of iframes, so it's difficult to list every single URL that the extension might need access to."})]}),Object($.jsx)("li",{children:"The extension keyboard shortcuts aren't working."}),Object($.jsxs)("ul",{children:[Object($.jsx)("li",{children:"Try uninstalling and reinstalling the extension and restarting Chrome."}),Object($.jsx)("li",{children:"Make sure the extension isn't installed twice."}),Object($.jsxs)("li",{children:["Verify the keyboard shortcut is bound as in this ",Object($.jsx)(Re.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://youtu.be/wYWbgovfNlI",children:"video"}),"."]})]}),Object($.jsx)("li",{children:"asbplayer can't connect to Anki. It shows an error message e.g. 'Failed to fetch.'"}),Object($.jsxs)("ul",{children:[Object($.jsx)("li",{children:"If you're using Brave, make sure asbplayer isn't being blocked by Shield."}),Object($.jsxs)("li",{children:["Make sure that asbplayer is allowed by AnkiConnect, as in this ",Object($.jsx)(Re.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://youtu.be/Mv7fEVb6PHo?t=44",children:"video"}),"."]}),Object($.jsx)("li",{children:"Check that your browser or an ad blocker isn't blocking the request. A good place to start is by opening your browser's developer console and looking for errors."})]}),Object($.jsx)("li",{children:"When mining streaming video, asbplayer isn't including audio/screenshot in flashcards."}),Object($.jsx)("ul",{children:Object($.jsx)("li",{children:"Make sure you use an extension keyboard shortcut (Ctrl+Shift+X by default)."})})]}),Object($.jsx)(xe.a,{variant:"h6",children:"Demos"}),Object($.jsxs)(xe.a,{component:"ul",children:[Object($.jsx)("li",{children:Object($.jsx)(Re.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://www.youtube.com/watch?v=W9Lf3C7sRzc",children:"Sentence mining streaming video (synchronous workflow)"})}),Object($.jsx)("li",{children:Object($.jsx)(Re.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://www.youtube.com/watch?v=kJXVVixD8H8",children:"Sentence mining streaming video (asynchronous workflow)"})}),Object($.jsx)("li",{children:Object($.jsx)(Re.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://www.youtube.com/watch?v=J3E82spYqIk",children:"Sentence mining video files (synchronous workflow)"})}),Object($.jsx)("li",{children:Object($.jsx)(Re.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://www.youtube.com/watch?v=HsrrpnfM4pI",children:"Sentence mining video files (asynchronous workflow)"})})]}),Object($.jsx)("br",{}),Object($.jsx)(xe.a,{variant:"h6",children:"Browser Compatibility"}),Object($.jsxs)(xe.a,{component:"ul",children:[Object($.jsx)("li",{children:"The asbplayer application and extension have only been tested on Chrome 91 and later and likely work on other Chromium-based browsers."}),Object($.jsxs)("li",{children:["Local file playback is supported only for codecs supported by the browser. The ",Object($.jsx)(Re.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://github.com/animebook/animebook.github.io#video-format-support",children:"animebook"})," readme has a detailed explanation of this and links to browsers that have good compatibility. Personally, I use Microsoft Edge and paid one dollar for HEVC support."]}),Object($.jsx)("li",{children:"Audio track selection for mkv files is available if experimental web platform features are enabled from chrome://flags."})]})]}),Object($.jsx)(ce.a,{children:Object($.jsx)(ae.a,{onClick:function(){return r()},children:"OK"})})]})}var Ve=n(328),Ke=n(329),Xe=Object(ne.a)((function(e){return{image:function(e){return{width:e.width,height:e.height,backgroundSize:"contain"}}}}));function Ge(e){var t,n=e.open,r=e.image,i=e.onClose,c=Object(a.useState)(),o=Object(d.a)(c,2),l=o[0],b=o[1],f=Object(a.useState)(),h=Object(d.a)(f,2),j=h[0],p=h[1],v=Object(a.useState)(),O=Object(d.a)(v,2),m=O[0],k=O[1],x=g(!0),y=Object(d.a)(x,2),C=y[0],w=y[1];t=j>0&&m>0?Math.min(1,Math.min(C/(2*j),w/(2*m))):1;var S=Xe({width:j*t,height:m*t});return Object(a.useEffect)((function(){function e(){return(e=Object(u.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.dataUrl();case 2:t=e.sent,(n=new Image).onload=function(){p(n.width),k(n.height),b(t)},n.src=t;case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}r&&(b(null),function(){e.apply(this,arguments)}())}),[r]),r&&l?Object($.jsx)(ie.a,{open:n,onBackdropClick:i,onEscapeKeyDown:i,maxWidth:"lg",children:Object($.jsx)(Ve.a,{children:Object($.jsx)(Ke.a,{className:S.image,image:l,title:r.name,style:{width:j*t,height:m*t}})})}):null}var Je=n(150),Qe=n(341),Ye=n(112),Ze=function(){function e(){Object(m.a)(this,e)}return Object(k.a)(e,[{key:"subtitles",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e,t){return n._subtitles(e,t)})));case 2:return e.abrupt("return",e.sent.flatMap((function(e){return e})).sort((function(e,t){return e.start-t.start})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_subtitles",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n){var a,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.name.endsWith(".srt")){e.next=7;break}return e.t0=Je.a,e.next=4,t.text();case 4:return e.t1=e.sent,a=(0,e.t0)(e.t1),e.abrupt("return",a.map((function(e){return Object(l.a)(Object(l.a)({},e.data),{},{track:n})})));case 7:if(!t.name.endsWith(".vtt")){e.next=9;break}return e.abrupt("return",new Promise(function(){var e=Object(u.a)(s.a.mark((function e(a,r){var i,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new Ye.WebVTT.Parser(window,Ye.WebVTT.StringDecoder()),c=[],i.oncue=function(e){return c.push(e)},i.onflush=function(){return a(c.map((function(e){return{start:Math.floor(1e3*e.startTime),end:Math.floor(1e3*e.endTime),text:e.text,track:n}})))},e.t0=i,e.next=7,t.text();case 7:e.t1=e.sent,e.t0.parse.call(e.t0,e.t1),i.flush();case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 9:if(!t.name.endsWith(".ass")){e.next=16;break}return e.t2=Qe.a,e.next=13,t.text();case 13:return e.t3=e.sent,r=(0,e.t2)(e.t3),e.abrupt("return",r.events.dialogue.map((function(e){return{start:Math.round(1e3*e.Start),end:Math.round(1e3*e.End),text:e.Text.combined,track:n}})));case 16:throw new Error("Unsupported subtitle file format");case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),$e=n(95),et=n(330),tt=n(155),nt=n.n(tt),at=n(156),rt=n.n(at),it=n(154),ct=n.n(it),ot=n(157),st=n.n(ot),ut=["show"],lt=Object(j.a)((function(e){return{title:{flexGrow:1},appBar:{transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{width:function(e){var t=e.drawerWidth;return"calc(100% - ".concat(t,"px)")},transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:function(e){return e.drawerWidth}},copyHistoryButton:{transform:"scaleX(1)",width:48,padding:12,transition:e.transitions.create(["transform","padding","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},copyHistoryButtonShift:{transform:"scaleX(0)",width:0,padding:5,transition:e.transitions.create(["transform","padding","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},hide:{display:"none"}}})),dt=Object(j.a)((function(e){return{tooltip:function(e){return{display:e.show?"block":"none"}}}}));function bt(e){var t=e.show,n=Object($e.a)(e,ut),a=dt({show:t});return Object($.jsx)(ke.a,Object(l.a)({classes:a},n))}function ft(e){var t=lt(e);return Object($.jsx)(et.a,{position:"static",elevation:0,className:Object(Q.a)(t.appBar,Object(b.a)({},t.appBarShift,e.drawerOpen)),children:Object($.jsxs)(me.a,{children:[Object($.jsx)(ke.a,{title:"Open Files",children:Object($.jsx)(de.a,{edge:"start",color:"inherit",onClick:e.onFileSelector,children:Object($.jsx)(ct.a,{})})}),Object($.jsx)(xe.a,{variant:"h6",className:t.title,children:e.title}),Object($.jsx)(ke.a,{title:"Submit Issue",children:Object($.jsx)(de.a,{edge:"end",color:"inherit",component:"a",href:"https://github.com/killergerbah/asbplayer/issues",target:"_blank",rel:"noreferrer",children:Object($.jsx)(nt.a,{})})}),Object($.jsx)(ke.a,{title:"Help",children:Object($.jsx)(de.a,{edge:"end",color:"inherit",onClick:e.onOpenHelp,children:Object($.jsx)(rt.a,{})})}),Object($.jsx)(ke.a,{title:"Settings",children:Object($.jsx)(de.a,{edge:"end",color:"inherit",onClick:e.onOpenSettings,children:Object($.jsx)(ge.a,{})})}),Object($.jsx)(bt,{title:"Copy History",show:!e.drawerOpen,children:Object($.jsx)(de.a,{edge:"end",color:"inherit","aria-label":"menu",className:Object(Q.a)(t.copyHistoryButton,Object(b.a)({},t.copyHistoryButtonShift,e.drawerOpen)),onClick:e.onOpenCopyHistory,children:Object($.jsx)(st.a,{})})})]})})}var ht=function(){function e(t){var n=this;Object(m.a)(this,e),this.onMessageCallbacks=[],this.onTabsCallbacks=[],this.tabs=[],this.versionPromise=new Promise((function(e,t){n.versionResolve=e})),this.id=Object(J.a)(),window.addEventListener("message",(function(e){if(e.source===window&&"asbplayer-extension-to-player"===e.data.sender&&e.data.message){if("tabs"===e.data.message.command){n.tabs=e.data.message.tabs;var t,a=Object(f.a)(n.onTabsCallbacks);try{for(a.s();!(t=a.n()).done;){(0,t.value)(n.tabs)}}catch(c){a.e(c)}finally{a.f()}return}if("version"===e.data.message.command)return void n.versionResolve(e.data.message.version);var r,i=Object(f.a)(n.onMessageCallbacks);try{for(i.s();!(r=i.n()).done;){(0,r.value)({data:e.data.message,tabId:e.data.tabId,src:e.data.src})}}catch(c){i.e(c)}finally{i.f()}}})),t&&(this._sendHeartbeat(),setInterval((function(){return n._sendHeartbeat()}),1e3))}return Object(k.a)(e,[{key:"_sendHeartbeat",value:function(){window.postMessage({sender:"asbplayerv2",message:{command:"heartbeat",id:this.id}},"*")}},{key:"installedVersion",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.versionPromise;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(e,t,n){window.postMessage({sender:"asbplayer",message:e,tabId:t,src:n},"*")}},{key:"publishMessage",value:function(e){var t,n=Object(f.a)(this.tabs);try{for(n.s();!(t=n.n()).done;){var a=t.value;window.postMessage({sender:"asbplayer",message:e,tabId:a.id,src:a.src},"*")}}catch(r){n.e(r)}finally{n.f()}}},{key:"subscribeTabs",value:function(e){this.onTabsCallbacks.push(e)}},{key:"unsubscribeTabs",value:function(e){this._remove(e,this.onTabsCallbacks)}},{key:"subscribe",value:function(e){this.onMessageCallbacks.push(e)}},{key:"unsubscribe",value:function(e){this._remove(e,this.onMessageCallbacks)}},{key:"_remove",value:function(e,t){for(var n=t.length-1;n>=0;--n)if(e===t[n]){t.splice(n,1);break}}}]),e}();function jt(e){var t=e.subtitleColor,n=e.subtitleSize,a=e.subtitleOutlineThickness,r=e.subtitleOutlineColor,i=e.subtitleBackgroundOpacity,c=e.subtitleBackgroundColor,o=e.subtitleFontFamily,s={color:t,fontSize:Number(n)};if(a>0){var u=a,l=r;s.textShadow="0 0 ".concat(u,"px ").concat(l,", 0 0 ").concat(u,"px ").concat(l,", 0 0 ").concat(u,"px ").concat(l,", 0 0 ").concat(u,"px ").concat(l)}if(i>0){var d=i,b=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}}(c),f=b.r,h=b.g,j=b.b;s.backgroundColor="rgba(".concat(f,", ").concat(h,", ").concat(j,", ").concat(d,")")}return o&&o.length>0&&(s.fontFamily=o),s}function pt(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e<0)return pt(0,t);var a=(e=Math.round(e))%1e3,r=(e=(e-a)/1e3)%60,i=(e=(e-r)/60)%60;if(t>=36e5){var c=(e-i)/60;return n?vt(c)+":"+vt(i)+":"+vt(r)+"."+gt(a):vt(c)+":"+vt(i)+":"+vt(r)}return n?vt(i)+":"+vt(r)+"."+gt(a):vt(i)+":"+vt(r)}function vt(e){return String(e).padStart(2,"0")}function gt(e){return String(e).padEnd(3,"0")}var Ot=n(334),mt=n(348),kt=n(159),xt=n.n(kt),yt=n(317),Ct=n(270),wt=n(333),St=n(331),Tt=n(332),Ft=n(316),Et=n(158),It=n.n(Et),Mt=Object(j.a)((function(e){return{drawer:{width:function(e){return e.drawerWidth},flexShrink:0},drawerPaper:{width:function(e){return e.drawerWidth}},drawerHeader:Object(l.a)(Object(l.a)({display:"flex",alignItems:"center",position:"static",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-start"}),listContainer:{position:"relative",height:"100%",overflowY:"auto",overflowX:"hidden"},listItem:{"&:hover":{backgroundColor:e.palette.action.hover}},listItemGutters:{paddingLeft:5,paddingRight:5},listItemIconRoot:{minWidth:20},emptyState:{display:"flex",justifyContent:"center",flexDirection:"column",textAlign:"center",height:"100%",padding:15},text:{flexGrow:1},emptyText:{flexGrow:1,color:e.palette.text.secondary},timestamp:{paddingRight:15,paddingLeft:15,color:e.palette.text.secondary}}}));function Pt(e){var t=e.open,n=e.anchorEl,r=e.onClose,i=e.onSelect,c=e.onClipAudio,o=e.onDownloadImage,s=e.onDelete,u=e.item,l=Object(a.useCallback)((function(){navigator.clipboard.writeText(u.text),r()}),[u,r]),d=Object(a.useCallback)((function(){i(u),r()}),[u,i,r]),b=Object(a.useCallback)((function(){c(u),r()}),[u,c,r]),f=Object(a.useCallback)((function(){o(u),r()}),[u,o,r]),h=Object(a.useCallback)((function(){s(u),r()}),[u,s,r]);return u?Object($.jsx)(Ft.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:r,anchorOrigin:{vertical:"center",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"right"},children:Object($.jsxs)(yt.a,{children:[Object($.jsx)(Ct.a,{button:!0,onClick:l,children:Object($.jsx)(St.a,{primaryTypographyProps:{variant:"body2"},primary:"Copy"})}),Object($.jsx)(Ct.a,{button:!0,onClick:d,children:Object($.jsx)(St.a,{primaryTypographyProps:{variant:"body2"},primary:"Jump To"})}),(u.videoFile||u.audioFile||u.audio)&&Object($.jsx)(Ct.a,{button:!0,onClick:b,children:Object($.jsx)(St.a,{primaryTypographyProps:{variant:"body2"},primary:"Download Audio"})}),(u.videoFile||u.image)&&Object($.jsx)(Ct.a,{button:!0,onClick:f,children:Object($.jsx)(St.a,{primaryTypographyProps:{variant:"body2"},primary:"Download Image"})}),Object($.jsx)(Ct.a,{button:!0,onClick:h,children:Object($.jsx)(St.a,{primaryTypographyProps:{variant:"body2"},primary:"Delete"})})]})}):null}function Rt(e){var t,n=Mt(e),i=Object(a.useCallback)((function(e){e&&e.scrollIntoView()}),[]),c=Object(a.useState)(),o=Object(d.a)(c,2),s=o[0],u=o[1],l=Object(a.useState)(!1),b=Object(d.a)(l,2),h=b[0],j=b[1],p=Object(a.useState)(),v=Object(d.a)(p,2),g=v[0],O=v[1],m=Object(a.useCallback)((function(e,t){u(t),j(!0),O(e.currentTarget)}),[]),k=Object(a.useCallback)((function(e,t){u(null),j(!1),O(null)}),[]),x=Object(a.useCallback)((function(t){e.onDelete(t)}),[e]);if(e.items.length>0){var y,C=[],w=null,S=0,T={},F=Object(f.a)(e.items);try{var E=function(){var t=y.value;null!==w&&w===t.name||(t.name in T?T[t.name]++:T[t.name]=0,w=t.name,C.push(Object($.jsx)(Tt.a,{disableSticky:!0,children:t.name},t.name+"-"+T[t.name])));var a=S===e.items.length-1?i:null;C.push(Object($.jsxs)(Ct.a,{ref:a,className:n.listItem,classes:{gutters:n.listItemGutters},children:[Object($.jsx)(wt.a,{classes:{root:n.listItemIconRoot},children:Object($.jsx)(ke.a,{title:"Export to Anki",children:Object($.jsx)(de.a,{onClick:function(){return e.onAnki(t)},children:Object($.jsx)(_e.a,{fontSize:"small"})})})}),Object($.jsx)(wt.a,{classes:{root:n.listItemIconRoot},children:Object($.jsx)(de.a,{onClick:function(e){return m(e,t)},children:Object($.jsx)(It.a,{fontSize:"small"})})}),Object($.jsx)(St.a,{primary:Object($.jsxs)(le.a,{wrap:"nowrap",container:!0,children:[Object($.jsx)(le.a,{item:!0,className:""===t.text?n.emptyText:n.text,children:""===t.text?"No text":t.text}),Object($.jsx)(le.a,{item:!0,className:n.timestamp,children:pt(t.start,t.start,!1)})]})})]},t.id)),++S};for(F.s();!(y=F.n()).done;)E()}catch(I){F.e(I)}finally{F.f()}t=Object($.jsx)("div",{className:n.listContainer,children:Object($.jsx)(yt.a,{children:C})})}else t=Object($.jsxs)("div",{className:n.emptyState,children:[Object($.jsx)(xe.a,{variant:"h6",children:"Copy history is empty."}),Object($.jsx)(xe.a,{variant:"caption",children:"See the help for keyboard shortcuts."})]});return Object($.jsxs)(r.a.Fragment,{children:[Object($.jsxs)(mt.a,{variant:"persistent",anchor:"right",open:e.open,className:n.drawer,classes:{paper:n.drawerPaper},children:[Object($.jsx)("div",{className:n.drawerHeader,children:Object($.jsx)(de.a,{onClick:e.onClose,children:Object($.jsx)(xt.a,{})})}),Object($.jsx)(Ot.a,{}),t]}),Object($.jsx)(Pt,{open:e.open&&h,anchorEl:g,item:s,onClose:k,onSelect:e.onSelect,onClipAudio:e.onClipAudio,onDownloadImage:e.onDownloadImage,onDelete:x})]})}var Dt=n(160),At=n.n(Dt),Nt=Object(ne.a)((function(e){return{background:{position:"absolute",height:"calc(100vh - 64px)",width:"100%",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center"},browseLink:{cursor:"pointer"}}}));function _t(e){var t=e.extension,n=e.latestExtensionVersion,i=e.extensionUrl,c=e.loading,o=e.dragging,l=e.onFileSelector,b=Nt(),f=Object(a.useState)(),h=Object(d.a)(f,2),j=h[0],p=h[1];Object(a.useEffect)((function(){function e(){return(e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=p,e.next=3,t.installedVersion();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t]);var v=j&&At()(n,j),g=!j;return Object($.jsx)(r.a.Fragment,{children:Object($.jsx)(Ee.a,{in:!c&&!o,timeout:500,children:Object($.jsx)("div",{className:b.background,children:Object($.jsxs)(xe.a,{variant:"h6",children:["Drag and drop subtitle and media files, or ",Object($.jsx)(Re.a,{target:"#",className:b.browseLink,onClick:l,color:"secondary",component:"label",children:"browse"}),".",Object($.jsx)("br",{}),g&&Object($.jsxs)("span",{children:["Install the ",Object($.jsx)(Re.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:i,children:"Chrome extension"})," to sync subtitles with streaming video."]}),v&&Object($.jsxs)("span",{children:["An extension ",Object($.jsx)(Re.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:i,children:"update"})," is available."]})]})})})})}var Ut=function(){function e(t){Object(m.a)(this,e),this.channel=new BroadcastChannel(t);var n=this;this.channel.onmessage=function(e){var t;null===(t=n.onMessage)||void 0===t||t.call(n,e)}}return Object(k.a)(e,[{key:"postMessage",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage(e)}},{key:"close",value:function(){var e;null===(e=this.channel)||void 0===e||e.close(),this.channel=null}}]),e}(),Lt=function(){function e(t,n,a){var r=this;Object(m.a)(this,e),this.tabId=t,this.src=n,this.listener=function(e){var a;e.tabId!==t||e.src&&e.src!==n||(null===(a=r.onMessage)||void 0===a||a.call(r,{data:e.data}))},a.subscribe(this.listener),this.extension=a}return Object(k.a)(e,[{key:"postMessage",value:function(e){this.extension.sendMessage(e,this.tabId,this.src)}},{key:"close",value:function(){this.extension.unsubscribe(this.listener)}}]),e}(),Bt=function(){function e(){Object(m.a)(this,e),this.accumulated=0,this.started=!1}return Object(k.a)(e,[{key:"time",value:function(e){return this.started?Math.min(e,this.accumulated+Date.now()-this.startTime):Math.min(e,this.accumulated)}},{key:"stop",value:function(){this.started&&(this.started=!1,this.accumulated+=Date.now()-this.startTime)}},{key:"start",value:function(){this.startTime=Date.now(),this.started=!0}},{key:"setTime",value:function(e){this.started?(this.startTime=Date.now(),this.accumulated=e):this.accumulated=e}},{key:"progress",value:function(e){return 0===e?0:Math.min(1,this.time(e)/e)}}]),e}(),Wt=n(7),Ht=n(162),zt=n.n(Ht),qt=n(163),Vt=n.n(qt),Kt=n(169),Xt=n.n(Kt),Gt=n(161),Jt=n.n(Gt),Qt=n(264),Yt=n(171),Zt=n.n(Yt),$t=n(173),en=n.n($t),tn=n(172),nn=n.n(tn),an=n(164),rn=n.n(an),cn=n(165),on=n.n(cn),sn=n(170),un=n.n(sn),ln=n(168),dn=n.n(ln),bn=n(113),fn=n.n(bn),hn=n(166),jn=n.n(hn),pn=n(167),vn=n.n(pn),gn=Object(j.a)((function(e){return{container:{position:"absolute",left:"50%",width:"50%",bottom:0,pointerEvents:"none",color:"#fff"},buttonContainer:{flexDirection:"row"},timeDisplay:{color:"#fff",display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",cursor:"default",fontSize:20,marginLeft:10},offsetInput:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",fontSize:20,marginLeft:10,width:100,color:"#fff",pointerEvents:"auto"},volumeInputContainerShown:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:5,pointerEvents:"auto"},volumeInputContainerHidden:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:0,pointerEvents:"auto"},volumeInputHidden:{transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),width:0,pointerEvents:"auto"},volumeInputShown:{transition:e.transitions.create("width",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),width:100,pointerEvents:"auto"},volumeInputThumbHidden:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),opacity:0,pointerEvents:"auto"},volumeInputThumbShown:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),opacity:1,pointerEvents:"auto"},subContainer:{background:"linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, .4) 40%, rgba(0, 0, 0, 0.7))",position:"relative",left:"-100%",width:"200%",zIndex:10},button:{pointerEvents:"auto"},inactiveButton:{color:"rgba(72, 72, 72, 0.7)",pointerEvents:"auto"},progress:{margin:5},closeButton:{position:"absolute",top:0,left:0,pointerEvents:"auto",color:"#fff"},hideSubtitlePlayerToggleButton:{position:"absolute",top:0,right:0,pointerEvents:"auto",color:"#fff"},gridContainer:{pointerEvents:"auto",padding:2}}})),On=Object(j.a)((function(e){return{root:{height:10},container:{height:10,pointerEvents:"auto",display:"flex",justifyContent:"center",flexDirection:"column",position:"absolute",width:"calc(100% - 20px)",marginLeft:10},mouseEventListener:{zIndex:1,height:10,cursor:"pointer",pointerEvents:"auto",position:"absolute",width:"100%"},fillContainer:{background:"rgba(30,30,30,0.7)",width:"100%",height:5,position:"relative"},fillContainerThick:{transition:e.transitions.create("height",{easing:e.transitions.easing.easeInOut,duration:50}),height:8},fill:{background:"linear-gradient(to left, #ff1f62, #49007a)",height:"100%"},handleContainer:{position:"absolute",display:"flex",justifyContent:"center",flexDirection:"column",height:"100%",bottom:0},handle:{borderRadius:"50%",width:16,height:16,opacity:0,left:-8,background:"white",position:"absolute"},handleOn:{opacity:1,transition:e.transitions.create("opacity",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.shortest})}}})),mn=Object(Wt.a)((function(e){return{root:{color:"white",verticalAlign:"middle"},thumb:{backgroundColor:"white",color:"white","&:focus":{boxShadow:"inherit"},"&:hover, &$active":{boxShadow:"0px 0px 0px 8px rgba(255, 255, 255, 0.1)"}},active:{color:"white"}}}))(Oe.a);function kn(e){var t=Math.floor(e/1e3),n=Math.floor(t/60),a=t%60;return String(n)+":"+String(a).padStart(2,"0")}function xn(e){var t=On(),n=Object(a.useState)(!1),r=Object(d.a)(n,2),i=r[0],c=r[1],o=Object(a.useRef)(null),s=e.onSeek,u=Object(a.useCallback)((function(e){var t=e.currentTarget.getBoundingClientRect(),n=t.right-t.left-20,a=Math.min(1,Math.max(0,(e.pageX-t.left-10)/n));s(a)}),[s]),l=Object(a.useCallback)((function(){return c(!0)}),[]),b=Object(a.useCallback)((function(){return c(!1)}),[]),f=o.current?function(e){var t=e.getBoundingClientRect();return t.right-t.left}(o.current)*e.value/100:0,h={width:f},j={marginLeft:f},p=i?t.fillContainer+" "+t.fillContainerThick:t.fillContainer,v=i?t.handle+" "+t.handleOn:t.handle;return Object($.jsxs)("div",{className:t.root,children:[Object($.jsx)("div",{ref:o,className:t.container,children:Object($.jsxs)("div",{className:p,children:[Object($.jsx)("div",{className:t.fill,style:h}),Object($.jsx)("div",{className:t.handleContainer,children:Object($.jsx)("div",{className:v,style:j})})]})}),Object($.jsx)("div",{className:t.mouseEventListener,onClick:u,onMouseOver:l,onMouseOut:b})]})}function yn(e){if(!e.audioTracks||0===e.audioTracks.length)return null;var t=e.audioTracks.map((function(t){return Object($.jsxs)(Ct.a,{selected:t.id===e.selectedAudioTrack,button:!0,onClick:function(){return e.onAudioTrackSelected(t.id)},children:[t.language," ",t.label]},t.id)}));return Object($.jsx)("div",{children:Object($.jsx)(Ft.a,{disableEnforceFocus:!0,open:e.open,anchorEl:e.anchorEl,onClose:e.onClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object($.jsx)(yt.a,{children:t})})})}function Cn(e){var t=e.open,n=e.anchorEl,a=e.onClose,r=e.tabs,i=e.selectedTab,c=e.onTabSelected;if(!r||0===r.length)return null;var o=r.map((function(e){return Object($.jsxs)(Ct.a,{selected:i&&e.id===i.id&&e.src===i.src,button:!0,onClick:function(){return c(e)},children:[e.id," ",e.title," ",e.src]},e.id)}));return Object($.jsx)("div",{children:Object($.jsx)(Ft.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:a,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object($.jsx)(yt.a,{children:o})})})}function wn(e){return Object($.jsx)("div",{children:Object($.jsx)(Ft.a,{disableEnforceFocus:!0,open:e.open,anchorEl:e.anchorEl,onClose:e.onClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object($.jsx)(yt.a,{children:Object($.jsxs)(Ct.a,{button:!0,onClick:function(t){return e.onUnload()},children:["Unload ",e.file]})})})})}function Sn(e){var t=e.clock,n=e.playing,i=e.length,c=e.offsetEnabled,o=e.displayLength,s=e.offset,u=e.onAudioTrackSelected,l=e.onSeek,b=e.mousePositionRef,f=e.onShow,h=e.onPause,j=e.onPlay,p=e.onTabSelected,v=e.onUnloadAudio,g=e.onUnloadVideo,O=e.onOffsetChange,m=e.onVolumeChange,k=e.disableKeyEvents,x=e.settingsProvider,y=e.closeEnabled,C=e.onClose,w=e.volumeEnabled,S=e.condensedModeEnabled,T=e.condensedModeToggleEnabled,F=e.onCondensedModeToggle,E=e.subtitlesEnabled,I=e.subtitlesToggle,M=e.onSubtitlesToggle,P=e.videoFile,R=e.audioFile,D=e.audioTracks,A=e.selectedAudioTrack,N=e.tabs,_=e.selectedTab,U=e.popOutEnabled,L=e.popOut,B=e.onPopOutToggle,W=e.fullscreenEnabled,H=e.fullscreen,z=e.onFullscreenToggle,q=e.hideSubtitlePlayerToggleEnabled,V=e.subtitlePlayerHidden,K=e.onHideSubtitlePlayerToggle,X=gn(),G=Object(a.useState)(!0),J=Object(d.a)(G,2),Q=J[0],Y=J[1],Z=Object(a.useState)(!1),ee=Object(d.a)(Z,2),te=ee[0],ne=ee[1],ae=Object(a.useState)(),re=Object(d.a)(ae,2),ie=re[0],ce=re[1],oe=Object(a.useState)(!1),se=Object(d.a)(oe,2),ue=se[0],be=se[1],fe=Object(a.useState)(),he=Object(d.a)(fe,2),je=he[0],pe=he[1],ve=Object(a.useState)(!1),ge=Object(d.a)(ve,2),Oe=ge[0],me=ge[1],xe=Object(a.useState)(),ye=Object(d.a)(xe,2),Ce=ye[0],we=ye[1],Se=Object(a.useState)(!1),Te=Object(d.a)(Se,2),Fe=Te[0],Ie=Te[1],Me=Object(a.useState)(),Pe=Object(d.a)(Me,2),Re=Pe[0],De=Pe[1],Ne=Object(a.useState)(!1),_e=Object(d.a)(Ne,2),Ue=_e[0],Le=_e[1],Be=Object(a.useState)(100),We=Object(d.a)(Be,2),He=We[0],ze=We[1],qe=Object(a.useState)(100),Ve=Object(d.a)(qe,2),Ke=Ve[0],Xe=Ve[1],Ge=Object(a.useRef)({x:0,y:0}),Je=Object(a.useRef)(Date.now()),Qe=Object(a.useRef)(Date.now()),Ye=Object(a.useRef)(!0),Ze=Object(a.useRef)(!1),$e=Object(a.useRef)(),et=Object(a.useState)(),tt=Object(d.a)(et,2)[1],nt=Object(a.useCallback)((function(){return tt({})}),[]),at=Object(a.useCallback)((function(e){l(e)}),[l]);function rt(e){Ze.current=!0}function it(e){Ze.current=!1}Object(a.useEffect)((function(){var e=Number(x.volume);ze(e),m(e/100),e>0&&Xe(e)}),[x,m]),Object(a.useEffect)((function(){var e=setInterval((function(){var e=Date.now(),t=e-Je.current<2e3||Math.pow(b.current.x-Ge.current.x,2)+Math.pow(b.current.y-Ge.current.y,2)>100||Ze.current||$e.current===document.activeElement||e-Qe.current<2e3;t&&!Ye.current?(Je.current=Date.now(),Y(t)):!t&&Ye.current&&Y(t),Ye.current=t,Ge.current.x=b.current.x,Ge.current.y=b.current.y}),100);return function(){return clearInterval(e)}}),[b,Y,Q]),Object(a.useEffect)((function(){return null===f||void 0===f?void 0:f(Q)}),[f,Q]),Object(a.useEffect)((function(){if(!k)return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)};function e(e){if(13===e.keyCode&&$e.current===document.activeElement){var t=Number($e.current.value);if(Number.isNaN(t))return;O(1e3*t),$e.current.blur()}}}),[O,k]);var ct=Object(a.useCallback)((function(e){var t;return e.target.setSelectionRange(0,(null===(t=e.target.value)||void 0===t?void 0:t.length)||0)}),[]);Object(a.useEffect)((function(){var e=setInterval((function(){nt()}),100);return function(){return clearInterval(e)}}),[nt]),Object(a.useEffect)((function(){if($e.current)if(0===s)$e.current.value=null;else{var e=s/1e3,t=e>=0?"+"+e.toFixed(2):String(e.toFixed(2));$e.current.value=t,Qe.current=Date.now()}}),[s]);var ot=Object(a.useCallback)((function(){ce(null),ne(!1)}),[]),st=Object(a.useCallback)((function(e){ce(e.currentTarget),ne(!0)}),[]),ut=Object(a.useCallback)((function(e){u(e),ce(null),ne(!1)}),[u]),lt=Object(a.useCallback)((function(){pe(null),be(!1)}),[]),dt=Object(a.useCallback)((function(e){pe(e.currentTarget),be(!0)}),[]),bt=Object(a.useCallback)((function(e){p(e),pe(null),be(!1)}),[p]),ft=Object(a.useCallback)((function(){we(null),me(!1)}),[]),ht=Object(a.useCallback)((function(e){we(e.currentTarget),me(!0)}),[]),jt=Object(a.useCallback)((function(){v(),me(!1)}),[v]),pt=Object(a.useCallback)((function(e){De(null),Ie(!1)}),[]),vt=Object(a.useCallback)((function(e){De(e.currentTarget),Ie(!0)}),[]),gt=Object(a.useCallback)((function(){g(),Ie(!1)}),[g]),Ot=Object(a.useCallback)((function(){return Le(!1)}),[]),mt=Object(a.useCallback)((function(){return Le(!0)}),[]),kt=Object(a.useCallback)((function(e,t){ze(t),m(t/100)}),[m]),xt=Object(a.useCallback)((function(e,t){t>0&&Xe(t),x.volume=t}),[x]),yt=Object(a.useCallback)((function(e,t){ze((function(e){var t=e>0?0:Ke;return m(t/100),t}))}),[m,Ke]),Ct=t.progress(i);return Object($.jsxs)(r.a.Fragment,{children:[y&&Object($.jsx)(Ee.a,{in:Q,timeout:200,children:Object($.jsx)(de.a,{color:"inherit",className:X.closeButton,onClick:C,onMouseOver:rt,onMouseOut:it,children:Object($.jsx)(Jt.a,{})})}),q&&Object($.jsx)(Ee.a,{in:Q,timeout:200,children:Object($.jsx)(de.a,{color:"inherit",className:X.hideSubtitlePlayerToggleButton,onClick:K,onMouseOver:rt,onMouseOut:it,children:V?Object($.jsx)(zt.a,{}):Object($.jsx)(Vt.a,{})})}),Object($.jsxs)("div",{className:X.container,onMouseOver:rt,onMouseOut:it,children:[Object($.jsx)(Ee.a,{in:Q,timeout:200,children:Object($.jsxs)("div",{className:X.subContainer,children:[Object($.jsx)(xn,{onSeek:at,value:100*Ct}),Object($.jsxs)(le.a,{container:!0,className:X.gridContainer,direction:"row",children:[Object($.jsx)(le.a,{item:!0,children:Object($.jsx)(de.a,{color:"inherit",onClick:function(){return n?h():j()},children:n?Object($.jsx)(rn.a,{className:X.button}):Object($.jsx)(on.a,{className:X.button})})}),w&&Object($.jsxs)(le.a,{item:!0,onMouseOver:mt,onMouseOut:Ot,className:Ue?X.volumeInputContainerShown:X.volumeInputContainerHidden,children:[Object($.jsx)(de.a,{color:"inherit",onClick:yt,children:0===He?Object($.jsx)(jn.a,{}):Object($.jsx)(vn.a,{})}),Object($.jsx)(mn,{onChange:kt,onChangeCommitted:xt,value:He,defaultValue:100,classes:{root:Ue?X.volumeInputShown:X.volumeInputHidden,thumb:Ue?X.volumeInputThumbShown:X.volumeInputThumbHidden}})]}),Object($.jsx)(le.a,{item:!0,children:Object($.jsxs)("div",{className:X.timeDisplay,children:[kn(Ct*i)," / ",kn(o||i)]})}),c&&Object($.jsx)(le.a,{item:!0,children:Object($.jsx)(Qt.a,{inputRef:$e,disableUnderline:!0,className:X.offsetInput,placeholder:"\xb1"+Number(0).toFixed(2),onClick:ct})}),Object($.jsx)(le.a,{item:!0,style:{flexGrow:1}}),T&&Object($.jsx)(le.a,{item:!0,children:Object($.jsx)(ke.a,{title:"Condensed Mode",children:Object($.jsx)(de.a,{color:"inherit",onClick:F,children:Object($.jsx)(Ae.a,{className:S?X.button:X.inactiveButton})})})}),I&&Object($.jsx)(le.a,{item:!0,children:Object($.jsx)(de.a,{color:"inherit",onClick:M,children:Object($.jsx)(dn.a,{className:E?X.button:X.inactiveButton})})}),P&&Object($.jsx)(le.a,{item:!0,children:Object($.jsx)(de.a,{color:"inherit",onClick:vt,children:Object($.jsx)(fn.a,{className:X.button})})}),R&&Object($.jsx)(le.a,{item:!0,children:Object($.jsx)(de.a,{color:"inherit",onClick:ht,children:Object($.jsx)(Xt.a,{className:X.button})})}),D&&D.length>1&&Object($.jsx)(le.a,{item:!0,children:Object($.jsx)(de.a,{color:"inherit",onClick:st,children:Object($.jsx)(un.a,{className:X.button})})}),N&&N.length>0&&Object($.jsx)(le.a,{item:!0,children:Object($.jsx)(de.a,{color:"inherit",onClick:dt,children:Object($.jsx)(fn.a,{className:_?X.button:X.inactiveButton})})}),U&&Object($.jsx)(le.a,{item:!0,children:Object($.jsx)(de.a,{color:"inherit",onClick:B,children:Object($.jsx)(Zt.a,{className:X.button,style:L?{transform:"rotateX(180deg)"}:{}})})}),W&&Object($.jsx)(le.a,{item:!0,children:Object($.jsx)(de.a,{color:"inherit",onClick:z,children:H?Object($.jsx)(nn.a,{className:X.button}):Object($.jsx)(en.a,{className:X.button})})})]})]})}),Object($.jsx)(Cn,{open:ue&&Q,anchorEl:je,tabs:N,selectedTab:_,onClose:lt,onTabSelected:bt}),Object($.jsx)(yn,{open:te&&Q,anchorEl:ie,audioTracks:D,selectedAudioTrack:A,onClose:ot,onAudioTrackSelected:ut}),Object($.jsx)(wn,{open:Oe,anchorEl:Ce,file:R,onClose:ft,onUnload:jt}),Object($.jsx)(wn,{open:Fe,anchorEl:Re,file:P,onClose:pt,onUnload:gt})]})]})}var Tn=function(){function e(t){Object(m.a)(this,e),this.ref=t,this.readyResolves=[]}return Object(k.a)(e,[{key:"seek",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){n.ref.current?(n.ref.current.currentTime=t,n._onMediaCanPlay((function(){return e()}))):e()})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onReady",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.ref.current?t._onMediaCanPlay((function(){return e()})):e()})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_onMediaCanPlay",value:function(e){var t=this;4!==this.ref.readyState?(this.ref.current&&!this.ref.current.oncanplay&&(this.ref.current.oncanplay=function(e){var n,a=Object(f.a)(t.readyResolves);try{for(a.s();!(n=a.n()).done;){(0,n.value)()}}catch(r){a.e(r)}finally{a.f()}t.readyResolves.length=0,t.ref.current.oncanplay=null}),this.readyResolves.push(e)):e()}},{key:"play",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.play()}},{key:"pause",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.pause()}}]),e}(),Fn=n(51),En=n(174),In=n.n(En),Mn=n(97),Pn=["index","compressed","selected","disabled","subtitle","subtitleRef","onClick","onCopy"],Rn=Object(j.a)((function(e){return{container:{height:"calc(100vh - 64px)",position:"relative",overflowX:"hidden",backgroundColor:e.palette.background.default,width:function(e){var t=e.compressed,n=e.windowWidth;return t?Math.max(350,.25*n):"100%"}},table:{backgroundColor:e.palette.background.default,marginBottom:75},noSubtitles:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center"}}})),Dn=Object(j.a)((function(e){return{subtitleRow:{"&:hover":{backgroundColor:e.palette.action.hover}},subtitle:{fontSize:20,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere"},compressedSubtitle:{fontSize:16,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere"},disabledSubtitle:{color:"transparent",backgroundColor:e.palette.action.disabledBackground,borderRadius:5},timestamp:{fontSize:14,color:"#aaaaaa",textAlign:"right",paddingRight:15,paddingLeft:5},copyButton:{textAlign:"right",padding:0}}})),An=r.a.memo((function(e){var t=e.index,n=e.compressed,r=e.selected,i=e.disabled,c=e.subtitle,o=e.subtitleRef,s=e.onClick,u=e.onCopy,b=Object($e.a)(e,Pn),f=Dn(),h=Object(a.useRef)(),j=Object(a.useState)(!1),p=Object(d.a)(j,2),v=p[0],g=p[1],O=n?f.compressedSubtitle:f.subtitle,m=i?f.disabledSubtitle:"";if(c.start<0||c.end<0)return null;return Object($.jsxs)(He.a,Object(l.a)(Object(l.a)({onClick:function(e){return!v&&s(t)},onMouseUp:function(e){var t,n=document.getSelection();g("Range"===(null===n||void 0===n?void 0:n.type)&&(null===(t=h.current)||void 0===t?void 0:t.isSameNode(n.anchorNode.parentNode)))},ref:o,className:f.subtitleRow,selected:r},b),{},{children:[Object($.jsx)(We.a,{className:O,children:Object($.jsx)("span",{ref:h,className:m,children:c.text})}),Object($.jsx)(We.a,{className:f.copyButton,children:Object($.jsx)(de.a,{onClick:function(e){return u(e,t)},children:Object($.jsx)(In.a,{fontSize:n?"small":"default"})})}),Object($.jsx)(We.a,{className:f.timestamp,children:c.displayTime})]}))}));function Nn(e){var t=e.clock,n=e.onSeek,r=e.onCopy,i=e.onOffsetChange,c=e.onAnkiDialogRequest,o=e.onToggleSubtitleTrack,s=e.playing,u=e.subtitles,l=e.length,b=e.jumpToSubtitle,h=e.compressed,j=e.loading,p=e.drawerOpen,v=e.displayHelp,O=e.disableKeyEvents,m=e.lastJumpToTopTimestamp,k=e.hidden,x=e.disabledSubtitleTracks,y=e.settingsProvider,C=Object(a.useRef)();C.current=s;var S=Object(a.useRef)();S.current=t;var T=Object(a.useRef)();T.current=u;var F=Object(a.useMemo)((function(){return u?Array(u.length).fill().map((function(e,t){return Object(a.createRef)()})):[]}),[u]),E=Object(a.useRef)();E.current=F;var I=Object(a.useRef)();I.current=O;var M=Object(a.useState)({}),P=Object(d.a)(M,2),R=P[0],D=P[1],A=Object(a.useRef)({}),N=Object(a.useRef)();N.current=l;var _=Object(a.useRef)();_.current=k;var U=Object(a.useRef)(0),L=Object(a.useRef)(),B=Object(a.useRef)();Object(a.useRef)().current=p;var W=g(!0),H=Object(d.a)(W,1)[0],z=Rn({compressed:h,windowWidth:H});Object(a.useEffect)((function(){return L.current=requestAnimationFrame((function e(t){for(var n=T.current||[],a=E.current,r=N.current,i=S.current.progress(N.current),c=Number.MAX_SAFE_INTEGER,o=-1,s={},u=n.length-1;u>=0;--u){var l=n[u],d=l.start/r,b=l.end/r;if(i>=d)i<b&&(c=u<c?u:c,s[u]=!0),-1===o&&(o=u);else if(c!==Number.MAX_SAFE_INTEGER)break}if(c===Number.MAX_SAFE_INTEGER&&-1!==o&&(s[o]=!0),!function(e,t){for(var n in e)if(!(n in t))return!1;for(var a in t)if(!(a in e))return!1;return!0}(s,A.current)&&(A.current=s,D(s),c!==Number.MAX_SAFE_INTEGER)){var f=a[c],h=!_.current&&Date.now()-U.current>5e3;(null===f||void 0===f?void 0:f.current)&&h&&f.current.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}L.current=requestAnimationFrame(e)})),function(){return cancelAnimationFrame(L.current)}}),[]);var q=Object(a.useCallback)((function(){var e,t=A.current;if(t){var n=Object.keys(t);if(0!==n.length){var a=F[n[0]];null===a||void 0===a||null===(e=a.current)||void 0===e||e.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}}),[F]);Object(a.useEffect)((function(){if(!k)return document.addEventListener("visibilitychange",e),function(){return document.removeEventListener("visibilitychange",e)};function e(){"visible"===document.visibilityState&&q()}}),[k,R,F,q]),Object(a.useEffect)((function(){k||q()}),[k,q]),Object(a.useEffect)((function(){var e;if(!_.current){var t=E.current;if(t&&0!==t.length){var n=t[0];null===n||void 0===n||null===(e=n.current)||void 0===e||e.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}}),[m]),Object(a.useEffect)((function(){var e=w.bindAdjustOffset((function(e,t){e.preventDefault(),e.stopPropagation(),i(t)}),(function(){return O}),(function(){return u}));return function(){return e()}}),[i,O,u]),Object(a.useEffect)((function(){var e=w.bindOffsetToSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),i(t)}),(function(){return O}),(function(){return t.time(l)}),(function(){return u}));return function(){return e()}}),[i,O,t,u,l]),Object(a.useEffect)((function(){var e=w.bindSeekToSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),n(t.start,!1)}),(function(){return O}),(function(){return t.time(l)}),(function(){return u}));return function(){return e()}}),[n,u,O,t,l]),Object(a.useEffect)((function(){function e(e){U.current=Date.now()}var t=B.current;return null===t||void 0===t||t.addEventListener("wheel",e),function(){return null===t||void 0===t?void 0:t.removeEventListener("wheel",e)}}),[B,U]),Object(a.useEffect)((function(){if(!k&&b&&u){var e,t,n,a=-1,r=0,i=Object(f.a)(u);try{for(i.s();!(e=i.n()).done;){var c=e.value;if(c.originalStart===b.originalStart&&c.text===b.text){a=r;break}++r}}catch(o){i.e(o)}finally{i.f()}if(-1!==a)null===(t=F[a])||void 0===t||null===(n=t.current)||void 0===n||n.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}),[k,b,u,F]);var V=Object(a.useCallback)((function(e){return A.current?K(u,e,y.surroundingSubtitlesCountRadius,y.surroundingSubtitlesTimeRadius):[]}),[u,y.surroundingSubtitlesCountRadius,y.surroundingSubtitlesTimeRadius]),X=Object(a.useCallback)((function(){if(!A.current)return[];var e=Math.min(Object.keys(A.current));return V(e)}),[V]);Object(a.useEffect)((function(){var e=w.bindCopy((function(e,t){e.preventDefault(),e.stopPropagation(),r(t,X(),!1)}),(function(){return I.current}),(function(){var e=Object.keys(A.current);if(!e||0===e.length)return null;var t=Math.min.apply(Math,Object(Fn.a)(e));return u[t]}));return function(){return e()}}),[u,X,r]),Object(a.useEffect)((function(){var e=w.bindToggleSubtitleTrackInList((function(e,t){e.preventDefault(),e.stopPropagation(),o(t)}),(function(){}),(function(){return O}));return function(){return e()}}),[O,o]),Object(a.useEffect)((function(){var e=w.bindAnkiExport((function(e){e.preventDefault(),e.stopPropagation();var t=Object.keys(A.current);if(t&&t.length>0){var n=Math.min.apply(Math,Object(Fn.a)(t));r(u[n],V(n),!0)}c()}),(function(){return!1}));return function(){return e()}}),[c,r,u,V]);var G=Object(a.useCallback)((function(e){var t=A.current||{};n(u[e].start,!C.current&&e in t)}),[u,n]),J=Object(a.useCallback)((function(e,t){e.preventDefault(),e.stopPropagation(),r(u[t],V(t),!1)}),[u,V,r]),Q=null;return u&&0!==u.length?Q=Object($.jsx)(Be.a,{className:z.table,children:Object($.jsx)(Ue.a,{children:Object($.jsx)(Le.a,{children:u.map((function(e,t){var n=t in R;return Object($.jsx)(An,{index:t,compressed:h,selected:n,disabled:x[e.track],subtitle:u[t],subtitleRef:F[t],onClick:G,onCopy:J},t)}))})})}):!j&&v?Q=!j&&v&&Object($.jsx)("div",{className:z.noSubtitles,children:Object($.jsx)(xe.a,{variant:"h6",children:v})}):u&&0===u.length&&(Q=Object($.jsx)("div",{className:z.noSubtitles,children:Object($.jsx)(xe.a,{variant:"h6",children:"No subtitles"})})),Object($.jsx)(Mn.a,{square:!0,elevation:0,ref:B,className:z.container,children:Q})}var _n=function(){function e(t){Object(m.a)(this,e),this.protocol=t,this.time=0,this.duration=0,this.isReady=!1,this.readyState=0,this.selectedAudioTrack=null,this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[],this.condensedModeToggleCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.toggleSubtitleTrackInListCallbacks=[];var n=this;this.protocol.onMessage=function(e){switch(e.data.command){case"ready":n.duration=e.data.duration,n.isReady=!0,n.audioTracks=e.data.audioTracks,n.selectedAudioTrack=e.data.selectedAudioTrack,n.readyState=4,n.time=e.data.currentTime;var t,a=Object(f.a)(n.readyCallbacks);try{for(a.s();!(t=a.n()).done;){(0,t.value)(e.data.paused)}}catch(M){a.e(M)}finally{a.f()}break;case"readyState":var r;if(n.readyState=e.data.value,4===n.readyState)null===(r=n.oncanplay)||void 0===r||r.call(n);break;case"play":var i,c=Object(f.a)(n.playCallbacks);try{for(c.s();!(i=c.n()).done;){(0,i.value)(e.data.echo)}}catch(M){c.e(M)}finally{c.f()}break;case"pause":var o,s=Object(f.a)(n.pauseCallbacks);try{for(s.s();!(o=s.n()).done;){(0,o.value)(e.data.echo)}}catch(M){s.e(M)}finally{s.f()}break;case"audioTrackSelected":var u,l=Object(f.a)(n.audioTrackSelectedCallbacks);try{for(l.s();!(u=l.n()).done;){var d=u.value;n.selectedAudioTrack=e.data.id,d(e.data.id)}}catch(M){l.e(M)}finally{l.f()}break;case"currentTime":var b,h=Object(f.a)(n.currentTimeCallbacks);try{for(h.s();!(b=h.n()).done;){(0,b.value)(e.data.value,e.data.echo)}}catch(M){h.e(M)}finally{h.f()}break;case"exit":var j,p=Object(f.a)(n.exitCallbacks);try{for(p.s();!(j=p.n()).done;){(0,j.value)()}}catch(M){p.e(M)}finally{p.f()}break;case"offset":var v,g=Object(f.a)(n.offsetCallbacks);try{for(g.s();!(v=g.n()).done;){(0,v.value)(e.data.value)}}catch(M){g.e(M)}finally{g.f()}break;case"popOutToggle":var O,m=Object(f.a)(n.popOutToggleCallbacks);try{for(m.s();!(O=m.n()).done;){(0,O.value)()}}catch(M){m.e(M)}finally{m.f()}break;case"copy":var k,x=Object(f.a)(n.copyCallbacks);try{for(x.s();!(k=x.n()).done;){(0,k.value)(e.data.subtitle,e.data.surroundingSubtitles,e.data.audio,e.data.image,e.data.preventDuplicate,e.data.id)}}catch(M){x.e(M)}finally{x.f()}break;case"condensedModeToggle":var y,C=Object(f.a)(n.condensedModeToggleCallbacks);try{for(C.s();!(y=C.n()).done;){(0,y.value)()}}catch(M){C.e(M)}finally{C.f()}break;case"hideSubtitlePlayerToggle":var w,S=Object(f.a)(n.hideSubtitlePlayerToggleCallbacks);try{for(S.s();!(w=S.n()).done;){(0,w.value)()}}catch(M){S.e(M)}finally{S.f()}break;case"sync":case"syncv2":break;case"ankiDialogRequest":var T,F=Object(f.a)(n.ankiDialogRequestCallbacks);try{for(F.s();!(T=F.n()).done;){(0,T.value)(e.data.forwardToVideo)}}catch(M){F.e(M)}finally{F.f()}break;case"toggleSubtitleTrackInList":var E,I=Object(f.a)(n.toggleSubtitleTrackInListCallbacks);try{for(I.s();!(E=I.n()).done;){(0,E.value)(e.data.track)}}catch(M){I.e(M)}finally{I.f()}break;case"playbackRate":break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(k.a)(e,[{key:"currentTime",get:function(){return this.time},set:function(e){this.time=e,this.readyState=3,this.protocol.postMessage({command:"currentTime",value:this.time})}},{key:"onReady",value:function(e){this.isReady&&e(),this.readyCallbacks.push(e)}},{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onExit",value:function(e){this.exitCallbacks.push(e)}},{key:"onOffset",value:function(e){this.offsetCallbacks.push(e)}},{key:"onPopOutToggle",value:function(e){this.popOutToggleCallbacks.push(e)}},{key:"onCopy",value:function(e){this.copyCallbacks.push(e)}},{key:"onCondensedModeToggle",value:function(e){this.condensedModeToggleCallbacks.push(e)}},{key:"onHideSubtitlePlayerToggle",value:function(e){this.hideSubtitlePlayerToggleCallbacks.push(e)}},{key:"onAnkiDialogRequest",value:function(e){this.ankiDialogRequestCallbacks.push(e)}},{key:"onToggleSubtitleTrackInList",value:function(e){this.toggleSubtitleTrackInListCallbacks.push(e)}},{key:"ready",value:function(e){this.protocol.postMessage({command:"ready",duration:e})}},{key:"init",value:function(){this.protocol.postMessage({command:"init"})}},{key:"play",value:function(){this.protocol.postMessage({command:"play"})}},{key:"pause",value:function(){this.protocol.postMessage({command:"pause"})}},{key:"audioTrackSelected",value:function(e){this.protocol.postMessage({command:"audioTrackSelected",id:e})}},{key:"subtitles",value:function(e,t){this.protocol.postMessage({command:"subtitles",value:e,name:t.length>0?t[0]:null,names:t})}},{key:"subtitleSettings",value:function(e){this.protocol.postMessage({command:"subtitleSettings",value:e})}},{key:"condensedModeToggle",value:function(e){this.protocol.postMessage({command:"condensedModeToggle",value:e})}},{key:"hideSubtitlePlayerToggle",value:function(e){this.protocol.postMessage({command:"hideSubtitlePlayerToggle",value:e})}},{key:"ankiDialogRequest",value:function(){this.protocol.postMessage({command:"ankiDialogRequest"})}},{key:"finishedAnkiDialogRequest",value:function(e){this.protocol.postMessage({command:"finishedAnkiDialogRequest",resume:e})}},{key:"ankiSettings",value:function(e){this.protocol.postMessage({command:"ankiSettings",value:e})}},{key:"miscSettings",value:function(e){this.protocol.postMessage({command:"miscSettings",value:e})}},{key:"close",value:function(){this.protocol.postMessage({command:"close"}),this.protocol.close(),this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[],this.condensedModeToggleCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.toggleSubtitleTrackInListCallbacks=[]}}]),e}(),Un=Object(j.a)({root:{height:"calc(100vh - 64px)",position:"relative",overflowX:"hidden"},container:{width:"100%",height:"100%"},videoFrame:{width:"100%",height:"100%",border:0}});function Ln(e,t,n,a){var r;r=n&&n.length>0?a?n[n.length-1].end:n[n.length-1].originalEnd:0;var i=e.current&&e.current.duration?1e3*e.current.duration:0,c=t.current&&t.current.duration?1e3*t.current.duration:0;return Math.max(c,Math.max(r,i))}function Bn(e){var t,n,r=e.sources,i=r.subtitleFiles,c=r.audioFile,o=r.audioFileUrl,b=r.videoFile,f=r.videoFileUrl,h=e.subtitleReader,j=e.settingsProvider,p=e.extension,v=e.videoFrameRef,g=e.drawerOpen,O=e.tab,m=e.availableTabs,k=e.ankiDialogRequestToVideo,x=e.ankiDialogRequested,y=e.ankiDialogFinishedRequest,C=e.onError,S=e.onUnloadAudio,T=e.onUnloadVideo,F=e.onCopy,E=e.onLoaded,I=e.onTabSelected,M=e.onAnkiDialogRequest,P=e.disableKeyEvents,R=e.jumpToSubtitle,D=Object(a.useState)(),A=Object(d.a)(D,2),N=A[0],_=A[1],U=Object(a.useRef)();U.current=N;var L=Object(a.useState)(!1),B=Object(d.a)(L,2),W=B[0],H=B[1],z=Object(a.useState)(!1),q=Object(d.a)(z,2),V=q[0],K=q[1],G=Object(a.useState)(0),Q=Object(d.a)(G,2),Y=Q[0],Z=Q[1],ee=Object(a.useState)(0),te=Object(d.a)(ee,2),ne=te[0],ae=te[1],re=Object(a.useRef)();re.current=V;var ie=Object(a.useState)(),ce=Object(d.a)(ie,2)[1],oe=Object(a.useState)(),se=Object(d.a)(oe,2),ue=se[0],de=se[1],be=Object(a.useState)(),fe=Object(d.a)(be,2),he=fe[0],je=fe[1],pe=Object(a.useState)(),ve=Object(d.a)(pe,2),ge=ve[0],Oe=ve[1],me=Object(a.useState)(!1),ke=Object(d.a)(me,2),xe=ke[0],ye=ke[1],Ce=Object(a.useState)(!1),we=Object(d.a)(Ce,2)[1],Se=Object(a.useState)(!1),Te=Object(d.a)(Se,2),Fe=Te[0],Ee=Te[1],Ie=Object(a.useRef)();Ie.current=Fe;var Me=Object(a.useState)({}),Pe=Object(d.a)(Me,2),Re=Pe[0],De=Pe[1],Ae=Object(a.useState)(!1),Ne=Object(d.a)(Ae,2),_e=Ne[0],Ue=Ne[1],Le=Object(a.useRef)();Le.current=_e;var Be=Object(a.useCallback)((function(){return ce({})}),[]),We=Object(a.useRef)({x:0,y:0}),He=Object(a.useRef)(),ze=Object(a.useRef)(),qe=Object(a.useMemo)((function(){return new Tn(o?He:f||O?ze:{})}),[o,f,O]),Ve=Object(a.useMemo)((function(){return new Bt}),[]),Ke=Un(),Xe=Object(a.useRef)(0);Xe.current=Ln(He,ze,N,!0);var Ge=Object(a.useCallback)(function(){var e=Object(u.a)(s.a.mark((function e(t,n,a){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.setTime(t),Be(),!a){e.next=5;break}return e.next=5,qe.seek(t/1e3);case 5:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),[Be,qe]),Je=Object(a.useCallback)((function(e,t){ae(e),_((function(n){if(n){var a,r=n.length>0?n[n.length-1].end+e:0,c=n.map((function(t){return{text:t.text,start:t.originalStart+e,originalStart:t.originalStart,end:t.originalEnd+e,originalEnd:t.originalEnd,displayTime:pt(t.originalStart+e,r),track:t.track}}));if(t)null===(a=ze.current)||void 0===a||a.subtitles(c,i.map((function(e){return e.name})));return c}}))}),[i]);function Qe(e,t,n){K(!0),e.start(),n&&t.play()}function Ye(e,t,n){K(!1),e.stop(),n&&t.pause()}Object(a.useEffect)((function(){var e=null,t=!1;function n(){return(n=Object(u.a)(s.a.mark((function n(){var a,r,d,v,g,m;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null===(a=ze.current)||void 0===a||a.close(),ze.current=null,Ve.setTime(0),Ve.stop(),ae(0),K(!1),de(null),je(null),Ue(!1),He.current.currentTime=0,He.current.pause(),!(i.length>0)){n.next=31;break}return H(!0),n.prev=13,n.next=16,h.subtitles(i);case 16:d=n.sent,v=d.length>0?d[d.length-1].end:0,r=d.map((function(e){return{text:e.text,start:e.start,originalStart:e.start,end:e.end,originalEnd:e.end,displayTime:pt(e.start,v),track:e.track}})),_(r),Z(Date.now()),n.next=26;break;case 23:n.prev=23,n.t0=n.catch(13),C(n.t0.message);case 26:return n.prev=26,H(!1),n.finish(26);case 29:n.next=32;break;case 31:r=null;case 32:if(!o){n.next=38;break}return n.next=35,qe.onReady();case 35:Be(),n.next=48;break;case 38:if(!f&&!O){n.next=48;break}if(!t){n.next=41;break}return n.abrupt("return");case 41:f?(g=Object(J.a)(),e=new _n(new Ut(g)),Oe(g)):O&&(e=new _n(new Lt(O.id,O.src,p))).init(),ze.current=e,m=!1,e.onExit((function(){return T(f)})),e.onPopOutToggle((function(){return ye((function(e){return!e}))})),e.onHideSubtitlePlayerToggle((function(){Ee((function(t){return e.hideSubtitlePlayerToggle(!t),!t}))})),e.onReady((function(t){Xe.current=Ln(He,ze,U.current),e.ready(Xe.current),U.current&&(e.subtitleSettings(j.subtitleSettings),e.subtitles(U.current,i.map((function(e){return e.name})))),e.ankiSettings(j.ankiSettings),e.miscSettings(j.miscSettings),e.condensedModeToggle(Le.current),e.hideSubtitlePlayerToggle(Ie.current),e.audioTracks&&e.audioTracks.length>1?(de(ze.current.audioTracks),je(ze.current.selectedAudioTrack)):(de(null),je(null)),Ve.setTime(1e3*ze.current.currentTime),t?Ve.stop():Ve.start(),K(!t),m||(e.onPlay((function(e){return Qe(Ve,qe,e)})),e.onPause((function(e){return Ye(Ve,qe,e)})),e.onOffset((function(e){var t;return Je(Math.max(null!==(t=-Xe.current)&&void 0!==t?t:0,e),!1)})),e.onCopy((function(t,n,a,r,o,s){return F(t,n,c,b,t?i[t.track]:null,e.selectedAudioTrack,a,r,o,s)})),e.onCondensedModeToggle((function(){return Ue((function(t){var n=!t;return e.condensedModeToggle(n),n}))})),e.onCurrentTime(function(){var e=Object(u.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return re.current&&Ve.stop(),e.next=3,Ge(1e3*t,Ve,n);case 3:re.current&&Ve.start();case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.onAudioTrackSelected(function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return re.current&&Ve.stop(),e.next=3,qe.onReady();case 3:re.current&&Ve.start(),je(t);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.onAnkiDialogRequest((function(e){return M(e)})),e.onToggleSubtitleTrackInList((function(e){return De((function(t){var n=Object(l.a)({},t);return n[e]=!t[e],n}))})),m=!0)}));case 48:case"end":return n.stop()}}),n,null,[[13,23,26,29]])})))).apply(this,arguments)}return function(){return n.apply(this,arguments)}().then((function(){return E()})),function(){var n;null===(n=e)||void 0===n||n.close(),t=!0}}),[h,p,j,Ve,qe,Ge,E,C,T,F,M,i,c,o,b,f,O,Be,v,Je]),Object(a.useEffect)((function(){var e;k&&(null===(e=ze.current)||void 0===e||e.ankiDialogRequest())}),[k]),Object(a.useEffect)((function(){var e;y&&y.timestamp>0&&(null===(e=ze.current)||void 0===e||e.finishedAnkiDialogRequest(y.resume),we((function(e){return e&&y.resume&&Qe(Ve,qe,!0),!1})))}),[y,Ve,qe]),Object(a.useEffect)((function(){x&&re.current&&(Ye(Ve,qe,!0),we(!0))}),[x,Ve,qe]),Object(a.useEffect)((function(){if(_e&&N&&0!==N.length){var e=!1,t=1e3,n=setInterval(Object(u.a)(s.a.mark((function n(){var a,r,i,c,o,u,l,d,b,f;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=Xe.current){n.next=3;break}return n.abrupt("return");case 3:r=Ve.progress(a),i=0,c=-1,o=N.length-1;case 7:if(!(o>=0)){n.next=17;break}if(u=N[o],l=u.start/a,d=u.end/a,!(r>=l)){n.next=14;break}return r<d?(c=o,i=o):i=Math.min(N.length-1,o+1),n.abrupt("break",17);case 14:--o,n.next=7;break;case 17:if(c===i){n.next=30;break}if(!((b=N[i]).start-r*a<t+500)){n.next=21;break}return n.abrupt("return");case 21:if(re.current&&Ve.stop(),e){n.next=29;break}return e=!0,f=Date.now(),n.next=27,Ge(b.start,Ve,!0);case 27:t=Date.now()-f,e=!1;case 29:re.current&&Ve.start();case 30:case"end":return n.stop()}}),n)}))),100);return function(){return clearInterval(n)}}}),[N,_e,Ve,Ge]),Object(a.useEffect)((function(){xe&&ge&&f&&window.open("/asbplayer/?video="+encodeURIComponent(f)+"&channel="+ge+"&popout=true","asbplayer-video-"+f,"resizable,width=800,height=450"),Z(Date.now())}),[xe,ge,f,v]);var Ze=Object(a.useCallback)((function(){return Qe(Ve,qe,!0)}),[Ve,qe]),$e=Object(a.useCallback)((function(){return Ye(Ve,qe,!0)}),[Ve,qe]),et=Object(a.useCallback)(function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Xe.current){e.next=2;break}return e.abrupt("return");case 2:return re.current&&Ve.stop(),e.next=5,Ge(t*Xe.current,Ve,!0);case 5:re.current&&Ve.start();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Ve,Ge]),tt=Object(a.useCallback)(function(){var e=Object(u.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n||Ye(Ve,qe,!0),re.current&&Ve.stop(),e.next=4,Ge(t,Ve,!0);case 4:n&&!re.current&&Qe(Ve,qe,!0);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[Ve,Ge,qe]),nt=Object(a.useCallback)((function(e,t,n){F(e,t,c,b,i[e.track],he,null,null,n,null)}),[F,c,b,i,he]),at=Object(a.useCallback)((function(e){We.current.x=e.screenX,We.current.y=e.screenY}),[]),rt=Object(a.useCallback)(function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ze.current&&ze.current.audioTrackSelected(t),Ye(Ve,qe,!0),e.next=4,Ge(0,Ve,!0);case 4:re.current&&Qe(Ve,qe,!0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Ve,qe,Ge]),it=Object(a.useCallback)((function(e){var t;Je(Math.max(null!==(t=-Xe.current)&&void 0!==t?t:0,e),!0)}),[Je]),ct=Object(a.useCallback)((function(e){He.current&&(He.current.volume=e)}),[]),ot=Object(a.useCallback)((function(){return Ue((function(e){return!e}))}),[]),st=Object(a.useCallback)((function(e){return De((function(t){var n=Object(l.a)({},t);return n[e]=!t[e],n}))}),[]);Object(a.useEffect)((function(){if(!O){var e=setInterval(Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Xe.current,!(Ve.progress(t)>=1)){e.next=7;break}return Ye(Ve,qe,!0),e.next=6,Ge(0,Ve,!0);case 6:Z(Date.now());case 7:case"end":return e.stop()}}),e)}))),1e3);return function(){return clearInterval(e)}}}),[Ve,N,qe,Ge,O]),Object(a.useEffect)((function(){var e=w.bindPlay((function(e){e.preventDefault(),V?Ye(Ve,qe,!0):Qe(Ve,qe,!0)}),(function(){return P}));return function(){return e()}}),[V,Ve,qe,P]),Object(a.useEffect)((function(){if((c||b)&&(!N||0===N.length)){var e=w.bindCopy((function(e,t){var n;e.preventDefault(),e.stopPropagation();var a=X(t,Xe.current,5e3);F(t,a,c,b,null!==(n=null===c||void 0===c?void 0:c.name)&&void 0!==n?n:null===b||void 0===b?void 0:b.name,he)}),(function(){return P}),(function(){if(!Xe.current)return null;var e=Ve.time(Xe.current);return{text:"",start:e,end:Math.min(e+5e3,Xe.current),track:0}})),t=w.bindAnkiExport((function(e){var t;e.preventDefault(),e.stopPropagation();var n=Ve.time(Xe.current),a={text:"",start:n,end:Math.min(n+5e3,Xe.current),track:0},r=X(a,Xe.current,5e3);F(a,r,c,b,null!==(t=null===c||void 0===c?void 0:c.name)&&void 0!==t?t:null===b||void 0===b?void 0:b.name,he),M()}),(function(){return!1}));return function(){e(),t()}}return null}),[c,b,N,Ve,he,P,F,M]);var ut=Xe.current,lt=o||f||N,dt=lt&&f&&!xe;return Object($.jsxs)("div",{onMouseMove:at,className:Ke.root,children:[Object($.jsxs)(le.a,{container:!0,direction:"row",wrap:"nowrap",className:Ke.container,children:[dt&&Object($.jsx)(le.a,{item:!0,style:{flexGrow:1,minWidth:600},children:Object($.jsx)("iframe",{ref:v,className:Ke.videoFrame,src:"/asbplayer/?video="+encodeURIComponent(f)+"&channel="+ge+"&popout=false",title:"asbplayer"})}),(!dt||(null===(t=N)||void 0===t?void 0:t.length)>0)&&Object($.jsxs)(le.a,{item:!0,style:{flexGrow:dt?0:1,width:dt&&Fe?0:"auto"},children:[lt&&!(f&&!xe)&&Object($.jsx)(Sn,{mousePositionRef:We,playing:V,clock:Ve,length:ut,displayLength:Ln(He,ze,N,!1),audioTracks:ue,selectedAudioTrack:he,tabs:!f&&!o&&m,selectedTab:O,audioFile:null===c||void 0===c?void 0:c.name,videoFile:null===b||void 0===b?void 0:b.name,offsetEnabled:!0,offset:ne,volumeEnabled:Boolean(o),condensedModeToggleEnabled:Boolean(o)&&(null===(n=N)||void 0===n?void 0:n.length)>0,condensedModeEnabled:_e,onPlay:Ze,onPause:$e,onSeek:et,onAudioTrackSelected:rt,onTabSelected:I,onUnloadAudio:function(){return S(o)},onUnloadVideo:function(){return T(f)},onOffsetChange:it,onVolumeChange:ct,onCondensedModeToggle:ot,disableKeyEvents:P,settingsProvider:j}),Object($.jsx)(Nn,{playing:V,subtitles:N,clock:Ve,length:ut,jumpToSubtitle:R,drawerOpen:g,compressed:f&&!xe,loading:W,displayHelp:(null===c||void 0===c?void 0:c.name)||xe&&(null===b||void 0===b?void 0:b.name),disableKeyEvents:P,lastJumpToTopTimestamp:Y,hidden:dt&&Fe,disabledSubtitleTracks:Re,onSeek:tt,onCopy:nt,onOffsetChange:it,onAnkiDialogRequest:M,onToggleSubtitleTrack:st,settingsProvider:j})]})]}),Object($.jsx)("audio",{ref:He,src:o})]})}var Wn=n(345),Hn=n(335);function zn(e){var t=e.open,n=e.onProceed,r=e.onCancel,i=e.existingCustomFieldNames,c=Object(a.useState)(""),o=Object(d.a)(c,2),s=o[0],u=o[1];Object(a.useEffect)((function(){u("")}),[t]);var l=[].concat(Object(Fn.a)(i),["Sentence","Word","Definition","Source","Image","Audio"]).includes(s);return Object($.jsxs)(ie.a,{open:t,disableEnforceFocus:!0,fullWidth:!0,maxWidth:"xs",onBackdropClick:r,onEscapeKeyDown:r,children:[Object($.jsx)(Hn.a,{children:"New Custom Field"}),Object($.jsx)(oe.a,{children:Object($.jsx)("form",{children:Object($.jsx)(re.a,{error:l,helperText:l&&"Field ".concat(s," already exists"),variant:"filled",fullWidth:!0,label:"Field Name",value:s,color:"secondary",onChange:function(e){return u(e.target.value)}})})}),Object($.jsxs)(ce.a,{children:[Object($.jsx)(ae.a,{onClick:function(){return r()},children:"Cancel"}),Object($.jsx)(ae.a,{disabled:l||""===s.trim(),onClick:function(){return n(s.trim())},children:"Create"})]})]})}var qn=n(266),Vn=n(338),Kn=n(337),Xn=n(269),Gn=n(268),Jn=n(267),Qn=n(336),Yn=n(175),Zn=n.n(Yn),$n=n(343),ea=n(176),ta=n.n(ea),na=n(272),aa=Object(ne.a)((function(e){return{root:{"& .MuiTextField-root":{marginTop:e.spacing(1),marginBottom:e.spacing(1)}},subtitleSetting:{"& .MuiTextField-root":{marginTop:e.spacing(1),marginBottom:e.spacing(1)}},subtitlePreview:{backgroundImage:"linear-gradient(45deg, ".concat(e.palette.action.disabledBackground," 25%, transparent 25%), linear-gradient(-45deg, ").concat(e.palette.action.disabledBackground," 25%, transparent 25%), linear-gradient(45deg, transparent 75%, ").concat(e.palette.action.disabledBackground," 75%), linear-gradient(-45deg, transparent 75%,").concat(e.palette.action.disabledBackground," 75%)"),backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px",marginTop:e.spacing(1),marginBottom:e.spacing(1),maxWidth:"100%",padding:10},subtitlePreviewInput:{border:"none",width:"100%",textAlign:"center",backgroundColor:"rgba(0,0,0,0)","&:focus":{outline:"none"}},addFieldButton:{width:"100%"}}})),ra=Object(ne.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120},root:{display:"flex",flexDirection:"row",justifyContent:"end",alignItems:"flex-end"}}}));function ia(e){var t=e.label,n=e.value,a=e.selections,r=e.removable,i=e.onChange,c=e.onSelectionChange,o=e.onRemoval,s=ra();return Object($.jsxs)("div",{className:s.root,children:[Object($.jsx)(re.a,{label:t,value:n,onChange:i,fullWidth:!0,color:"secondary",InputProps:{endAdornment:r&&Object($.jsx)(be.a,{position:"end",children:Object($.jsx)(de.a,{onClick:function(e){return null===o||void 0===o?void 0:o()},children:Object($.jsx)(Zn.a,{})})})}}),Object($.jsxs)(qn.a,{className:s.formControl,children:[Object($.jsx)(Jn.a,{}),Object($.jsx)(na.a,{value:n,disabled:!a,color:"secondary",onChange:c,children:a&&a.map((function(e){return Object($.jsx)(Qn.a,{value:e,children:e},e)}))})]})]})}function ca(e){var t=e.anki,n=e.open,i=e.settings,c=e.onClose,o=aa(),l=Object(a.useState)(i.ankiConnectUrl),b=Object(d.a)(l,2),f=b[0],h=b[1],j=Object(a.useState)(),p=Object(d.a)(j,2),v=p[0],g=p[1],O=Object(a.useState)(0),m=Object(d.a)(O,2),k=m[0],x=m[1],y=Object(a.useState)(i.deck||""),C=Object(d.a)(y,2),w=C[0],S=C[1],T=Object(a.useState)(),F=Object(d.a)(T,2),E=F[0],I=F[1],M=Object(a.useState)(i.noteType||""),P=Object(d.a)(M,2),R=P[0],D=P[1],A=Object(a.useState)(),N=Object(d.a)(A,2),_=N[0],U=N[1],L=Object(a.useState)(i.sentenceField||""),B=Object(d.a)(L,2),W=B[0],H=B[1],z=Object(a.useState)(i.definitionField||""),q=Object(d.a)(z,2),V=q[0],K=q[1],X=Object(a.useState)(i.audioField||""),G=Object(d.a)(X,2),J=G[0],Q=G[1],Y=Object(a.useState)(i.imageField||""),Z=Object(d.a)(Y,2),ee=Z[0],te=Z[1],ne=Object(a.useState)(i.wordField||""),se=Object(d.a)(ne,2),ue=se[0],fe=se[1],he=Object(a.useState)(i.sourceField||""),je=Object(d.a)(he,2),pe=je[0],ve=je[1],ge=Object(a.useState)(i.customAnkiFields),Oe=Object(d.a)(ge,2),me=Oe[0],ke=Oe[1],xe=Object(a.useState)(i.preferMp3),ye=Object(d.a)(xe,2),Ce=ye[0],we=ye[1],Se=Object(a.useState)(),Te=Object(d.a)(Se,2),Fe=Te[0],Ee=Te[1],Ie=Object(a.useState)(!1),Me=Object(d.a)(Ie,2),Pe=Me[0],De=Me[1],Ae=Object(a.useState)(i.audioPaddingStart),Ne=Object(d.a)(Ae,2),_e=Ne[0],Ue=Ne[1],Le=Object(a.useState)(i.audioPaddingEnd),Be=Object(d.a)(Le,2),We=Be[0],He=Be[1],ze=Object(a.useState)(i.maxImageWidth),qe=Object(d.a)(ze,2),Ve=qe[0],Ke=qe[1],Xe=Object(a.useState)(i.maxImageHeight),Ge=Object(d.a)(Xe,2),Je=Ge[0],Qe=Ge[1],Ye=Object(a.useState)(i.subtitleColor),Ze=Object(d.a)(Ye,2),$e=Ze[0],et=Ze[1],tt=Object(a.useState)(i.subtitleSize),nt=Object(d.a)(tt,2),at=nt[0],rt=nt[1],it=Object(a.useState)(i.subtitleOutlineColor),ct=Object(d.a)(it,2),ot=ct[0],st=ct[1],ut=Object(a.useState)(i.subtitleOutlineThickness),lt=Object(d.a)(ut,2),dt=lt[0],bt=lt[1],ft=Object(a.useState)(i.subtitleBackgroundColor),ht=Object(d.a)(ft,2),pt=ht[0],vt=ht[1],gt=Object(a.useState)(i.subtitleBackgroundOpacity),Ot=Object(d.a)(gt,2),mt=Ot[0],kt=Ot[1],xt=Object(a.useState)(i.subtitleFontFamily),yt=Object(d.a)(xt,2),Ct=yt[0],wt=yt[1],St=Object(a.useState)(i.subtitlePreview),Tt=Object(d.a)(St,2),Ft=Tt[0],Et=Tt[1],It=Object(a.useState)(i.themeType),Mt=Object(d.a)(It,2),Pt=Mt[0],Rt=Mt[1],Dt=Object(a.useCallback)((function(e){h(e.target.value),x(Date.now())}),[]),At=Object(a.useCallback)((function(e){return x(Date.now())}),[]),Nt=Object(a.useCallback)((function(e){return S(e.target.value)}),[]),_t=Object(a.useCallback)((function(e){return D(e.target.value)}),[]),Ut=Object(a.useCallback)((function(e){return H(e.target.value)}),[]),Lt=Object(a.useCallback)((function(e){return K(e.target.value)}),[]),Bt=Object(a.useCallback)((function(e){return Q(e.target.value)}),[]),Wt=Object(a.useCallback)((function(e){return te(e.target.value)}),[]),Ht=Object(a.useCallback)((function(e){return fe(e.target.value)}),[]),zt=Object(a.useCallback)((function(e){return ve(e.target.value)}),[]),qt=Object(a.useCallback)((function(e){return Ue(e.target.value)}),[]),Vt=Object(a.useCallback)((function(e){return He(e.target.value)}),[]),Kt=Object(a.useCallback)((function(e){return Ke(e.target.value)}),[]),Xt=Object(a.useCallback)((function(e){return Qe(e.target.value)}),[]),Gt=Object(a.useCallback)((function(e){return et(e.target.value)}),[]),Jt=Object(a.useCallback)((function(e){return rt(e.target.value)}),[]),Qt=Object(a.useCallback)((function(e){return st(e.target.value)}),[]),Yt=Object(a.useCallback)((function(e){return bt(e.target.value)}),[]),Zt=Object(a.useCallback)((function(e){return vt(e.target.value)}),[]),$t=Object(a.useCallback)((function(e){return kt(e.target.value)}),[]),en=Object(a.useCallback)((function(e){return wt(e.target.value)}),[]),tn=Object(a.useCallback)((function(e){return Et(e.target.value)}),[]),nn=Object(a.useCallback)((function(e){ke((function(t){var n={};return Object.assign(n,t),n[e]="",n})),De(!1)}),[]),an=Object(a.useCallback)((function(e,t){ke((function(n){var a={};return Object.assign(a,n),a[e]=t,a}))}),[]),rn=Object(a.useCallback)((function(e){return ke((function(t){var n={};return Object.assign(n,t),delete n[e],n}))}),[]),cn=Object(a.useCallback)((function(e){return we(e.target.checked)}),[]),on=Object(a.useCallback)((function(e){return Rt(e.target.value)}),[]),sn=Object(a.useMemo)((function(){return jt({subtitleColor:$e,subtitleSize:at,subtitleOutlineThickness:dt,subtitleOutlineColor:ot,subtitleBackgroundOpacity:mt,subtitleBackgroundColor:pt,subtitleFontFamily:Ct})}),[$e,at,dt,ot,mt,pt,Ct]);Object(a.useEffect)((function(){var e=!1,n=setTimeout(Object(u.a)(s.a.mark((function n(){return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e){n.next=3;break}return n.abrupt("return");case 3:return n.next=5,t.requestPermission(f);case 5:return n.t0=I,n.next=8,t.deckNames(f);case 8:return n.t1=n.sent,(0,n.t0)(n.t1),n.t2=U,n.next=13,t.modelNames(f);case 13:n.t3=n.sent,(0,n.t2)(n.t3),g(null),n.next=26;break;case 18:if(n.prev=18,n.t4=n.catch(0),!e){n.next=22;break}return n.abrupt("return");case 22:console.error(n.t4),I(null),U(null),g(n.t4.message);case 26:case"end":return n.stop()}}),n,null,[[0,18]])}))),1e3);return function(){e=!0,clearTimeout(n)}}),[t,f,k]),Object(a.useEffect)((function(){if(R&&!v){var e=!1;return function(){n.apply(this,arguments)}(),function(){return e=!0}}function n(){return(n=Object(u.a)(s.a.mark((function n(){return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e){n.next=3;break}return n.abrupt("return");case 3:return n.t0=Ee,n.t1=[""],n.t2=Fn.a,n.next=8,t.modelFieldNames(R,f);case 8:n.t3=n.sent,n.t4=(0,n.t2)(n.t3),n.t5=n.t1.concat.call(n.t1,n.t4),(0,n.t0)(n.t5),g(null),n.next=22;break;case 15:if(n.prev=15,n.t6=n.catch(0),!e){n.next=19;break}return n.abrupt("return");case 19:console.error(n.t6),Ee(null),g(n.t6.message);case 22:case"end":return n.stop()}}),n,null,[[0,15]])})))).apply(this,arguments)}}),[t,R,f,v,k]);var un=Object(a.useCallback)((function(){c({ankiConnectUrl:f,deck:w,noteType:R,sentenceField:W,definitionField:V,audioField:J,imageField:ee,wordField:ue,sourceField:pe,subtitleSize:Number(at),subtitleColor:$e,subtitleOutlineThickness:Number(dt),subtitleOutlineColor:ot,subtitleBackgroundColor:pt,subtitleBackgroundOpacity:Number(mt),subtitleFontFamily:Ct,subtitlePreview:Ft,customAnkiFields:me,preferMp3:Ce,themeType:Pt,audioPaddingStart:_e,audioPaddingEnd:We,maxImageWidth:Ve,maxImageHeight:Je})}),[c,f,w,R,W,V,J,ee,ue,pe,me,Ce,at,$e,dt,ot,pt,mt,Ct,Ft,Pt,_e,We,Ve,Je]),ln=Object.keys(me).map((function(e){return Object($.jsx)(ia,{label:"".concat(e," Field"),value:me[e],selections:Fe,onChange:function(t){return an(e,t.target.value)},onSelectionChange:function(t){return an(e,t.target.value)},onRemoval:function(){return rn(e)},removable:!0},e)}));return Object($.jsxs)(r.a.Fragment,{children:[Object($.jsx)(zn,{open:Pe,existingCustomFieldNames:Object.keys(me),onProceed:nn,onCancel:function(){return De(!1)}}),Object($.jsxs)(ie.a,{open:n,maxWidth:"xs",fullWidth:!0,onBackdropClick:un,onEscapeKeyDown:un,children:[Object($.jsx)(Hn.a,{children:"Settings"}),Object($.jsx)(oe.a,{children:Object($.jsxs)(le.a,{container:!0,direction:"column",spacing:3,children:[Object($.jsxs)(le.a,{item:!0,children:[Object($.jsx)(Gn.a,{children:"Anki"}),Object($.jsxs)(Kn.a,{className:o.root,children:[Object($.jsx)(re.a,{label:"Anki Connect URL",value:f,error:Boolean(v),helperText:v,color:"secondary",onChange:Dt,InputProps:{endAdornment:Object($.jsx)(be.a,{position:"end",children:Object($.jsx)(de.a,{onClick:At,children:Object($.jsx)(ta.a,{})})})}}),Object($.jsxs)(Xn.a,{children:["Ensure that ",window.location.protocol+"//"+window.location.hostname," is in the webCorsOriginList in your AnkiConnect settings as in this ",Object($.jsx)(Re.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://youtu.be/Mv7fEVb6PHo?t=44",children:"video"}),"."]}),Object($.jsx)(ia,{label:"Deck",value:w,selections:E,onChange:Nt,onSelectionChange:Nt}),Object($.jsx)(ia,{label:"Note Type",value:R,selections:_,onChange:_t,onSelectionChange:_t}),Object($.jsx)(ia,{label:"Sentence Field",value:W,selections:Fe,onChange:Ut,onSelectionChange:Ut}),Object($.jsx)(ia,{label:"Definition Field",value:V,selections:Fe,onChange:Lt,onSelectionChange:Lt}),Object($.jsx)(ia,{label:"Word Field",value:ue,selections:Fe,onChange:Ht,onSelectionChange:Ht}),Object($.jsx)(ia,{label:"Audio Field",value:J,selections:Fe,onChange:Bt,onSelectionChange:Bt}),Object($.jsx)(ia,{label:"Image Field",value:ee,selections:Fe,onChange:Wt,onSelectionChange:Wt}),Object($.jsx)(ia,{label:"Source Field",value:pe,selections:Fe,onChange:zt,onSelectionChange:zt}),ln,Object($.jsx)(ae.a,{className:o.addFieldButton,onClick:function(e){return De(!0)},children:"Add Custom Field"}),Object($.jsx)(Vn.a,{control:Object($.jsx)(Wn.a,{checked:Ce,onChange:cn}),label:"Re-encode audio as mp3 (slower)"}),Object($.jsx)(re.a,{type:"number",label:"Audio Padding Start",fullWidth:!0,value:_e,color:"secondary",onChange:qt,inputProps:{min:0,step:1},InputProps:{endAdornment:Object($.jsx)(be.a,{position:"end",children:"ms"})}}),Object($.jsx)(re.a,{type:"number",label:"Audio Padding End",fullWidth:!0,value:We,color:"secondary",onChange:Vt,inputProps:{min:0,step:1},InputProps:{endAdornment:Object($.jsx)(be.a,{position:"end",children:"ms"})}}),Object($.jsx)(re.a,{type:"number",label:"Max Image Width",fullWidth:!0,value:Ve,color:"secondary",onChange:Kt,inputProps:{min:0,step:1}}),Object($.jsx)(re.a,{type:"number",label:"Max Image Height",fullWidth:!0,value:Je,color:"secondary",onChange:Xt,inputProps:{min:0,step:1}})]})]}),Object($.jsxs)(le.a,{item:!0,children:[Object($.jsx)(Gn.a,{children:"Video Subtitle Appearance"}),Object($.jsxs)(Kn.a,{children:[Object($.jsx)("div",{className:o.subtitleSetting,children:Object($.jsx)(re.a,{type:"color",label:"Subtitle Color",fullWidth:!0,value:$e,color:"secondary",onChange:Gt})}),Object($.jsx)("div",{className:o.subtitleSetting,children:Object($.jsx)(re.a,{type:"number",label:"Subtitle Size",fullWidth:!0,value:at,color:"secondary",onChange:Jt,inputProps:{min:1,step:1}})}),Object($.jsx)("div",{className:o.subtitleSetting,children:Object($.jsx)(re.a,{type:"color",label:"Subtitle Outline Color",fullWidth:!0,value:ot,color:"secondary",onChange:Qt})}),Object($.jsx)("div",{className:o.subtitleSetting,children:Object($.jsx)(re.a,{type:"number",label:"Subtitle Outline Thickness",fullWidth:!0,value:dt,onChange:Yt,inputProps:{min:0,step:1},color:"secondary"})}),Object($.jsx)("div",{className:o.subtitleSetting,children:Object($.jsx)(re.a,{type:"color",label:"Subtitle Background Color",fullWidth:!0,value:pt,color:"secondary",onChange:Zt})}),Object($.jsx)("div",{className:o.subtitleSetting,children:Object($.jsx)(re.a,{type:"number",label:"Subtitle Background Opacity",fullWidth:!0,inputProps:{min:0,max:1,step:.1},value:mt,color:"secondary",onChange:$t})}),Object($.jsx)("div",{className:o.subtitleSetting,children:Object($.jsx)(re.a,{type:"text",label:"Subtitle Font Family",placeholder:"Inherited",fullWidth:!0,value:Ct,color:"secondary",onChange:en})}),Object($.jsx)("div",{className:o.subtitlePreview,children:Object($.jsx)("input",{value:Ft,className:o.subtitlePreviewInput,onChange:tn,style:sn})})]})]}),Object($.jsxs)(le.a,{item:!0,children:[Object($.jsx)(Gn.a,{children:"Theme"}),Object($.jsxs)("div",{children:[Object($.jsx)(Vn.a,{control:Object($.jsx)($n.a,{checked:"light"===Pt,value:"light",onChange:on}),label:"Light"}),Object($.jsx)(Vn.a,{control:Object($.jsx)($n.a,{checked:"dark"===Pt,value:"dark",onChange:on}),label:"Dark"})]})]})]})}),Object($.jsx)(ce.a,{children:Object($.jsx)(ae.a,{onClick:un,children:"OK"})})]})]})}var oa="ankiConnectUrl",sa="deck",ua="noteType",la="sentenceField",da="definitionField",ba="audioField",fa="imageField",ha="wordField",ja="sourceField",pa="customAnkiFields",va="subtitleSize",ga="subtitleColor",Oa="subtitleOutlineThickness",ma="subtitleOutlineColor",ka="subtitleBackgroundColor",xa="subtitleBackgroundOpacity",ya="subtitleFontFamily",Ca="subtitlePreview",wa="audioPaddingStart",Sa="audioPaddingEnd",Ta="maxImageWidth",Fa="maxImageHeight",Ea="volume",Ia="preferMp3",Ma="themeType",Pa=function(){function e(){Object(m.a)(this,e)}return Object(k.a)(e,[{key:"settings",get:function(){return{ankiConnectUrl:this.ankiConnectUrl,deck:this.deck,noteType:this.noteType,sentenceField:this.sentenceField,definitionField:this.definitionField,audioField:this.audioField,imageField:this.imageField,wordField:this.wordField,customAnkiFields:this.customAnkiFields,sourceField:this.sourceField,subtitleSize:this.subtitleSize,subtitleColor:this.subtitleColor,subtitleOutlineThickness:this.subtitleOutlineThickness,subtitleOutlineColor:this.subtitleOutlineColor,subtitleBackgroundColor:this.subtitleBackgroundColor,subtitleBackgroundOpacity:this.subtitleBackgroundOpacity,subtitleFontFamily:this.subtitleFontFamily,subtitlePreview:this.subtitlePreview,preferMp3:this.preferMp3,themeType:this.themeType,audioPaddingStart:this.audioPaddingStart,audioPaddingEnd:this.audioPaddingEnd,maxImageWidth:this.maxImageWidth,maxImageHeight:this.maxImageHeight,surroundingSubtitlesCountRadius:this.surroundingSubtitlesCountRadius,surroundingSubtitlesTimeRadius:this.surroundingSubtitlesTimeRadius}},set:function(e){this.ankiConnectUrl=e.ankiConnectUrl,this.deck=e.deck,this.noteType=e.noteType,this.modelNames=e.modelNames,this.sentenceField=e.sentenceField,this.definitionField=e.definitionField,this.audioField=e.audioField,this.imageField=e.imageField,this.wordField=e.wordField,this.sourceField=e.sourceField,this.subtitleSize=e.subtitleSize,this.subtitleColor=e.subtitleColor,this.subtitleOutlineThickness=e.subtitleOutlineThickness,this.subtitleOutlineColor=e.subtitleOutlineColor,this.subtitleBackgroundColor=e.subtitleBackgroundColor,this.subtitleBackgroundOpacity=e.subtitleBackgroundOpacity,this.subtitleFontFamily=e.subtitleFontFamily,this.subtitlePreview=e.subtitlePreview,this.customAnkiFields=e.customAnkiFields,this.preferMp3=e.preferMp3,this.themeType=e.themeType,this.audioPaddingStart=e.audioPaddingStart,this.audioPaddingEnd=e.audioPaddingEnd,this.maxImageWidth=e.maxImageWidth,this.maxImageHeight=e.maxImageHeight}},{key:"subtitleSettings",get:function(){return{subtitleSize:this.subtitleSize,subtitleColor:this.subtitleColor,subtitleOutlineThickness:this.subtitleOutlineThickness,subtitleOutlineColor:this.subtitleOutlineColor,subtitleBackgroundColor:this.subtitleBackgroundColor,subtitleBackgroundOpacity:this.subtitleBackgroundOpacity,subtitleFontFamily:this.subtitleFontFamily}}},{key:"ankiSettings",get:function(){return{ankiConnectUrl:this.ankiConnectUrl,deck:this.deck,noteType:this.noteType,modelNames:this.modelNames,sentenceField:this.sentenceField,definitionField:this.definitionField,audioField:this.audioField,imageField:this.imageField,wordField:this.wordField,sourceField:this.sourceField,customAnkiFields:this.customAnkiFields,preferMp3:this.preferMp3,audioPaddingStart:this.audioPaddingStart,audioPaddingEnd:this.audioPaddingEnd,maxImageWidth:this.maxImageWidth,maxImageHeight:this.maxImageHeight,surroundingSubtitlesCountRadius:this.surroundingSubtitlesCountRadius,surroundingSubtitlesTimeRadius:this.surroundingSubtitlesTimeRadius}}},{key:"miscSettings",get:function(){return{themeType:this.themeType}}},{key:"ankiConnectUrl",get:function(){return localStorage.getItem(oa)||"http://127.0.0.1:8765"},set:function(e){localStorage.setItem(oa,e)}},{key:"deck",get:function(){return localStorage.getItem(sa)},set:function(e){localStorage.setItem(sa,e)}},{key:"noteType",get:function(){return localStorage.getItem(ua)},set:function(e){localStorage.setItem(ua,e)}},{key:"sentenceField",get:function(){return localStorage.getItem(la)},set:function(e){localStorage.setItem(la,e)}},{key:"definitionField",get:function(){return localStorage.getItem(da)},set:function(e){localStorage.setItem(da,e)}},{key:"audioField",get:function(){return localStorage.getItem(ba)},set:function(e){localStorage.setItem(ba,e)}},{key:"imageField",get:function(){return localStorage.getItem(fa)},set:function(e){localStorage.setItem(fa,e)}},{key:"wordField",get:function(){return localStorage.getItem(ha)},set:function(e){localStorage.setItem(ha,e)}},{key:"sourceField",get:function(){return localStorage.getItem(ja)},set:function(e){localStorage.setItem(ja,e)}},{key:"customAnkiFields",get:function(){var e=localStorage.getItem(pa);return e?JSON.parse(e):{}},set:function(e){localStorage.setItem(pa,JSON.stringify(e))}},{key:"subtitleColor",get:function(){return localStorage.getItem(ga)||"#ffffff"},set:function(e){localStorage.setItem(ga,e)}},{key:"subtitleSize",get:function(){return localStorage.getItem(va)||36},set:function(e){localStorage.setItem(va,e)}},{key:"subtitleOutlineColor",get:function(){return localStorage.getItem(ma)||"#000000"},set:function(e){localStorage.setItem(ma,e)}},{key:"subtitleOutlineThickness",get:function(){return localStorage.getItem(Oa)||0},set:function(e){localStorage.setItem(Oa,e)}},{key:"subtitleBackgroundColor",get:function(){return localStorage.getItem(ka)||"#000000"},set:function(e){localStorage.setItem(ka,e)}},{key:"subtitleBackgroundOpacity",get:function(){return localStorage.getItem(xa)||.5},set:function(e){localStorage.setItem(xa,e)}},{key:"subtitleFontFamily",get:function(){return localStorage.getItem(ya)||""},set:function(e){localStorage.setItem(ya,e)}},{key:"subtitlePreview",get:function(){return localStorage.getItem(Ca)||"\u30a2\u3042\u5b89"},set:function(e){localStorage.setItem(Ca,e)}},{key:"volume",get:function(){return localStorage.getItem(Ea)||100},set:function(e){localStorage.setItem(Ea,e)}},{key:"preferMp3",get:function(){return"true"===localStorage.getItem(Ia)||!1},set:function(e){localStorage.setItem(Ia,e)}},{key:"themeType",get:function(){return localStorage.getItem(Ma)||"dark"},set:function(e){localStorage.setItem(Ma,e)}},{key:"audioPaddingStart",get:function(){var e=localStorage.getItem(wa);return e?Number(e):0},set:function(e){localStorage.setItem(wa,e)}},{key:"audioPaddingEnd",get:function(){var e=localStorage.getItem(Sa);return e?Number(e):500},set:function(e){localStorage.setItem(Sa,e)}},{key:"maxImageWidth",get:function(){var e=localStorage.getItem(Ta);return e?Number(e):0},set:function(e){localStorage.setItem(Ta,e)}},{key:"maxImageHeight",get:function(){var e=localStorage.getItem(Fa);return e?Number(e):0},set:function(e){localStorage.setItem(Fa,e)}},{key:"surroundingSubtitlesCountRadius",get:function(){return 1}},{key:"surroundingSubtitlesTimeRadius",get:function(){return 5e3}}]),e}(),Ra=n(177),Da=function(){function e(t){Object(m.a)(this,e),this.channel=new BroadcastChannel(t),this.time=0,this.duration=0,this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.closeCallbacks=[],this.readyCallbacks=[],this.subtitlesCallbacks=[],this.condensedModeToggleCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.finishedAnkiDialogRequestCallbacks=[];var n=this;this.channel.onmessage=function(e){switch(e.data.command){case"init":break;case"ready":var t,a=Object(f.a)(n.readyCallbacks);try{for(a.s();!(t=a.n()).done;){(0,t.value)(e.data.duration)}}catch(w){a.e(w)}finally{a.f()}break;case"play":var r,i=Object(f.a)(n.playCallbacks);try{for(i.s();!(r=i.n()).done;){(0,r.value)()}}catch(w){i.e(w)}finally{i.f()}break;case"pause":var c,o=Object(f.a)(n.pauseCallbacks);try{for(o.s();!(c=o.n()).done;){(0,c.value)()}}catch(w){o.e(w)}finally{o.f()}break;case"currentTime":var s,u=Object(f.a)(n.currentTimeCallbacks);try{for(u.s();!(s=u.n()).done;){(0,s.value)(e.data.value)}}catch(w){u.e(w)}finally{u.f()}break;case"audioTrackSelected":var l,d=Object(f.a)(n.audioTrackSelectedCallbacks);try{for(d.s();!(l=d.n()).done;){(0,l.value)(e.data.id)}}catch(w){d.e(w)}finally{d.f()}break;case"close":var b,h=Object(f.a)(n.closeCallbacks);try{for(h.s();!(b=h.n()).done;){(0,b.value)()}}catch(w){h.e(w)}finally{h.f()}break;case"subtitles":var j,p=Object(f.a)(n.subtitlesCallbacks);try{for(p.s();!(j=p.n()).done;){(0,j.value)(e.data.value)}}catch(w){p.e(w)}finally{p.f()}break;case"subtitleSettings":break;case"condensedModeToggle":var v,g=Object(f.a)(n.condensedModeToggleCallbacks);try{for(g.s();!(v=g.n()).done;){(0,v.value)(e.data.value)}}catch(w){g.e(w)}finally{g.f()}break;case"hideSubtitlePlayerToggle":var O,m=Object(f.a)(n.hideSubtitlePlayerToggleCallbacks);try{for(m.s();!(O=m.n()).done;){(0,O.value)(e.data.value)}}catch(w){m.e(w)}finally{m.f()}break;case"ankiDialogRequest":var k,x=Object(f.a)(n.ankiDialogRequestCallbacks);try{for(x.s();!(k=x.n()).done;){(0,k.value)()}}catch(w){x.e(w)}finally{x.f()}break;case"finishedAnkiDialogRequest":var y,C=Object(f.a)(n.finishedAnkiDialogRequestCallbacks);try{for(C.s();!(y=C.n()).done;){(0,y.value)(e.data.resume)}}catch(w){C.e(w)}finally{C.f()}break;case"ankiSettings":case"miscSettings":break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(k.a)(e,[{key:"currentTime",get:function(){return this.time},set:function(e){var t;this.time=e,null===(t=this.channel)||void 0===t||t.postMessage({command:"currentTime",value:this.time,echo:!0})}},{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onClose",value:function(e){this.closeCallbacks.push(e)}},{key:"onReady",value:function(e){this.readyCallbacks.push(e)}},{key:"onSubtitles",value:function(e){this.subtitlesCallbacks.push(e)}},{key:"onCondensedModeToggle",value:function(e){this.condensedModeToggleCallbacks.push(e)}},{key:"onHideSubtitlePlayerToggle",value:function(e){this.hideSubtitlePlayerToggleCallbacks.push(e)}},{key:"onAnkiDialogRequest",value:function(e){this.ankiDialogRequestCallbacks.push(e)}},{key:"onFinishedAnkiDialogRequest",value:function(e){this.finishedAnkiDialogRequestCallbacks.push(e)}},{key:"ready",value:function(e,t,n,a){var r;null===(r=this.channel)||void 0===r||r.postMessage({command:"ready",duration:e,paused:t,currentTime:0,audioTracks:n,selectedAudioTrack:a})}},{key:"readyState",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"readyState",value:e})}},{key:"play",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"play",echo:!0})}},{key:"pause",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"pause",echo:!0})}},{key:"audioTrackSelected",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"audioTrackSelected",id:e})}},{key:"offset",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"offset",value:e})}},{key:"popOutToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"popOutToggle"})}},{key:"copy",value:function(e,t,n){var a;null===(a=this.channel)||void 0===a||a.postMessage({command:"copy",subtitle:e,surroundingSubtitles:t,preventDuplicate:n})}},{key:"condensedModeToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"condensedModeToggle"})}},{key:"hideSubtitlePlayerToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"hideSubtitlePlayerToggle"})}},{key:"ankiDialogRequest",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"ankiDialogRequest",forwardToVideo:e})}},{key:"toggleSubtitleTrackInList",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"toggleSubtitleTrackInList",track:e})}},{key:"close",value:function(){this.channel&&(this.channel.postMessage({command:"exit"}),this.channel.close(),this.channel=null,this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.closeCallbacks=[],this.readyCallbacks=[],this.subtitlesCallbacks=[],this.condensedModeToggleCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.finishedAnkiDialogRequestCallbacks=[])}}]),e}(),Aa=Object(j.a)({root:{position:"relative",backgroundColor:"black",height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},video:{margin:"auto"},cursorHidden:{cursor:"none"}});function Na(e,t,n,a){if(window.outerWidth&&e.videoWidth>0&&e.videoHeight>0){var r=window.screen.availWidth-(window.outerWidth-window.innerWidth),i=window.screen.availHeight-(window.outerHeight-window.innerHeight),c=Math.min(1,Math.min(r/e.videoWidth,i/e.videoHeight));window.resizeTo(c*e.videoWidth+(window.outerWidth-window.innerWidth),c*e.videoHeight+(window.outerHeight-window.innerHeight))}var o,s;if(e.audioTracks){o=[];var u,l=Object(f.a)(e.audioTracks);try{for(l.s();!(u=l.n()).done;){var d=u.value;o.push({id:d.id,label:d.label,language:d.language}),d.enabled&&(s=d.id)}}catch(b){l.e(b)}finally{l.f()}}else o=null,s=null;n(o),a(s),t.ready(e.duration,e.paused,o,s)}function _a(e){var t=Aa(),n=e.settingsProvider,i=e.videoFile,c=e.channel,o=e.popOut,b=e.onError,h=Object(a.useRef)(),j=Object(a.useRef)(),p=g(!0),v=Object(d.a)(p,2),O=v[0],m=v[1];j.current&&(j.current.width=O,j.current.height=m);var k=Object(a.useMemo)((function(){return new Da(c)}),[c]),x=Object(a.useState)(!1),y=Object(d.a)(x,2),C=y[0],S=y[1],T=function(){var e=Object(a.useState)(Boolean(document.fullscreenElement)),t=Object(d.a)(e,2),n=t[0],r=t[1];return Object(a.useEffect)((function(){var e=function(){return r(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",e),function(){return document.removeEventListener("fullscreenchange",e)}}),[]),n}(),F=Object(a.useRef)();F.current=T;var E=Object(a.useRef)();E.current=C;var I=Object(a.useState)(0),M=Object(d.a)(I,2),P=M[0],R=M[1],D=Object(a.useState)(0),A=Object(d.a)(D,2),N=A[0],_=A[1],U=Object(a.useState)(),L=Object(d.a)(U,2),B=L[0],W=L[1],H=Object(a.useState)(),z=Object(d.a)(H,2),q=z[0],G=z[1],J=Object(a.useState)([]),Q=Object(d.a)(J,2),Y=Q[0],Z=Q[1],ee=Object(a.useState)([]),ne=Object(d.a)(ee,2),ae=ne[0],re=ne[1],ie=Object(a.useState)(!0),ce=Object(d.a)(ie,2),oe=ce[0],se=ce[1],ue=Object(a.useState)({}),le=Object(d.a)(ue,2),de=le[0],be=le[1],fe=Object(a.useState)(!1),he=Object(d.a)(fe,2),je=he[0],pe=he[1],ve=Object(a.useState)(!1),ge=Object(d.a)(ve,2),Oe=ge[0],me=ge[1],ke=Object(a.useRef)([]);ke.current=ae;var xe=Object(a.useMemo)((function(){return new Bt}),[]),ye=Object(a.useRef)({x:0,y:0}),Ce=Object(a.useRef)(),we=Object(a.useState)(),Se=Object(d.a)(we,2),Te=Se[0],Fe=Se[1],Ee=Object(a.useState)(!1),Ie=Object(d.a)(Ee,2),Me=Ie[0],Pe=Ie[1],Re=Object(a.useState)(!0),De=Object(d.a)(Re,2),Ae=De[0],Ne=De[1],_e=Object(a.useState)(!1),Ue=Object(d.a)(_e,2),Le=Ue[0],Be=Ue[1],We=Object(a.useRef)();We.current=Le;var He=Object(a.useCallback)((function(e){e&&(j.current=e,4===e.readyState?Na(e,k,W,G):e.onloadeddata=function(t){Na(e,k,W,G)},e.oncanplay=function(e){k.readyState(4),E.current&&xe.start()},e.ontimeupdate=function(t){return xe.setTime(1e3*e.currentTime)},e.onerror=function(t){return b(function(e){var t;switch(e.error.code){case 1:t="Aborted";break;case 2:t="Network error";break;case 3:t="Decoding error";break;case 4:t="Source not supported";break;default:t="Unknown error"}return t+": "+(e.error.message||"<details missing>")}(e))})}),[xe,k,b]);function ze(e){var t,n=Object(f.a)(j.current.audioTracks);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.id===e?a.enabled=!0:a.enabled=!1}}catch(r){n.e(r)}finally{n.f()}}Object(a.useEffect)((function(){return k.onReady((function(e){return R(e)})),k.onPlay(Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.current.play();case 2:xe.start(),S(!0);case 4:case"end":return e.stop()}}),e)})))),k.onPause((function(){j.current.pause(),xe.stop(),S(!1)})),k.onCurrentTime((function(e){var t;j.current&&(j.current.currentTime=e),4===(null===(t=j.current)||void 0===t?void 0:t.readyState)&&k.readyState(4),xe.stop(),xe.setTime(1e3*e)})),k.onAudioTrackSelected((function(e){ze(e),k.audioTrackSelected(e)})),k.onClose((function(){k.close(),window.close()})),k.onSubtitles((function(e){if(Z(e),e&&e.length>0){var t=e[0],n=t.start-t.originalStart;_(n)}})),k.onCondensedModeToggle((function(e){return pe(e)})),k.onHideSubtitlePlayerToggle((function(e){return me(e)})),k.onAnkiDialogRequest((function(){F.current&&!o&&(document.exitFullscreen(),Be(!0))})),k.onFinishedAnkiDialogRequest(function(){var e=Object(u.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!We.current){e.next=11;break}if(!t){e.next=10;break}return e.prev=2,e.next=5,null===(n=Ce.current)||void 0===n?void 0:n.requestFullscreen();case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.error(e.t0);case 10:Be(!1);case 11:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}()),window.onbeforeunload=function(e){h.current||k.close()},function(){return k.close()}}),[xe,k,o]);var qe=Object(a.useCallback)((function(){j.current&&k.play()}),[k]),Ve=Object(a.useCallback)((function(){return k.pause()}),[k]),Ke=Object(a.useCallback)((function(e){E.current&&xe.stop();var t=e*P;k.currentTime=t/1e3}),[P,xe,k]);var Xe=Object(a.useCallback)((function(e){E.current&&(xe.stop(),k.pause()),ze(e),G(e),k.currentTime=0,k.audioTrackSelected(e)}),[k,xe]);Object(a.useEffect)((function(){if(Y&&0!==Y.length){var e=setInterval((function(){for(var e=xe.time(P),t=[],n=0;n<Y.length;++n){var a=Y[n];if(e>=a.start&&e<a.end&&!de[a.track]&&t.push(Object(l.a)(Object(l.a)({},a),{},{index:n})),e<a.start)break}(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};if(e.length!==t.length)return!1;for(var a=0;a<e.length;++a)if(!n(e[a],t[a]))return!1;return!0})(t=t.sort((function(e,t){return e.track-t.track})),ke.current,(function(e,t){return e.index===t.index}))||re(t)}),50);return function(){return clearTimeout(e)}}}),[Y,de,xe,P]);var Ge=Object(a.useCallback)((function(e){_(e),Z((function(t){return t.map((function(t){return{text:t.text,start:t.originalStart+e,originalStart:t.originalStart,end:t.originalEnd+e,originalEnd:t.originalEnd,track:t.track}}))})),k.offset(e)}),[k]);Object(a.useEffect)((function(){var e=w.bindSeekToSubtitle((function(e,t){e.stopPropagation(),e.preventDefault(),k.currentTime=t.start/1e3}),(function(){return!j.current}),(function(){return xe.time(P)}),(function(){return Y}));return function(){return e()}}),[k,Y,P,xe]);var Je=Object(a.useCallback)((function(e){return K(Y,e,n.surroundingSubtitlesCountRadius,n.surroundingSubtitlesTimeRadius)}),[Y,n.surroundingSubtitlesCountRadius,n.surroundingSubtitlesTimeRadius]);Object(a.useEffect)((function(){var e=w.bindCopy((function(e,t){e.stopPropagation(),e.preventDefault();var n=!Y||0===Y.length;k.copy(t,n?X(t,P,5e3):Je(t.index)),T&&(Fe(""===t.text?"Saved ".concat(V(t.start)):'Copied: "'.concat(t.text,'"')),Pe(!0))}),(function(){return!1}),(function(){if(!Y||0===Y.length){var e=xe.time(P);return{text:"",start:e,end:Math.min(e+5e3,P),track:0}}return ke.current&&0!==ke.current.length?ke.current[0]:null}));return function(){return e()}}),[k,xe,P,Y,Je,T]),Object(a.useEffect)((function(){var e=w.bindAdjustOffset((function(e,t){e.preventDefault(),e.stopPropagation(),Ge(t)}),(function(){return!1}),(function(){return Y}));return function(){return e()}}),[Ge,Y]),Object(a.useEffect)((function(){var e=w.bindToggleSubtitles((function(e){e.preventDefault(),e.stopPropagation(),se((function(e){return!e}))}),(function(){}),(function(){return!1}));return function(){return e()}}),[]),Object(a.useEffect)((function(){var e=w.bindToggleSubtitleTrackInVideo((function(e,t){e.preventDefault(),e.stopPropagation(),be((function(e){var n=Object(l.a)({},e);return n[t]=!e[t],n}))}),(function(){}),(function(){return!1}));return function(){return e()}}),[]),Object(a.useEffect)((function(){var e=w.bindToggleSubtitleTrackInList((function(e,t){e.preventDefault(),e.stopPropagation(),k.toggleSubtitleTrackInList(t)}),(function(){}),(function(){return!1}));return function(){return e()}}),[k]),Object(a.useEffect)((function(){var e=w.bindOffsetToSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),Ge(t)}),(function(){return!1}),(function(){return xe.time(P)}),(function(){return Y}));return function(){return e()}}),[Ge,Y,xe,P]),Object(a.useEffect)((function(){var e=w.bindAnkiExport((function(e){if(e.preventDefault(),e.stopPropagation(),Y&&0!==Y.length){if(ke.current&&ke.current.length>0){var t=ke.current[0];k.copy(t,Je(t.index),!0)}}else{var n=xe.time(P),a={text:"",start:n,end:Math.min(n+5e3,P),track:0};k.copy(a,X(a,P,5e3),!1)}k.ankiDialogRequest(T)}),(function(){return!1}));return function(){return e()}}),[k,Y,xe,P,Je,T]),Object(a.useEffect)((function(){var e=w.bindPlay((function(e){e.preventDefault(),C?k.pause():k.play()}),(function(){return!1}));return function(){return e()}}),[C,k]);var Qe=Object(a.useCallback)((function(e){return Ne(e)}),[]),Ye=Object(a.useCallback)((function(){return se((function(e){return!e}))}),[]),Ze=Object(a.useCallback)((function(){var e;T?document.exitFullscreen():null===(e=Ce.current)||void 0===e||e.requestFullscreen()}),[T]),$e=Object(a.useCallback)((function(e){j.current&&(j.current.volume=e)}),[]),et=Object(a.useCallback)((function(){k.popOutToggle(),o&&(h.current=!0,window.close())}),[k,o]),tt=Object(a.useCallback)((function(){k.condensedModeToggle()}),[k]),nt=Object(a.useCallback)((function(){k.close(),window.close()}),[k]),at=Object(a.useCallback)((function(){k.hideSubtitlePlayerToggle()}),[k]),rt=Object(a.useCallback)((function(){C?k.pause():k.play()}),[k,C]),it=Object(a.useCallback)((function(){return Ze()}),[Ze]),ct=Object(a.useCallback)((function(){return Pe(!1)}),[]),ot=n.subtitleSettings,st=ot.subtitleSize,ut=ot.subtitleColor,lt=ot.subtitleOutlineThickness,dt=ot.subtitleOutlineColor,bt=ot.subtitleBackgroundColor,ft=ot.subtitleBackgroundOpacity,ht=ot.subtitleFontFamily,pt=Object(a.useMemo)((function(){return e={subtitleSize:st,subtitleColor:ut,subtitleOutlineThickness:lt,subtitleOutlineColor:dt,subtitleBackgroundColor:bt,subtitleBackgroundOpacity:ft,subtitleFontFamily:ht},Object(l.a)({position:"absolute",paddingLeft:20,paddingRight:20,bottom:100,textAlign:"center"},jt(e));var e}),[st,ut,lt,dt,bt,ft,ht]);return Object($.jsxs)("div",{ref:Ce,onMouseMove:function(e){ye.current.x=e.screenX,ye.current.y=e.screenY},className:t.root,children:[Object($.jsx)("video",{preload:"auto",nocontrols:1,onClick:rt,onDoubleClick:it,className:Ae?t.video:"".concat(t.cursorHidden," ").concat(t.video),ref:He,src:i}),oe&&Object($.jsx)("div",{style:pt,children:ae.map((function(e){return Object($.jsxs)(r.a.Fragment,{children:[e.text,Object($.jsx)("br",{})]},e.index)}))}),T&&Object($.jsx)(te,{open:Me,onClose:ct,autoHideDuration:3e3,severity:"success",children:Te}),Object($.jsx)(Sn,{mousePositionRef:ye,playing:C,clock:xe,length:P,audioTracks:B,selectedAudioTrack:q,subtitlesToggle:Y&&Y.length>0,subtitlesEnabled:oe,offsetEnabled:!0,offset:N,fullscreenEnabled:!0,fullscreen:T,closeEnabled:!o,popOut:o,volumeEnabled:!0,popOutEnabled:!Ra.isMobile,condensedModeToggleEnabled:!0,condensedModeEnabled:je,hideSubtitlePlayerToggleEnabled:(null===Y||void 0===Y?void 0:Y.length)>0&&!o&&!T,subtitlePlayerHidden:Oe,onShow:Qe,onPlay:qe,onPause:Ve,onSeek:Ke,onAudioTrackSelected:Xe,onSubtitlesToggle:Ye,onFullscreenToggle:Ze,onVolumeChange:$e,onOffsetChange:Ge,onPopOutToggle:et,onCondensedModeToggle:tt,onClose:nt,onHideSubtitlePlayerToggle:at,settingsProvider:n})]})}var Ua="https://github.com/killergerbah/asbplayer/releases/latest",La=Object(j.a)((function(e){return{content:{flexGrow:1,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginRight:0},contentShift:function(t){var n=t.drawerWidth;return{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:n}}}}));function Ba(e,t,n,a){if(e.audio){var r,i,c,o,s=null!==(r=e.audio.start)&&void 0!==r?r:e.start,u=null!==(i=e.audio.end)&&void 0!==i?i:e.end;return N.fromBase64(e.subtitleFile.name,Math.max(0,s-(null!==(c=e.audio.paddingStart)&&void 0!==c?c:0)),u+(null!==(o=e.audio.paddingEnd)&&void 0!==o?o:0),e.audio.base64,e.audio.extension)}var l,d;return e.audioFile||e.videoFile?(t?(l=t.subtitleStart,d=t.subtitleEnd):(l=e.start,d=e.end),N.fromFile(e.audioFile||e.videoFile,Math.max(0,l-n),d+a,e.audioTrack)):null}function Wa(e,t,n){return e.image?B.fromBase64(e.subtitleFile.name,e.start,e.image.base64,e.image.extension):e.videoFile?B.fromFile(e.videoFile,e.start,t,n):null}function Ha(e){var t,n,a,r,i,c=null!==(t=null!==(n=null===e||void 0===e||null===(a=e.subtitleFile)||void 0===a?void 0:a.name)&&void 0!==n?n:null===e||void 0===e||null===(r=e.audioFile)||void 0===r?void 0:r.name)&&void 0!==t?t:null===e||void 0===e||null===(i=e.videoFile)||void 0===i?void 0:i.name;return c?"".concat(c," (").concat(V(e.start),")"):null}function za(e){var t=La(e);return Object($.jsx)("main",{className:Object(Q.a)(t.content,Object(b.a)({},t.contentShift,e.drawerOpen)),children:e.children})}var qa=function(){var e=Object(a.useMemo)((function(){return new Ze}),[]),t=Object(a.useMemo)((function(){return new Pa}),[]),n=Object(a.useMemo)((function(){return Object(p.a)({palette:{primary:{main:"#49007a"},secondary:{main:"#ff1f62"},error:{main:O.a.A400},type:t.themeType}})}),[t.themeType]),r=Object(a.useMemo)((function(){return new q(t)}),[t]),i="/video"===Object(h.g)().pathname,c=Object(a.useMemo)((function(){return new ht(!i)}),[i]),o=Object(a.useRef)(),b=g(!i),j=Object(d.a)(b,1)[0],m=o.current?.2:.3,k=o.current?150:300,x=Math.max(k,j*m),y=Object(a.useState)([]),C=Object(d.a)(y,2),w=C[0],S=C[1],T=Object(a.useRef)();T.current=w;var F=Object(a.useState)(!1),E=Object(d.a)(F,2),I=E[0],M=E[1],P=Object(a.useState)(),R=Object(d.a)(P,2),D=R[0],A=R[1],N=Object(a.useState)(!1),_=Object(d.a)(N,2),U=_[0],L=_[1],B=Object(a.useState)(),W=Object(d.a)(B,2),H=W[0],z=W[1],K=Object(a.useState)(),X=Object(d.a)(K,2),G=X[0],Q=X[1],Y=Object(a.useState)({subtitleFiles:[]}),Z=Object(d.a)(Y,2),ee=Z[0],ne=Z[1],ae=Object(a.useState)(!1),re=Object(d.a)(ae,2),ie=re[0],ce=re[1],oe=Object(a.useState)(!1),se=Object(d.a)(oe,2),ue=se[0],le=se[1],de=Object(a.useRef)(),be=Object(a.useState)(),fe=Object(d.a)(be,2),he=fe[0],je=fe[1],pe=Object(a.useState)(!1),ve=Object(d.a)(pe,2),ge=ve[0],Oe=ve[1],me=Object(a.useState)(!1),ke=Object(d.a)(me,2),xe=ke[0],ye=ke[1],Ce=Object(a.useState)(),we=Object(d.a)(Ce,2),Se=we[0],Ee=we[1],Ie=Object(a.useMemo)((function(){return Se&&((e=Se)?{subtitleStart:e.start,subtitleEnd:e.end,subtitles:e.surroundingSubtitles||[{start:e.start,end:e.end,text:e.text,track:e.track}]}:null);var e}),[Se]),Me=Object(a.useMemo)((function(){return Se&&Ba(Se,Ie,t.audioPaddingStart,t.audioPaddingEnd)}),[Se,Ie,t.audioPaddingStart,t.audioPaddingEnd]),Re=Object(a.useMemo)((function(){return Se&&Wa(Se,t.maxImageWidth,t.maxImageHeight)}),[Se,t.maxImageWidth,t.maxImageHeight]),De=Object(a.useState)(),Ae=Object(d.a)(De,2),Ne=Ae[0],_e=Ae[1],Ue=Object(a.useState)(!1),Le=Object(d.a)(Ue,2),Be=Le[0],We=Le[1],He=Object(a.useState)({timestamp:0,resume:!1}),ze=Object(d.a)(He,2),Ve=ze[0],Ke=ze[1],Xe=Object(a.useState)(!1),Je=Object(d.a)(Xe,2),Qe=Je[0],Ye=Je[1],$e=Object(a.useState)(!1),et=Object(d.a)($e,2),tt=et[0],nt=et[1],at=Object(a.useState)(!1),rt=Object(d.a)(at,2),it=rt[0],ct=rt[1],ot=Object(a.useState)(!1),st=Object(d.a)(ot,2),ut=st[0],lt=st[1],dt=Object(a.useState)(),bt=Object(d.a)(dt,2),jt=bt[0],pt=bt[1],vt=Object(a.useState)(),gt=Object(d.a)(vt,2),Ot=gt[0],mt=gt[1],kt=Object(a.useState)([]),xt=Object(d.a)(kt,2),yt=xt[0],Ct=xt[1],wt=Object(a.useRef)(),St=ee.subtitleFiles,Tt=Object(a.useCallback)((function(e,t,n,a,r,i,c,o,s,u){e&&navigator.clipboard.writeText(e.text),S((function(d){if(s&&d.length>0){var b=d[d.length-1];if(e.start===b.start&&e.end===b.end&&e.text===b.text&&r.name===b.subtitleFile.name)return d}var h,j=[],p=!1,v=Object(f.a)(d);try{for(v.s();!(h=v.n()).done;){var g=h.value;if(u&&g.id===u){var O=Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)({},g),e),t&&{surroundingSubtitles:t}),r&&{subtitleFile:r}),n&&{audioFile:n}),a&&{videoFile:a}),i&&{audioTrack:i}),c&&{audio:c}),o&&{image:o});j.push(O),p=!0}else j.push(g)}}catch(m){v.e(m)}finally{v.f()}return p||j.push(Object(l.a)(Object(l.a)({},e),{},{surroundingSubtitles:t,timestamp:Date.now(),id:u||Object(J.a)(),name:he,subtitleFile:r,audioFile:n,videoFile:a,audioTrack:i,audio:c,image:o})),j})),e&&(z("success"),A(""===e.text?"Saved ".concat(V(e.start)):'Copied: "'.concat(e.text,'"')),L(!0))}),[he]),Ft=Object(a.useCallback)((function(){return M((function(e){return!e}))}),[]),Et=Object(a.useCallback)((function(){return M(!1)}),[]),It=Object(a.useCallback)((function(){lt(!0),Ye(!0)}),[]),Mt=Object(a.useCallback)((function(){return nt(!0)}),[]),Pt=Object(a.useCallback)((function(){return nt(!1)}),[]),Dt=Object(a.useCallback)((function(){return L(!1)}),[]),At=Object(a.useCallback)((function(){return ct(!1)}),[]),Nt=Object(a.useCallback)((function(e){t.settings=e,Ye(!1),lt(!1),c.publishMessage({command:"subtitleSettings",value:t.subtitleSettings}),c.publishMessage({command:"ankiSettings",value:t.ankiSettings}),c.publishMessage({command:"miscSettings",value:t.miscSettings})}),[c,t]),Ut=Object(a.useCallback)((function(e){var t,n=[],a=Object(f.a)(w);try{for(a.s();!(t=a.n()).done;){var r=t.value;e.id!==r.id&&n.push(r)}}catch(i){a.e(i)}finally{a.f()}S(n)}),[w]),Lt=Object(a.useCallback)((function(e){z("error"),A(e),L(!0)}),[]),Bt=Object(a.useCallback)((function(e){e===ee.audioFileUrl&&ne((function(t){return URL.revokeObjectURL(e),{subtitleFiles:t.subtitleFiles,audioFile:null,audioFileUrl:null,videoFile:t.videoFile,videoFileUrl:t.videoFileUrl}}))}),[ee]),Wt=Object(a.useCallback)((function(e){e===ee.videoFileUrl&&ne((function(t){return URL.revokeObjectURL(e),{subtitleFiles:t.subtitleFiles,audioFile:t.audioFile,audioFileUrl:t.audioFileUrl,videoFile:null,videoFileUrl:null}}))}),[ee]),Ht=Object(a.useCallback)(function(){var e=Object(u.a)(s.a.mark((function e(n){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ba(n);case 3:a=e.sent,t.preferMp3?a.toMp3().download():a.download(),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0),Lt(e.t0.message);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),[Lt,t]),zt=Object(a.useCallback)(function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Wa(t).download();case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0),Lt(e.t0.message);case 9:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),[Lt]),qt=Object(a.useCallback)((function(e){0!==St.filter((function(t){return t.name===e.subtitleFile.name})).length?Q({text:e.text,originalStart:e.originalStart}):Lt("Subtitle file "+e.subtitleFile.name+" is not open.")}),[St,Lt]),Vt=Object(a.useCallback)((function(e){Ee(e),Oe(!0),ye(!1),lt(!0)}),[]),Kt=Object(a.useCallback)((function(){Oe(!1),ye(!1),lt(!1),Be&&(Ke({timestamp:Date.now(),resume:!0}),We(!1))}),[Be]),Xt=Object(a.useCallback)(function(){var e=Object(u.a)(s.a.mark((function e(t,n,a,i,c,o,u,l){var d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ye(!0),e.prev=1,e.next=4,r.export(t,n,a,i,c,o,u,l);case 4:d=e.sent,"gui"!==l&&("default"===l?(z("success"),A("Export succeeded: "+d),L(!0)):"updateLast"===l&&(z("success"),A("Update succeeded: "+d),L(!0)),Oe(!1),Be&&(Ke({timestamp:Date.now(),resume:!0}),We(!1))),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0),Lt(e.t0.message);case 12:return e.prev=12,ye(!1),lt(!1),e.finish(12);case 16:case"end":return e.stop()}}),e,null,[[1,8,12,16]])})));return function(t,n,a,r,i,c,o,s){return e.apply(this,arguments)}}(),[r,Lt,Be]),Gt=Object(a.useCallback)((function(e){if(0!==T.current.length){var t=T.current[T.current.length-1];Ee(t),Oe(!0),ye(!1),lt(!0),We(!0),e&&_e(Date.now())}}),[]),Jt=Object(a.useCallback)((function(e){pt(e),ct(!0)}),[]);Object(a.useEffect)((function(){function e(e){if(e.length!==yt.length)Ct(e);else{for(var t=!1,n=0;n<yt.length;++n){var a=yt[n],r=e[n];if(a.id!==r.id||a.title!==r.title||a.src!==r.src){t=!0;break}}t&&Ct(e)}Ot&&0===e.filter((function(e){return e.id===Ot.id&&e.src===Ot.src})).length&&(mt(null),Lt("Lost connection with tab "+Ot.id+" "+Ot.title))}return c.subscribeTabs(e),function(){return c.unsubscribeTabs(e)}}),[yt,Ot,c,Lt]);var Qt=Object(a.useCallback)((function(e){return mt(e)}),[]),Yt=Object(a.useCallback)((function(e){try{var t=function(e){var t,n=[],a=null,r=null,i=Object(f.a)(e);try{for(i.s();!(t=i.n()).done;){var c=t.value,o=c.name.lastIndexOf(".");if(-1===o)throw new Error("Unable to determine extension of "+c.name);var s=c.name.substring(o+1,c.name.length);switch(s){case"ass":case"srt":case"vtt":n.push(c);break;case"mkv":case"mp4":case"avi":if(r)throw new Error("Cannot open two video files simultaneously");r=c;break;case"mp3":case"m4a":case"aac":case"flac":case"ogg":case"wav":case"opus":if(a)throw new Error("Cannot open two audio files simultaneously");a=c;break;default:throw new Error("Unsupported extension "+s)}}}catch(u){i.e(u)}finally{i.f()}if(r&&a)throw new Error("Cannot load both an audio and video file simultaneously");return{subtitleFiles:n,audioFile:a,videoFile:r}}(e),n=t.subtitleFiles,a=t.audioFile,r=t.videoFile;if(ne((function(e){ce(!0);var t=null,i=null;return r||a?(!function(e){e.audioFileUrl&&URL.revokeObjectURL(e.audioFileUrl),e.videoFileUrl&&URL.revokeObjectURL(e.videoFileUrl)}(e),r?t=URL.createObjectURL(r):a&&(i=URL.createObjectURL(a)),mt(null)):(r=e.videoFile,t=e.videoFileUrl,a=e.audioFile,i=e.audioFileUrl),{subtitleFiles:0===n.length?e.subtitleFiles:n,audioFile:a,audioFileUrl:i,videoFile:r,videoFileUrl:t}})),n.length>0){var i=n[0].name;je(i.substring(0,i.lastIndexOf(".")))}}catch(c){console.error(c),Lt(c.message)}}),[Lt]);Object(a.useEffect)((function(){function e(e){return t.apply(this,arguments)}function t(){return(t=Object(u.a)(s.a.mark((function e(t){var n,a,r,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("sync"!==t.data.command&&"syncv2"!==t.data.command){e.next=27;break}if(0!==(n=yt.filter((function(e){return e.id===t.tabId&&(!t.src||e.src===t.src)}))).length){e.next=5;break}return t.src?console.error("Received sync request but the requesting tab ID "+t.tabId+" with src "+t.src+" was not found"):console.error("Received sync request but the requesting tab ID "+t.tabId+" was not found"),e.abrupt("return");case 5:if(a=n[0],"sync"!==t.data.command){e.next=19;break}return e.t0=File,e.next=10,fetch("data:text/plain;base64,"+t.data.subtitles.base64);case 10:return e.next=12,e.sent.blob();case 12:e.t1=e.sent,e.t2=[e.t1],e.t3=t.data.subtitles.name,e.t4=new e.t0(e.t2,e.t3),r=[e.t4],e.next=23;break;case 19:if("syncv2"!==t.data.command){e.next=23;break}return e.next=22,Promise.all(t.data.subtitles.map(function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=File,e.next=3,fetch("data:text/plain;base64,"+t.base64);case 3:return e.next=5,e.sent.blob();case 5:return e.t1=e.sent,e.t2=[e.t1],e.t3=t.name,e.abrupt("return",new e.t0(e.t2,e.t3));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 22:r=e.sent;case 23:i=r[0].name,je(i.substring(0,i.lastIndexOf("."))),ne({subtitleFiles:r,audioFile:null,audioFileUrl:null,videoFile:null,videoFileUrl:null}),mt(a);case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return c.subscribe(e),function(){return c.unsubscribe(e)}}),[c,yt]);var Zt=Object(a.useCallback)((function(e){e.preventDefault(),i?Lt("Video player cannot receive dropped files. Drop outside of the video frame instead."):(le(!1),de.current=null,e.dataTransfer.files&&0!==e.dataTransfer.files.length&&Yt(e.dataTransfer.files))}),[i,Lt,Yt]),$t=Object(a.useCallback)((function(){var e,t=null===(e=wt.current)||void 0===e?void 0:e.files;t&&t.length>0&&Yt(t)}),[Yt]),en=Object(a.useCallback)((function(){var e;return null===(e=wt.current)||void 0===e?void 0:e.click()}),[]),tn=Object(a.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),i||(de.current=e.target,le(!0))}),[i]),nn=Object(a.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),i||de.current!==e.target||le(!1)}),[i]),an=Object(a.useCallback)((function(){return ce(!1)}),[]),rn=ie&&!o.current||0===ee.subtitleFiles.length&&!ee.audioFile&&!ee.videoFile;return Object($.jsxs)(v.a,{theme:n,children:[Object($.jsx)(Fe.a,{}),Object($.jsxs)("div",{onDrop:Zt,onDragOver:function(e){return e.preventDefault()},onDragEnter:tn,onDragLeave:nn,children:[Object($.jsx)(te,{open:U,onClose:Dt,autoHideDuration:3e3,severity:H,children:D}),Object($.jsxs)(h.d,{children:[Object($.jsx)(h.b,{exact:!0,path:"/",render:function(){var n=new URLSearchParams(window.location.search),a=n.get("video"),i=n.get("channel"),s=n.get("popout");return a&&i?Object($.jsx)(h.a,{to:"/video?video="+encodeURIComponent(a)+"&channel="+i+"&popout="+s}):Object($.jsxs)("div",{children:[Object($.jsx)(Rt,{items:w,open:I,drawerWidth:x,onClose:Et,onDelete:Ut,onClipAudio:Ht,onDownloadImage:zt,onSelect:qt,onAnki:Vt}),Object($.jsx)(Te,{open:ge,disabled:xe,text:null===Se||void 0===Se?void 0:Se.text,audioClip:Me,image:Re,source:Ha(Se),sliderContext:Ie,customFields:t.customAnkiFields,anki:r,settingsProvider:t,onCancel:Kt,onProceed:Xt,onViewImage:Jt,onOpenSettings:It}),Object($.jsx)(Ge,{open:it,image:jt,onClose:At}),Object($.jsx)(ca,{anki:r,open:Qe,onClose:Nt,settings:t.settings}),Object($.jsx)(qe,{open:tt,extensionUrl:Ua,onClose:Pt}),Object($.jsx)(ft,{title:he||"asbplayer",drawerWidth:x,drawerOpen:I,onOpenCopyHistory:Ft,onOpenSettings:It,onOpenHelp:Mt,onFileSelector:en}),Object($.jsx)("input",{ref:wt,onChange:$t,type:"file",accept:".srt,.ass,.vtt,.mp3,.m4a,.aac,.flac,.ogg,.wav,.opus,.mkv,.mp4,.avi",multiple:!0,hidden:!0}),Object($.jsxs)(za,{drawerWidth:x,drawerOpen:I,children:[rn&&Object($.jsx)(_t,{latestExtensionVersion:"0.16.0",extensionUrl:Ua,extension:c,loading:ie,dragging:ue,onFileSelector:en}),Object($.jsx)(Pe,{dragging:ue,loading:ie}),Object($.jsx)(Bn,{subtitleReader:e,settingsProvider:t,onCopy:Tt,onError:Lt,onUnloadAudio:Bt,onUnloadVideo:Wt,onLoaded:an,onTabSelected:Qt,onAnkiDialogRequest:Gt,tab:Ot,availableTabs:yt,sources:ee,jumpToSubtitle:G,videoFrameRef:o,extension:c,drawerOpen:I,disableKeyEvents:ut,ankiDialogRequested:Be,ankiDialogRequestToVideo:Ne,ankiDialogFinishedRequest:Ve})]})]})}}),Object($.jsx)(h.b,{exact:!0,path:"/video",render:function(){var e=new URLSearchParams(window.location.search),n=e.get("video"),a=e.get("channel"),r="true"===e.get("popout");return Object($.jsx)(_a,{settingsProvider:t,videoFile:n,popOut:r,channel:a,onError:Lt})}})]})]})]})},Va=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,349)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),i(e),c(e)}))},Ka=n(110);c.a.render(Object($.jsx)(Ka.a,{basename:"/asbplayer",forceRefresh:!1,children:Object($.jsx)(qa,{})}),document.querySelector("#root")),Va()}},[[260,1,2]]]);
//# sourceMappingURL=main.9d32d467.chunk.js.map