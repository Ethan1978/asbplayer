(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{192:function(e,t){},194:function(e,t){},213:function(e,t){},215:function(e,t){},223:function(e,t){},225:function(e,t){},233:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n(0),c=n.n(r),i=n(14),o=n.n(i),s=n(307),u=n(306),l=n(12),d=n.n(l),b=n(24),f=n(10),j=n(43),h=n(48),O=n(6),p=n(46),v=n(19),m=n(276);function g(e){var t=Object(r.useState)([0,0]),n=Object(O.a)(t,2),a=n[0],c=n[1];return Object(r.useLayoutEffect)((function(){function t(){e&&c([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",t),t(),function(){return window.removeEventListener("resize",t)}}),[e]),a}var k=n(4),y=n(310),x=n(234),C=Object(m.a)({root:{display:"flex",justifyContent:"center",position:"fixed",top:80,width:"100%",pointerEvents:"none",zIndex:2e3}});function w(e){var t=C();return Object(r.useEffect)((function(){if(e.open){var t=setTimeout(e.onClose,e.autoHideDuration);return function(){return clearTimeout(t)}}return null}),[e.open,e.autoHideDuration,e.onClose]),Object(a.jsx)("div",{className:t.root,children:Object(a.jsx)(x.a,{in:e.open,children:Object(a.jsx)(y.a,{severity:e.severity,children:e.children})})})}var S=n(16),T=n(17),F=function(){function e(t){Object(S.a)(this,e),this.settingsProvider=t}return Object(T.a)(e,[{key:"deckNames",value:function(){var e=Object(b.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction(t,"deckNames");case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelNames",value:function(){var e=Object(b.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction(t,"modelNames");case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelFieldNames",value:function(){var e=Object(b.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction(t,"modelFieldNames",{modelName:n});case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"export",value:function(){var e=Object(b.a)(d.a.mark((function e(t,n,a,r,c,i){var o,s,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=6;break}return e.next=3,this._blobToBase64(r);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=null;case 7:o=e.t0,(s={})[this.settingsProvider.sentenceField]=n,s[this.settingsProvider.definitionField]=a,u={note:{deckName:this.settingsProvider.deck,modelName:this.settingsProvider.noteType,fields:s,options:{allowDuplicate:!1,duplicateScope:"deck",duplicateScopeOptions:{deckName:this.settingsProvider.deck,checkChildren:!1}}}},o&&c&&(u.note.audio={filename:c+"_"+Date.now()+"."+i,data:o,fields:[this.settingsProvider.audioField]}),this._executeAction(t,"addNote",u);case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r,c,i){return e.apply(this,arguments)}}()},{key:"_executeAction",value:function(){var e=Object(b.a)(d.a.mark((function e(t,n,a){var r,c,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={action:n,version:6},a&&(r.params=a),e.next=4,fetch(t,{method:"POST",body:JSON.stringify(r)});case 4:if(c=e.sent,!(i=c.json()).error){e.next=8;break}throw new Error(i.error);case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"_blobToBase64",value:function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var a=new FileReader;a.readAsDataURL(t),a.onloadend=function(){var t=a.result,n=t.substr(t.indexOf(",")+1);e(n)}})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),E=n(291),R=n(311),M=n(281),I=n(290),N=n(283),U=n(284),A=n(282);function L(e){var t=e.open,n=e.disabled,c=e.text,i=e.onProceed,o=e.onCancel,s=Object(r.useState)(""),u=Object(O.a)(s,2),l=u[0],d=u[1];return Object(r.useEffect)((function(){d("")}),[t]),Object(a.jsxs)(M.a,{open:t,disableEnforceFocus:!0,fullWidth:!0,maxWidth:"sm",children:[Object(a.jsx)(A.a,{children:"Anki Export"}),Object(a.jsxs)(N.a,{children:[Object(a.jsx)(U.a,{color:"textPrimary",children:c}),Object(a.jsx)(R.a,{variant:"filled",multiline:!0,fullWidth:!0,rows:8,label:"Definition",value:l,onChange:function(e){return d(e.target.value)}})]}),Object(a.jsxs)(I.a,{children:[Object(a.jsx)(E.a,{disabled:n,onClick:function(){return o()},children:"Cancel"}),Object(a.jsx)(E.a,{disabled:n||!l,onClick:function(){return i(l)},children:"Export"})]})]})}var P=n(138),D=n(308),_=function(){function e(){Object(S.a)(this,e)}return Object(T.a)(e,[{key:"subtitles",value:function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.name.endsWith(".srt")){e.next=4;break}return e.abrupt("return",t.text().then((function(e){return Object(P.a)(e)})).then((function(e){return e.map((function(e){return e.data})).sort((function(e,t){return e.start-t.start}))})));case 4:if(!t.name.endsWith(".ass")){e.next=6;break}return e.abrupt("return",t.text().then((function(e){return Object(D.a)(e)})).then((function(e){return e.events.dialogue.map((function(e){return{start:Math.round(1e3*e.Start),end:Math.round(1e3*e.End),text:e.Text.combined}})).sort((function(e,t){return e.start-t.start}))})));case 6:throw new Error("Unsupported subtitle file format");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),W={"audio/ogg;codecs=opus":"ogg","audio/webm;codecs=opus":"webm"},z=function(){function e(){Object(S.a)(this,e)}return Object(T.a)(e,[{key:"clipAndSaveAudio",value:function(){var e=Object(b.a)(d.a.mark((function e(t,n,a,r){var c,i,o,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.clipAudio(t,n,a,r);case 2:return c=e.sent,i=Object(O.a)(c,2),o=i[0],s=i[1],e.next=8,this._saveToFile(o,this._nameWithoutExtension(t.name)+"_"+n+"_"+a+"."+s);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"clipAudio",value:function(){var e=Object(b.a)(d.a.mark((function e(t,n,a,r){var c=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,i){var o=new Audio;if(o.src=URL.createObjectURL(t),o.preload="none",r&&o.audioTracks&&o.audioTracks.length>0){var s,u=Object(f.a)(o.audioTracks);try{for(u.s();!(s=u.n()).done;){var l=s.value;l.enabled=r===l.id}}catch(d){u.e(d)}finally{u.f()}}o.currentTime=n/1e3,o.load(),o.oncanplay=function(t){o.play();var r,i=c._captureStream(o),s=Object(f.a)(i.getVideoTracks());try{for(s.s();!(r=s.n()).done;){r.value.stop()}}catch(d){s.e(d)}finally{s.f()}var u=c._findMediaType(),l=Object(O.a)(u,2),b=l[0],j=l[1],h=new MediaRecorder(i,{mimeType:b}),p=[];h.ondataavailable=function(e){p.push(e.data)},h.onstop=function(t){e([new Blob(p),j])},h.start(),setTimeout((function(){o.pause(),h.stop();var e=o.src;o.src=null,URL.revokeObjectURL(e)}),a-n+100)}})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"_nameWithoutExtension",value:function(e){return e.substring(0,e.lastIndexOf("."))}},{key:"_saveToFile",value:function(e,t){var n=window.URL.createObjectURL(e),a=document.createElement("a");document.body.appendChild(a),a.style="display: none",a.href=n,a.download=t,a.click(),URL.revokeObjectURL(n),a.remove()}},{key:"_findMediaType",value:function(){return Object.keys(W).filter(MediaRecorder.isTypeSupported).map((function(e){return[e,W[e]]}))[0]}},{key:"_captureStream",value:function(e){if("function"===typeof e.captureStream)return e.captureStream();if("function"===typeof e.mozCaptureStream)return e.mozCaptureStream();throw new Error("Unable to capture stream from media")}}]),e}(),B=n(292),H=n(280),G=n(143),V=n.n(G),X=n(142),q=n.n(X),J=n(293),K=n(58);function Y(e){var t,n=(t=e.drawerWidth,Object(m.a)((function(e){return{title:{flexGrow:1},appBar:{transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{width:"calc(100% - ".concat(t,"px)"),transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:t},hide:{display:"none"}}})))();return Object(a.jsx)(B.a,{position:"static",className:Object(k.a)(n.appBar,Object(p.a)({},n.appBarShift,e.drawerOpen)),children:Object(a.jsxs)(J.a,{children:[Object(a.jsx)(K.a,{variant:"h6",className:n.title,children:e.title}),Object(a.jsx)(H.a,{edge:"end",onClick:e.onOpenSettings,children:Object(a.jsx)(q.a,{})}),Object(a.jsx)(H.a,{edge:"end",color:"inherit","aria-label":"menu",onClick:e.onOpenCopyHistory,className:Object(k.a)(e.drawerOpen&&n.hide),children:Object(a.jsx)(V.a,{})})]})})}var $=function(){function e(){var t=this;Object(S.a)(this,e),this.onMessageCallbacks=[],this.tabs=[],window.addEventListener("message",(function(e){if(e.source===window&&"asbplayer-extension-to-player"===e.data.sender&&e.data.message)if("tabs"===e.data.message.command)t.tabs=e.data.message.tabs;else{var n,a=Object(f.a)(t.onMessageCallbacks);try{for(a.s();!(n=a.n()).done;){(0,n.value)({data:e.data.message,tabId:e.data.tabId})}}catch(r){a.e(r)}finally{a.f()}}}))}return Object(T.a)(e,[{key:"sendMessage",value:function(e,t){window.postMessage({sender:"asbplayer",message:e,tabId:t},"*")}},{key:"subscribe",value:function(e){this.onMessageCallbacks.push(e)}},{key:"unsubscribe",value:function(e){for(var t=this.onMessageCallbacks.length-1;t>=0;--t)if(e===this.onMessageCallbacks[t]){this.onMessageCallbacks.splice(t,1);break}}}]),e}(),Q=n(297),Z=n(313),ee=n(147),te=n.n(ee),ne=n(146),ae=n.n(ne),re=n(289),ce=n(236),ie=n(296),oe=n(294),se=n(295),ue=n(288),le=n(145),de=n.n(le),be=n(144),fe=n.n(be);function je(e){var t=e.open,n=e.anchorEl,c=e.onClose,i=e.onSelect,o=e.onClipAudio,s=e.item,u=Object(r.useCallback)((function(){navigator.clipboard.writeText(s.text),c()}),[s,c]),l=Object(r.useCallback)((function(){i(s),c()}),[s,i,c]),d=Object(r.useCallback)((function(){o(s),c()}),[s,o,c]);return s?Object(a.jsx)(ue.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:c,anchorOrigin:{vertical:"center",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"right"},children:Object(a.jsxs)(re.a,{children:[Object(a.jsx)(ce.a,{button:!0,onClick:u,children:Object(a.jsx)(oe.a,{primaryTypographyProps:{variant:"body2"},primary:"Copy"})}),Object(a.jsx)(ce.a,{button:!0,onClick:l,children:Object(a.jsx)(oe.a,{primaryTypographyProps:{variant:"body2"},primary:"Jump To"})}),(s.videoFile||s.audioFile)&&Object(a.jsx)(ce.a,{button:!0,onClick:d,children:Object(a.jsx)(oe.a,{primaryTypographyProps:{variant:"body2"},primary:"Clip Audio"})})]})}):null}function he(e){var t,n=(t=e.drawerWidth,Object(m.a)((function(e){return{drawer:{width:t,flexShrink:0},drawerPaper:{width:t},drawerHeader:Object(j.a)(Object(j.a)({display:"flex",alignItems:"center",position:"static",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-start"}),listContainer:{position:"relative",height:"100%",overflowY:"auto",overflowX:"hidden"},listItem:{"&:hover":{backgroundColor:e.palette.action.hover}},listItemGutters:{paddingLeft:5,paddingRight:5},listItemIconRoot:{minWidth:20}}})))(),i=Object(r.useCallback)((function(e){e&&e.scrollIntoView()}),[]),o=Object(r.useState)(),s=Object(O.a)(o,2),u=s[0],l=s[1],d=Object(r.useState)(!1),b=Object(O.a)(d,2),h=b[0],p=b[1],v=Object(r.useState)(),g=Object(O.a)(v,2),k=g[0],y=g[1],x=Object(r.useCallback)((function(e,t){l(t),p(!0),y(e.currentTarget)}),[]),C=Object(r.useCallback)((function(e,t){l(null),p(!1),y(null)}),[]),w=Object(r.useCallback)((function(t){e.onDelete(t)}),[e]),S=null;if(e.items.length>0){S=[];var T,F=null,E=0,R=Object(f.a)(e.items);try{var M=function(){var t=T.value;null!==F&&F===t.name||(F=t.name,S.push(Object(a.jsx)(se.a,{disableSticky:!0,children:t.name},t.name)));var r=E===e.items.length-1?i:null;S.push(Object(a.jsxs)(ce.a,{ref:r,className:n.listItem,classes:{gutters:n.listItemGutters},children:[Object(a.jsx)(ie.a,{classes:{root:n.listItemIconRoot},children:Object(a.jsx)(H.a,{onClick:function(){return e.onAnki(t)},children:Object(a.jsx)(fe.a,{fontSize:"small"})})}),Object(a.jsx)(ie.a,{classes:{root:n.listItemIconRoot},children:Object(a.jsx)(H.a,{onClick:function(e){return x(e,t)},children:Object(a.jsx)(de.a,{fontSize:"small"})})}),Object(a.jsx)(oe.a,{children:t.text}),Object(a.jsx)(ie.a,{classes:{root:n.listItemIconRoot},children:Object(a.jsx)(H.a,{onClick:function(){return w(t)},children:Object(a.jsx)(ae.a,{fontSize:"small"})})})]},t.timestamp)),++E};for(R.s();!(T=R.n()).done;)M()}catch(N){R.e(N)}finally{R.f()}}else S=Object(a.jsx)(ce.a,{children:"Copy history is empty."});var I=Object(a.jsx)(re.a,{children:S});return Object(a.jsxs)(c.a.Fragment,{children:[Object(a.jsxs)(Z.a,{variant:"persistent",anchor:"right",open:e.open,className:n.drawer,classes:{paper:n.drawerPaper},children:[Object(a.jsx)("div",{className:n.drawerHeader,children:Object(a.jsx)(H.a,{onClick:e.onClose,children:Object(a.jsx)(te.a,{})})}),Object(a.jsx)(Q.a,{}),Object(a.jsx)("div",{className:n.listContainer,children:I})]}),Object(a.jsx)(je,{open:e.open&&h,anchorEl:k,item:u,onClose:C,onSelect:e.onSelect,onClipAudio:e.onClipAudio})]})}var Oe=function(){function e(t){Object(S.a)(this,e),this.channel=new BroadcastChannel(t);var n=this;this.channel.onmessage=function(e){var t;null===(t=n.onMessage)||void 0===t||t.call(n,e)}}return Object(T.a)(e,[{key:"postMessage",value:function(e){this.channel.postMessage(e)}},{key:"close",value:function(){this.channel.close()}}]),e}(),pe=function(){function e(t,n){var a=this;Object(S.a)(this,e),this.tabId=t,this.listener=function(e){var n;e.tabId===t&&(null===(n=a.onMessage)||void 0===n||n.call(a,{data:e.data}))},n.subscribe(this.listener),this.extension=n}return Object(T.a)(e,[{key:"postMessage",value:function(e){this.extension.sendMessage(e,this.tabId)}},{key:"close",value:function(){this.extension.unsubscribe(this.listener)}}]),e}(),ve=function(){function e(){Object(S.a)(this,e),this.accumulated=0,this.started=!1}return Object(T.a)(e,[{key:"time",value:function(e){return this.started?Math.min(e,this.accumulated+Date.now()-this.startTime):Math.min(e,this.accumulated)}},{key:"stop",value:function(){this.started&&(this.started=!1,this.accumulated+=Date.now()-this.startTime)}},{key:"start",value:function(){this.startTime=Date.now(),this.started=!0}},{key:"setTime",value:function(e){this.started?(this.startTime=Date.now(),this.accumulated=e):this.accumulated=e}},{key:"progress",value:function(e){return 0===e?0:Math.min(1,this.time(e)/e)}}]),e}(),me=n(5),ge=n(154),ke=n.n(ge),ye=n(148),xe=n.n(ye),Ce=n(163),we=n(298),Se=n(285),Te=n(156),Fe=n.n(Te),Ee=n(158),Re=n.n(Ee),Me=n(157),Ie=n.n(Me),Ne=n(149),Ue=n.n(Ne),Ae=n(150),Le=n.n(Ae),Pe=n(155),De=n.n(Pe),_e=n(314),We=n(153),ze=n.n(We),Be=n(105),He=n.n(Be),Ge=n(151),Ve=n.n(Ge),Xe=n(152),qe=n.n(Xe),Je=Object(m.a)((function(e){return{container:{position:"absolute",left:"50%",width:"50%",bottom:0},buttonContainer:{flexDirection:"row"},timeDisplay:{color:e.palette.action.active,display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",cursor:"default",fontSize:20,marginLeft:10},offsetInput:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",fontSize:20,marginLeft:10,width:100,color:e.palette.text.secondary},volumeInputContainerShown:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:5},volumeInputContainerHidden:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:0},volumeInputHidden:{transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),width:0},volumeInputShown:{transition:e.transitions.create("width",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),width:100},volumeInputThumbHidden:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),opacity:0},volumeInputThumbShown:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),opacity:1},subContainer:{background:"linear-gradient(to bottom, rgba(0,0,0,0), rgba(0,0,0,0.7))",position:"relative",left:"-100%",width:"200%",zIndex:10,padding:10},button:{color:e.palette.action.active},inactiveButton:{color:e.palette.action.disabled},progress:{margin:5},closeButton:{position:"absolute",top:0,right:0}}})),Ke=Object(m.a)((function(e){return{container:{background:"rgba(30,30,30,0.7)",height:5,margin:"0 10px 5px 10px",cursor:"pointer"},fillContainer:{width:"100%"},fill:{background:"linear-gradient(to left, #e21e4a, #a92fff)",height:"100%"},handleContainer:{position:"relative",width:0,height:0},handle:{borderRadius:"50%",width:15,height:15,background:"white",position:"absolute",top:5,left:12,filter:"drop-shadow(3px 3px 3px rgba(0,0,0,0.3))"}}})),Ye=Object(me.a)((function(e){return{root:{color:e.palette.text.secondary,verticalAlign:"middle"},thumb:{backgroundColor:"white",color:e.palette.text.secondary,"&:focus":{boxShadow:"inherit"},"&:hover, &$active":{boxShadow:"0px 0px 0px 8px rgba(255, 255, 255, 0.1)"}},active:{color:e.palette.text.secondary}}}))(_e.a);function $e(e){var t=Math.floor(e/1e3),n=Math.floor(t/60),a=t%60;return String(n)+":"+String(a).padStart(2,"0")}function Qe(e){var t=e.getBoundingClientRect();return t.right-t.left}function Ze(e){var t=Ke(),n=Object(r.useRef)(null);var c={width:e.value+"%"},i={marginLeft:n.current?Qe(n.current)*e.value/100:0};return Object(a.jsxs)("div",{ref:n,onClick:function(t){var n=t.currentTarget.getBoundingClientRect(),a=n.right-n.left,r=Math.min(1,Math.max(0,(t.pageX-n.left)/a));e.onSeek(r)},className:t.container,children:[Object(a.jsx)("div",{className:t.fill,style:c}),Object(a.jsx)("div",{className:t.handleAnchor,children:Object(a.jsx)("div",{className:t.handle,style:i})})]})}function et(e){if(!e.audioTracks||0===e.audioTracks.length)return null;var t=e.audioTracks.map((function(t){return Object(a.jsxs)(ce.a,{selected:t.id===e.selectedAudioTrack,button:!0,onClick:function(){return e.onAudioTrackSelected(t.id)},children:[t.language," ",t.label]},t.id)}));return Object(a.jsx)("div",{children:Object(a.jsx)(ue.a,{disableEnforceFocus:!0,open:e.open,anchorEl:e.anchorEl,onClose:e.onClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(a.jsx)(re.a,{children:t})})})}function tt(e){if(!e.tabs||0===e.tabs.length)return null;var t=e.tabs.map((function(t){return Object(a.jsxs)(ce.a,{selected:t.id===e.selectedTab,button:!0,onClick:function(){return e.onTabSelected(t.id)},children:[t.id," ",t.title," ",t.src]},t.id)}));return Object(a.jsx)("div",{children:Object(a.jsx)(ue.a,{disableEnforceFocus:!0,open:e.open,anchorEl:e.anchorEl,onClose:e.onClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(a.jsx)(re.a,{children:t})})})}function nt(e){return Object(a.jsx)("div",{children:Object(a.jsx)(ue.a,{disableEnforceFocus:!0,open:e.open,anchorEl:e.anchorEl,onClose:e.onClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(a.jsx)(re.a,{children:Object(a.jsxs)(ce.a,{button:!0,onClick:function(t){return e.onUnload()},children:["Unload ",e.file]})})})})}function at(e){var t=Je(),n=e.playing,i=e.length,o=e.offsetEnabled,s=e.displayLength,u=e.offset,l=e.onAudioTrackSelected,d=e.onSeek,b=e.mousePositionRef,f=e.onPause,j=e.onPlay,h=e.onTabSelected,p=e.onUnloadAudio,v=e.onUnloadVideo,m=e.onOffsetChange,g=e.onVolumeChange,k=Object(r.useState)(!0),y=Object(O.a)(k,2),x=y[0],C=y[1],w=Object(r.useState)(!1),S=Object(O.a)(w,2),T=S[0],F=S[1],E=Object(r.useState)(),R=Object(O.a)(E,2),M=R[0],I=R[1],N=Object(r.useState)(!1),U=Object(O.a)(N,2),A=U[0],L=U[1],P=Object(r.useState)(),D=Object(O.a)(P,2),_=D[0],W=D[1],z=Object(r.useState)(!1),B=Object(O.a)(z,2),G=B[0],V=B[1],X=Object(r.useState)(),q=Object(O.a)(X,2),J=q[0],K=q[1],Y=Object(r.useState)(!1),$=Object(O.a)(Y,2),Q=$[0],Z=$[1],ee=Object(r.useState)(),te=Object(O.a)(ee,2),ne=te[0],ae=te[1],re=Object(r.useState)(!1),ce=Object(O.a)(re,2),ie=ce[0],oe=ce[1],se=Object(r.useState)(100),ue=Object(O.a)(se,2),le=ue[0],de=ue[1],be=Object(r.useState)(100),fe=Object(O.a)(be,2),je=fe[0],he=fe[1],Oe=Object(r.useRef)({x:0,y:0}),pe=Object(r.useRef)(Date.now()),ve=Object(r.useRef)(!0),me=Object(r.useRef)(!1),ge=Object(r.useRef)(),ye=Object(r.useState)(),Te=Object(O.a)(ye,2)[1],Ee=Object(r.useCallback)((function(){return Te({})}),[]),Me=Object(r.useCallback)((function(e){d(e)}),[d]);Object(r.useEffect)((function(){var e=setInterval((function(){var e=Date.now()-pe.current<2e3||Math.pow(b.current.x-Oe.current.x,2)+Math.pow(b.current.y-Oe.current.y,2)>100||me.current||ge.current===document.activeElement;e&&!ve.current?(pe.current=Date.now(),C(e)):!e&&ve.current&&C(e),ve.current=e,Oe.current.x=b.current.x,Oe.current.y=b.current.y}),100);return function(){return clearInterval(e)}}),[b,C,x]),Object(r.useEffect)((function(){function e(e){if(32===e.keyCode)e.preventDefault(),n?f():j();else if(13===e.keyCode&&ge.current===document.activeElement){var t=Number(ge.current.value);if(Number.isNaN(t))return;m(1e3*t),ge.current.blur()}}return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[n,f,j,m]),Object(r.useEffect)((function(){var e=setInterval((function(){Ee()}),100);return function(){return clearInterval(e)}}),[Ee]),Object(r.useEffect)((function(){if(ge.current)if(0===u)ge.current.value=null;else{var e=u/1e3,t=e>=0?"+"+e.toFixed(2):String(e.toFixed(2));ge.current.value=t}}),[u]);var Ne=Object(r.useCallback)((function(){I(null),F(!1)}),[]),Ae=Object(r.useCallback)((function(e){I(e.currentTarget),F(!0)}),[]),Pe=Object(r.useCallback)((function(e){l(e),I(null),F(!1)}),[l]),_e=Object(r.useCallback)((function(){W(null),L(!1)}),[]),We=Object(r.useCallback)((function(e){W(e.currentTarget),L(!0)}),[]),Be=Object(r.useCallback)((function(e){h(e),W(null),L(!1)}),[h]),Ge=Object(r.useCallback)((function(){K(null),V(!1)}),[]),Xe=Object(r.useCallback)((function(e){K(e.currentTarget),V(!0)}),[]),Ke=Object(r.useCallback)((function(){p(),V(!1)}),[p]),Qe=Object(r.useCallback)((function(e){ae(null),Z(!1)}),[]),at=Object(r.useCallback)((function(e){ae(e.currentTarget),Z(!0)}),[]),rt=Object(r.useCallback)((function(){v(),Z(!1)}),[v]),ct=Object(r.useCallback)((function(){return oe(!1)}),[]),it=Object(r.useCallback)((function(){return oe(!0)}),[]),ot=Object(r.useCallback)((function(e,t){de(t),g(t/100)}),[g]),st=Object(r.useCallback)((function(e,t){t>0&&he(t)}),[]),ut=Object(r.useCallback)((function(e,t){de((function(e){var t=e>0?0:je;return g(t/100),t}))}),[g,je]),lt=e.clock.progress(i);return Object(a.jsxs)(c.a.Fragment,{children:[e.closeEnabled&&Object(a.jsx)(Ce.a,{in:x,timeout:200,children:Object(a.jsx)(H.a,{className:t.closeButton,onClick:function(){return e.onClose()},children:Object(a.jsx)(xe.a,{})})}),Object(a.jsxs)("div",{className:t.container,onMouseOver:function(e){me.current=!0},onMouseOut:function(e){me.current=!1},children:[Object(a.jsx)(Ce.a,{in:x,timeout:200,children:Object(a.jsxs)("div",{className:t.subContainer,children:[Object(a.jsx)(Ze,{onSeek:Me,value:100*lt}),Object(a.jsxs)(we.a,{container:!0,direction:"row",children:[Object(a.jsx)(we.a,{item:!0,children:Object(a.jsx)(H.a,{onClick:function(){return n?f():j()},children:n?Object(a.jsx)(Ue.a,{className:t.button}):Object(a.jsx)(Le.a,{className:t.button})})}),e.volumeEnabled&&Object(a.jsxs)(we.a,{item:!0,onMouseOver:it,onMouseOut:ct,className:ie?t.volumeInputContainerShown:t.volumeInputContainerHidden,children:[Object(a.jsx)(H.a,{onClick:ut,children:0===le?Object(a.jsx)(Ve.a,{}):Object(a.jsx)(qe.a,{})}),Object(a.jsx)(Ye,{onChange:ot,onChangeCommitted:st,value:le,defaultValue:100,classes:{root:ie?t.volumeInputShown:t.volumeInputHidden,thumb:ie?t.volumeInputThumbShown:t.volumeInputThumbHidden}})]}),Object(a.jsx)(we.a,{item:!0,children:Object(a.jsxs)("div",{className:t.timeDisplay,children:[$e(lt*i)," / ",$e(s||i)]})}),o&&Object(a.jsx)(we.a,{item:!0,children:Object(a.jsx)(Se.a,{inputRef:ge,disableUnderline:!0,className:t.offsetInput,placeholder:"\xb1"+Number(0).toFixed(2)})}),Object(a.jsx)(we.a,{style:{flexGrow:1},item:!0}),e.subtitlesToggle&&Object(a.jsx)(we.a,{item:!0,children:Object(a.jsx)(H.a,{onClick:function(t){return e.onSubtitlesToggle()},children:Object(a.jsx)(ze.a,{className:e.subtitlesEnabled?t.button:t.inactiveButton})})}),e.videoFile&&Object(a.jsx)(we.a,{item:!0,children:Object(a.jsx)(H.a,{onClick:at,children:Object(a.jsx)(He.a,{className:t.button})})}),e.audioFile&&Object(a.jsx)(we.a,{item:!0,children:Object(a.jsx)(H.a,{onClick:Xe,children:Object(a.jsx)(ke.a,{className:t.button})})}),e.audioTracks&&e.audioTracks.length>1&&Object(a.jsx)(we.a,{item:!0,children:Object(a.jsx)(H.a,{onClick:Ae,children:Object(a.jsx)(De.a,{className:t.button})})}),e.tabs&&e.tabs.length>0&&Object(a.jsx)(we.a,{item:!0,children:Object(a.jsx)(H.a,{onClick:We,children:Object(a.jsx)(He.a,{className:e.selectedTab?t.button:t.inactiveButton})})}),e.popOutEnabled&&Object(a.jsx)(we.a,{item:!0,children:Object(a.jsx)(H.a,{onClick:function(){return e.onPopOutToggle()},children:Object(a.jsx)(Fe.a,{style:e.popOut?{transform:"rotateX(180deg)"}:{}})})}),e.fullscreenEnabled&&Object(a.jsx)(we.a,{item:!0,children:Object(a.jsx)(H.a,{onClick:function(){return e.onFullscreenToggle()},children:e.fullscreen?Object(a.jsx)(Ie.a,{}):Object(a.jsx)(Re.a,{})})})]})]})}),Object(a.jsx)(tt,{open:A&&x,anchorEl:_,tabs:e.tabs,selectedTab:e.selectedTab,onClose:_e,onTabSelected:Be}),Object(a.jsx)(et,{open:T&&x,anchorEl:M,audioTracks:e.audioTracks,selectedAudioTrack:e.selectedAudioTrack,onClose:Ne,onAudioTrackSelected:Pe}),Object(a.jsx)(nt,{open:G,anchorEl:J,file:e.audioFile,onClose:Ge,onUnload:Ke}),Object(a.jsx)(nt,{open:Q,anchorEl:ne,file:e.videoFile,onClose:Qe,onUnload:rt})]})]})}var rt=function(){function e(t){Object(S.a)(this,e),this.ref=t,this.readyResolves=[]}return Object(T.a)(e,[{key:"seek",value:function(e){var t=this;return new Promise((function(n,a){t.ref.current?(t.ref.current.currentTime=e,t._onMediaCanPlay((function(){return n()}))):n()}))}},{key:"onReady",value:function(){var e=this;return new Promise((function(t,n){e.ref.current?e._onMediaCanPlay((function(){return t()})):t()}))}},{key:"_onMediaCanPlay",value:function(e){var t=this;4!==this.ref.readyState?(this.ref.current&&!this.ref.current.oncanplay&&(this.ref.current.oncanplay=function(e){var n,a=Object(f.a)(t.readyResolves);try{for(a.s();!(n=a.n()).done;){(0,n.value)()}}catch(r){a.e(r)}finally{a.f()}t.readyResolves.length=0,t.ref.current.oncanplay=null}),this.readyResolves.push(e)):e()}},{key:"play",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.play()}},{key:"pause",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.pause()}}]),e}();function ct(e){return e.ctrlKey&&e.shiftKey&&65===e.keyCode}var it=n(159),ot=n.n(it),st=n(299),ut=n(108),lt=n(301),dt=n(302),bt=n(304),ft=n(300),jt=n(303),ht=n.p+"static/media/background.aa598bb3.png";function Ot(e){var t=e.clock,n=e.onSeek,c=e.onCopy,i=e.playing,o=e.subtitles,s=e.length,u=e.jumpToSubtitle,l=e.compressed,d=e.loading,b=Object(r.useRef)();b.current=t;var j=Object(r.useRef)();j.current=o;var p=Object(r.useMemo)((function(){return o?Array(o.length).fill().map((function(e,t){return Object(r.createRef)()})):[]}),[o]),v=Object(r.useRef)();v.current=p;var k=Object(r.useState)({}),y=Object(O.a)(k,2),x=y[0],C=y[1],w=Object(r.useRef)({}),S=Object(r.useRef)();S.current=e.length;var T=Object(r.useRef)(0),F=Object(r.useRef)(),E=Object(r.useRef)();Object(r.useRef)().current=e.drawerOpen;var R=g(!0),M=Object(O.a)(R,1)[0],I=function(e,t){return Object(m.a)((function(n){return{container:{height:"calc(100vh - 64px)",position:"relative",overflowX:"hidden",backgroundColor:n.palette.background.default,width:e?Math.max(350,.25*t):"100%"},table:{backgroundColor:n.palette.background.default,marginBottom:75},subtitleRow:{"&:hover":{backgroundColor:n.palette.action.hover}},subtitle:{fontSize:20,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere"},compressedSubtitle:{fontSize:16,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere"},timestamp:{fontSize:14,color:"#aaaaaa",textAlign:"right",paddingRight:15,paddingLeft:5},copyButton:{textAlign:"right",padding:0},noSubtitles:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundImage:"url("+ht+")",backgroundSize:"500px 500px",backgroundRepeat:"no-repeat",backgroundPosition:"center",padding:15,textAlign:"center"}}}))}(l,M)();Object(r.useEffect)((function(){return F.current=requestAnimationFrame((function e(t){for(var n=j.current||[],a=v.current,r=S.current,c=b.current.progress(S.current),i=Number.MAX_SAFE_INTEGER,o=-1,s={},u=n.length-1;u>=0;--u){var l=n[u],d=l.start/r,f=l.end/r;if(c>=d)c<f&&(i=u<i?u:i,s[u]=!0),-1===o&&(o=u);else if(i!==Number.MAX_SAFE_INTEGER)break}if(i===Number.MAX_SAFE_INTEGER&&-1!==o&&(s[o]=!0),!function(e,t){for(var n in e)if(!(n in t))return!1;for(var a in t)if(!(a in e))return!1;return!0}(s,w.current)&&(w.current=s,C(s),i!==Number.MAX_SAFE_INTEGER)){var h=a[i],O=Date.now()-T.current>5e3;(null===h||void 0===h?void 0:h.current)&&O&&h.current.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}F.current=requestAnimationFrame(e)})),function(){return cancelAnimationFrame(F.current)}}),[]),Object(r.useEffect)((function(){function e(e){if(o&&0!==o.length){var t;if(37===e.keyCode){var a=Object.keys(x);t=a.length>0?Math.max(0,Math.min.apply(Math,Object(h.a)(a))-1):-1}else{if(39!==e.keyCode)return;var r=Object.keys(x);t=r.length>0?Math.min(o.length-1,Math.max.apply(Math,Object(h.a)(r))+1):-1}if(-1!==t){e.preventDefault();var c=o[t].start/s;n(c,!1)}}}return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[n,x,o,s]),Object(r.useEffect)((function(){function e(e){T.current=Date.now()}var t=E.current;return null===t||void 0===t||t.addEventListener("wheel",e),function(){null===t||void 0===t||t.removeEventListener("wheel",e)}}),[E,T]),Object(r.useEffect)((function(){if(u&&o){var e,t=-1,n=0,a=Object(f.a)(o);try{for(a.s();!(e=a.n()).done;){var r=e.value;if(r.originalStart===u.originalStart&&r.text===u.text){t=n;break}++n}}catch(c){a.e(c)}finally{a.f()}-1!==t&&p[t].current.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}),[u,o,p]);var N,U=Object(r.useCallback)((function(e){var t=o[e].start/s;n(t,!i&&e in x)}),[o,s,i,n,x]),A=Object(r.useCallback)((function(e,t){e.stopPropagation();var n=o[t],a=n.text;navigator.clipboard.writeText(a),c(n)}),[o,c]);return Object(r.useEffect)((function(){function e(e){var t=Object.keys(w.current);if(0!==t.length&&ct(e)){var n=Math.min.apply(Math,Object(h.a)(t));A(e,n)}}return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[A]),N=!o&&l&&d?null:o?0===o.length?null:Object(a.jsx)(ft.a,{className:I.table,children:Object(a.jsx)(lt.a,{children:Object(a.jsx)(dt.a,{children:o.map((function(e,t){var n=t in x,r=l?I.compressedSubtitle:I.subtitle;return e.start<0&&e.end<0?null:Object(a.jsxs)(jt.a,{onClick:function(e){return U(t)},ref:p[t],selected:n,className:I.subtitleRow,children:[Object(a.jsx)(bt.a,{className:r,children:e.text}),Object(a.jsx)(bt.a,{className:I.copyButton,children:Object(a.jsx)(H.a,{onClick:function(e){return A(e,t)},children:Object(a.jsx)(ot.a,{fontSize:l?"small":"default"})})}),Object(a.jsx)(bt.a,{className:I.timestamp,children:e.displayTime})]},t)}))})})}):Object(a.jsxs)("div",{className:I.noSubtitles,children:[!l&&Object(a.jsx)(Ce.a,{in:!d,timeout:500,children:Object(a.jsxs)(K.a,{children:["Drag and drop srt, ass, mp3, or mkv files. ",Object(a.jsx)("br",{}),"Install the ",Object(a.jsx)(st.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://github.com/killergerbah/asbplayer/releases/tag/v0.2.1",children:"extension"})," to sync subtitles with videos in other tabs."]})}),l&&!d&&Object(a.jsx)(K.a,{children:"No subtitles loaded. Drag and drop to load."})]}),Object(a.jsx)(ut.a,{square:!0,elevation:0,ref:E,className:I.container,children:N})}var pt=function(){function e(t){Object(S.a)(this,e),this.protocol=t,this.time=0,this.duration=0,this.isReady=!1,this.readyState=0,this.selectedAudioTrack=null,this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[];var n=this;this.protocol.onMessage=function(e){switch(e.data.command){case"ready":n.duration=e.data.duration,n.isReady=!0,n.audioTracks=e.data.audioTracks,n.selectedAudioTrack=e.data.selectedAudioTrack,n.readyState=4,n.time=e.data.currentTime;var t,a=Object(f.a)(n.readyCallbacks);try{for(a.s();!(t=a.n()).done;){(0,t.value)(e.data.paused)}}catch(x){a.e(x)}finally{a.f()}break;case"readyState":var r;if(n.readyState=e.data.value,4===n.readyState)null===(r=n.oncanplay)||void 0===r||r.call(n);break;case"play":var c,i=Object(f.a)(n.playCallbacks);try{for(i.s();!(c=i.n()).done;){(0,c.value)(e.data.echo)}}catch(x){i.e(x)}finally{i.f()}break;case"pause":var o,s=Object(f.a)(n.pauseCallbacks);try{for(s.s();!(o=s.n()).done;){(0,o.value)(e.data.echo)}}catch(x){s.e(x)}finally{s.f()}break;case"audioTrackSelected":var u,l=Object(f.a)(n.audioTrackSelectedCallbacks);try{for(l.s();!(u=l.n()).done;){var d=u.value;n.selectedAudioTrack=e.data.id,d(e.data.id)}}catch(x){l.e(x)}finally{l.f()}break;case"currentTime":var b,j=Object(f.a)(n.currentTimeCallbacks);try{for(j.s();!(b=j.n()).done;){(0,b.value)(e.data.value,e.data.echo)}}catch(x){j.e(x)}finally{j.f()}break;case"exit":var h,O=Object(f.a)(n.exitCallbacks);try{for(O.s();!(h=O.n()).done;){(0,h.value)()}}catch(x){O.e(x)}finally{O.f()}break;case"offset":var p,v=Object(f.a)(n.offsetCallbacks);try{for(v.s();!(p=v.n()).done;){(0,p.value)(e.data.value)}}catch(x){v.e(x)}finally{v.f()}break;case"popOutToggle":var m,g=Object(f.a)(n.popOutToggleCallbacks);try{for(g.s();!(m=g.n()).done;){(0,m.value)()}}catch(x){g.e(x)}finally{g.f()}break;case"copy":var k,y=Object(f.a)(n.copyCallbacks);try{for(y.s();!(k=y.n()).done;){(0,k.value)(e.data.subtitle)}}catch(x){y.e(x)}finally{y.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(T.a)(e,[{key:"onReady",value:function(e){this.isReady&&e(),this.readyCallbacks.push(e)}},{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onExit",value:function(e){this.exitCallbacks.push(e)}},{key:"onOffset",value:function(e){this.offsetCallbacks.push(e)}},{key:"onPopOutToggle",value:function(e){this.popOutToggleCallbacks.push(e)}},{key:"onCopy",value:function(e){this.copyCallbacks.push(e)}},{key:"ready",value:function(e){this.protocol.postMessage({command:"ready",duration:e})}},{key:"init",value:function(){this.protocol.postMessage({command:"init"})}},{key:"play",value:function(){this.protocol.postMessage({command:"play"})}},{key:"pause",value:function(){this.protocol.postMessage({command:"pause"})}},{key:"audioTrackSelected",value:function(e){this.protocol.postMessage({command:"audioTrackSelected",id:e})}},{key:"subtitles",value:function(e){this.protocol.postMessage({command:"subtitles",value:e})}},{key:"close",value:function(){this.protocol.postMessage({command:"close"}),this.protocol.close()}},{key:"currentTime",get:function(){return this.time},set:function(e){this.time=e,this.readyState=3,this.protocol.postMessage({command:"currentTime",value:this.time})}}]),e}(),vt=Object(m.a)({root:{maxHeight:"calc(100vh - 64px)",position:"relative",overflowX:"hidden"},videoFrame:{width:"100%",height:"100%",border:0}});function mt(e,t){if(e<0)return mt(0,t);var n=e%1e3,a=(e=(e-n)/1e3)%60,r=(e=(e-a)/60)%60;return t>=36e5?gt((e-r)/60)+":"+gt(r)+":"+gt(a)+"."+kt(n):gt(r)+":"+gt(a)+"."+kt(n)}function gt(e){return String(e).padStart(2,"0")}function kt(e){return String(e).padEnd(3,"0")}function yt(e,t,n,a){var r;r=n&&n.length>0?a?n[n.length-1].end:n[n.length-1].originalEnd:0;var c=e.current&&e.current.duration?1e3*e.current.duration:0,i=t.current&&t.current.duration?1e3*t.current.duration:0;return Math.max(i,Math.max(r,c))}function xt(e){var t=e.subtitleReader,n=e.extension,c=e.offsetRef,i=e.videoFrameRef,o=e.drawerOpen,s=e.onError,u=e.onUnloadVideo,l=e.onCopy,d=e.sources,b=d.subtitleFile,f=d.audioFile,j=d.audioFileUrl,h=d.videoFile,p=d.videoFileUrl,v=Object(r.useState)(!1),m=Object(O.a)(v,2),g=m[0],k=m[1],y=Object(r.useState)(),x=Object(O.a)(y,2),C=x[0],w=x[1],S=Object(r.useState)(),T=Object(O.a)(S,2),F=T[0],E=T[1],R=Object(r.useState)(!1),M=Object(O.a)(R,2),I=M[0],N=M[1],U=Object(r.useRef)();U.current=I;var A=Object(r.useState)(),L=Object(O.a)(A,2)[1],P=Object(r.useState)(),D=Object(O.a)(P,2),_=D[0],W=D[1],z=Object(r.useState)(),B=Object(O.a)(z,2),H=B[0],G=B[1],V=Object(r.useState)(0),X=Object(O.a)(V,2),q=X[0],J=X[1],K=Object(r.useState)(),Y=Object(O.a)(K,2),$=Y[0],Q=Y[1],Z=Object(r.useState)(!1),ee=Object(O.a)(Z,2),te=ee[0],ne=ee[1],ae=Object(r.useCallback)((function(){return L({})}),[]),re=Object(r.useRef)({x:0,y:0}),ce=Object(r.useRef)(),ie=Object(r.useRef)(),oe=Object(r.useMemo)((function(){return new rt(j?ce:p||C?ie:{})}),[j,p,C]),se=Object(r.useMemo)((function(){return new ve}),[]),ue=vt(),le=Object(r.useState)([]),de=Object(O.a)(le,2),be=de[0],fe=de[1],je=Object(r.useRef)(0);je.current=yt(ce,ie,F,!0);var he=Object(r.useCallback)((function(e,t,n,a){var r=e*je.current;t.setTime(r),ae(),n?oe.seek(r/1e3).then((function(e){return a()})):a()}),[ae,oe]);function me(e,t,n){N(!0),e.start(),n&&t.play()}function ge(e,t,n){N(!1),e.stop(),n&&t.pause()}Object(r.useEffect)((function(){var e,a;null===(e=ie.current)||void 0===e||e.close(),ie.current=null,se.setTime(0),se.stop(),N(!1),W(null),G(null),J(0),ce.current.currentTime=0,ce.current.pause(),b?(k(!0),a=t.subtitles(b).then((function(e){var t=e.length>0?e[e.length-1].end:0,n=e.map((function(e){return{text:e.text,start:e.start,originalStart:e.start,end:e.end,originalEnd:e.end,displayTime:mt(e.start,t)}}));return E(n),n})).catch((function(e){return s(e)})).finally((function(){return k(!1)}))):a=new Promise((function(e,t){return e()})),j?oe.onReady().then((function(){return ae()})):(p||C)&&a.then((function(e){var t;if(p){var a=String(Date.now());t=new pt(new Oe(a)),Q(a)}else C&&(t=new pt(new pe(C.id,n))).init();ie.current=t;var r=!1;t.onReady((function(n){je.current=yt(ce,ie,e),t.ready(je.current),e&&t.subtitles(e),t.audioTracks&&t.audioTracks.length>1?(W(ie.current.audioTracks),G(ie.current.selectedAudioTrack)):(W(null),G(null)),se.setTime(1e3*ie.current.currentTime),n?se.stop():se.start(),N(!n),r||(t.onPlay((function(e){me(se,oe,e)})),t.onPause((function(e){ge(se,oe,e)})),t.onCurrentTime((function(e,t){var n=1e3*e/je.current;U.current&&se.stop(),he(n,se,t,(function(e){U.current&&se.start()}))})),t.onAudioTrackSelected((function(e){U.current&&se.stop(),oe.onReady().then((function(){U.current&&se.start()})),G(e)})),t.onExit((function(){u(p)})),t.onOffset((function(e){var t;J(Math.max(null!==(t=-je.current)&&void 0!==t?t:0,e))})),t.onPopOutToggle((function(){ne((function(e){return!e}))})),t.onCopy((function(e){l(e,f,h,b,t.selectedAudioTrack)})),r=!0)}))}))}),[t,n,se,oe,he,s,u,l,b,f,j,h,p,C,ae,i]),Object(r.useEffect)((function(){te&&$&&p&&window.open("/asbplayer/?video="+encodeURIComponent(p)+"&channel="+$+"&popout=true","asbplayer-video-"+p,"resizable,width=800,height=450")}),[te,$,p,i]);var ke=Object(r.useCallback)((function(){me(se,oe,!0)}),[se,oe]),ye=Object(r.useCallback)((function(){ge(se,oe,!0)}),[se,oe]),xe=Object(r.useCallback)((function(e){U.current&&se.stop(),he(e,se,!0,(function(){U.current&&se.start()}))}),[se,he]),Ce=Object(r.useCallback)((function(e,t){t||ge(se,oe,!0),U.current&&se.stop(),he(e,se,!0,(function(){t&&!U.current&&me(se,oe,!0)}))}),[se,he,oe]),Se=Object(r.useCallback)((function(e){l(e,f,h,b,H)}),[l,f,h,b,H]);var Te=Object(r.useCallback)((function(e){ie.current&&ie.current.audioTrackSelected(e),ge(se,oe,!0),he(0,se,!0,(function(){U.current&&me(se,oe,!0)}))}),[se,oe,he]),Fe=Object(r.useCallback)((function(e){var t=be.filter((function(t){return t.id===e}))[0];w(t)}),[be]),Ee=Object(r.useCallback)((function(e){var t;J(Math.max(null!==(t=-je.current)&&void 0!==t?t:0,e))}),[]);Object(r.useEffect)((function(){c&&(c.current=q),E((function(e){var t;if(e){var n=e.length>0?e[e.length-1].end+q:0,a=e.map((function(e){return{text:e.text,start:e.originalStart+q,originalStart:e.originalStart,end:e.originalEnd+q,originalEnd:e.originalEnd,displayTime:mt(e.originalStart+q,n)}}));return null===(t=ie.current)||void 0===t||t.subtitles(a),a}}))}),[q,c]);var Re=Object(r.useCallback)((function(e){ce.current&&(ce.current.volume=e)}),[]);Object(r.useEffect)((function(){var e=setInterval((function(){var e=je.current;se.progress(e)>=1&&(se.setTime(0),se.stop(),oe.pause(),N(!1))}),1e3);return function(){return clearInterval(e)}}),[se,F,oe]),Object(r.useEffect)((function(){var t=setInterval((function(){if(e.extension.tabs.length!==be.length)fe(e.extension.tabs);else{for(var t=!1,n=0;n<be.length;++n){var a=be[n],r=e.extension.tabs[n];if(a.id!==r.id||a.title!==r.title||a.src!==r.src){t=!0;break}}t&&fe(e.extension.tabs)}C&&0===e.extension.tabs.filter((function(e){return e.id===C.id&&e.src===C.src})).length&&(w(null),e.onError("Lost connection with tab "+C.id+" "+C.title))}),1e3);return function(){return clearInterval(t)}}),[be,C,e]),Object(r.useEffect)((function(){w(null)}),[f,h]);var Me=je.current,Ie=j||p||F,Ne=Ie&&p&&$&&!te;return Object(a.jsxs)("div",{onMouseMove:function(e){re.current.x=e.screenX,re.current.y=e.screenY},className:ue.root,children:[Object(a.jsxs)(we.a,{container:!0,direction:"row",wrap:"nowrap",children:[Ne&&Object(a.jsx)(we.a,{item:!0,style:{flexGrow:1,minWidth:600},children:Object(a.jsx)("iframe",{ref:i,className:ue.videoFrame,src:"/asbplayer/?video="+encodeURIComponent(p)+"&channel="+$+"&popout=false",title:"asbplayer"})}),Object(a.jsxs)(we.a,{item:!0,style:{flexGrow:Ne?0:1},children:[Ie&&!(p&&!te)&&Object(a.jsx)(at,{mousePositionRef:re,playing:I,clock:se,length:Me,displayLength:yt(ce,ie,F,!1),audioTracks:_,selectedAudioTrack:H,tabs:!p&&!j&&be,selectedTab:C&&C.id,audioFile:null===f||void 0===f?void 0:f.name,videoFile:null===h||void 0===h?void 0:h.name,offsetEnabled:!0,offset:q,volumeEnabled:Boolean(j),onPlay:ke,onPause:ye,onSeek:xe,onAudioTrackSelected:Te,onTabSelected:Fe,onUnloadAudio:function(){return e.onUnloadAudio(j)},onUnloadVideo:function(){return e.onUnloadVideo(p)},onOffsetChange:Ee,onVolumeChange:Re}),Object(a.jsx)(Ot,{playing:I,subtitles:F,clock:se,length:Me,jumpToSubtitle:e.jumpToSubtitle,drawerOpen:o,compressed:p&&!te,loading:g,onSeek:Ce,onCopy:Se})]})]}),Object(a.jsx)("audio",{ref:ce,src:j})]})}var Ct=n(237),wt=n(287),St=n(312),Tt=n(305),Ft=n(309),Et=Object(Ct.a)((function(e){return{root:{"& .MuiTextField-root":{margin:e.spacing(1)}}}})),Rt=Object(Ct.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120}}}));function Mt(e){var t=Rt(),n=e.label,r=e.value,c=e.selections,i=e.onChange,o=e.onSelectionChange;return Object(a.jsxs)("div",{children:[Object(a.jsx)(R.a,{label:n,value:r,onChange:i}),Object(a.jsxs)(wt.a,{className:t.formControl,children:[Object(a.jsx)(St.a,{}),Object(a.jsx)(Ft.a,{value:r,disabled:!c,onChange:o,children:c&&c.map((function(e){return Object(a.jsx)(Tt.a,{value:e,children:e},e)}))})]})]})}function It(e){var t=e.anki,n=e.open,c=e.settings,i=e.onClose,o=Et(),s=Object(r.useState)(c.ankiConnectUrl),u=Object(O.a)(s,2),l=u[0],f=u[1],j=Object(r.useState)(),h=Object(O.a)(j,2),p=h[0],v=h[1],m=Object(r.useState)(0),g=Object(O.a)(m,2),k=g[0],y=g[1],x=Object(r.useState)(c.deck||""),C=Object(O.a)(x,2),w=C[0],S=C[1],T=Object(r.useState)(),F=Object(O.a)(T,2),U=F[0],L=F[1],P=Object(r.useState)(c.noteType||""),D=Object(O.a)(P,2),_=D[0],W=D[1],z=Object(r.useState)(),B=Object(O.a)(z,2),H=B[0],G=B[1],V=Object(r.useState)(c.sentenceField||""),X=Object(O.a)(V,2),q=X[0],J=X[1],K=Object(r.useState)(c.definitionField||""),Y=Object(O.a)(K,2),$=Y[0],Q=Y[1],Z=Object(r.useState)(c.audioField||""),ee=Object(O.a)(Z,2),te=ee[0],ne=ee[1],ae=Object(r.useState)(),re=Object(O.a)(ae,2),ce=re[0],ie=re[1],oe=Object(r.useCallback)((function(e){f(e.target.value),y(Date.now())}),[]),se=Object(r.useCallback)((function(e){return S(e.target.value)}),[]),ue=Object(r.useCallback)((function(e){return S(e.target.value)}),[]),le=Object(r.useCallback)((function(e){return W(e.target.value)}),[]),de=Object(r.useCallback)((function(e){return W(e.target.value)}),[]),be=Object(r.useCallback)((function(e){return J(e.target.value)}),[]),fe=Object(r.useCallback)((function(e){return J(e.target.value)}),[]),je=Object(r.useCallback)((function(e){return Q(e.target.value)}),[]),he=Object(r.useCallback)((function(e){return Q(e.target.value)}),[]),Oe=Object(r.useCallback)((function(e){return ne(e.target.value)}),[]),pe=Object(r.useCallback)((function(e){return ne(e.target.value)}),[]);Object(r.useEffect)((function(){var e=setTimeout(Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=L,e.next=4,t.deckNames(l);case 4:return e.t1=e.sent,(0,e.t0)(e.t1),e.t2=G,e.next=9,t.modelNames(l);case 9:e.t3=e.sent,(0,e.t2)(e.t3),v(null),e.next=19;break;case 14:e.prev=14,e.t4=e.catch(0),console.error(e.t4),L(null),v(e.t4.message);case 19:case"end":return e.stop()}}),e,null,[[0,14]])}))),1e3);return function(){return clearTimeout(e)}}),[t,l,k]),Object(r.useEffect)((function(){function e(){return(e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=ie,e.next=4,t.modelFieldNames(l,_);case 4:e.t1=e.sent,(0,e.t0)(e.t1),v(null),e.next=14;break;case 9:e.prev=9,e.t2=e.catch(0),console.error(e.t2),ie(null),v(e.t2.message);case 14:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}_&&function(){e.apply(this,arguments)}()}),[t,_,l,k]);var ve=Object(r.useCallback)((function(){i({ankiConnectUrl:l,deck:w,noteType:_,sentenceField:q,definitionField:$,audioField:te})}),[i,l,w,_,q,$,te]);return Object(a.jsxs)(M.a,{open:n,children:[Object(a.jsx)(A.a,{children:"Settings"}),Object(a.jsx)(N.a,{children:Object(a.jsxs)("form",{className:o.root,children:[Object(a.jsx)("div",{children:Object(a.jsx)(R.a,{label:"Anki Connect URL",color:"secondary",value:l,error:Boolean(p),helperText:p,onChange:oe})}),Object(a.jsx)(Mt,{label:"Deck",value:w,selections:U,onChange:ue,onSelectionChange:se}),Object(a.jsx)(Mt,{label:"Note Type",value:_,selections:H,onChange:de,onSelectionChange:le}),Object(a.jsx)(Mt,{label:"Sentence Field",value:q,selections:ce,onChange:be,onSelectionChange:fe}),Object(a.jsx)(Mt,{label:"Definition Field",value:$,selections:ce,onChange:je,onSelectionChange:he}),Object(a.jsx)(Mt,{label:"Audio Field",value:te,selections:ce,onChange:Oe,onSelectionChange:pe})]})}),Object(a.jsx)(I.a,{children:Object(a.jsx)(E.a,{onClick:ve,children:"OK"})})]})}var Nt="http://127.0.0.1:8765",Ut="ankiConnectUrl",At="deck",Lt="noteType",Pt="sentenceField",Dt="definitionField",_t="audioField",Wt=function(){function e(){Object(S.a)(this,e)}return Object(T.a)(e,[{key:"settings",get:function(){return{ankiConnectUrl:localStorage.getItem(Ut)||Nt,deck:localStorage.getItem(At),noteType:localStorage.getItem(Lt),sentenceField:localStorage.getItem(Pt),definitionField:localStorage.getItem(Dt),audioField:localStorage.getItem(_t)}}},{key:"ankiConnectUrl",get:function(){return localStorage.getItem(Ut)||Nt},set:function(e){localStorage.setItem(Ut,e)}},{key:"deck",get:function(){return localStorage.getItem(At)},set:function(e){localStorage.setItem(At,e)}},{key:"noteType",get:function(){return localStorage.getItem(Lt)},set:function(e){localStorage.setItem(Lt,e)}},{key:"sentenceField",get:function(){return localStorage.getItem(Pt)},set:function(e){localStorage.setItem(Pt,e)}},{key:"definitionField",get:function(){return localStorage.getItem(Dt)},set:function(e){localStorage.setItem(Dt,e)}},{key:"audioField",get:function(){return localStorage.getItem(_t)},set:function(e){localStorage.setItem(_t,e)}}]),e}(),zt=function(){function e(t){Object(S.a)(this,e),this.channel=new BroadcastChannel(t),this.time=0,this.duration=0,this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.closeCallbacks=[],this.readyCallbacks=[],this.subtitlesCallbacks=[];var n=this;this.channel.onmessage=function(e){switch(e.data.command){case"init":break;case"ready":var t,a=Object(f.a)(n.readyCallbacks);try{for(a.s();!(t=a.n()).done;){(0,t.value)(e.data.duration)}}catch(p){a.e(p)}finally{a.f()}break;case"play":var r,c=Object(f.a)(n.playCallbacks);try{for(c.s();!(r=c.n()).done;){(0,r.value)()}}catch(p){c.e(p)}finally{c.f()}break;case"pause":var i,o=Object(f.a)(n.pauseCallbacks);try{for(o.s();!(i=o.n()).done;){(0,i.value)()}}catch(p){o.e(p)}finally{o.f()}break;case"currentTime":var s,u=Object(f.a)(n.currentTimeCallbacks);try{for(u.s();!(s=u.n()).done;){(0,s.value)(e.data.value)}}catch(p){u.e(p)}finally{u.f()}break;case"audioTrackSelected":var l,d=Object(f.a)(n.audioTrackSelectedCallbacks);try{for(d.s();!(l=d.n()).done;){(0,l.value)(e.data.id)}}catch(p){d.e(p)}finally{d.f()}break;case"close":var b,j=Object(f.a)(n.closeCallbacks);try{for(j.s();!(b=j.n()).done;){(0,b.value)()}}catch(p){j.e(p)}finally{j.f()}break;case"subtitles":var h,O=Object(f.a)(n.subtitlesCallbacks);try{for(O.s();!(h=O.n()).done;){(0,h.value)(e.data.value)}}catch(p){O.e(p)}finally{O.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(T.a)(e,[{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onClose",value:function(e){this.closeCallbacks.push(e)}},{key:"onReady",value:function(e){this.readyCallbacks.push(e)}},{key:"onSubtitles",value:function(e){this.subtitlesCallbacks.push(e)}},{key:"ready",value:function(e,t,n,a){this.channel.postMessage({command:"ready",duration:e,paused:t,currentTime:0,audioTracks:n,selectedAudioTrack:a})}},{key:"readyState",value:function(e){this.channel.postMessage({command:"readyState",value:e})}},{key:"play",value:function(){this.channel.postMessage({command:"play",echo:!0})}},{key:"pause",value:function(){this.channel.postMessage({command:"pause",echo:!0})}},{key:"audioTrackSelected",value:function(e){this.channel.postMessage({command:"audioTrackSelected",id:e})}},{key:"offset",value:function(e){this.channel.postMessage({command:"offset",value:e})}},{key:"popOutToggle",value:function(){this.channel.postMessage({command:"popOutToggle"})}},{key:"copy",value:function(e){this.channel.postMessage({command:"copy",subtitle:e})}},{key:"close",value:function(){this.channel&&(this.channel.postMessage({command:"exit"}),this.channel.close(),this.channel=null)}},{key:"currentTime",get:function(){return this.time},set:function(e){this.time=e,this.channel.postMessage({command:"currentTime",value:this.time,echo:!0})}}]),e}(),Bt=Object(m.a)({root:{position:"relative",backgroundColor:"black",height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},video:{margin:"auto"},subtitle:{position:"absolute",paddingLeft:20,paddingRight:20,width:"100%",bottom:100,textAlign:"center",color:"white",textShadow:"0 0 2px black, 0 0 2px black, 0 0 2px black, 0 0 2px black",fontSize:36}});function Ht(e,t,n,a){if(window.outerWidth&&e.videoWidth>0&&e.videoHeight>0){var r=window.screen.availWidth-(window.outerWidth-window.innerWidth),c=window.screen.availHeight-(window.outerHeight-window.innerHeight),i=Math.min(1,Math.min(r/e.videoWidth,c/e.videoHeight));window.resizeTo(i*e.videoWidth+(window.outerWidth-window.innerWidth),i*e.videoHeight+(window.outerHeight-window.innerHeight))}var o,s;if(e.audioTracks){o=[];var u,l=Object(f.a)(e.audioTracks);try{for(l.s();!(u=l.n()).done;){var d=u.value;o.push({id:d.id,label:d.label,language:d.language}),d.enabled&&(s=d.id)}}catch(b){l.e(b)}finally{l.f()}}else o=null,s=null;n(o),a(s),t.ready(e.duration,e.paused,o,s)}function Gt(e){var t=Bt(),n=e.videoFile,i=e.channel,o=e.popOut,s=e.onError,u=Object(r.useRef)(),l=Object(r.useRef)(),d=g(!0),b=Object(O.a)(d,2),h=b[0],p=b[1];l.current&&(l.current.width=h,l.current.height=p);var v=Object(r.useMemo)((function(){return new zt(i)}),[i]),m=Object(r.useState)(!1),k=Object(O.a)(m,2),y=k[0],x=k[1],C=function(){var e=Object(r.useState)(Boolean(document.fullscreenElement)),t=Object(O.a)(e,2),n=t[0],a=t[1];return Object(r.useEffect)((function(){var e=function(){return a(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",e),function(){return document.removeEventListener("fullscreenchange",e)}}),[]),n}(),S=Object(r.useRef)();S.current=y;var T=Object(r.useState)(0),F=Object(O.a)(T,2),E=F[0],R=F[1],M=Object(r.useState)(0),I=Object(O.a)(M,2),N=I[0],U=I[1],A=Object(r.useState)(),L=Object(O.a)(A,2),P=L[0],D=L[1],_=Object(r.useState)(),W=Object(O.a)(_,2),z=W[0],B=W[1],H=Object(r.useState)([]),G=Object(O.a)(H,2),V=G[0],X=G[1],q=Object(r.useState)([]),J=Object(O.a)(q,2),K=J[0],Y=J[1],$=Object(r.useState)(!0),Q=Object(O.a)($,2),Z=Q[0],ee=Q[1],te=Object(r.useRef)([]);te.current=K;var ne=Object(r.useMemo)((function(){return new ve}),[]),ae=Object(r.useRef)({x:0,y:0}),re=Object(r.useRef)(),ce=Object(r.useState)(),ie=Object(O.a)(ce,2),oe=ie[0],se=ie[1],ue=Object(r.useState)(!1),le=Object(O.a)(ue,2),de=le[0],be=le[1],fe=Object(r.useCallback)((function(e){e&&(l.current=e,4===e.readyState?Ht(e,v,D,B):e.onloadeddata=function(t){Ht(e,v,D,B)},e.oncanplay=function(e){v.readyState(4),S.current&&ne.start()},e.onerror=function(t){s(function(e){var t;switch(e.error.code){case 1:t="Aborted";break;case 2:t="Network error";break;case 3:t="Decoding error";break;case 4:t="Source not supported";break;default:t="Unknown error"}return t+": "+(e.error.message||"<details missing>")}(e))})}),[ne,v,s]);function je(e){var t,n=Object(f.a)(l.current.audioTracks);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.id===e?a.enabled=!0:a.enabled=!1}}catch(r){n.e(r)}finally{n.f()}}Object(r.useEffect)((function(){return v.onReady((function(e){R(e)})),v.onPlay((function(){l.current.play(),ne.start(),x(!0)})),v.onPause((function(){l.current.pause(),ne.stop(),x(!1)})),v.onCurrentTime((function(e){var t;l.current&&(l.current.currentTime=e),4===(null===(t=l.current)||void 0===t?void 0:t.readyState)&&v.readyState(4),ne.stop(),ne.setTime(1e3*e)})),v.onAudioTrackSelected((function(e){je(e),v.audioTrackSelected(e)})),v.onClose((function(){v.close(),window.close()})),v.onSubtitles((function(e){if(X(e),e&&e.length>0){var t=e[0],n=t.start-t.originalStart;U(n)}})),window.onbeforeunload=function(e){u.current||v.close()},function(){v.close()}}),[ne,v]);var he=Object(r.useCallback)((function(){l.current&&v.play()}),[v]),Oe=Object(r.useCallback)((function(){v.pause()}),[v]),pe=Object(r.useCallback)((function(e){S.current&&ne.stop();var t=e*E;v.currentTime=t/1e3}),[E,ne,v]);var me=Object(r.useCallback)((function(e){S.current&&(ne.stop(),v.pause()),je(e),B(e),v.currentTime=0,v.audioTrackSelected(e)}),[v,ne]);Object(r.useEffect)((function(){if(V&&0!==V.length){var e=setInterval((function(){for(var e=1e3*l.current.currentTime,t=[],n=0;n<V.length;++n){var a=V[n];if(e>=a.start&&e<a.end&&t.push(Object(j.a)(Object(j.a)({},a),{},{index:n})),e<a.start)break}(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};if(e.length!==t.length)return!1;for(var a=0;a<e.length;++a)if(!n(e[a],t[a]))return!1;return!0})(t,te.current,(function(e,t){return e.index===t.index}))||Y(t)}),10);return function(){return clearTimeout(e)}}}),[V]),Object(r.useEffect)((function(){function e(e){if(l.current&&V&&0!==V.length){var t;if(37===e.keyCode)t=!1;else{if(39!==e.keyCode)return;t=!0}var n=Math.round(1e3*l.current.currentTime),a=-1;if(t)for(var r=Number.MAX_SAFE_INTEGER,c=0;c<V.length;++c){var i=V[c],o=i.start-n;r<=o||n<i.start&&(r=o,a=c)}else for(var s=Number.MAX_SAFE_INTEGER,u=0;u<V.length;++u){var d=V[u],b=n-d.start;s<=b||n>d.start&&(s=b,a=n<d.end?Math.max(0,u-1):u)}-1!==a&&(e.preventDefault(),v.currentTime=V[a].start/1e3)}}return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[v,ne,V,E]),Object(r.useEffect)((function(){function e(e){if(te.current&&0!==te.current.length&&ct(e)){e.stopPropagation(),e.preventDefault();var t=te.current[0];v.copy(t),C&&(se("Copied "+t.text),be(!0))}}return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[v,C]);var ge=Object(r.useCallback)((function(){ee((function(e){return!e}))}),[]),ke=Object(r.useCallback)((function(){var e;C?document.exitFullscreen():null===(e=re.current)||void 0===e||e.requestFullscreen()}),[C]),ye=Object(r.useCallback)((function(e){l.current&&(l.current.volume=e)}),[]),xe=Object(r.useCallback)((function(e){v.offset(e)}),[v]),Ce=Object(r.useCallback)((function(){v.popOutToggle(),o&&(u.current=!0,window.close())}),[v,o]),we=Object(r.useCallback)((function(){v.close(),window.close()}),[v]),Se=Object(r.useCallback)((function(){y?v.pause():v.play()}),[v,y]),Te=Object(r.useCallback)((function(){be(!1)}),[]);return Object(a.jsxs)("div",{ref:re,onMouseMove:function(e){ae.current.x=e.screenX,ae.current.y=e.screenY},className:t.root,children:[Object(a.jsx)("video",{preload:"auto",nocontrols:1,onClick:Se,className:t.video,ref:fe,src:n}),Z&&Object(a.jsx)("div",{className:t.subtitle,children:K.map((function(e){return Object(a.jsxs)(c.a.Fragment,{children:[e.text,Object(a.jsx)("br",{})]},e.index)}))}),C&&Object(a.jsx)(w,{open:de,onClose:Te,autoHideDuration:3e3,severity:"success",children:oe}),Object(a.jsx)(at,{mousePositionRef:ae,playing:y,clock:ne,length:E,audioTracks:P,selectedAudioTrack:z,subtitlesToggle:V&&V.length>0,subtitlesEnabled:Z,offsetEnabled:!0,offset:N,fullscreenEnabled:!0,fullscreen:C,closeEnabled:!o,popOut:o,volumeEnabled:!0,popOutEnabled:!0,onPlay:he,onPause:Oe,onSeek:pe,onAudioTrackSelected:me,onSubtitlesToggle:ge,onFullscreenToggle:ke,onVolumeChange:ye,onOffsetChange:xe,onPopOutToggle:Ce,onClose:we})]})}function Vt(e){var t,n=(t=e.drawerWidth,Object(m.a)((function(e){return{content:{flexGrow:1,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginRight:0},contentShift:{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:t}}})))();return Object(a.jsx)("main",{className:Object(k.a)(n.content,Object(p.a)({},n.contentShift,e.drawerOpen)),children:e.children})}var Xt=function(){var e=Object(r.useMemo)((function(){return new _}),[]),t=Object(r.useMemo)((function(){return new z}),[]),n=Object(r.useMemo)((function(){return new Wt}),[]),c=Object(r.useMemo)((function(){return new F(n)}),[n]),i=Object(r.useMemo)((function(){return new $}),[]),o=Object(v.g)(),s=Object(r.useRef)(),u=g("/video"!==o.pathname),l=Object(O.a)(u,1)[0],p=s.current?.2:.3,m=s.current?150:300,k=Math.max(m,l*p),y=Object(r.useState)([]),x=Object(O.a)(y,2),C=x[0],S=x[1],T=Object(r.useState)(!1),E=Object(O.a)(T,2),R=E[0],M=E[1],I=Object(r.useState)(),N=Object(O.a)(I,2),U=N[0],A=N[1],P=Object(r.useState)(!1),D=Object(O.a)(P,2),W=D[0],B=D[1],H=Object(r.useState)(),G=Object(O.a)(H,2),V=G[0],X=G[1],q=Object(r.useState)(),J=Object(O.a)(q,2),K=J[0],Q=J[1],Z=Object(r.useState)({}),ee=Object(O.a)(Z,2),te=ee[0],ne=ee[1],ae=Object(r.useState)(),re=Object(O.a)(ae,2),ce=re[0],ie=re[1],oe=Object(r.useState)(!1),se=Object(O.a)(oe,2),ue=se[0],le=se[1],de=Object(r.useState)(!1),be=Object(O.a)(de,2),fe=be[0],je=be[1],Oe=Object(r.useState)(),pe=Object(O.a)(Oe,2),ve=pe[0],me=pe[1],ge=Object(r.useState)(!1),ke=Object(O.a)(ge,2),ye=ke[0],xe=ke[1],Ce=Object(r.useRef)(),we=te.subtitleFile,Se=Object(r.useCallback)((function(e,t,n,a,r){S((function(c){return[].concat(Object(h.a)(c),[Object(j.a)(Object(j.a)({},e),{},{timestamp:Date.now(),name:ce,subtitleFile:a,audioFile:t,videoFile:n,audioTrack:r})])})),X("success"),A("Copied "+e.text),B(!0)}),[ce]),Te=Object(r.useCallback)((function(){M((function(e){return!e}))}),[]),Fe=Object(r.useCallback)((function(){M(!1)}),[]),Ee=Object(r.useCallback)((function(){xe(!0)}),[]),Re=Object(r.useCallback)((function(e){n.ankiConnectUrl=e.ankiConnectUrl,n.deck=e.deck,n.noteType=e.noteType,n.modelNames=e.modelNames,n.sentenceField=e.sentenceField,n.definitionField=e.definitionField,n.audioField=e.audioField,xe(!1)}),[n]),Me=Object(r.useCallback)((function(e){var t,n=[],a=Object(f.a)(C);try{for(a.s();!(t=a.n()).done;){var r=t.value;e.timestamp!==r.timestamp&&n.push(r)}}catch(c){a.e(c)}finally{a.f()}S(n)}),[C]),Ie=Object(r.useCallback)((function(){B(!1)}),[]),Ne=Object(r.useCallback)((function(e){X("error"),A(e),B(!0)}),[]),Ue=Object(r.useCallback)((function(e){e===te.audioFileUrl&&ne((function(t){return URL.revokeObjectURL(e),{subtitleFile:t.subtitleFile,audioFile:null,audioFileUrl:null,videoFile:t.videoFile,videoFileUrl:t.videoFileUrl}}))}),[te]),Ae=Object(r.useCallback)((function(e){e===te.videoFileUrl&&ne((function(t){return URL.revokeObjectURL(e),{subtitleFile:t.subtitleFile,audioFile:t.audioFile,audioFileUrl:t.audioFileUrl,videoFile:null,videoFileUrl:null}}))}),[te]),Le=Object(r.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Ce.current||0,e.prev=1,e.next=4,t.clipAndSaveAudio(n.audioFile||n.videoFile,n.originalStart+a,n.originalEnd+a);case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(1),console.error(e.t0),Ne(e.t0.message);case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}(),[t,Ne]),Pe=Object(r.useCallback)((function(e){we.name===e.subtitleFile.name?Q({text:e.text,originalStart:e.originalStart}):Ne("Subtitle file "+e.subtitleFile.name+" is not open.")}),[we,Ne]),De=Object(r.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:me(t),le(!0),je(!1);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),_e=Object(r.useCallback)((function(){me(null),le(!1),je(!1)}),[]),We=Object(r.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(a){var r,i,o,s,u,l,b;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return je(!0),r=ve,i=Ce.current||0,e.prev=3,o=r.audioFile||r.videoFile,e.next=7,t.clipAudio(o,r.originalStart+i,r.originalEnd+i);case 7:return s=e.sent,u=Object(O.a)(s,2),l=u[0],b=u[1],e.next=13,c.export(n.ankiConnectUrl,r.text,a,l,o.name,b);case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),console.error(e.t0),Ne(e.t0.message);case 19:return e.prev=19,me(null),le(!1),je(!1),e.finish(19);case 24:case"end":return e.stop()}}),e,null,[[3,15,19,24]])})));return function(t){return e.apply(this,arguments)}}(),[c,n,t,Ne,ve]),ze=Object(r.useCallback)((function(e){if(e.preventDefault(),e.dataTransfer.files&&0!==e.dataTransfer.files.length)try{var t=function(e){var t,n=null,a=null,r=null,c=Object(f.a)(e);try{for(c.s();!(t=c.n()).done;){var i=t.value,o=i.name.lastIndexOf(".");if(-1===o)throw new Error("Unable to determine extension of "+i.name);var s=i.name.substring(o+1,i.name.length);switch(s){case"ass":case"srt":if(n)throw new Error("Cannot open two subtitle files simultaneously");n=i;break;case"mkv":if(r)throw new Error("Cannot open two video files simultaneously");r=i;break;case"mp3":if(a)throw new Error("Cannot open two audio files simultaneously");a=i;break;default:throw new Error("Unsupported extension "+s)}}}catch(u){c.e(u)}finally{c.f()}if(r&&a)throw new Error("Cannot load both an audio and video file simultaneously");return{subtitleFile:n,audioFile:a,videoFile:r}}(e.dataTransfer.files),n=t.subtitleFile,a=t.audioFile,r=t.videoFile;ne((function(e){var t=null,c=null;return r||a?(!function(e){e.audioFileUrl&&URL.revokeObjectURL(e.audioFileUrl),e.videoFileUrl&&URL.revokeObjectURL(e.videoFileUrl)}(e),r?t=URL.createObjectURL(r):a&&(c=URL.createObjectURL(a))):(r=e.videoFile,t=e.videoFileUrl,a=e.audioFile,c=e.audioFileUrl),{subtitleFile:n||e.subtitleFile,audioFile:a,audioFileUrl:c,videoFile:r,videoFileUrl:t}})),n&&ie(n.name)}catch(e){console.error(e),Ne(e.message)}}),[Ne]);return Object(a.jsxs)("div",{onDrop:ze,onDragOver:function(e){return e.preventDefault()},children:[Object(a.jsx)(w,{open:W,onClose:Ie,autoHideDuration:3e3,severity:V,children:U}),Object(a.jsxs)(v.d,{children:[Object(a.jsx)(v.b,{exact:!0,path:"/",render:function(){var t=new URLSearchParams(window.location.search),r=t.get("video"),o=t.get("channel"),u=t.get("popout");return r&&o?Object(a.jsx)(v.a,{to:"/video?video="+encodeURIComponent(r)+"&channel="+o+"&popout="+u}):Object(a.jsxs)("div",{children:[Object(a.jsx)(he,{items:C,open:R,drawerWidth:k,onClose:Fe,onDelete:Me,onClipAudio:Le,onSelect:Pe,onAnki:De}),Object(a.jsx)(L,{open:ue,disabled:fe,text:null===ve||void 0===ve?void 0:ve.text,onCancel:_e,onProceed:We}),Object(a.jsx)(It,{anki:c,open:ye,onClose:Re,settings:n.settings}),Object(a.jsx)(Y,{title:ce||"a subtitle player",drawerWidth:k,drawerOpen:R,onOpenCopyHistory:Te,onOpenSettings:Ee}),Object(a.jsx)(Vt,{drawerWidth:k,drawerOpen:R,children:Object(a.jsx)(xt,{subtitleReader:e,onCopy:Se,onError:Ne,onUnloadAudio:Ue,onUnloadVideo:Ae,offsetRef:Ce,sources:te,jumpToSubtitle:K,videoFrameRef:s,extension:i,drawerOpen:R})})]})}}),Object(a.jsx)(v.b,{exact:!0,path:"/video",render:function(){var e=new URLSearchParams(window.location.search),t=e.get("video"),n=e.get("channel"),r="true"===e.get("popout");return Object(a.jsx)(Gt,{videoFile:t,popOut:r,channel:n,onError:Ne})}})]})]})},qt=n(93),Jt=n(160),Kt=Object(Jt.a)({palette:{primary:{main:"#49007a"},secondary:{main:"#ff1f62"},error:{main:qt.a.A400},type:"dark"}}),Yt=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,316)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),c(e),i(e)}))},$t=n(104);n(232);o.a.render(Object(a.jsx)($t.a,{basename:"/asbplayer",forceRefresh:!1,children:Object(a.jsxs)(u.a,{theme:Kt,children:[Object(a.jsx)(s.a,{}),Object(a.jsx)(Xt,{})]})}),document.querySelector("#root")),Yt()}},[[233,1,2]]]);
//# sourceMappingURL=main.a0edb12b.chunk.js.map