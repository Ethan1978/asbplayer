(this["webpackJsonp@project/client"]=this["webpackJsonp@project/client"]||[]).push([[0],{221:function(e,t){},223:function(e,t){},240:function(e,t){},242:function(e,t){},273:function(e,t,n){"use strict";n.r(t);n(208);var a=n(22),r=n.n(a),i=n(8),o=n(18),c=n(3),s=n(17),u=n(11),l=n(4),d=n.n(l),b=n(0),f=n.n(b),h=n(26),j=n(321),v=n(184),p=n(353);function g(e){var t=Object(b.useState)([0,0]),n=Object(c.a)(t,2),a=n[0],r=n[1];return Object(b.useLayoutEffect)((function(){function t(){e&&r([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",t),t(),function(){return window.removeEventListener("resize",t)}}),[e]),a}var O,m=n(93),k=n(13),x=n(12),y=function(){function e(){Object(k.a)(this,e)}return Object(x.a)(e,null,[{key:"detectCopy",value:function(e){return e.ctrlKey&&e.shiftKey&&65===e.keyCode}},{key:"detectDecreaseOffset",value:function(e){return e.ctrlKey&&e.shiftKey&&39===e.keyCode}},{key:"detectAnkiExport",value:function(e){return e.ctrlKey&&e.shiftKey&&81===e.keyCode}},{key:"detectIncreaseOffset",value:function(e){return e.ctrlKey&&e.shiftKey&&37===e.keyCode}},{key:"detectDecreaseOffsetToNextSubtitle",value:function(t){return!e.detectDecreaseOffset(t)&&(t.ctrlKey||t.shiftKey)&&39===t.keyCode}},{key:"detectIncreaseOffsetToPreviousSubtitle",value:function(t){return!e.detectIncreaseOffset(t)&&(t.ctrlKey||t.shiftKey)&&37===t.keyCode}},{key:"detectPreviousSubtitle",value:function(t){return!e.detectIncreaseOffset(t)&&!e.detectIncreaseOffsetToPreviousSubtitle(t)&&37===t.keyCode}},{key:"detectNextSubtitle",value:function(t){return!e.detectDecreaseOffset(t)&&!e.detectDecreaseOffsetToNextSubtitle(t)&&39===t.keyCode}},{key:"detectPlay",value:function(e){return 32===e.keyCode}}]),e}();!function(e){e[e.REJECTED=0]="REJECTED",e[e.CANCELED=1]="CANCELED",e[e.ADVANCED=2]="ADVANCED",e[e.COMPLETE=3]="COMPLETE"}(O||(O={}));var C=function(){function e(t){var n=t.up,a=t.holding,r=t.canceledBy,i=t.map;Object(k.a)(this,e),this.up=void 0,this.holding=void 0,this.canceledBy=void 0,this.map=void 0,this.currentlyHolding=void 0,this.canceled=void 0,this.up=n||[],this.holding=a||[],this.canceledBy=r||[],this.map=i||function(e){return!0},this.currentlyHolding={},this.canceled=!1}return Object(x.a)(e,[{key:"reset",value:function(){this.currentlyHolding={},this.canceled=!1}},{key:"accept",value:function(e){var t=O.REJECTED,n=null;return"keydown"===e.type&&(this.holding.includes(e.keyCode)&&(this.currentlyHolding[e.keyCode]=!0,this.canceled=!1,t=O.ADVANCED),this.canceledBy.includes(e.keyCode)&&(this.canceled=!0,t=O.CANCELED),this.up.includes(e.keyCode)&&(this.canceled=!1,t=O.ADVANCED)),"keyup"===e.type&&(delete this.currentlyHolding[e.keyCode],this.up.includes(e.keyCode)&&this._holdingAll()&&!this.canceled&&(n=this.map(e),t=O.COMPLETE)),{result:t,extra:n}}},{key:"_holdingAll",value:function(){var e,t=Object(u.a)(this.holding);try{for(t.s();!(e=t.n()).done;){if(!(e.value in this.currentlyHolding))return!1}}catch(n){t.e(n)}finally{t.f()}return!0}}]),e}(),w=function(){function e(){Object(k.a)(this,e)}return Object(x.a)(e,null,[{key:"toggleSubtitles",value:function(){return new C({up:[83],canceledBy:[49,50,51,52,53,54,55,56,57]})}},{key:"toggleSubtitleTrack",value:function(){return new C({holding:[83],up:[49,50,51,52,53,54,55,56,57],map:function(e){return e.keyCode-49}})}},{key:"toggleSubtitleTrackInList",value:function(){return new C({holding:[68],up:[49,50,51,52,53,54,55,56,57],map:function(e){return e.keyCode-49}})}}]),e}(),S=function(){function e(){Object(k.a)(this,e)}return Object(x.a)(e,null,[{key:"bindCopy",value:function(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return e._bindDown((function(e){if(!n()&&y.detectCopy(e)){var r=a();r&&t(e,r)}}),r)}},{key:"bindAnkiExport",value:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e._bindDown((function(e){n()||y.detectAnkiExport(e)&&t(e)}),a)}},{key:"bindSeekToSubtitle",value:function(t,n,a,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return e._bindDown((function(i){if(!n()){var o=r();if(o&&0!==o.length){var c;if(y.detectPreviousSubtitle(i))c=!1;else{if(!y.detectNextSubtitle(i))return;c=!0}var s=e._adjacentSubtitle(c,a(),o);null!==s&&s.start>=0&&s.end>=0&&t(i,s)}}}),i)}},{key:"bindOffsetToSubtitle",value:function(t,n,a,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return e._bindDown((function(i){if(!n()){var o=r();if(o&&0!==o.length){var c;if(y.detectIncreaseOffsetToPreviousSubtitle(i))c=!1;else{if(!y.detectDecreaseOffsetToNextSubtitle(i))return;c=!0}var s=a(),u=e._adjacentSubtitle(c,s,o);if(null!==u){var l=u.originalStart;t(i,s-l)}}}}),i)}},{key:"_adjacentSubtitle",value:function(e,t,n){for(var a=t,r=-1,i=Number.MAX_SAFE_INTEGER,o=0;o<n.length;++o){var c=n[o],s=e?c.start-a:a-c.start;i<=s||(e&&a<c.start?(i=s,r=o):!e&&a>c.start&&(i=s,r=a<c.end?Math.max(0,o-1):o))}return-1!==r?n[r]:null}},{key:"bindAdjustOffset",value:function(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return e._bindDown((function(e){if(!n()){var r=a();if(r&&0!==r.length){var i;if(y.detectDecreaseOffset(e))i=!1;else{if(!y.detectIncreaseOffset(e))return;i=!0}var o=r[0].start-r[0].originalStart;t(e,o+(i?100:-100))}}}),r)}},{key:"bindToggleSubtitles",value:function(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=w.toggleSubtitles(),o=function(e){if(a())i.reset();else{var r=i.accept(e);r.result===O.ADVANCED?n():r.result===O.COMPLETE&&t(e)}},c=e._bindDown(o,r),s=e._bindUp(o,r);return function(){c(),s()}}},{key:"bindToggleSubtitleTrackInVideo",value:function(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=w.toggleSubtitleTrack(),o=function(e){if(a())i.reset();else{var r=i.accept(e);r.result===O.ADVANCED?n(e):r.result===O.COMPLETE&&t(e,r.extra)}},c=e._bindDown(o,r),s=e._bindUp(o,r);return function(){c(),s()}}},{key:"bindToggleSubtitleTrackInList",value:function(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=w.toggleSubtitleTrackInList(),o=function(e){if(a())i.reset();else{var r=i.accept(e);r.result===O.ADVANCED?n(e):r.result===O.COMPLETE&&t(e,r.extra)}},c=e._bindDown(o,r),s=e._bindUp(o,r);return function(){c(),s()}}},{key:"bindPlay",value:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e._bindDown((function(e){n()||y.detectPlay(e)&&t(e)}),a)}},{key:"_bindDown",value:function(e,t){return window.addEventListener("keydown",e,t),function(){return window.removeEventListener("keydown",e,t)}}},{key:"_bindUp",value:function(e,t){return window.addEventListener("keyup",e,t),function(){return window.removeEventListener("keyup",e,t)}}}]),e}(),T=function(){function e(){Object(k.a)(this,e)}return Object(x.a)(e,null,[{key:"encode",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(i.a)(d.a.mark((function e(a,r){var o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(o=new FileReader).onload=function(){var e=Object(i.a)(d.a.mark((function e(t){var i,o,c,s,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,i=new AudioContext,null!==t.target){e.next=5;break}return r(new Error("Could not obtain buffer to encode")),e.abrupt("return");case 5:return e.next=7,i.decodeAudioData(t.target.result);case 7:for(o=e.sent,c=[],s=0;s<o.numberOfChannels;++s)c.push(o.getChannelData(s));(u=n()).postMessage({command:"encode",audioBuffer:{channels:c,numberOfChannels:o.numberOfChannels,length:o.length,sampleRate:o.sampleRate}}),u.onmessage=function(e){a(new Blob(e.data.buffer,{type:"audio/mp3"})),u.terminate()},u.onerror=function(e){var t,n=null!==(t=null===e||void 0===e?void 0:e.error)&&void 0!==t?t:new Error("MP3 encoding failed: "+(null===e||void 0===e?void 0:e.message));r(n),u.terminate()},e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),r(e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t){return e.apply(this,arguments)}}(),o.readAsArrayBuffer(t);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function F(){return new Worker(n.p+"static/js/mp3-encoder.d9a88fab.worker.js")}var E={"audio/ogg;codecs=opus":"ogg","audio/webm;codecs=opus":"webm"},M=Object(c.a)(Object.keys(E).filter(MediaRecorder.isTypeSupported).map((function(e){return[e,E[e]]}))[0],2),R=M[0],I=M[1],P=function(){return new F},A=function(){function e(t,n,a,r,i){Object(k.a)(this,e),this._name=void 0,this.start=void 0,this.end=void 0,this._base64=void 0,this._extension=void 0,this.cachedBlob=void 0,this._name=t+"_"+Math.floor(n)+"_"+Math.floor(a),this.start=n,this.end=a,this._base64=r,this._extension=i}return Object(x.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return this._extension}},{key:"base64",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._base64);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(i.a)(d.a.mark((function e(){var t,n,a=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return t=e.sent,(n=new Audio).src=URL.createObjectURL(t),n.preload="none",n.load(),e.next=9,n.play();case 9:return e.abrupt("return",new Promise((function(e,t){setTimeout((function(){n.pause();var t=n.src;n.src="",URL.revokeObjectURL(t),e(void 0)}),a.end-a.start+1e3)})));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_blob",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cachedBlob){e.next=6;break}return e.next=3,fetch("data:audio/"+this.extension+";base64,"+this._base64);case 3:return e.next=5,e.sent.blob();case 5:this.cachedBlob=e.sent;case 6:return e.abrupt("return",this.cachedBlob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"slice",value:function(e,t){return this}},{key:"isSliceable",value:function(e,t){return!1}}]),e}(),D=function(){function e(t,n,a,r){Object(k.a)(this,e),this.file=void 0,this._name=void 0,this.start=void 0,this.end=void 0,this.trackId=void 0,this._extension=void 0,this._blob=void 0,this.file=t,this._name=t.name+"_"+n+"_"+a,this.start=n,this.end=a,this.trackId=r,this._extension=I}return Object(x.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return this._extension}},{key:"base64",value:function(){var e=Object(i.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(i.a)(d.a.mark((function e(n,a){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new FileReader,e.t0=r,e.next=4,t.blob();case 4:e.t1=e.sent,e.t0.readAsDataURL.call(e.t0,e.t1),r.onloadend=function(){var e=r.result,t=e.substring(e.indexOf(",")+1);n(t)};case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(i.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=5;break}return e.next=3,this._clipAudio();case 3:return this._blob=e.sent,e.abrupt("return");case 5:return e.next=7,this._audioElement(this._blob,!1);case 7:return(t=e.sent).currentTime=0,e.next=11,t.play();case 11:return e.next=13,this._stopAudio(t);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=4;break}return e.next=3,this._clipAudio();case 3:this._blob=e.sent;case 4:return e.abrupt("return",this._blob);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_clipAudio",value:function(){var e=Object(i.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(i.a)(d.a.mark((function e(n,a){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._audioElement(t.file,!0);case 2:(r=e.sent).oncanplay=function(){var e=Object(i.a)(d.a.mark((function e(a){var i,o,c,s,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.play(),i=t._captureStream(r),o=Object(u.a)(i.getVideoTracks());try{for(o.s();!(c=o.n()).done;)c.value.stop()}catch(a){o.e(a)}finally{o.f()}return s=new MediaRecorder(i,{mimeType:R}),l=[],s.ondataavailable=function(e){l.push(e.data)},s.onstop=function(e){n(new Blob(l))},s.start(),e.next=11,t._stopAudio(r);case 11:s.stop();case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_audioElement",value:function(e,t){var n=this,a=new Audio;return a.src=URL.createObjectURL(e),new Promise((function(e,r){a.onloadedmetadata=function(r){if(t&&n.trackId&&a.audioTracks&&a.audioTracks.length>0){var i,o=Object(u.a)(a.audioTracks);try{for(o.s();!(i=o.n()).done;){var c=i.value;c.enabled=n.trackId===c.id}}catch(s){o.e(s)}finally{o.f()}}a.currentTime=n.start/1e3,e(a)}}))}},{key:"_captureStream",value:function(e){if("function"===typeof e.captureStream)return e.captureStream();if("function"===typeof e.mozCaptureStream)return e.mozCaptureStream();throw new Error("Unable to capture stream from audio")}},{key:"_stopAudio",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){setTimeout((function(){t.pause();var n=t.src;t.src="",URL.revokeObjectURL(n),e(void 0)}),n.end-n.start+100)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"slice",value:function(t,n){return new e(this.file,t,n,this.trackId)}},{key:"isSliceable",value:function(e,t){return!0}}]),e}(),_=function(){function e(t,n){Object(k.a)(this,e),this.data=void 0,this.workerFactory=void 0,this._blob=void 0,this.data=t,this.workerFactory=n}return Object(x.a)(e,[{key:"name",get:function(){return this.data.name}},{key:"extension",get:function(){return"mp3"}},{key:"base64",value:function(){var e=Object(i.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(i.a)(d.a.mark((function e(n,a){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new FileReader,e.t0=r,e.next=5,t.blob();case 5:e.t1=e.sent,e.t0.readAsDataURL.call(e.t0,e.t1),r.onloadend=function(){var e=r.result,t=e.substring(e.indexOf(",")+1);n(t)},e.next=13;break;case 10:e.prev=10,e.t2=e.catch(0),a(e.t2);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.play();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=9;break}return e.t0=T,e.next=4,this.data.blob();case 4:return e.t1=e.sent,e.t2=this.workerFactory,e.next=8,e.t0.encode.call(e.t0,e.t1,e.t2);case 8:this._blob=e.sent;case 9:return e.abrupt("return",this._blob);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"slice",value:function(t,n){return new e(this.data.slice(t,n),this.workerFactory)}},{key:"isSliceable",value:function(e,t){return this.data.isSliceable(e,t)}}]),e}(),N=function(){function e(t){Object(k.a)(this,e),this.data=void 0,this.data=t}return Object(x.a)(e,[{key:"name",get:function(){return this.data.name+"."+this.data.extension}},{key:"play",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.play();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"base64",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.base64();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=Object(i.a)(d.a.mark((function e(){var t,n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:t=e.sent,n=window.URL.createObjectURL(t),a=document.createElement("a"),document.body.appendChild(a),a.style.display="none",a.href=n,a.download=this.name,a.click(),URL.revokeObjectURL(n),a.remove();case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toMp3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P;return new e(new _(this.data,t))}},{key:"slice",value:function(t,n){return new e(this.data.slice(t,n))}},{key:"isSliceable",value:function(e,t){return this.data.isSliceable(e,t)}}],[{key:"fromBase64",value:function(t,n,a,r,i){return new e(new A(t.substring(0,t.lastIndexOf(".")),n,a,r,i))}},{key:"fromFile",value:function(t,n,a,r){return new e(new D(t,n,a,r))}}]),e}(),B=function(){function e(){Object(k.a)(this,e)}return Object(x.a)(e,[{key:"resize",value:function(e,t,n,a){return new Promise((function(r,i){var o=n<=0?1:n/e.width,c=a<=0?1:a/e.height,s=Math.min(1,Math.min(o,c));if(s<1){var u=e.width*s,l=e.height*s;createImageBitmap(e,{resizeWidth:u,resizeHeight:l}).then((function(n){e.width=u,e.height=l,t.drawImage(n,0,0),r(e)})).catch((function(e){return i(e)}))}else r(e)}))}}]),e}(),L=function(){function e(t,n,a){Object(k.a)(this,e),this._name=void 0,this._base64=void 0,this._extension=void 0,this.cachedBlob=void 0,this._name=t,this._base64=n,this._extension=a}return Object(x.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return this._extension}},{key:"base64",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._base64);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_blob",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cachedBlob){e.next=6;break}return e.next=3,fetch(this._dataUrl());case 3:return e.next=5,e.sent.blob();case 5:this.cachedBlob=e.sent;case 6:return e.abrupt("return",this.cachedBlob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._dataUrl());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_dataUrl",value:function(){return"data:image/"+this.extension+";base64,"+this._base64}}]),e}(),U=function(){function e(t,n,a,r){Object(k.a)(this,e),this.file=void 0,this.timestamp=void 0,this.maxWidth=void 0,this.maxHeight=void 0,this._name=void 0,this.file=t,this._name=t.name+"_"+Math.floor(n)+".jpeg",this.timestamp=n,this.maxWidth=a,this.maxHeight=r}return Object(x.a)(e,[{key:"name",get:function(){return this._name}},{key:"base64",value:function(){var e=Object(i.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(i.a)(d.a.mark((function e(n,a){var r,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._canvas();case 2:r=e.sent,i=r.toDataURL("image/jpeg"),n(i.substring(i.indexOf(",")+1));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(i.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(i.a)(d.a.mark((function e(n,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._canvas();case 2:e.sent.toBlob((function(e){null===e?a(new Error("Could not obtain blob")):n(e)}),"image/jpeg");case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(i.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canvas();case 2:return t=e.sent,e.abrupt("return",t.toDataURL());case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_canvas",value:function(){var e=Object(i.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(i.a)(d.a.mark((function e(n,a){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(r=t._videoElement(t.file)).oncanplay=function(){var e=Object(i.a)(d.a.mark((function e(a){var i,o,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=document.createElement("canvas")).width=r.videoWidth,i.height=r.videoHeight,(o=i.getContext("2d")).drawImage(r,0,0,i.width,i.height),!(t.maxWidth>0||t.maxHeight>0)){e.next=12;break}return c=new B,e.next=9,c.resize(i,o,t.maxWidth,t.maxHeight);case 9:n(i),e.next=13;break;case 12:n(i);case 13:URL.revokeObjectURL(r.src);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_videoElement",value:function(e){var t=document.createElement("video");return t.src=URL.createObjectURL(e),t.preload="none",t.currentTime=this.timestamp/1e3,t.load(),t}}]),e}(),W=function(){function e(t){Object(k.a)(this,e),this.data=void 0,this.data=t}return Object(x.a)(e,[{key:"name",get:function(){return this.data.name}},{key:"base64",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.base64();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.dataUrl();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=Object(i.a)(d.a.mark((function e(){var t,n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:t=e.sent,n=window.URL.createObjectURL(t),a=document.createElement("a"),document.body.appendChild(a),a.style.display="none",a.href=n,a.download=this.data.name,a.click(),URL.revokeObjectURL(n),a.remove();case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"fromBase64",value:function(t,n,a,r){var i=t.substring(0,t.lastIndexOf("."))+"_"+Math.floor(n)+"."+r;return new e(new L(i,a,r))}},{key:"fromFile",value:function(t,n,a,r){return new e(new U(t,n,a,r))}}]),e}(),H=function(){function e(){Object(k.a)(this,e)}return Object(x.a)(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=Object(i.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"POST",body:JSON.stringify(n)});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}]),e}(),q=['"',"*","_","\\",":"],z=[":","/","\\","<",">",'"',"|","?","*","^"],V=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new H;Object(k.a)(this,e),this.settingsProvider=void 0,this.fetcher=void 0,this.settingsProvider=t,this.fetcher=n}return Object(x.a)(e,[{key:"deckNames",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("deckNames",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelNames",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("modelNames",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelFieldNames",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("modelFieldNames",{modelName:t},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findNotesWithWord",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("findNotes",{query:this.settingsProvider.wordField+":"+this._escapeQuery(t)},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findNotesWithWordGui",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("guiBrowse",{query:this.settingsProvider.wordField+":"+this._escapeQuery(t)},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_escapeQuery",value:function(e){for(var t="",n=0;n<e.length;++n){var a=e[n];q.includes(a)?t+="\\".concat(a):t+=a}return'"'.concat(t,'"')}},{key:"requestPermission",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("requestPermission",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"export",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n,a,r,i,o,c,s,u,l,b){var f,h,j,v,p,g,O,m,k,x,y,C;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f={},this._appendField(f,this.settingsProvider.sentenceField,t,!0),this._appendField(f,this.settingsProvider.definitionField,n,!0),this._appendField(f,this.settingsProvider.wordField,i,!1),this._appendField(f,this.settingsProvider.sourceField,o,!1),this._appendField(f,this.settingsProvider.urlField,c,!1),s)for(h=0,j=Object.keys(s);h<j.length;h++)v=j[h],this._appendField(f,this.settingsProvider.customAnkiFields[v],s[v],!1);if(p={note:{deckName:this.settingsProvider.deck,modelName:this.settingsProvider.noteType,tags:u,options:{allowDuplicate:!1,duplicateScope:"deck",duplicateScopeOptions:{deckName:this.settingsProvider.deck,checkChildren:!1}}}},g="gui"===l,!this.settingsProvider.audioField||!a){e.next=30;break}if(O=this._sanitizeFileName(a.name),!g){e.next=24;break}return e.t0=this,e.t1=O,e.next=16,a.base64();case 16:return e.t2=e.sent,e.t3=b,e.next=20,e.t0._storeMediaFile.call(e.t0,e.t1,e.t2,e.t3);case 20:m=e.sent.result,this._appendField(f,this.settingsProvider.audioField,"[sound:".concat(m,"]"),!1),e.next=30;break;case 24:return e.t4=O,e.next=27,a.base64();case 27:e.t5=e.sent,e.t6=[this.settingsProvider.audioField],p.note.audio={filename:e.t4,data:e.t5,fields:e.t6};case 30:if(!this.settingsProvider.imageField||!r){e.next=51;break}if(k=this._sanitizeFileName(r.name),!g){e.next=45;break}return e.t7=this,e.t8=k,e.next=37,r.base64();case 37:return e.t9=e.sent,e.t10=b,e.next=41,e.t7._storeMediaFile.call(e.t7,e.t8,e.t9,e.t10);case 41:x=e.sent.result,this._appendField(f,this.settingsProvider.imageField,'<div><img src="'.concat(x,'"></div>'),!1),e.next=51;break;case 45:return e.t11=k,e.next=48,r.base64();case 48:e.t12=e.sent,e.t13=[this.settingsProvider.imageField],p.note.picture={filename:e.t11,data:e.t12,fields:e.t13};case 51:p.note.fields=f,e.t14=l,e.next="gui"===e.t14?55:"updateLast"===e.t14?58:"default"===e.t14?68:71;break;case 55:return e.next=57,this._executeAction("guiAddCards",p,b);case 57:return e.abrupt("return",e.sent.result);case 58:return e.next=60,this._executeAction("findNotes",{query:"added:1"},b);case 60:if(0!==(y=e.sent.result.sort()).length){e.next=63;break}throw new Error("Could not find note to update");case 63:return C=y[y.length-1],p.note.id=C,e.next=67,this._executeAction("updateNoteFields",p,b);case 67:return e.abrupt("return",C);case 68:return e.next=70,this._executeAction("addNote",p,b);case 70:return e.abrupt("return",e.sent.result);case 71:throw new Error("Unknown export mode: "+l);case 72:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r,i,o,c,s,u,l,d){return e.apply(this,arguments)}}()},{key:"_appendField",value:function(e,t,n,a){if(t&&n){var r=a?n.split("\n").join("<br>"):n,i=e[t];i&&(r=i+"<br>"+r),e[t]=r}}},{key:"_sanitizeFileName",value:function(e){for(var t="",n=0;n<e.length;++n){var a=e[n];z.includes(a)?t+="_":t+=a}return t}},{key:"_storeMediaFile",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAction("storeMediaFile",{filename:t,data:n},a));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"_executeAction",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n,a){var r,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={action:t,version:6},n&&(r.params=n),e.next=4,this.fetcher.fetch(a||this.settingsProvider.ankiConnectUrl,r);case 4:if(!(i=e.sent).error){e.next=7;break}throw new Error(i.error);case 7:return e.abrupt("return",i);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()}]),e}();function X(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=Math.floor(e/1e3);t=n?Math.round(e/1e3%60*10)/10:a%60;var r=Math.floor(a/60)%60,i=Math.floor(a/3600);return i>0?i+"h"+String(r).padStart(2,"0")+"m"+String(t).padStart(2,"0")+"s":r+"m"+String(t).padStart(2,"0")+"s"}function K(e,t,n,a){for(var r=t,i=t;i>=0&&!J(e,r=i,t,n,a,!1);--i);for(var o=r,c=t;c<=e.length-1&&!J(e,o=c,t,n,a,!0);++c);return e.slice(r,o+1)}function G(e,t,n){var a=[e],r=e.start-e.originalStart;if(e.end<t){var i=Math.min(t,e.end+n);a.push({text:"",start:e.end,end:i,originalStart:e.end-r,originalEnd:i-r,track:e.track})}if(e.start>0){var o=Math.max(0,e.start-n);a.unshift({text:"",start:o,end:e.start,originalStart:o-r,originalEnd:e.start-r,track:e.track})}return a}function J(e,t,n,a,r,i){var o;return o=i?t+1<e.length?e[t+1]:null:t-1>=0?e[t-1]:null,Math.abs(n-t)>=a&&(null===o||Math.abs(o.start-e[n].start)>=r)}var Q=n(358),Y=n(6),Z=n(356),$=n(274),ee=n(1),te=Object(j.a)({root:{display:"flex",justifyContent:"center",position:"fixed",top:80,width:"100%",pointerEvents:"none",zIndex:2e3}});function ne(e){var t=te();return Object(b.useEffect)((function(){if(e.open){var t=setTimeout(e.onClose,e.autoHideDuration);return function(){return clearTimeout(t)}}}),[e.open,e.autoHideDuration,e.onClose]),Object(ee.jsx)("div",{className:t.root,children:Object(ee.jsx)($.a,{in:e.open,children:Object(ee.jsx)(Z.a,{severity:e.severity,children:e.children})})})}var ae=n(5),re=n(325),ie=["tags","onTagsChange"];function oe(e){var t=e.tags,n=e.onTagsChange,a=Object(ae.a)(e,ie),r=Object(b.useState)(""),i=Object(c.a)(r,2),s=i[0],l=i[1];Object(b.useEffect)((function(){t.join(", ")!==s&&l(t.join(", "))}),[s,t]);var d=Object(b.useCallback)((function(e){var t=e.target.value;s.length>t.length&&s.includes(t)&&t.endsWith(",")&&(t=t.substring(0,t.length-1));var a=function(e){var t,n=e.split(" ").join("").split(","),a=[],r=Object(u.a)(n);try{for(r.s();!(t=r.n()).done;){var i=t.value;a.push(i.trim())}}catch(o){r.e(o)}finally{r.f()}return a}(t);l(a.join(", ")),n(a)}),[s,n]);return Object(ee.jsx)(re.a,Object(o.a)(Object(o.a)({},a),{},{value:s,onChange:d}))}var ce=n(284),se=n(330),ue=n(331),le=n(329),de=Object(ce.a)((function(e){return{image:function(e){return{width:e.width,height:e.height,backgroundSize:"contain"}}}}));function be(e){var t,n=e.open,a=e.image,r=e.onClose,o=Object(b.useState)(),s=Object(c.a)(o,2),u=s[0],l=s[1],f=Object(b.useState)(0),h=Object(c.a)(f,2),j=h[0],v=h[1],p=Object(b.useState)(0),g=Object(c.a)(p,2),O=g[0],m=g[1],k=function(){var e=Object(b.useState)([0,0]),t=Object(c.a)(e,2),n=t[0],a=t[1];return Object(b.useLayoutEffect)((function(){function e(){a([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),n}(),x=Object(c.a)(k,2),y=x[0],C=x[1];t=j>0&&O>0?Math.min(1,Math.min(y/(2*j),C/(2*O))):1;var w=de({width:j*t,height:O*t});return Object(b.useEffect)((function(){function e(){return e=Object(i.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,a.dataUrl();case 4:t=e.sent,(n=new Image).onload=function(){v(n.width),m(n.height),l(t)},n.src=t;case 8:case"end":return e.stop()}}),e)}))),e.apply(this,arguments)}l(void 0),function(){e.apply(this,arguments)}()}),[a]),a&&u?Object(ee.jsx)(le.a,{open:n,onClose:r,maxWidth:"lg",children:Object(ee.jsx)(se.a,{children:Object(ee.jsx)(ue.a,{className:w.image,image:u,title:a.name,style:{width:j*t,height:O*t}})})}):null}var fe=n(337),he=n(336),je=n(333),ve=n(94),pe=n.n(ve),ge=n(335),Oe=n(275),me=n(334),ke=n(151),xe=n.n(ke),ye=n(150),Ce=n.n(ye),we=n(88),Se=n.n(we),Te=n(362),Fe=n(332),Ee=n(360),Me=n(53),Re=n(152),Ie=n.n(Re),Pe=Object(j.a)((function(e){return{root:{"& .MuiTextField-root":{marginBottom:e.spacing(1)}},title:{flexGrow:1},mediaField:{cursor:"pointer","& input":{cursor:"pointer"}},rangeSelectSlider:{"& .MuiSlider-markLabel":{transform:"translateX(-3%)"}}}}));function Ae(e,t){var n={};return e.subtitles.filter((function(e){return""!==e.text.trim()})).map((function(e){return e.start in n?null:(n[e.start]=!0,{value:e.start,label:"".concat(e.text.trim().substring(0,Math.min(e.text.length,3)),"...")})})).filter((function(e){return null!==e})).filter((function(e){return e.value>=t[0]&&e.value<=t[1]}))}function De(e){return X(e,!0)}function _e(e){var t=e.children,n=e.open,a=e.value;return Object(ee.jsx)(Ee.a,{open:n,enterTouchDelay:0,placement:"top",title:a,children:t})}function Ne(e){var t=e.open,n=e.disabled,a=e.text,r=e.onProceed,o=e.onCancel,s=e.onViewImage,l=e.onOpenSettings,f=e.onRerecord,h=e.audioClip,j=e.image,v=e.source,p=e.url,g=e.sliderContext,O=e.customFields,m=e.settingsProvider,k=e.anki,x=e.definition,y=e.word,C=e.customFieldValues,w=e.timestampInterval,S=e.lastAppliedTimestampIntervalToText,T=Pe(),F=Object(b.useState)(""),E=Object(c.a)(F,2),M=E[0],R=E[1],I=Object(b.useState)(""),P=Object(c.a)(I,2),A=P[0],D=P[1],_=Object(b.useState)(""),N=Object(c.a)(_,2),B=N[0],L=N[1],U=Object(b.useState)(),W=Object(c.a)(U,2),H=W[0],q=W[1],z=Object(b.useState)(null!==v&&void 0!==v?v:""),V=Object(c.a)(z,2),X=V[0],K=V[1],G=Object(b.useState)(m.tags),J=Object(c.a)(G,2),Q=J[0],Y=J[1],Z=Object(b.useState)(null!==p&&void 0!==p?p:""),$=Object(c.a)(Z,2),te=$[0],ne=$[1],ae=Object(b.useState)([]),ie=Object(c.a)(ae,2),ce=ie[0],se=ie[1],ue=Object(b.useState)(0),de=Object(c.a)(ue,2),be=de[0],ve=de[1],ke=Object(b.useState)({}),ye=Object(c.a)(ke,2),we=ye[0],Re=ye[1],Ne=Object(b.useState)(),Be=Object(c.a)(Ne,2),Le=Be[0],Ue=Be[1],We=Object(b.useState)(),He=Object(c.a)(We,2),qe=He[0],ze=He[1],Ve=Object(b.useState)(),Xe=Object(c.a)(Ve,2),Ke=Xe[0],Ge=Xe[1],Je=Object(b.useState)(),Qe=Object(c.a)(Je,2),Ye=Qe[0],Ze=Qe[1],$e=Object(b.useState)(),et=Object(c.a)($e,2),tt=et[0],nt=et[1],at=Object(b.useState)(),rt=Object(c.a)(at,2),it=rt[0],ot=rt[1],ct=Object(b.useState)(),st=Object(c.a)(ct,2),ut=st[0],lt=st[1],dt=Object(b.useState)(),bt=Object(c.a)(dt,2),ft=bt[0],ht=bt[1];Object(b.useEffect)((function(){D(null!==a&&void 0!==a?a:""),R(null!==x&&void 0!==x?x:""),L(null!==y&&void 0!==y?y:""),K(null!==v&&void 0!==v?v:""),ne(null!==p&&void 0!==p?p:""),se([]),Re(null!==C&&void 0!==C?C:{}),Y(m.tags)}),[a,v,x,y,C,p,m.tags]),Object(b.useEffect)((function(){var e=w||g&&[g.subtitleStart,g.subtitleEnd]||void 0,t=g&&function(e){var t,n=null,a=null,r=Object(u.a)(e.subtitles);try{for(r.s();!(t=r.n()).done;){var i=t.value;(null===n||i.start<n)&&(n=i.start),(null===a||i.end>a)&&(a=i.end)}}catch(o){r.e(o)}finally{r.f()}return null!==n&&null!==a&&[n,a]}(g)||void 0,n=g&&Ae(g,t)||void 0;Ue(e),ze(e),ot(e),lt(e),Ze(t),Ge(t),nt(n)}),[g,w,S]),Object(b.useEffect)((function(){if(h){var e=h;m.preferMp3&&(e=e.toMp3()),ut&&(e=e.slice(Math.max(0,Math.round(ut[0])-m.audioPaddingStart),Math.round(ut[1])+m.audioPaddingEnd)),ht(e)}else ht(void 0)}),[h,m.preferMp3,ut,m.audioPaddingStart,m.audioPaddingEnd]),Object(b.useEffect)((function(){ve(Date.now())}),[B]),Object(b.useEffect)((function(){if(B&&m.wordField){var e=B.trim();if(""!==e&&e!==H){var t=setTimeout(Object(i.a)(d.a.mark((function t(){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=se,t.next=4,k.findNotesWithWord(e);case 4:t.t1=t.sent,(0,t.t0)(t.t1),q(e),t.next=12;break;case 9:t.prev=9,t.t2=t.catch(0),console.error(t.t2);case 12:case"end":return t.stop()}}),t,null,[[0,9]])}))),500);return function(){return clearTimeout(t)}}}}),[B,be,H,k,m.wordField]);var jt,vt=Object(b.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),ft.play()}),[ft]),pt=Object(b.useCallback)((function(e,t){var n={};Object.assign(n,we),n[e]=t,Re(n)}),[we]);jt=B&&B.trim()===H&&m.wordField?ce.length>0?"Found ".concat(ce.length,' notes with word "').concat(B,'" in field "').concat(m.wordField,'"'):'No notes found with word "'.concat(B.trim(),'" in field "').concat(m.wordField,'"'):"";var gt=Object(b.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),s(j)}),[j,s]),Ot=Object(b.useCallback)((function(e,t){Ue(t)}),[]),mt=Object(b.useCallback)((function(){var e,t=[],n=Le,a=Object(u.a)(g.subtitles);try{for(a.s();!(e=a.n()).done;){var r=e.value;(r.start>=n[0]&&r.start<=n[1]||r.end>=n[0]&&r.end<=n[1]||n[0]>=r.start&&n[0]<=r.end||n[1]>=r.start&&n[1]<=r.end)&&t.push(r.text)}}catch(i){a.e(i)}finally{a.f()}D(t.join("\n")),ot(Le)}),[Le,g]),kt=Object(b.useCallback)((function(e){if(e.stopPropagation(),f){if(!it||!Le)return;e.stopPropagation(),f({text:A,sliderContext:g,definition:M,word:B,source:X,url:te,customFieldValues:we,lastAppliedTimestampIntervalToText:it,timestampInterval:Le})}else lt(Le)}),[f,it,Le,A,g,M,B,X,te,we]),xt=Object(b.useCallback)((function(){Ke&&(Ue(qe),Ze(Ke),nt(g&&Ae(g,Ke)))}),[qe,Ke,g]),yt=Object(b.useCallback)((function(){if(Ye&&Le){var e=[(Ye[0]+Le[0])/2,(Ye[1]+Le[1])/2];Ze(e),nt(g&&Ae(g,e))}}),[Ye,Le,g]),Ct=!g||0===g.subtitles.filter((function(e){return""!==e.text.trim()})).length;return Object(ee.jsxs)(le.a,{open:t,disableEnforceFocus:!0,fullWidth:!0,maxWidth:"sm",onClose:o,children:[Object(ee.jsxs)(Fe.a,{children:[Object(ee.jsx)(Me.a,{variant:"h6",className:T.title,children:"Anki Export"}),l&&Object(ee.jsx)(Oe.a,{edge:"end",onClick:function(){return l()},children:Object(ee.jsx)(Se.a,{})})]}),Object(ee.jsx)(je.a,{children:Object(ee.jsxs)("form",{className:T.root,children:[Object(ee.jsx)(re.a,{variant:"filled",color:"secondary",multiline:!0,fullWidth:!0,maxRows:8,label:"Sentence",value:A,onChange:function(e){return D(e.target.value)},InputProps:{endAdornment:Le&&Object(ee.jsx)(me.a,{position:"end",children:Object(ee.jsx)(Ee.a,{title:"Apply Selection",children:Object(ee.jsx)("span",{children:Object(ee.jsx)(Oe.a,{disabled:!Le||!it||Le[0]===it[0]&&Le[1]===it[1]||Ct,onClick:mt,edge:"end",children:Object(ee.jsx)(pe.a,{})})})})})}}),Object(ee.jsx)(re.a,{variant:"filled",color:"secondary",multiline:!0,fullWidth:!0,rows:8,label:"Definition",value:M,onChange:function(e){return R(e.target.value)}}),Object(ee.jsx)(re.a,{variant:"filled",color:"secondary",fullWidth:!0,label:"Word",value:B,onChange:function(e){return L(e.target.value)},helperText:jt,InputProps:{endAdornment:Object(ee.jsx)(me.a,{position:"end",children:Object(ee.jsx)(Ee.a,{title:"Search in Anki",children:Object(ee.jsx)("span",{children:Object(ee.jsx)(Oe.a,{disabled:n||!m.wordField||!B||""===B.trim(),onClick:function(){return k.findNotesWithWordGui(B.trim())},edge:"end",children:Object(ee.jsx)(Ce.a,{})})})})})}}),Object.keys(O).map((function(e){return Object(ee.jsx)(re.a,{variant:"filled",color:"secondary",fullWidth:!0,multiline:!0,maxRows:8,label:e,value:we[e]||"",onChange:function(t){return pt(e,t.target.value)}},e)})),ft&&Object(ee.jsx)("div",{className:T.mediaField,onClick:vt,children:Object(ee.jsx)(re.a,{variant:"filled",color:"secondary",fullWidth:!0,value:ft.name,label:"Audio",InputProps:{endAdornment:Le&&Object(ee.jsx)(me.a,{position:"end",children:f?Object(ee.jsx)(Ee.a,{title:"Apply Selection (rerecord)",children:Object(ee.jsx)("span",{children:Object(ee.jsx)(Oe.a,{disabled:!Le||!qe||Le[0]===qe[0]&&Le[1]===qe[1],onClick:kt,edge:"end",children:Object(ee.jsx)(pe.a,{})})})}):Object(ee.jsx)(Ee.a,{title:"Apply Selection",children:Object(ee.jsx)("span",{children:Object(ee.jsx)(Oe.a,{disabled:!ut||Le[0]===ut[0]&&Le[1]===ut[1]||!ft.isSliceable(Le[0],Le[1]),onClick:kt,edge:"end",children:Object(ee.jsx)(pe.a,{})})})})})}})}),j&&Object(ee.jsx)("div",{className:T.mediaField,onClick:gt,children:Object(ee.jsx)(re.a,{variant:"filled",color:"secondary",fullWidth:!0,value:j.name,label:"Image"})}),Object(ee.jsx)(re.a,{variant:"filled",color:"secondary",fullWidth:!0,label:"Source",value:X,onChange:function(e){return K(e.target.value)}}),p&&Object(ee.jsx)(re.a,{variant:"filled",color:"secondary",fullWidth:!0,label:"URL",value:te,onChange:function(e){return ne(e.target.value)}}),m.tags.length>0&&Object(ee.jsx)(oe,{variant:"filled",label:"Tags",helperText:"Comma-separated list of strings",fullWidth:!0,color:"secondary",tags:Q,onTagsChange:function(e){return Y(e)}}),Le&&Ye&&tt&&Object(ee.jsxs)(ge.a,{container:!0,direction:"row",children:[Object(ee.jsx)(ge.a,{item:!0,style:{flexGrow:1},children:Object(ee.jsx)(Te.a,{ValueLabelComponent:_e,value:Le,valueLabelFormat:De,onChange:Ot,min:Ye[0],max:Ye[1],marks:tt,step:1,valueLabelDisplay:"auto",className:T.rangeSelectSlider,color:"secondary"})}),Object(ee.jsx)(ge.a,{item:!0,children:Object(ee.jsx)(Ee.a,{title:"Reset",children:Object(ee.jsx)("span",{children:Object(ee.jsx)(Oe.a,{edge:"end",style:{marginTop:-8},onClick:xt,children:Object(ee.jsx)(xe.a,{})})})})}),Object(ee.jsx)(ge.a,{item:!0,children:Object(ee.jsx)(Ee.a,{title:"Zoom In",children:Object(ee.jsx)("span",{children:Object(ee.jsx)(Oe.a,{edge:"end",style:{marginTop:-8},onClick:yt,children:Object(ee.jsx)(Ie.a,{})})})})})]})]})}),Object(ee.jsxs)(he.a,{children:[Object(ee.jsx)(fe.a,{disabled:n,onClick:function(){return o()},children:"Cancel"}),Object(ee.jsx)(fe.a,{disabled:n,onClick:function(){return r(A,M,ft,j,B,null!==X&&void 0!==X?X:"",null!==te&&void 0!==te?te:"",we,Q,"gui")},children:"Open in Anki"}),Object(ee.jsx)(fe.a,{disabled:n,onClick:function(){return r(A,M,ft,j,B,null!==X&&void 0!==X?X:"",null!==te&&void 0!==te?te:"",we,Q,"updateLast")},children:"Update Last Card"}),Object(ee.jsx)(fe.a,{disabled:n,onClick:function(){return r(A,M,ft,j,B,null!==X&&void 0!==X?X:"",null!==te&&void 0!==te?te:"",we,Q,"default")},children:"Export"})]})]})}var Be=n(354),Le=n(187),Ue=n.p+"static/media/background-colored.cbc50e45.png",We=Object(ce.a)((function(e){return{root:function(e){var t=e.dragging;return{position:"absolute",height:e.appBarHidden?"100%":"calc(100% - 64px)",width:"100%",zIndex:101,pointerEvents:t?"auto":"none"}},transparentBackground:function(e){return{"&::before":{content:"' '",position:"absolute",height:e.appBarHidden?"100vh":"calc(100vh - 64px)",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",backgroundSize:"300px 300px",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundImage:"url(".concat(Ue,")"),backgroundBlendMode:"overlay",background:"rgba(0, 0, 0, .3)",filter:"drop-shadow(10px 10px 10px rgb(0, 0, 0, .4))"},width:"100%",height:"100%"}}}}));function He(e){var t=e.dragging,n=e.appBarHidden,a=e.loading,r=We({dragging:t,appBarHidden:n});return Object(ee.jsx)("div",{className:r.root,children:Object(ee.jsx)(Le.a,{in:t||a,children:Object(ee.jsx)("div",{className:r.transparentBackground})})})}var qe=n(338),ze=n(90),Ve=n.n(ze),Xe=n(89),Ke=n.n(Xe),Ge=n(340),Je=n(341),Qe=n(339),Ye=n(343),Ze=n(342),$e=Object(ce.a)((function(e){return{inlineIcon:{maxWidth:"80%",height:20,display:"inline-flex",flexDirection:"column",flexWrap:"wrap",alignItems:"start",textAlign:"left"}}}));function et(e){var t=e.open,n=e.extensionUrl,a=e.onClose,r=$e();return Object(ee.jsxs)(le.a,{open:t,onClose:a,children:[Object(ee.jsxs)(je.a,{children:[Object(ee.jsx)(Me.a,{variant:"h6",children:"Loading files"}),Object(ee.jsxs)(Me.a,{component:"ul",children:[Object(ee.jsx)("li",{children:"Drag and drop mkv, srt, ass, or mp3 files into the player."}),Object(ee.jsx)("li",{children:"Multiple files can be dragged and dropped simultaneously e.g. mkv+srt, mp3+ass etc."}),Object(ee.jsx)("li",{children:"Multiple subtitle files can loaded simultaneously. When multiple subtitle files are loaded, they can be toggled on and off in-video using S+1, S+2, etc."})]}),Object(ee.jsx)("br",{}),Object(ee.jsx)(Me.a,{variant:"h6",children:"Syncing with streaming video in another tab"}),Object(ee.jsxs)(Me.a,{component:"ul",children:[Object(ee.jsxs)("li",{children:["Install the Chrome"," ",Object(ee.jsx)(qe.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:n,children:"extension"}),"."]}),Object(ee.jsx)("li",{children:"Drag-and-drop a subtitle file into the video element you want to sync."}),Object(ee.jsx)("li",{children:"Or, load a subtitle file into asbplayer and use the camera button in the bottom right."}),Object(ee.jsx)("li",{children:'On supported sites you can sync detected subtitles via the extension keyboard shortcut (Ctrl+Shift+F by default), or via the "automatically sync detected subtitles" option. The same shortcut also allows you to sync an empty subtitle track, allowing you to mine media without accompanying subtitles.'}),Object(ee.jsx)("li",{children:"It is recommended to use the extension keyboard shortcut (Ctrl+Shift+X by default) to mine subtitles since that will include audio/screenshots."})]}),Object(ee.jsx)("br",{}),Object(ee.jsx)(Me.a,{variant:"h6",children:"Supported streaming video sites for subtitle detection"}),Object(ee.jsxs)(Me.a,{component:"ul",children:[Object(ee.jsx)("li",{children:"Netflix (on main /watch url)"}),Object(ee.jsx)("li",{children:"Youtube (on main /watch url)"})]}),Object(ee.jsx)("br",{}),Object(ee.jsx)(Me.a,{variant:"h6",children:"Anki"}),Object(ee.jsxs)(Me.a,{component:"ul",children:[Object(ee.jsx)("li",{children:"Synchronous workflow:"}),Object(ee.jsxs)("ul",{children:[Object(ee.jsx)("li",{children:"For synced streaming video, open the Anki dialog during playback by using Ctrl+Shift+X."}),Object(ee.jsx)("li",{children:"For local file playback, open the Anki dialog during playback by using Ctrl+Shift+Q."})]}),Object(ee.jsx)("li",{children:"Asynchronous workflow:"}),Object(ee.jsxs)("ul",{children:[Object(ee.jsx)("li",{children:"For synced streaming video, copy the current subtitle by using Ctrl+Shift+Z."}),Object(ee.jsx)("li",{children:"For local file playback, copy the current subtitle by using Ctrl+Shift+A."}),Object(ee.jsx)("li",{children:Object(ee.jsxs)("div",{className:r.inlineIcon,children:["Use the \xa0",Object(ee.jsx)(Ke.a,{fontSize:"small"}),"\xa0 button in the copy history."]})})]}),Object(ee.jsx)("li",{children:"For synced streaming video, an audio/image will only be available if an extension keyboard shortcut was used (Ctrl+Shift+X or Ctrl+Shift+Z by default)."}),Object(ee.jsxs)("li",{children:["Configure Anki settings with the settings button in the top right. See this"," ",Object(ee.jsx)(qe.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://youtu.be/Mv7fEVb6PHo?t=44",children:"video"})," ","for how to configure AnkiConnect so that asbplayer can connect to Anki."]})]}),Object(ee.jsx)("br",{}),Object(ee.jsx)(Me.a,{variant:"h6",children:"Changing subtitle offset"}),Object(ee.jsxs)(Me.a,{component:"ul",children:[Object(ee.jsx)("li",{children:"Use Ctrl+Left/Right to cause the previous/next subtitle to appear at the current timestamp."}),Object(ee.jsx)("li",{children:"Use Ctrl+Shift+Left/Right to adjust timing further by 100 ms increments."}),Object(ee.jsx)("li",{children:"Or, click on the subtitle offset input field in the controls, type a number, and hit Enter."})]}),Object(ee.jsx)("br",{}),Object(ee.jsx)(Me.a,{variant:"h6",children:"Condensed playback of local media files"}),Object(ee.jsxs)(Me.a,{component:"ul",children:[Object(ee.jsx)("li",{children:"Load an audio/video file with a subtitle file."}),Object(ee.jsx)("li",{children:Object(ee.jsxs)("div",{className:r.inlineIcon,children:["Use the \xa0",Object(ee.jsx)(Ve.a,{fontSize:"small"}),"\xa0 button in the bottom right."]})})]}),Object(ee.jsx)("br",{}),Object(ee.jsx)(Me.a,{variant:"h6",children:"Keyboard shortcuts"}),Object(ee.jsx)(Qe.a,{children:Object(ee.jsx)(Ge.a,{size:"small",children:Object(ee.jsxs)(Je.a,{children:[Object(ee.jsxs)(Ze.a,{children:[Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Ctrl+Shift+A"})}),Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Copy current subtitle"})})]}),Object(ee.jsxs)(Ze.a,{children:[Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Ctrl+Shift+Q"})}),Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Copy current subtitle and open Anki export dialog"})})]}),Object(ee.jsxs)(Ze.a,{children:[Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Ctrl+Shift+Z (default, streaming video)"})}),Object(ee.jsxs)(Ye.a,{children:[Object(ee.jsx)(Me.a,{children:"Copy current subtitle"}),Object(ee.jsx)(Me.a,{children:"When video is synced without a subtitle file, starts/stops recording audio"})]})]}),Object(ee.jsxs)(Ze.a,{children:[Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Ctrl+Shift+X (default, streaming video)"})}),Object(ee.jsxs)(Ye.a,{children:[Object(ee.jsx)(Me.a,{children:"Copy current subtitle and open Anki export dialog"}),Object(ee.jsx)(Me.a,{children:"When video is synced without a subtitle file, starts/stops recording audio"})]})]}),Object(ee.jsxs)(Ze.a,{children:[Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Ctrl+Shift+F (default, streaming video)"})}),Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Select video element to mine without a subtitle file, or with detected subtitles on supported sites"})})]}),Object(ee.jsxs)(Ze.a,{children:[Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Space"})}),Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Play/pause"})})]}),Object(ee.jsxs)(Ze.a,{children:[Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"S"})}),Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Toggle subtitles"})})]}),Object(ee.jsxs)(Ze.a,{children:[Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"S+1, S+2..."})}),Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Toggle subtitle track 1, 2... in video"})})]}),Object(ee.jsxs)(Ze.a,{children:[Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"D+1, D+2..."})}),Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Toggle subtitle track 1, 2... in asbplayer"})})]}),Object(ee.jsxs)(Ze.a,{children:[Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Left/Right"})}),Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Seek to previous/next subtitle"})})]}),Object(ee.jsxs)(Ze.a,{children:[Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Ctrl+Left/Right or Shift+Left/Right"})}),Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Adjust offset to previous/next subtitle"})})]}),Object(ee.jsxs)(Ze.a,{children:[Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Ctrl+Shift+Left/Right"})}),Object(ee.jsx)(Ye.a,{children:Object(ee.jsx)(Me.a,{children:"Adjust offset by +/- 100 ms"})})]})]})})}),Object(ee.jsx)("br",{}),Object(ee.jsx)(Me.a,{variant:"h6",children:"Common issues"}),Object(ee.jsxs)(Me.a,{component:"ul",children:[Object(ee.jsx)("li",{children:"asbplayer isn't detecting streaming video."}),Object(ee.jsxs)("ul",{children:[Object(ee.jsx)("li",{children:"Try refreshing both the asbplayer tab and the video in the other tab."}),Object(ee.jsx)("li",{children:"Make sure that in the extension details, the extension has access to all sites. A lot of video players are loaded inside of iframes, so it's difficult to list every single URL that the extension might need access to."})]}),Object(ee.jsx)("li",{children:"The extension keyboard shortcuts aren't working."}),Object(ee.jsxs)("ul",{children:[Object(ee.jsx)("li",{children:"Try uninstalling and reinstalling the extension and restarting Chrome."}),Object(ee.jsx)("li",{children:"Make sure the extension isn't installed twice."}),Object(ee.jsxs)("li",{children:["Verify the keyboard shortcut is bound as in this"," ",Object(ee.jsx)(qe.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://youtu.be/wYWbgovfNlI",children:"video"}),"."]})]}),Object(ee.jsx)("li",{children:"asbplayer can't connect to Anki. It shows an error message e.g. 'Failed to fetch.'"}),Object(ee.jsxs)("ul",{children:[Object(ee.jsx)("li",{children:"If you're using Brave, make sure asbplayer isn't being blocked by Shield."}),Object(ee.jsxs)("li",{children:["Make sure that asbplayer is allowed by AnkiConnect, as in this"," ",Object(ee.jsx)(qe.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://youtu.be/Mv7fEVb6PHo?t=44",children:"video"}),"."]}),Object(ee.jsx)("li",{children:"Check that your browser or an ad blocker isn't blocking the request. A good place to start is by opening your browser's developer console and looking for errors."})]}),Object(ee.jsx)("li",{children:"When mining streaming video, asbplayer isn't including audio/screenshot in flashcards."}),Object(ee.jsx)("ul",{children:Object(ee.jsx)("li",{children:"Make sure you use an extension keyboard shortcut (Ctrl+Shift+X by default)."})})]}),Object(ee.jsx)(Me.a,{variant:"h6",children:"Demos"}),Object(ee.jsxs)(Me.a,{component:"ul",children:[Object(ee.jsx)("li",{children:Object(ee.jsx)(qe.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://www.youtube.com/watch?v=W9Lf3C7sRzc",children:"Sentence mining streaming video (synchronous workflow)"})}),Object(ee.jsx)("li",{children:Object(ee.jsx)(qe.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://www.youtube.com/watch?v=kJXVVixD8H8",children:"Sentence mining streaming video (asynchronous workflow)"})}),Object(ee.jsx)("li",{children:Object(ee.jsx)(qe.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://www.youtube.com/watch?v=sgrJF99WX-Q",children:"Sentence mining streaming video (no subtitle file)"})}),Object(ee.jsx)("li",{children:Object(ee.jsx)(qe.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://www.youtube.com/watch?v=J3E82spYqIk",children:"Sentence mining video files (synchronous workflow)"})}),Object(ee.jsx)("li",{children:Object(ee.jsx)(qe.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://www.youtube.com/watch?v=HsrrpnfM4pI",children:"Sentence mining video files (asynchronous workflow)"})})]}),Object(ee.jsx)("br",{}),Object(ee.jsx)(Me.a,{variant:"h6",children:"Browser Compatibility"}),Object(ee.jsxs)(Me.a,{component:"ul",children:[Object(ee.jsx)("li",{children:"The asbplayer application and extension have only been tested on Chrome 91 and later and likely work on other Chromium-based browsers."}),Object(ee.jsxs)("li",{children:["Local file playback is supported only for codecs supported by the browser. The"," ",Object(ee.jsx)(qe.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://github.com/animebook/animebook.github.io#video-format-support",children:"animebook"})," ","readme has a detailed explanation of this and links to browsers that have good compatibility. Personally, I use Microsoft Edge and paid one dollar for HEVC support."]}),Object(ee.jsx)("li",{children:"Audio track selection for mkv files is available if experimental web platform features are enabled from chrome://flags."})]})]}),Object(ee.jsx)(he.a,{children:Object(ee.jsx)(fe.a,{onClick:function(){return a()},children:"OK"})})]})}var tt=n(355),nt=n(153),at=n(109),rt=n(157),it=RegExp("</?([^>]*)>","ig"),ot=RegExp(/\\[nN]/,"ig"),ct=document.createElement("div"),st=function(){function e(){Object(k.a)(this,e),this.xmlParser=void 0}return Object(x.a)(e,[{key:"subtitles",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e,t){return n._subtitles(e,t)})));case 2:return e.abrupt("return",e.sent.flatMap((function(e){return e})).sort((function(e,t){return e.start-t.start})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_subtitles",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var a,r,c,s,l,b,f,h,j,v,p=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.name.endsWith(".srt")){e.next=7;break}return e.t0=nt.a,e.next=4,t.text();case 4:return e.t1=e.sent,a=(0,e.t0)(e.t1),e.abrupt("return",a.map((function(e){return Object(o.a)(Object(o.a)({},e.data),{},{track:n})})));case 7:if(!t.name.endsWith(".vtt")&&!t.name.endsWith(".nfvtt")){e.next=9;break}return e.abrupt("return",new Promise(function(){var e=Object(i.a)(d.a.mark((function e(a,r){var i,o,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.name.endsWith(".nfvtt"),o=new at.WebVTT.Parser(window,at.WebVTT.StringDecoder()),c=[],o.oncue=function(e){if(i){e.text=e.text.replace(it,"");var t,n=e.text.split("\n"),a=[],r=Object(u.a)(n);try{for(r.s();!(t=r.n()).done;){var o=t.value;a.push(p._fixRTL(o))}}catch(s){r.e(s)}finally{r.f()}e.text=a.join("\n")}c.push(e)},o.onflush=function(){return a(c.map((function(e){return{start:Math.floor(1e3*e.startTime),end:Math.floor(1e3*e.endTime),text:e.text,track:n}})))},e.t0=o,e.next=8,t.text();case 8:e.t1=e.sent,e.t0.parse.call(e.t0,e.t1),o.flush();case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 9:if(!t.name.endsWith(".ass")){e.next=17;break}return e.t2=tt.a,e.next=13,t.text();case 13:return e.t3=e.sent,e.t4={},r=(0,e.t2)(e.t3,e.t4),e.abrupt("return",r.dialogues.map((function(e){return{start:Math.round(1e3*e.start),end:Math.round(1e3*e.end),text:e.slices.flatMap((function(e){return e.fragments.map((function(e){return e.text}))})).join("").replace(ot,"\n"),track:n}})));case 17:if(!t.name.endsWith(".ytxml")){e.next=28;break}return e.next=20,t.text();case 20:if(c=e.sent,s=this._xmlParser().parse(c),0!==Object.keys(s).length){e.next=24;break}return e.abrupt("return",[]);case 24:for(l=s.transcript.text,b=[],f=0,h=l.length;f<h;f++)j=l[f],v=parseFloat(j["@_start"]),b.push({start:Math.floor(1e3*v),end:Math.floor(1e3*(v+parseFloat(j["@_dur"]))),text:this._decodeHTML(String(j["#text"]).replace(it,"")),track:n});return e.abrupt("return",b);case 28:throw new Error("Unsupported subtitle file format");case 29:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_fixRTL",value:function(e){var t=e.indexOf("&lrm;"),n=e.indexOf("&rlm;"),a="";return t>-1?(a=e.substring(0,t)+"\u202a"+e.substring(t+5)+"\u202c",this._fixRTL(a)):n>-1?(a=e.substring(0,n)+"\u202b"+e.substring(n+5)+"\u202c",this._fixRTL(a)):e}},{key:"_decodeHTML",value:function(e){return ct.innerHTML=e,0===ct.childNodes.length?"":ct.childNodes[0].nodeValue}},{key:"_xmlParser",value:function(){return void 0===this.xmlParser&&(this.xmlParser=new rt.XMLParser({ignoreAttributes:!1})),this.xmlParser}}]),e}(),ut=n(344),lt=n(160),dt=n.n(lt),bt=n(159),ft=n.n(bt),ht=n(161),jt=n.n(ht),vt=n(158),pt=n.n(vt),gt=n(162),Ot=n.n(gt),mt=["show"],kt=Object(j.a)((function(e){return{title:{flexGrow:1},appBar:{transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{width:function(e){var t=e.drawerWidth;return"calc(100% - ".concat(t,"px)")},transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:function(e){return e.drawerWidth}},copyHistoryButton:{transform:"scaleX(1)",width:48,padding:12,transition:e.transitions.create(["transform","padding","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},copyHistoryButtonShift:{transform:"scaleX(0)",width:0,padding:5,transition:e.transitions.create(["transform","padding","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},hide:{display:"none"}}})),xt=Object(j.a)((function(e){return{tooltip:function(e){return{display:e.show?"block":"none"}}}}));function yt(e){var t=e.show,n=Object(ae.a)(e,mt),a=xt({show:t});return Object(ee.jsx)(Ee.a,Object(o.a)({classes:a},n))}function Ct(e){var t,n=kt(e);return Object(ee.jsx)(ut.a,{position:"static",elevation:0,className:Object(Y.a)(n.appBar,(t={},Object(s.a)(t,n.appBarShift,e.drawerOpen),Object(s.a)(t,n.hide,e.hidden),t)),children:Object(ee.jsxs)(Fe.a,{children:[Object(ee.jsx)(Ee.a,{title:"Open Files",children:Object(ee.jsx)(Oe.a,{edge:"start",color:"inherit",onClick:e.onFileSelector,children:Object(ee.jsx)(pt.a,{})})}),Object(ee.jsx)(Me.a,{variant:"h6",className:n.title,children:e.title}),Object(ee.jsx)(Ee.a,{title:"Donate",children:Object(ee.jsx)(Oe.a,{edge:"end",color:"inherit",component:"a",href:"https://github.com/sponsors/killergerbah?frequency=one-time",target:"_blank",rel:"noreferrer",children:Object(ee.jsx)(ft.a,{})})}),Object(ee.jsx)(Ee.a,{title:"Submit Issue",children:Object(ee.jsx)(Oe.a,{edge:"end",color:"inherit",component:"a",href:"https://github.com/killergerbah/asbplayer/issues",target:"_blank",rel:"noreferrer",children:Object(ee.jsx)(dt.a,{})})}),Object(ee.jsx)(Ee.a,{title:"Help",children:Object(ee.jsx)(Oe.a,{edge:"end",color:"inherit",onClick:e.onOpenHelp,children:Object(ee.jsx)(jt.a,{})})}),Object(ee.jsx)(Ee.a,{title:"Settings",children:Object(ee.jsx)(Oe.a,{edge:"end",color:"inherit",onClick:e.onOpenSettings,children:Object(ee.jsx)(Se.a,{})})}),Object(ee.jsx)(yt,{title:"Copy History",show:!e.drawerOpen,children:Object(ee.jsx)(Oe.a,{edge:"end",color:"inherit","aria-label":"menu",className:Object(Y.a)(n.copyHistoryButton,Object(s.a)({},n.copyHistoryButtonShift,e.drawerOpen)),onClick:e.onOpenCopyHistory,children:Object(ee.jsx)(Ot.a,{})})})]})})}var wt=function(){function e(t){var n=this;Object(k.a)(this,e),this.onMessageCallbacks=void 0,this.onTabsCallbacks=void 0,this.versionPromise=void 0,this.id=void 0,this.tabs=void 0,this.versionResolve=void 0,this.onMessageCallbacks=[],this.onTabsCallbacks=[],this.tabs=[],this.versionPromise=new Promise((function(e,t){n.versionResolve=e})),this.id=Object(Q.a)(),window.addEventListener("message",(function(e){if(e.source===window&&"asbplayer-extension-to-player"===e.data.sender&&e.data.message){if("tabs"===e.data.message.command){n.tabs=e.data.message.tabs;var t,a=Object(u.a)(n.onTabsCallbacks);try{for(a.s();!(t=a.n()).done;){(0,t.value)(n.tabs)}}catch(o){a.e(o)}finally{a.f()}return}if("version"===e.data.message.command)return void n.versionResolve(e.data.message.version);var r,i=Object(u.a)(n.onMessageCallbacks);try{for(i.s();!(r=i.n()).done;){(0,r.value)({data:e.data.message,tabId:e.data.tabId,src:e.data.src})}}catch(o){i.e(o)}finally{i.f()}}})),t&&(this._sendHeartbeat(),setInterval((function(){return n._sendHeartbeat()}),1e3))}return Object(x.a)(e,[{key:"_sendHeartbeat",value:function(){window.postMessage({sender:"asbplayerv2",message:{command:"heartbeat",id:this.id,receivedTabs:this.tabs}},"*")}},{key:"installedVersion",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.versionPromise;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(e,t,n){var a={sender:"asbplayerv2",message:e,tabId:t,src:n};window.postMessage(a,"*")}},{key:"publishMessage",value:function(e){var t,n=Object(u.a)(this.tabs);try{for(n.s();!(t=n.n()).done;){var a=t.value,r={sender:"asbplayerv2",message:e,tabId:a.id,src:a.src};window.postMessage(r,"*")}}catch(i){n.e(i)}finally{n.f()}}},{key:"subscribeTabs",value:function(e){this.onTabsCallbacks.push(e)}},{key:"unsubscribeTabs",value:function(e){this._remove(e,this.onTabsCallbacks)}},{key:"subscribe",value:function(e){this.onMessageCallbacks.push(e)}},{key:"unsubscribe",value:function(e){this._remove(e,this.onMessageCallbacks)}},{key:"_remove",value:function(e,t){for(var n=t.length-1;n>=0;--n)if(e===t[n]){t.splice(n,1);break}}}]),e}();function St(e){var t=e.subtitleColor,n=e.subtitleSize,a=e.subtitleOutlineThickness,r=e.subtitleOutlineColor,i=e.subtitleBackgroundOpacity,o=e.subtitleBackgroundColor,c=e.subtitleFontFamily,s={color:t,fontSize:Number(n)};if(a>0){var u=a,l=r;s.textShadow="0 0 ".concat(u,"px ").concat(l,", 0 0 ").concat(u,"px ").concat(l,", 0 0 ").concat(u,"px ").concat(l,", 0 0 ").concat(u,"px ").concat(l)}if(i>0){var d=i,b=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}}(o),f=b.r,h=b.g,j=b.b;s.backgroundColor="rgba(".concat(f,", ").concat(h,", ").concat(j,", ").concat(d,")")}return c&&c.length>0&&(s.fontFamily=c),s}function Tt(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e<0)return Tt(0,t);var a=(e=Math.round(e))%1e3,r=(e=(e-a)/1e3)%60,i=(e=(e-r)/60)%60;if(t>=36e5){var o=(e-i)/60;return n?Ft(o)+":"+Ft(i)+":"+Ft(r)+"."+Et(a):Ft(o)+":"+Ft(i)+":"+Ft(r)}return n?Ft(i)+":"+Ft(r)+"."+Et(a):Ft(i)+":"+Ft(r)}function Ft(e){return String(e).padStart(2,"0")}function Et(e){return String(e).padEnd(3,"0")}var Mt=n(348),Rt=n(361),It=n(164),Pt=n.n(It),At=n(328),Dt=n(283),_t=n(347),Nt=n(345),Bt=n(346),Lt=n(326),Ut=n(163),Wt=n.n(Ut),Ht=Object(j.a)((function(e){return{drawer:{width:function(e){return e.drawerWidth},flexShrink:0},drawerPaper:{width:function(e){return e.drawerWidth}},drawerHeader:Object(o.a)(Object(o.a)({display:"flex",alignItems:"center",position:"static",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-start"}),listContainer:{position:"relative",height:"100%",overflowY:"auto",overflowX:"hidden"},listItem:{"&:hover":{backgroundColor:e.palette.action.hover}},listItemGutters:{paddingLeft:5,paddingRight:5},listItemIconRoot:{minWidth:20},emptyState:{display:"flex",justifyContent:"center",flexDirection:"column",textAlign:"center",height:"100%",padding:15},text:{flexGrow:1},emptyText:{flexGrow:1,color:e.palette.text.secondary},timestamp:{paddingRight:15,paddingLeft:15,color:e.palette.text.secondary}}}));function qt(e){var t=e.open,n=e.anchorEl,a=e.onClose,r=e.onSelect,i=e.onClipAudio,o=e.onDownloadImage,c=e.onDelete,s=e.item,u=Object(b.useCallback)((function(){navigator.clipboard.writeText(s.text),a()}),[s,a]),l=Object(b.useCallback)((function(){r(s),a()}),[s,r,a]),d=Object(b.useCallback)((function(){i(s),a()}),[s,i,a]),f=Object(b.useCallback)((function(){o(s),a()}),[s,o,a]),h=Object(b.useCallback)((function(){c(s),a()}),[s,c,a]);return s?Object(ee.jsx)(Lt.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:a,anchorOrigin:{vertical:"center",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"right"},children:Object(ee.jsxs)(At.a,{children:[Object(ee.jsx)(Dt.a,{button:!0,onClick:u,children:Object(ee.jsx)(Nt.a,{primaryTypographyProps:{variant:"body2"},primary:"Copy"})}),Object(ee.jsx)(Dt.a,{button:!0,onClick:l,children:Object(ee.jsx)(Nt.a,{primaryTypographyProps:{variant:"body2"},primary:"Jump To"})}),(s.videoFile||s.audioFile||s.audio)&&Object(ee.jsx)(Dt.a,{button:!0,onClick:d,children:Object(ee.jsx)(Nt.a,{primaryTypographyProps:{variant:"body2"},primary:"Download Audio"})}),(s.videoFile||s.image)&&Object(ee.jsx)(Dt.a,{button:!0,onClick:f,children:Object(ee.jsx)(Nt.a,{primaryTypographyProps:{variant:"body2"},primary:"Download Image"})}),Object(ee.jsx)(Dt.a,{button:!0,onClick:h,children:Object(ee.jsx)(Nt.a,{primaryTypographyProps:{variant:"body2"},primary:"Delete"})})]})}):null}function zt(e){var t,n=e.onDelete,a=Ht(e),r=Object(b.useCallback)((function(e){e&&e.scrollIntoView()}),[]),i=Object(b.useState)(),o=Object(c.a)(i,2),s=o[0],l=o[1],d=Object(b.useState)(!1),h=Object(c.a)(d,2),j=h[0],v=h[1],p=Object(b.useState)(),g=Object(c.a)(p,2),O=g[0],m=g[1],k=Object(b.useCallback)((function(e,t){l(t),v(!0),m(e.currentTarget)}),[]),x=Object(b.useCallback)((function(){l(void 0),v(!1),m(void 0)}),[]),y=Object(b.useCallback)((function(e){n(e)}),[n]);if(e.items.length>0){var C,w=[],S=null,T=0,F={},E=Object(u.a)(e.items);try{var M=function(){var t=C.value;null!==S&&S===t.name||(t.name in F?F[t.name]++:F[t.name]=0,S=t.name,w.push(Object(ee.jsx)(Bt.a,{disableSticky:!0,children:t.name},t.name+"-"+F[t.name])));var n=T===e.items.length-1?r:null;w.push(Object(ee.jsxs)(Dt.a,{ref:n,className:a.listItem,classes:{gutters:a.listItemGutters},children:[Object(ee.jsx)(_t.a,{classes:{root:a.listItemIconRoot},children:Object(ee.jsx)(Ee.a,{title:"Export to Anki",children:Object(ee.jsx)(Oe.a,{onClick:function(){return e.onAnki(t)},children:Object(ee.jsx)(Ke.a,{fontSize:"small"})})})}),Object(ee.jsx)(_t.a,{classes:{root:a.listItemIconRoot},children:Object(ee.jsx)(Oe.a,{onClick:function(e){return k(e,t)},children:Object(ee.jsx)(Wt.a,{fontSize:"small"})})}),Object(ee.jsx)(Nt.a,{primary:Object(ee.jsxs)(ge.a,{wrap:"nowrap",container:!0,children:[Object(ee.jsx)(ge.a,{item:!0,className:""===t.text?a.emptyText:a.text,children:""===t.text?"No text":t.text}),Object(ee.jsx)(ge.a,{item:!0,className:a.timestamp,children:Tt(t.start,t.start,!1)})]})})]},t.id)),++T};for(E.s();!(C=E.n()).done;)M()}catch(R){E.e(R)}finally{E.f()}t=Object(ee.jsx)("div",{className:a.listContainer,children:Object(ee.jsx)(At.a,{children:w})})}else t=Object(ee.jsxs)("div",{className:a.emptyState,children:[Object(ee.jsx)(Me.a,{variant:"h6",children:"Copy history is empty."}),Object(ee.jsx)(Me.a,{variant:"caption",children:"See the help for keyboard shortcuts."})]});return Object(ee.jsxs)(f.a.Fragment,{children:[Object(ee.jsxs)(Rt.a,{variant:"persistent",anchor:"right",open:e.open,className:a.drawer,classes:{paper:a.drawerPaper},children:[Object(ee.jsx)("div",{className:a.drawerHeader,children:Object(ee.jsx)(Oe.a,{onClick:e.onClose,children:Object(ee.jsx)(Pt.a,{})})}),Object(ee.jsx)(Mt.a,{}),t]}),Object(ee.jsx)(qt,{open:e.open&&j,anchorEl:O,item:s,onClose:x,onSelect:e.onSelect,onClipAudio:e.onClipAudio,onDownloadImage:e.onDownloadImage,onDelete:y})]})}var Vt=n(165),Xt=n.n(Vt),Kt=Object(ce.a)((function(e){return{background:function(e){return{position:"absolute",height:e.appBarHidden?"100vh":"calc(100vh - 64px)",width:"100%",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center"}},browseLink:{cursor:"pointer"}}}));function Gt(e){var t=e.extension,n=e.latestExtensionVersion,a=e.extensionUrl,r=e.loading,o=e.dragging,s=e.appBarHidden,u=e.onFileSelector,l=Kt({appBarHidden:s}),h=Object(b.useState)(),j=Object(c.a)(h,2),v=j[0],p=j[1];Object(b.useEffect)((function(){function e(){return(e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=p,e.next=3,t.installedVersion();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t]);var g=v&&Xt()(n,v),O=!v;return Object(ee.jsx)(f.a.Fragment,{children:Object(ee.jsx)(Le.a,{in:!r&&!o,timeout:500,children:Object(ee.jsx)("div",{className:l.background,children:Object(ee.jsxs)(Me.a,{variant:"h6",children:["Drag and drop subtitle and media files, or"," ",Object(ee.jsx)(qe.a,{target:"#",className:l.browseLink,onClick:u,color:"secondary",component:"label",children:"browse"}),".",Object(ee.jsx)("br",{}),O&&Object(ee.jsxs)("span",{children:["Install the"," ",Object(ee.jsx)(qe.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:a,children:"Chrome extension"})," ","to sync subtitles with streaming video."]}),g&&Object(ee.jsxs)("span",{children:["An extension"," ",Object(ee.jsx)(qe.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:a,children:"update"})," ","is available."]})]})})})})}var Jt=function(){function e(t){Object(k.a)(this,e),this.channel=void 0,this.onMessage=void 0,this.channel=new BroadcastChannel(t);var n=this;this.channel.onmessage=function(e){var t;null===(t=n.onMessage)||void 0===t||t.call(n,e)}}return Object(x.a)(e,[{key:"postMessage",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage(e)}},{key:"close",value:function(){var e;null===(e=this.channel)||void 0===e||e.close(),this.channel=void 0}}]),e}(),Qt=function(){function e(t,n,a){var r=this;Object(k.a)(this,e),this.tabId=void 0,this.src=void 0,this.extension=void 0,this.listener=void 0,this.onMessage=void 0,this.tabId=t,this.src=n,this.listener=function(e){var a;e.tabId!==t||e.src&&e.src!==n||(null===(a=r.onMessage)||void 0===a||a.call(r,{data:e.data}))},a.subscribe(this.listener),this.extension=a}return Object(x.a)(e,[{key:"postMessage",value:function(e){this.extension.sendMessage(e,this.tabId,this.src)}},{key:"close",value:function(){this.extension.unsubscribe(this.listener)}}]),e}(),Yt=function(){function e(){Object(k.a)(this,e),this.accumulated=void 0,this.started=void 0,this.startTime=void 0,this.accumulated=0,this.started=!1}return Object(x.a)(e,[{key:"time",value:function(e){return this.started?Math.min(e,this.accumulated+Date.now()-this.startTime):Math.min(e,this.accumulated)}},{key:"stop",value:function(){this.started&&(this.started=!1,this.accumulated+=Date.now()-this.startTime)}},{key:"start",value:function(){this.startTime=Date.now(),this.started=!0}},{key:"setTime",value:function(e){this.started?(this.startTime=Date.now(),this.accumulated=e):this.accumulated=e}},{key:"progress",value:function(e){return 0===e?0:Math.min(1,this.time(e)/e)}}]),e}(),Zt=n(7),$t=n(168),en=n.n($t),tn=n(169),nn=n.n(tn),an=n(175),rn=n.n(an),on=n(166),cn=n.n(on),sn=n(276),un=n(177),ln=n.n(un),dn=n(179),bn=n.n(dn),fn=n(167),hn=n.n(fn),jn=n(178),vn=n.n(jn),pn=n(170),gn=n.n(pn),On=n(171),mn=n.n(On),kn=n(176),xn=n.n(kn),yn=n(174),Cn=n.n(yn),wn=n(110),Sn=n.n(wn),Tn=n(172),Fn=n.n(Tn),En=n(173),Mn=n.n(En),Rn=Object(j.a)((function(e){return{container:{position:"absolute",left:"50%",width:"50%",bottom:0,pointerEvents:"none",color:"#fff"},buttonContainer:{flexDirection:"row"},timeDisplay:{color:"#fff",display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",cursor:"default",fontSize:20,marginLeft:10},offsetInput:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",fontSize:20,marginLeft:10,width:100,color:"#fff",pointerEvents:"auto"},volumeInputContainerShown:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:5,pointerEvents:"auto"},volumeInputContainerHidden:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:0,pointerEvents:"auto"},volumeInputHidden:{transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),width:0,pointerEvents:"auto"},volumeInputShown:{transition:e.transitions.create("width",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),width:100,pointerEvents:"auto"},volumeInputThumbHidden:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),opacity:0,pointerEvents:"auto"},volumeInputThumbShown:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),opacity:1,pointerEvents:"auto"},subContainer:{background:"linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, .4) 40%, rgba(0, 0, 0, 0.7))",position:"relative",left:"-100%",width:"200%",zIndex:10},button:{pointerEvents:"auto"},inactiveButton:{color:"rgba(72, 72, 72, 0.7)",pointerEvents:"auto"},inactiveTopButton:{color:"rgba(255, 255, 255, 0.5)",pointerEvents:"auto"},progress:{margin:5},topButton:{pointerEvents:"auto",color:"#fff"},gridContainer:{pointerEvents:"auto",padding:2}}})),In=Object(j.a)((function(e){return{root:{height:10},container:{height:10,pointerEvents:"auto",display:"flex",justifyContent:"center",flexDirection:"column",position:"absolute",width:"calc(100% - 20px)",marginLeft:10},mouseEventListener:{zIndex:1,height:10,cursor:"pointer",pointerEvents:"auto",position:"absolute",width:"100%"},fillContainer:{background:"rgba(30,30,30,0.7)",width:"100%",height:5,position:"relative"},fillContainerThick:{transition:e.transitions.create("height",{easing:e.transitions.easing.easeInOut,duration:50}),height:8},fill:{background:"linear-gradient(to left, #ff1f62, #49007a)",height:"100%"},handleContainer:{position:"absolute",display:"flex",justifyContent:"center",flexDirection:"column",height:"100%",bottom:0},handle:{borderRadius:"50%",width:16,height:16,opacity:0,left:-8,background:"white",position:"absolute"},handleOn:{opacity:1,transition:e.transitions.create("opacity",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.shortest})}}})),Pn=Object(Zt.a)((function(e){return{root:{color:"white",verticalAlign:"middle"},thumb:{backgroundColor:"white",color:"white","&:focus":{boxShadow:"inherit"},"&:hover, &$active":{boxShadow:"0px 0px 0px 8px rgba(255, 255, 255, 0.1)"}},active:{color:"white"}}}))(Te.a);function An(e){var t=Math.floor(e/1e3),n=Math.floor(t/60),a=t%60;return String(n)+":"+String(a).padStart(2,"0")}function Dn(e){var t=e.onSeek,n=e.value,a=In(),r=Object(b.useState)(!1),i=Object(c.a)(r,2),o=i[0],s=i[1],u=Object(b.useRef)(null),l=Object(b.useCallback)((function(e){var n=e.currentTarget.getBoundingClientRect(),a=n.right-n.left-20,r=Math.min(1,Math.max(0,(e.pageX-n.left-10)/a));t(r)}),[t]),d=Object(b.useCallback)((function(){return s(!0)}),[]),f=Object(b.useCallback)((function(){return s(!1)}),[]),h=u.current?function(e){var t=e.getBoundingClientRect();return t.right-t.left}(u.current)*n/100:0,j={width:h},v={marginLeft:h},p=o?a.fillContainer+" "+a.fillContainerThick:a.fillContainer,g=o?a.handle+" "+a.handleOn:a.handle;return Object(ee.jsxs)("div",{className:a.root,children:[Object(ee.jsx)("div",{ref:u,className:a.container,children:Object(ee.jsxs)("div",{className:p,children:[Object(ee.jsx)("div",{className:a.fill,style:j}),Object(ee.jsx)("div",{className:a.handleContainer,children:Object(ee.jsx)("div",{className:g,style:v})})]})}),Object(ee.jsx)("div",{className:a.mouseEventListener,onClick:l,onMouseOver:d,onMouseOut:f})]})}function _n(e){var t=e.open,n=e.anchorEl,a=e.audioTracks,r=e.selectedAudioTrack,i=e.onAudioTrackSelected,o=e.onClose;if(!a||0===a.length)return null;var c=a.map((function(e){return Object(ee.jsxs)(Dt.a,{selected:e.id===r,button:!0,onClick:function(){return i(e.id)},children:[e.language," ",e.label]},e.id)}));return Object(ee.jsx)("div",{children:Object(ee.jsx)(Lt.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:o,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(ee.jsx)(At.a,{children:c})})})}function Nn(e){var t=e.open,n=e.anchorEl,a=e.onClose,r=e.tabs,i=e.selectedTab,o=e.onTabSelected;if(!r||0===r.length)return null;var c=r.map((function(e){return Object(ee.jsxs)(Dt.a,{selected:i&&e.id===i.id&&e.src===i.src,button:!0,onClick:function(){return o(e)},children:[e.id," ",e.title," ",e.src]},e.id)}));return Object(ee.jsx)("div",{children:Object(ee.jsx)(Lt.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:a,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(ee.jsx)(At.a,{children:c})})})}function Bn(e){var t=e.open,n=e.anchorEl,a=e.onUnload,r=e.onClose,i=e.file;return Object(ee.jsx)("div",{children:Object(ee.jsx)(Lt.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:r,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(ee.jsx)(At.a,{children:Object(ee.jsxs)(Dt.a,{button:!0,onClick:function(e){return a()},children:["Unload ",i]})})})})}function Ln(e){var t=e.clock,n=e.playing,a=e.length,r=e.offsetEnabled,i=e.displayLength,o=e.offset,s=e.onAudioTrackSelected,u=e.onSeek,l=e.mousePositionRef,d=e.onShow,h=e.onPause,j=e.onPlay,v=e.onTabSelected,p=e.onUnloadAudio,g=e.onUnloadVideo,O=e.onOffsetChange,m=e.onVolumeChange,k=e.disableKeyEvents,x=e.settingsProvider,y=e.closeEnabled,C=e.onClose,w=e.volumeEnabled,S=e.condensedModeEnabled,T=e.condensedModeToggleEnabled,F=e.onCondensedModeToggle,E=e.subtitlesEnabled,M=e.subtitlesToggle,R=e.onSubtitlesToggle,I=e.videoFile,P=e.audioFile,A=e.audioTracks,D=e.selectedAudioTrack,_=e.tabs,N=e.selectedTab,B=e.popOutEnabled,L=e.popOut,U=e.onPopOutToggle,W=e.fullscreenEnabled,H=e.fullscreen,q=e.onFullscreenToggle,z=e.hideSubtitlePlayerToggleEnabled,V=e.subtitlePlayerHidden,X=e.onHideSubtitlePlayerToggle,K=e.showOnMouseMovement,G=e.theaterModeToggleEnabled,J=e.theaterModeEnabled,Q=e.onTheaterModeToggle,Y=Rn(),Z=Object(b.useState)(!0),$=Object(c.a)(Z,2),te=$[0],ne=$[1],ae=Object(b.useState)(!1),re=Object(c.a)(ae,2),ie=re[0],oe=re[1],ce=Object(b.useState)(),se=Object(c.a)(ce,2),ue=se[0],le=se[1],de=Object(b.useState)(!1),be=Object(c.a)(de,2),fe=be[0],he=be[1],je=Object(b.useState)(),ve=Object(c.a)(je,2),pe=ve[0],me=ve[1],ke=Object(b.useState)(!1),xe=Object(c.a)(ke,2),ye=xe[0],Ce=xe[1],we=Object(b.useState)(),Se=Object(c.a)(we,2),Te=Se[0],Fe=Se[1],Me=Object(b.useState)(!1),Re=Object(c.a)(Me,2),Ie=Re[0],Pe=Re[1],Ae=Object(b.useState)(),De=Object(c.a)(Ae,2),_e=De[0],Ne=De[1],Be=Object(b.useState)(!1),Ue=Object(c.a)(Be,2),We=Ue[0],He=Ue[1],qe=Object(b.useState)(100),ze=Object(c.a)(qe,2),Xe=ze[0],Ke=ze[1],Ge=Object(b.useState)(100),Je=Object(c.a)(Ge,2),Qe=Je[0],Ye=Je[1],Ze=Object(b.useRef)({x:0,y:0}),$e=Object(b.useRef)(Date.now()),et=Object(b.useRef)(Date.now()),tt=Object(b.useRef)(!0),nt=Object(b.useRef)(!1),at=Object(b.useRef)(),rt=Object(b.useRef)(null),it=Object(b.useRef)(null),ot=Object(b.useState)(),ct=Object(c.a)(ot,2)[1],st=Object(b.useCallback)((function(){return ct({})}),[]),ut=Object(b.useCallback)((function(e){u(e)}),[u]);function lt(){nt.current=!0}function dt(){nt.current=!1}Object(b.useEffect)((function(){var e=Number(x.volume);Ke(e),m(e/100),e>0&&Ye(e)}),[x,m]),Object(b.useEffect)((function(){var e=setInterval((function(){var e,t;K?e=Date.now()-$e.current<2e3||Math.pow(l.current.x-Ze.current.x,2)+Math.pow(l.current.y-Ze.current.y,2)>100:e=null!==(t=rt.current&&l.current.y>rt.current.offsetTop-20||it.current&&l.current.y<it.current.offsetHeight+20)&&void 0!==t&&t;(e=e||nt.current||at.current===document.activeElement||Date.now()-et.current<2e3)&&!tt.current?($e.current=Date.now(),ne(e)):!e&&tt.current&&ne(e),tt.current=e,Ze.current.x=l.current.x,Ze.current.y=l.current.y}),100);return function(){return clearInterval(e)}}),[l,K]),Object(b.useEffect)((function(){return null===d||void 0===d?void 0:d(te)}),[d,te]),Object(b.useEffect)((function(){if(!k)return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)};function e(e){if("Enter"===e.key&&at.current===document.activeElement){var t=Number(at.current.value);if(Number.isNaN(t))return;O(1e3*t),at.current.blur()}}}),[O,k]);var bt=Object(b.useCallback)((function(e){var t;return e.target.setSelectionRange(0,(null===(t=e.target.value)||void 0===t?void 0:t.length)||0)}),[]);Object(b.useEffect)((function(){var e=setInterval((function(){st()}),100);return function(){return clearInterval(e)}}),[st]),Object(b.useEffect)((function(){if(at.current)if(0===o)at.current.value="";else{var e=o/1e3,t=e>=0?"+"+e.toFixed(2):String(e.toFixed(2));at.current.value=t,et.current=Date.now()}}),[o]);var ft=Object(b.useCallback)((function(){le(void 0),oe(!1)}),[]),ht=Object(b.useCallback)((function(e){le(e.currentTarget),oe(!0)}),[]),jt=Object(b.useCallback)((function(e){s(e),le(void 0),oe(!1)}),[s]),vt=Object(b.useCallback)((function(){me(void 0),he(!1)}),[]),pt=Object(b.useCallback)((function(e){me(e.currentTarget),he(!0)}),[]),gt=Object(b.useCallback)((function(e){null===v||void 0===v||v(e),me(void 0),he(!1)}),[v]),Ot=Object(b.useCallback)((function(){Fe(void 0),Ce(!1)}),[]),mt=Object(b.useCallback)((function(e){Fe(e.currentTarget),Ce(!0)}),[]),kt=Object(b.useCallback)((function(){null===p||void 0===p||p(),Ce(!1)}),[p]),xt=Object(b.useCallback)((function(){Ne(void 0),Pe(!1)}),[]),yt=Object(b.useCallback)((function(e){Ne(e.currentTarget),Pe(!0)}),[]),Ct=Object(b.useCallback)((function(){null===g||void 0===g||g(),Pe(!1)}),[g]),wt=Object(b.useCallback)((function(){return He(!1)}),[]),St=Object(b.useCallback)((function(){return He(!0)}),[]),Tt=Object(b.useCallback)((function(e,t){Ke(t),m(t/100)}),[m]),Ft=Object(b.useCallback)((function(e,t){t>0&&Ye(t),x.volume=t}),[x]),Et=Object(b.useCallback)((function(){Ke((function(e){var t=e>0?0:Qe;return m(t/100),t}))}),[m,Qe]),Mt=t.progress(a);return Object(ee.jsxs)(f.a.Fragment,{children:[Object(ee.jsx)(Le.a,{in:te,timeout:200,children:Object(ee.jsxs)(ge.a,{container:!0,style:{position:"absolute",top:0},children:[Object(ee.jsx)(ge.a,{item:!0,style:{flexGrow:1},children:y&&Object(ee.jsx)(Oe.a,{ref:it,color:"inherit",className:Y.topButton,onClick:C,onMouseOver:lt,onMouseOut:dt,children:Object(ee.jsx)(cn.a,{})})}),Object(ee.jsxs)(ge.a,{item:!0,children:[G&&Object(ee.jsx)(Oe.a,{color:"inherit",className:J?Y.topButton:Y.inactiveTopButton,onClick:Q,onMouseOver:lt,onMouseOut:dt,children:Object(ee.jsx)(hn.a,{})}),z&&Object(ee.jsx)(Oe.a,{color:"inherit",className:Y.topButton,onClick:X,onMouseOver:lt,onMouseOut:dt,children:V?Object(ee.jsx)(en.a,{}):Object(ee.jsx)(nn.a,{})})]})]})}),Object(ee.jsxs)("div",{ref:rt,className:Y.container,onMouseOver:lt,onMouseOut:dt,children:[Object(ee.jsx)(Le.a,{in:te,timeout:200,children:Object(ee.jsxs)("div",{className:Y.subContainer,children:[Object(ee.jsx)(Dn,{onSeek:ut,value:100*Mt}),Object(ee.jsxs)(ge.a,{container:!0,className:Y.gridContainer,direction:"row",children:[Object(ee.jsx)(ge.a,{item:!0,children:Object(ee.jsx)(Oe.a,{color:"inherit",onClick:function(){return n?h():j()},children:n?Object(ee.jsx)(gn.a,{className:Y.button}):Object(ee.jsx)(mn.a,{className:Y.button})})}),w&&Object(ee.jsxs)(ge.a,{item:!0,onMouseOver:St,onMouseOut:wt,className:We?Y.volumeInputContainerShown:Y.volumeInputContainerHidden,children:[Object(ee.jsx)(Oe.a,{color:"inherit",onClick:Et,children:0===Xe?Object(ee.jsx)(Fn.a,{}):Object(ee.jsx)(Mn.a,{})}),Object(ee.jsx)(Pn,{onChange:Tt,onChangeCommitted:Ft,value:Xe,defaultValue:100,classes:{root:We?Y.volumeInputShown:Y.volumeInputHidden,thumb:We?Y.volumeInputThumbShown:Y.volumeInputThumbHidden}})]}),Object(ee.jsx)(ge.a,{item:!0,children:Object(ee.jsxs)("div",{className:Y.timeDisplay,children:[An(Mt*a)," / ",An(i||a)]})}),r&&Object(ee.jsx)(ge.a,{item:!0,children:Object(ee.jsx)(sn.a,{inputRef:at,disableUnderline:!0,className:Y.offsetInput,placeholder:"\xb1"+Number(0).toFixed(2),onClick:bt})}),Object(ee.jsx)(ge.a,{item:!0,style:{flexGrow:1}}),T&&Object(ee.jsx)(ge.a,{item:!0,children:Object(ee.jsx)(Ee.a,{title:"Condensed Mode",children:Object(ee.jsx)(Oe.a,{color:"inherit",onClick:F,children:Object(ee.jsx)(Ve.a,{className:S?Y.button:Y.inactiveButton})})})}),M&&Object(ee.jsx)(ge.a,{item:!0,children:Object(ee.jsx)(Oe.a,{color:"inherit",onClick:R,children:Object(ee.jsx)(Cn.a,{className:E?Y.button:Y.inactiveButton})})}),I&&Object(ee.jsx)(ge.a,{item:!0,children:Object(ee.jsx)(Oe.a,{color:"inherit",onClick:yt,children:Object(ee.jsx)(Sn.a,{className:Y.button})})}),P&&Object(ee.jsx)(ge.a,{item:!0,children:Object(ee.jsx)(Oe.a,{color:"inherit",onClick:mt,children:Object(ee.jsx)(rn.a,{className:Y.button})})}),A&&A.length>1&&Object(ee.jsx)(ge.a,{item:!0,children:Object(ee.jsx)(Oe.a,{color:"inherit",onClick:ht,children:Object(ee.jsx)(xn.a,{className:Y.button})})}),_&&_.length>0&&Object(ee.jsx)(ge.a,{item:!0,children:Object(ee.jsx)(Oe.a,{color:"inherit",onClick:pt,children:Object(ee.jsx)(Sn.a,{className:N?Y.button:Y.inactiveButton})})}),B&&Object(ee.jsx)(ge.a,{item:!0,children:Object(ee.jsx)(Oe.a,{color:"inherit",onClick:U,children:Object(ee.jsx)(ln.a,{className:Y.button,style:L?{transform:"rotateX(180deg)"}:{}})})}),W&&Object(ee.jsx)(ge.a,{item:!0,children:Object(ee.jsx)(Oe.a,{color:"inherit",onClick:q,children:H?Object(ee.jsx)(vn.a,{className:Y.button}):Object(ee.jsx)(bn.a,{className:Y.button})})})]})]})}),Object(ee.jsx)(Nn,{open:fe&&te,anchorEl:pe,tabs:_,selectedTab:N,onClose:vt,onTabSelected:gt}),Object(ee.jsx)(_n,{open:ie&&te,anchorEl:ue,audioTracks:A,selectedAudioTrack:D,onClose:ft,onAudioTrackSelected:jt}),Object(ee.jsx)(Bn,{open:ye,anchorEl:Te,file:P,onClose:Ot,onUnload:kt}),Object(ee.jsx)(Bn,{open:Ie,anchorEl:_e,file:I,onClose:xt,onUnload:Ct})]})]})}var Un=function(){function e(t){Object(k.a)(this,e),this.ref=void 0,this.readyResolves=void 0,this.ref=t,this.readyResolves=[]}return Object(x.a)(e,[{key:"seek",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){n.ref.current?(n.ref.current.currentTime=t,n._onMediaCanPlay((function(){return e(void 0)}))):e(void 0)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onReady",value:function(){var e=Object(i.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.ref.current?t._onMediaCanPlay((function(){return e(void 0)})):e(void 0)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_onMediaCanPlay",value:function(e){var t,n=this;4!==(null===(t=this.ref.current)||void 0===t?void 0:t.readyState)?(this.ref.current&&!this.ref.current.oncanplay&&(this.ref.current.oncanplay=function(e){var t,a=Object(u.a)(n.readyResolves);try{for(a.s();!(t=a.n()).done;){(0,t.value)()}}catch(r){a.e(r)}finally{a.f()}n.readyResolves.length=0,n.ref.current&&(n.ref.current.oncanplay=null)}),this.readyResolves.push(e)):e()}},{key:"play",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.play()}},{key:"pause",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.pause()}}]),e}(),Wn=n(24),Hn=n(180),qn=n.n(Hn),zn=n(95),Vn=["index","selected","subtitleRef","onClickSubtitle","onCopySubtitle","compressed","disabled","subtitle"],Xn=Object(j.a)((function(e){return{container:{height:function(e){return e.appBarHidden?"100vh":"calc(100vh - 64px)"},position:"relative",overflowX:"hidden",backgroundColor:e.palette.background.default,width:function(e){var t=e.compressed,n=e.windowWidth;return t?Math.max(350,.25*n):"100%"}},table:{backgroundColor:e.palette.background.default,marginBottom:75},noSubtitles:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center"}}})),Kn=Object(j.a)((function(e){return{subtitleRow:{"&:hover":{backgroundColor:e.palette.action.hover}},subtitle:{fontSize:20,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere"},compressedSubtitle:{fontSize:16,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere"},disabledSubtitle:{color:"transparent",backgroundColor:e.palette.action.disabledBackground,borderRadius:5},timestamp:{fontSize:14,color:"#aaaaaa",textAlign:"right",paddingRight:15,paddingLeft:5},copyButton:{textAlign:"right",padding:0}}})),Gn=f.a.memo((function(e){var t=e.index,n=e.selected,a=e.subtitleRef,r=e.onClickSubtitle,i=e.onCopySubtitle,s=e.compressed,u=e.disabled,l=e.subtitle,d=Object(ae.a)(e,Vn),f=Kn(),h=Object(b.useRef)(null),j=Object(b.useState)(!1),v=Object(c.a)(j,2),p=v[0],g=v[1],O=s?f.compressedSubtitle:f.subtitle,m=u?f.disabledSubtitle:"";if(l.start<0||l.end<0)return null;return Object(ee.jsxs)(Ze.a,Object(o.a)(Object(o.a)({onClick:function(){return!p&&r(t)},onMouseUp:function(){var e,t,n,a=document.getSelection(),r="Range"===(null===a||void 0===a?void 0:a.type)&&(null===(e=h.current)||void 0===e?void 0:e.isSameNode(null!==(t=null===(n=a.anchorNode)||void 0===n?void 0:n.parentNode)&&void 0!==t?t:null));g(null!==r&&void 0!==r&&r)},ref:a,className:f.subtitleRow,selected:n},d),{},{children:[Object(ee.jsx)(Ye.a,{className:O,children:Object(ee.jsx)("span",{ref:h,className:m,children:l.text})}),Object(ee.jsx)(Ye.a,{className:f.copyButton,children:Object(ee.jsx)(Oe.a,{onClick:function(e){return i(e,t)},children:Object(ee.jsx)(qn.a,{fontSize:s?"small":"medium"})})}),Object(ee.jsx)(Ye.a,{className:f.timestamp,children:l.displayTime})]}))}));function Jn(e){var t=e.clock,n=e.onSeek,a=e.onCopy,r=e.onOffsetChange,i=e.onAnkiDialogRequest,o=e.onToggleSubtitleTrack,s=e.playing,l=e.subtitles,d=e.length,f=e.jumpToSubtitle,h=e.compressed,j=e.loading,v=e.drawerOpen,p=e.appBarHidden,O=e.displayHelp,m=e.disableKeyEvents,k=e.lastJumpToTopTimestamp,x=e.hidden,y=e.disabledSubtitleTracks,C=e.settingsProvider,w=Object(b.useRef)();w.current=s;var T=Object(b.useRef)(t);T.current=t;var F=Object(b.useRef)();F.current=l;var E=Object(b.useMemo)((function(){return l?Array(l.length).fill(void 0).map((function(e){return Object(b.createRef)()})):[]}),[l]),M=Object(b.useRef)([]);M.current=E;var R=Object(b.useRef)();R.current=m;var I=Object(b.useState)({}),P=Object(c.a)(I,2),A=P[0],D=P[1],_=Object(b.useRef)({}),N=Object(b.useRef)(0);N.current=d;var B=Object(b.useRef)(!1);B.current=x;var L=Object(b.useRef)(0),U=Object(b.useRef)(),W=Object(b.useRef)();Object(b.useRef)().current=v;var H=g(!0),q=Object(c.a)(H,1)[0],z=Xn({compressed:h,windowWidth:q,appBarHidden:p});Object(b.useEffect)((function(){return U.current=requestAnimationFrame((function e(){for(var t=F.current||[],n=M.current,a=N.current,r=T.current.progress(N.current),i=Number.MAX_SAFE_INTEGER,o=-1,c={},s=t.length-1;s>=0;--s){var u=t[s],l=u.start/a,d=u.end/a;if(r>=l)r<d&&(i=s<i?s:i,c[s]=!0),-1===o&&(o=s);else if(i!==Number.MAX_SAFE_INTEGER)break}if(i===Number.MAX_SAFE_INTEGER&&-1!==o&&(c[o]=!0),!function(e,t){for(var n in e)if(!(n in t))return!1;for(var a in t)if(!(a in e))return!1;return!0}(c,_.current)&&(_.current=c,D(c),i!==Number.MAX_SAFE_INTEGER)){var b=n[i],f=!B.current&&Date.now()-L.current>5e3;null!==b&&void 0!==b&&b.current&&f&&b.current.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}U.current=requestAnimationFrame(e)})),function(){void 0!==U.current&&cancelAnimationFrame(U.current)}}),[]);var V=Object(b.useCallback)((function(){var e,t=_.current;if(t){var n=Object.keys(t);if(0!==n.length){var a=E[Number(n[0])];null===a||void 0===a||null===(e=a.current)||void 0===e||e.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}}),[E]);Object(b.useEffect)((function(){if(!x)return document.addEventListener("visibilitychange",e),function(){return document.removeEventListener("visibilitychange",e)};function e(){"visible"===document.visibilityState&&V()}}),[x,A,E,V]),Object(b.useEffect)((function(){x||V()}),[x,V]),Object(b.useEffect)((function(){var e;if(!B.current){var t=M.current;if(t&&0!==t.length){var n=t[0];null===n||void 0===n||null===(e=n.current)||void 0===e||e.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}}),[k]),Object(b.useEffect)((function(){var e=S.bindAdjustOffset((function(e,t){e.preventDefault(),e.stopPropagation(),r(t)}),(function(){return m}),(function(){return l}));return function(){return e()}}),[r,m,l]),Object(b.useEffect)((function(){var e=S.bindOffsetToSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),r(t)}),(function(){return m}),(function(){return t.time(d)}),(function(){return l}));return function(){return e()}}),[r,m,t,l,d]),Object(b.useEffect)((function(){var e=S.bindSeekToSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),n(t.start,!1)}),(function(){return m}),(function(){return t.time(d)}),(function(){return l}));return function(){return e()}}),[n,l,m,t,d]),Object(b.useEffect)((function(){function e(){L.current=Date.now()}var t=W.current;return null===t||void 0===t||t.addEventListener("wheel",e),function(){return null===t||void 0===t?void 0:t.removeEventListener("wheel",e)}}),[W,L]),Object(b.useEffect)((function(){if(!x&&f&&l){var e,t,n,a=-1,r=0,i=Object(u.a)(l);try{for(i.s();!(e=i.n()).done;){var o=e.value;if(o.originalStart===f.originalStart&&o.text===f.text){a=r;break}++r}}catch(c){i.e(c)}finally{i.f()}if(-1!==a)null===(t=E[a])||void 0===t||null===(n=t.current)||void 0===n||n.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}),[x,f,l,E]);var X=Object(b.useCallback)((function(e){return _.current&&l?K(l,e,C.surroundingSubtitlesCountRadius,C.surroundingSubtitlesTimeRadius):[]}),[l,C.surroundingSubtitlesCountRadius,C.surroundingSubtitlesTimeRadius]),G=Object(b.useCallback)((function(){if(!_.current)return[];var e=Math.min.apply(Math,Object(Wn.a)(Object.keys(_.current).map((function(e){return Number(e)}))));return X(e)}),[X]);Object(b.useEffect)((function(){var e=S.bindCopy((function(e,t){e.preventDefault(),e.stopPropagation(),a(t,G(),!1)}),(function(){var e;return null!==(e=R.current)&&void 0!==e&&e}),(function(){var e=Object.keys(_.current).map((function(e){return Number(e)}));if(l&&e&&0!==e.length){var t=Math.min.apply(Math,Object(Wn.a)(e));return l[t]}}));return function(){return e()}}),[l,G,a]),Object(b.useEffect)((function(){var e=S.bindToggleSubtitleTrackInList((function(e,t){e.preventDefault(),e.stopPropagation(),o(t)}),(function(){}),(function(){return m}));return function(){return e()}}),[m,o]),Object(b.useEffect)((function(){var e=S.bindAnkiExport((function(e){e.preventDefault(),e.stopPropagation();var t=Object.keys(_.current).map((function(e){return Number(e)}));if(l&&t&&t.length>0){var n=Math.min.apply(Math,Object(Wn.a)(t));a(l[n],X(n),!0)}i()}),(function(){return!1}));return function(){return e()}}),[i,a,l,X]);var J=Object(b.useCallback)((function(e){if(l){var t=_.current||{};n(l[e].start,!w.current&&e in t)}}),[l,n]),Q=Object(b.useCallback)((function(e,t){e.preventDefault(),e.stopPropagation(),l&&a(l[t],X(t),!1)}),[l,X,a]),Y=null;return l&&0!==l.length?Y=Object(ee.jsx)(Qe.a,{className:z.table,children:Object(ee.jsx)(Ge.a,{children:Object(ee.jsx)(Je.a,{children:l.map((function(e,t){var n=t in A;return Object(ee.jsx)(Gn,{index:t,compressed:h,selected:n,disabled:y[e.track],subtitle:l[t],subtitleRef:E[t],onClickSubtitle:J,onCopySubtitle:Q},t)}))})})}):!j&&O?Y=!j&&O&&Object(ee.jsx)("div",{className:z.noSubtitles,children:Object(ee.jsx)(Me.a,{variant:"h6",children:O})}):l&&0===l.length&&(Y=Object(ee.jsx)("div",{className:z.noSubtitles,children:Object(ee.jsx)(Me.a,{variant:"h6",children:"No subtitles"})})),Object(ee.jsx)(zn.a,{square:!0,elevation:0,ref:W,className:z.container,children:Y})}var Qn=function(){function e(t){Object(k.a)(this,e),this.protocol=void 0,this.time=void 0,this.isReady=void 0,this.readyCallbacks=void 0,this.playCallbacks=void 0,this.pauseCallbacks=void 0,this.audioTrackSelectedCallbacks=void 0,this.currentTimeCallbacks=void 0,this.exitCallbacks=void 0,this.offsetCallbacks=void 0,this.popOutToggleCallbacks=void 0,this.copyCallbacks=void 0,this.condensedModeToggleCallbacks=void 0,this.hideSubtitlePlayerToggleCallbacks=void 0,this.appBarToggleCallbacks=void 0,this.ankiDialogRequestCallbacks=void 0,this.toggleSubtitleTrackInListCallbacks=void 0,this.readyState=void 0,this.oncanplay=null,this.audioTracks=void 0,this.selectedAudioTrack=void 0,this.duration=void 0,this.protocol=t,this.time=0,this.duration=0,this.isReady=!1,this.readyState=0,this.selectedAudioTrack=void 0,this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[],this.condensedModeToggleCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.toggleSubtitleTrackInListCallbacks=[];var n=this;this.protocol.onMessage=function(e){switch(e.data.command){case"ready":var t=e.data;n.duration=t.duration,n.isReady=!0,n.audioTracks=t.audioTracks,n.selectedAudioTrack=t.selectedAudioTrack,n.readyState=4,n.time=t.currentTime;var a,r=Object(u.a)(n.readyCallbacks);try{for(r.s();!(a=r.n()).done;){(0,a.value)(t.paused)}}catch(V){r.e(V)}finally{r.f()}break;case"readyState":var i,o=e.data;if(n.readyState=o.value,4===n.readyState)null===(i=n.oncanplay)||void 0===i||i.call(n,new Event("canplay"));break;case"play":var c,s=e.data,l=Object(u.a)(n.playCallbacks);try{for(l.s();!(c=l.n()).done;){(0,c.value)(s.echo)}}catch(V){l.e(V)}finally{l.f()}break;case"pause":var d,b=e.data,f=Object(u.a)(n.pauseCallbacks);try{for(f.s();!(d=f.n()).done;){(0,d.value)(b.echo)}}catch(V){f.e(V)}finally{f.f()}break;case"audioTrackSelected":var h,j=e.data,v=Object(u.a)(n.audioTrackSelectedCallbacks);try{for(v.s();!(h=v.n()).done;){var p=h.value;n.selectedAudioTrack=j.id,p(j.id)}}catch(V){v.e(V)}finally{v.f()}break;case"currentTime":var g,O=e.data,m=Object(u.a)(n.currentTimeCallbacks);try{for(m.s();!(g=m.n()).done;){(0,g.value)(O.value,O.echo)}}catch(V){m.e(V)}finally{m.f()}break;case"exit":var k,x=Object(u.a)(n.exitCallbacks);try{for(x.s();!(k=x.n()).done;){(0,k.value)()}}catch(V){x.e(V)}finally{x.f()}break;case"offset":var y,C=e.data,w=Object(u.a)(n.offsetCallbacks);try{for(w.s();!(y=w.n()).done;){(0,y.value)(C.value)}}catch(V){w.e(V)}finally{w.f()}break;case"popOutToggle":var S,T=Object(u.a)(n.popOutToggleCallbacks);try{for(T.s();!(S=T.n()).done;){(0,S.value)()}}catch(V){T.e(V)}finally{T.f()}break;case"copy":var F,E=Object(u.a)(n.copyCallbacks);try{for(E.s();!(F=E.n()).done;){var M,R=F.value,I=e.data;R(I.subtitle,I.surroundingSubtitles,I.audio,I.image,I.url,null!==(M=I.preventDuplicate)&&void 0!==M&&M,I.id)}}catch(V){E.e(V)}finally{E.f()}break;case"condensedModeToggle":var P,A=Object(u.a)(n.condensedModeToggleCallbacks);try{for(A.s();!(P=A.n()).done;){(0,P.value)()}}catch(V){A.e(V)}finally{A.f()}break;case"hideSubtitlePlayerToggle":var D,_=Object(u.a)(n.hideSubtitlePlayerToggleCallbacks);try{for(_.s();!(D=_.n()).done;){(0,D.value)()}}catch(V){_.e(V)}finally{_.f()}break;case"appBarToggle":var N,B=Object(u.a)(n.appBarToggleCallbacks);try{for(B.s();!(N=B.n()).done;){(0,N.value)()}}catch(V){B.e(V)}finally{B.f()}break;case"sync":case"syncv2":case"playbackRate":break;case"ankiDialogRequest":var L,U=e.data,W=Object(u.a)(n.ankiDialogRequestCallbacks);try{for(W.s();!(L=W.n()).done;){(0,L.value)(U.forwardToVideo)}}catch(V){W.e(V)}finally{W.f()}break;case"toggleSubtitleTrackInList":var H,q=e.data,z=Object(u.a)(n.toggleSubtitleTrackInListCallbacks);try{for(z.s();!(H=z.n()).done;){(0,H.value)(q.track)}}catch(V){z.e(V)}finally{z.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(x.a)(e,[{key:"currentTime",get:function(){return this.time},set:function(e){this.time=e,this.readyState=3;var t={command:"currentTime",value:this.time};this.protocol.postMessage(t)}},{key:"onReady",value:function(e){this.isReady&&e(!1),this.readyCallbacks.push(e)}},{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onExit",value:function(e){this.exitCallbacks.push(e)}},{key:"onOffset",value:function(e){this.offsetCallbacks.push(e)}},{key:"onPopOutToggle",value:function(e){this.popOutToggleCallbacks.push(e)}},{key:"onCopy",value:function(e){this.copyCallbacks.push(e)}},{key:"onCondensedModeToggle",value:function(e){this.condensedModeToggleCallbacks.push(e)}},{key:"onHideSubtitlePlayerToggle",value:function(e){this.hideSubtitlePlayerToggleCallbacks.push(e)}},{key:"onAppBarToggle",value:function(e){this.appBarToggleCallbacks.push(e)}},{key:"onAnkiDialogRequest",value:function(e){this.ankiDialogRequestCallbacks.push(e)}},{key:"onToggleSubtitleTrackInList",value:function(e){this.toggleSubtitleTrackInListCallbacks.push(e)}},{key:"ready",value:function(e){var t={command:"ready",duration:e};this.protocol.postMessage(t)}},{key:"init",value:function(){this.protocol.postMessage({command:"init"})}},{key:"play",value:function(){return this.protocol.postMessage({command:"play"}),new Promise((function(e,t){return e()}))}},{key:"pause",value:function(){this.protocol.postMessage({command:"pause"})}},{key:"audioTrackSelected",value:function(e){var t={command:"audioTrackSelected",id:e};this.protocol.postMessage(t)}},{key:"subtitles",value:function(e,t){this.protocol.postMessage({command:"subtitles",value:e,name:t.length>0?t[0]:null,names:t})}},{key:"subtitleSettings",value:function(e){var t={command:"subtitleSettings",value:e};this.protocol.postMessage(t)}},{key:"condensedModeToggle",value:function(e){var t={command:"condensedModeToggle",value:e};this.protocol.postMessage(t)}},{key:"hideSubtitlePlayerToggle",value:function(e){var t={command:"hideSubtitlePlayerToggle",value:e};this.protocol.postMessage(t)}},{key:"appBarToggle",value:function(e){var t={command:"appBarToggle",value:e};this.protocol.postMessage(t)}},{key:"ankiDialogRequest",value:function(){this.protocol.postMessage({command:"ankiDialogRequest"})}},{key:"finishedAnkiDialogRequest",value:function(e){var t={command:"finishedAnkiDialogRequest",resume:e};this.protocol.postMessage(t)}},{key:"ankiSettings",value:function(e){var t={command:"ankiSettings",value:e};this.protocol.postMessage(t)}},{key:"miscSettings",value:function(e){var t={command:"miscSettings",value:e};this.protocol.postMessage(t)}},{key:"close",value:function(){this.protocol.postMessage({command:"close"}),this.protocol.close(),this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[],this.condensedModeToggleCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.toggleSubtitleTrackInListCallbacks=[]}}]),e}(),Yn=Object(j.a)({root:function(e){return{height:e.appBarHidden?"100vh":"calc(100vh - 64px)",position:"relative",overflowX:"hidden"}},container:{width:"100%",height:"100%"},videoFrame:{width:"100%",height:"100%",border:0,display:"block"}});function Zn(e,t,n,a){var r;r=n&&n.length>0?a?n[n.length-1].end:n[n.length-1].originalEnd:0;var i=e.current&&e.current.duration?1e3*e.current.duration:0,o=t.current&&t.current.duration?1e3*t.current.duration:0;return Math.max(o,Math.max(r,i))}function $n(e){var t,n=e.sources,a=n.subtitleFiles,r=n.audioFile,s=n.audioFileUrl,u=n.videoFile,l=n.videoFileUrl,f=e.subtitleReader,h=e.settingsProvider,j=e.extension,v=e.videoFrameRef,p=e.drawerOpen,g=e.appBarHidden,O=e.tab,m=e.availableTabs,k=e.ankiDialogRequestToVideo,x=e.ankiDialogRequested,y=e.ankiDialogFinishedRequest,C=e.onError,w=e.onUnloadAudio,T=e.onUnloadVideo,F=e.onCopy,E=e.onLoaded,M=e.onTabSelected,R=e.onAnkiDialogRequest,I=e.onAppBarToggle,P=e.disableKeyEvents,A=e.jumpToSubtitle,D=Object(b.useState)(),_=Object(c.a)(D,2),N=_[0],B=_[1],L=Object(b.useRef)();L.current=N;var U=Object(b.useState)(!1),W=Object(c.a)(U,2),H=W[0],q=W[1],z=Object(b.useState)(!1),V=Object(c.a)(z,2),X=V[0],K=V[1],J=Object(b.useState)(0),Y=Object(c.a)(J,2),Z=Y[0],$=Y[1],te=Object(b.useState)(0),ne=Object(c.a)(te,2),ae=ne[0],re=ne[1],ie=Object(b.useRef)();ie.current=X;var oe=Object(b.useState)(),ce=Object(c.a)(oe,2)[1],se=Object(b.useState)(),ue=Object(c.a)(se,2),le=ue[0],de=ue[1],be=Object(b.useState)(),fe=Object(c.a)(be,2),he=fe[0],je=fe[1],ve=Object(b.useState)(),pe=Object(c.a)(ve,2),Oe=pe[0],me=pe[1],ke=Object(b.useState)(!1),xe=Object(c.a)(ke,2),ye=xe[0],Ce=xe[1],we=Object(b.useState)(!1),Se=Object(c.a)(we,2)[1],Te=Object(b.useState)(!1),Fe=Object(c.a)(Te,2),Ee=Fe[0],Me=Fe[1],Re=Object(b.useRef)();Re.current=Ee;var Ie=Object(b.useState)({}),Pe=Object(c.a)(Ie,2),Ae=Pe[0],De=Pe[1],_e=Object(b.useState)(!1),Ne=Object(c.a)(_e,2),Be=Ne[0],Le=Ne[1],Ue=Object(b.useRef)();Ue.current=Be;var We=Object(b.useCallback)((function(){return ce({})}),[]),He=Object(b.useRef)({x:0,y:0}),qe=Object(b.useRef)(null),ze=Object(b.useRef)(),Ve=Object(b.useMemo)((function(){return new Un(s?qe:l||O?ze:{current:null})}),[s,l,O]),Xe=Object(b.useMemo)((function(){return new Yt}),[]),Ke=Yn({appBarHidden:g}),Ge=Object(b.useRef)(0);Ge.current=Zn(qe,ze,N,!0);var Je=Object(b.useCallback)(function(){var e=Object(i.a)(d.a.mark((function e(t,n,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.setTime(t),We(),!a){e.next=5;break}return e.next=5,Ve.seek(t/1e3);case 5:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),[We,Ve]),Qe=Object(b.useCallback)((function(e,t){re(e),B((function(n){if(n){var r=n.length>0?n[n.length-1].end+e:0,i=n.map((function(t){return{text:t.text,start:t.originalStart+e,originalStart:t.originalStart,end:t.originalEnd+e,originalEnd:t.originalEnd,displayTime:Tt(t.originalStart+e,r),track:t.track}}));return t&&ze.current instanceof Qn&&ze.current.subtitles(i,a.map((function(e){return e.name}))),i}}))}),[a]);function Ye(e,t,n){K(!0),e.start(),n&&t.play()}function Ze(e,t,n){K(!1),e.stop(),n&&t.pause()}Object(b.useEffect)((function(){var e=void 0,t=!1;function n(){return n=Object(i.a)(d.a.mark((function n(){var c,b,v,p,g;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(ze.current instanceof Qn&&ze.current.close(),ze.current=void 0,Xe.setTime(0),Xe.stop(),re(0),K(!1),de(void 0),je(void 0),Le(!1),qe.current&&(qe.current.currentTime=0,qe.current.pause()),!(a.length>0)){n.next=30;break}return q(!0),n.prev=12,n.next=15,f.subtitles(a);case 15:b=n.sent,v=b.length>0?b[b.length-1].end:0,c=b.map((function(e){return{text:e.text,start:e.start,originalStart:e.start,end:e.end,originalEnd:e.end,displayTime:Tt(e.start,v),track:e.track}})),B(c),$(Date.now()),n.next=25;break;case 22:n.prev=22,n.t0=n.catch(12),n.t0 instanceof Error?C(n.t0.message):C(String(n.t0));case 25:return n.prev=25,q(!1),n.finish(25);case 28:n.next=31;break;case 30:c=null;case 31:if(!s){n.next=37;break}return n.next=34,Ve.onReady();case 34:We(),n.next=59;break;case 37:if(!l&&!O){n.next=59;break}if(!t){n.next=40;break}return n.abrupt("return");case 40:if(!l){n.next=46;break}p=Object(Q.a)(),e=new Qn(new Jt(p)),me(p),n.next=52;break;case 46:if(!O){n.next=51;break}(e=new Qn(new Qt(O.id,O.src,j))).init(),n.next=52;break;case 51:throw new Error("Unreachable code");case 52:ze.current=e,g=!1,e.onExit((function(){return l&&T(l)})),e.onPopOutToggle((function(){return Ce((function(e){return!e}))})),e.onHideSubtitlePlayerToggle((function(){Me((function(t){var n;return null===(n=e)||void 0===n||n.hideSubtitlePlayerToggle(!t),!t}))})),e.onAppBarToggle((function(){I()})),e.onReady((function(t){var n,c,s,l,b,f,j,v,p,O,m,k,x,y,C,w,S,T,E,M,I,P,A;(Ge.current=Zn(qe,ze,L.current),null===(n=e)||void 0===n||n.ready(Ge.current),L.current)&&(null===(m=e)||void 0===m||m.subtitleSettings(h.subtitleSettings),null===(k=e)||void 0===k||k.subtitles(L.current,a.map((function(e){return e.name}))));(null===(c=e)||void 0===c||c.ankiSettings(h.ankiSettings),null===(s=e)||void 0===s||s.miscSettings(h.miscSettings),null===(l=e)||void 0===l||l.condensedModeToggle(null!==(b=Ue.current)&&void 0!==b&&b),null===(f=e)||void 0===f||f.hideSubtitlePlayerToggle(null!==(j=Re.current)&&void 0!==j&&j),null!==(v=e)&&void 0!==v&&v.audioTracks&&(null===(p=e)||void 0===p||null===(O=p.audioTracks)||void 0===O?void 0:O.length)>1)?(de(null===(x=e)||void 0===x?void 0:x.audioTracks),je(null===(y=e)||void 0===y?void 0:y.selectedAudioTrack)):(de(void 0),je(void 0));(ze.current&&Xe.setTime(1e3*ze.current.currentTime),t?Xe.stop():Xe.start(),K(!t),g)||(null===(C=e)||void 0===C||C.onPlay((function(e){return Ye(Xe,Ve,e)})),null===(w=e)||void 0===w||w.onPause((function(e){return Ze(Xe,Ve,e)})),null===(S=e)||void 0===S||S.onOffset((function(e){var t;return Qe(Math.max(null!==(t=-Ge.current)&&void 0!==t?t:0,e),!1)})),null===(T=e)||void 0===T||T.onCopy((function(t,n,i,o,c,s,l){var d;return F(t,n,r,u,t?a[t.track]:void 0,null===(d=e)||void 0===d?void 0:d.selectedAudioTrack,i,o,c,s,l)})),null===(E=e)||void 0===E||E.onCondensedModeToggle((function(){return Le((function(t){var n,a=!t;return null===(n=e)||void 0===n||n.condensedModeToggle(a),a}))})),null===(M=e)||void 0===M||M.onCurrentTime(function(){var e=Object(i.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ie.current&&Xe.stop(),e.next=3,Je(1e3*t,Xe,n);case 3:ie.current&&Xe.start();case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),null===(I=e)||void 0===I||I.onAudioTrackSelected(function(){var e=Object(i.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ie.current&&Xe.stop(),e.next=3,Ve.onReady();case 3:ie.current&&Xe.start(),je(t);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),null===(P=e)||void 0===P||P.onAnkiDialogRequest((function(e){return R(e)})),null===(A=e)||void 0===A||A.onToggleSubtitleTrackInList((function(e){return De((function(t){var n=Object(o.a)({},t);return n[e]=!t[e],n}))})),g=!0)}));case 59:case"end":return n.stop()}}),n,null,[[12,22,25,28]])}))),n.apply(this,arguments)}return function(){return n.apply(this,arguments)}().then((function(){return E()})),function(){var n;null===(n=e)||void 0===n||n.close(),t=!0}}),[f,j,h,Xe,Ve,Je,E,C,T,F,R,I,a,r,s,u,l,O,We,v,Qe]),Object(b.useEffect)((function(){k&&ze.current instanceof Qn&&ze.current.ankiDialogRequest()}),[k]),Object(b.useEffect)((function(){y&&y.timestamp>0&&(ze.current instanceof Qn&&ze.current.finishedAnkiDialogRequest(y.resume),Se((function(e){return e&&y.resume&&Ye(Xe,Ve,!0),!1})))}),[y,Xe,Ve]),Object(b.useEffect)((function(){x&&ie.current&&(Ze(Xe,Ve,!0),Se(!0))}),[x,Xe,Ve]),Object(b.useEffect)((function(){if(Be&&N&&0!==N.length){var e=!1,t=1e3,n=setInterval(Object(i.a)(d.a.mark((function n(){var a,r,i,o,c,s,u,l,b,f;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=Ge.current){n.next=3;break}return n.abrupt("return");case 3:r=Xe.progress(a),i=0,o=-1,c=N.length-1;case 7:if(!(c>=0)){n.next=17;break}if(s=N[c],u=s.start/a,l=s.end/a,!(r>=u)){n.next=14;break}return r<l?(o=c,i=c):i=Math.min(N.length-1,c+1),n.abrupt("break",17);case 14:--c,n.next=7;break;case 17:if(o===i){n.next=30;break}if(!((b=N[i]).start-r*a<t+500)){n.next=21;break}return n.abrupt("return");case 21:if(ie.current&&Xe.stop(),e){n.next=29;break}return e=!0,f=Date.now(),n.next=27,Je(b.start,Xe,!0);case 27:t=Date.now()-f,e=!1;case 29:ie.current&&Xe.start();case 30:case"end":return n.stop()}}),n)}))),100);return function(){return clearInterval(n)}}}),[N,Be,Xe,Je]),Object(b.useEffect)((function(){ye&&Oe&&l&&window.open("/asbplayer/?video="+encodeURIComponent(l)+"&channel="+Oe+"&popout=true","asbplayer-video-"+l,"resizable,width=800,height=450"),$(Date.now())}),[ye,Oe,l,v]);var $e=Object(b.useCallback)((function(){return Ye(Xe,Ve,!0)}),[Xe,Ve]),et=Object(b.useCallback)((function(){return Ze(Xe,Ve,!0)}),[Xe,Ve]),tt=Object(b.useCallback)(function(){var e=Object(i.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ge.current){e.next=2;break}return e.abrupt("return");case 2:return ie.current&&Xe.stop(),e.next=5,Je(t*Ge.current,Xe,!0);case 5:ie.current&&Xe.start();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Xe,Je]),nt=Object(b.useCallback)(function(){var e=Object(i.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n||Ze(Xe,Ve,!0),ie.current&&Xe.stop(),e.next=4,Je(t,Xe,!0);case 4:n&&!ie.current&&Ye(Xe,Ve,!0);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[Xe,Je,Ve]),at=Object(b.useCallback)((function(e,t,n){F(e,t,r,u,a[e.track],he,void 0,void 0,void 0,n,void 0)}),[F,r,u,a,he]),rt=Object(b.useCallback)((function(e){He.current.x=e.screenX,He.current.y=e.screenY}),[]),it=Object(b.useCallback)(function(){var e=Object(i.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ze.current instanceof Qn&&ze.current.audioTrackSelected(t),Ze(Xe,Ve,!0),e.next=4,Je(0,Xe,!0);case 4:ie.current&&Ye(Xe,Ve,!0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Xe,Ve,Je]),ot=Object(b.useCallback)((function(e){var t;Qe(Math.max(null!==(t=-Ge.current)&&void 0!==t?t:0,e),!0)}),[Qe]),ct=Object(b.useCallback)((function(e){qe.current instanceof HTMLMediaElement&&(qe.current.volume=e)}),[]),st=Object(b.useCallback)((function(){return Le((function(e){return!e}))}),[]),ut=Object(b.useCallback)((function(e){return De((function(t){var n=Object(o.a)({},t);return n[e]=!t[e],n}))}),[]);Object(b.useEffect)((function(){if(!O){var e=setInterval(Object(i.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Ge.current,!(Xe.progress(t)>=1)){e.next=7;break}return Ze(Xe,Ve,!0),e.next=6,Je(0,Xe,!0);case 6:$(Date.now());case 7:case"end":return e.stop()}}),e)}))),1e3);return function(){return clearInterval(e)}}}),[Xe,N,Ve,Je,O]),Object(b.useEffect)((function(){var e=S.bindPlay((function(e){e.preventDefault(),X?Ze(Xe,Ve,!0):Ye(Xe,Ve,!0)}),(function(){return P}));return function(){return e()}}),[X,Xe,Ve,P]),Object(b.useEffect)((function(){if((r||u)&&(!N||0===N.length)){var e=S.bindCopy((function(e,t){e.preventDefault(),e.stopPropagation();var n=G(t,Ge.current,5e3);F(t,n,r,u,void 0,he,void 0,void 0,void 0,void 0,void 0)}),(function(){return P}),(function(){if(Ge.current){var e=Xe.time(Ge.current),t=Math.min(e+5e3,Ge.current);return{text:"",start:e,originalStart:e,end:t,originalEnd:t,track:0}}})),t=S.bindAnkiExport((function(e){e.preventDefault(),e.stopPropagation();var t=Xe.time(Ge.current),n=Math.min(t+5e3,Ge.current),a={text:"",start:t,originalStart:t,end:n,originalEnd:n,track:0},i=G(a,Ge.current,5e3);F(a,i,r,u,void 0,he,void 0,void 0,void 0,void 0,void 0),R()}),(function(){return!1}));return function(){e(),t()}}}),[r,u,N,Xe,he,P,F,R]),Object(b.useEffect)((function(){ze.current instanceof Qn&&ze.current.appBarToggle(g)}),[g]);var lt=Ge.current,dt=s||l||N,bt=Boolean(dt&&l&&!ye);return Object(ee.jsxs)("div",{onMouseMove:rt,className:Ke.root,children:[Object(ee.jsxs)(ge.a,{container:!0,direction:"row",wrap:"nowrap",className:Ke.container,children:[bt&&Object(ee.jsx)(ge.a,{item:!0,style:{flexGrow:1,minWidth:600},children:Object(ee.jsx)("iframe",{ref:v,className:Ke.videoFrame,src:"/asbplayer/?video="+encodeURIComponent(l)+"&channel="+Oe+"&popout=false",title:"asbplayer"})}),(!bt||N&&(null===(t=N)||void 0===t?void 0:t.length)>0)&&Object(ee.jsxs)(ge.a,{item:!0,style:{flexGrow:bt?0:1,width:bt&&Ee?0:"auto"},children:[dt&&!(l&&!ye)&&Object(ee.jsx)(Ln,{mousePositionRef:He,playing:X,clock:Xe,length:lt,displayLength:Zn(qe,ze,N,!1),audioTracks:le,selectedAudioTrack:he,tabs:!l&&!s&&m||void 0,selectedTab:O,audioFile:null===r||void 0===r?void 0:r.name,videoFile:null===u||void 0===u?void 0:u.name,offsetEnabled:!0,offset:ae,volumeEnabled:Boolean(s),condensedModeToggleEnabled:Boolean(s)&&N&&N.length>0,condensedModeEnabled:Be,onPlay:$e,onPause:et,onSeek:tt,onAudioTrackSelected:it,onTabSelected:M,onUnloadAudio:function(){return s&&w(s)},onUnloadVideo:function(){return l&&T(l)},onOffsetChange:ot,onVolumeChange:ct,onCondensedModeToggle:st,disableKeyEvents:P,settingsProvider:h,showOnMouseMovement:!0}),Object(ee.jsx)(Jn,{playing:X,subtitles:N,clock:Xe,length:lt,jumpToSubtitle:A,drawerOpen:p,appBarHidden:g,compressed:Boolean(l&&!ye),loading:H,displayHelp:(null===r||void 0===r?void 0:r.name)||ye&&(null===u||void 0===u?void 0:u.name)||void 0,disableKeyEvents:P,lastJumpToTopTimestamp:Z,hidden:bt&&Ee,disabledSubtitleTracks:Ae,onSeek:nt,onCopy:at,onOffsetChange:ot,onAnkiDialogRequest:R,onToggleSubtitleTrack:ut,settingsProvider:h})]})]}),Object(ee.jsx)("audio",{ref:qe,src:s})]})}var ea=n(359),ta=n(349);function na(e){var t=e.open,n=e.onProceed,a=e.onCancel,r=e.existingCustomFieldNames,i=Object(b.useState)(""),o=Object(c.a)(i,2),s=o[0],u=o[1];Object(b.useEffect)((function(){u("")}),[t]);var l=[].concat(Object(Wn.a)(r),["Sentence","Word","Definition","Source","Image","Audio"]).includes(s);return Object(ee.jsxs)(le.a,{open:t,disableEnforceFocus:!0,fullWidth:!0,maxWidth:"xs",onClose:a,children:[Object(ee.jsx)(ta.a,{children:"New Custom Field"}),Object(ee.jsx)(je.a,{children:Object(ee.jsx)("form",{children:Object(ee.jsx)(re.a,{error:l,helperText:l&&"Field ".concat(s," already exists"),variant:"filled",fullWidth:!0,label:"Field Name",value:s,color:"secondary",onChange:function(e){return u(e.target.value)}})})}),Object(ee.jsxs)(he.a,{children:[Object(ee.jsx)(fe.a,{onClick:function(){return a()},children:"Cancel"}),Object(ee.jsx)(fe.a,{disabled:l||""===s.trim(),onClick:function(){return n(s.trim())},children:"Create"})]})]})}var aa=n(278),ra=n(352),ia=n(351),oa=n(281),ca=n(280),sa=n(279),ua=n(350),la=n(181),da=n.n(la),ba=n(357),fa=n(182),ha=n.n(fa),ja=n(285),va=Object(ce.a)((function(e){return{root:{"& .MuiTextField-root":{marginTop:e.spacing(1),marginBottom:e.spacing(1)}},subtitleSetting:{"& .MuiTextField-root":{marginTop:e.spacing(1),marginBottom:e.spacing(1)}},subtitlePreview:{backgroundImage:"linear-gradient(45deg, ".concat(e.palette.action.disabledBackground," 25%, transparent 25%), linear-gradient(-45deg, ").concat(e.palette.action.disabledBackground," 25%, transparent 25%), linear-gradient(45deg, transparent 75%, ").concat(e.palette.action.disabledBackground," 75%), linear-gradient(-45deg, transparent 75%,").concat(e.palette.action.disabledBackground," 75%)"),backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px",marginTop:e.spacing(1),marginBottom:e.spacing(1),maxWidth:"100%",padding:10},subtitlePreviewInput:{border:"none",width:"100%",textAlign:"center",backgroundColor:"rgba(0,0,0,0)","&:focus":{outline:"none"}},addFieldButton:{width:"100%"}}})),pa=Object(ce.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120},root:{display:"flex",flexDirection:"row",justifyContent:"end",alignItems:"flex-end"}}}));function ga(e){var t=e.label,n=e.value,a=e.selections,r=e.removable,i=e.onChange,o=e.onSelectionChange,c=e.onRemoval,s=pa();return Object(ee.jsxs)("div",{className:s.root,children:[Object(ee.jsx)(re.a,{label:t,value:n,onChange:i,fullWidth:!0,color:"secondary",InputProps:{endAdornment:r&&Object(ee.jsx)(me.a,{position:"end",children:Object(ee.jsx)(Oe.a,{onClick:function(e){return null===c||void 0===c?void 0:c()},children:Object(ee.jsx)(da.a,{})})})}}),Object(ee.jsxs)(aa.a,{className:s.formControl,children:[Object(ee.jsx)(sa.a,{}),Object(ee.jsx)(ja.a,{value:n,disabled:!a,color:"secondary",onChange:o,children:a&&a.map((function(e){return Object(ee.jsx)(ua.a,{value:e,children:e},e)}))})]})]})}function Oa(e){var t=e.anki,n=e.open,a=e.settings,r=e.onClose,o=va(),s=Object(b.useState)(a.ankiConnectUrl),u=Object(c.a)(s,2),l=u[0],h=u[1],j=Object(b.useState)(),v=Object(c.a)(j,2),p=v[0],g=v[1],O=Object(b.useState)(0),m=Object(c.a)(O,2),k=m[0],x=m[1],y=Object(b.useState)(a.deck||""),C=Object(c.a)(y,2),w=C[0],S=C[1],T=Object(b.useState)(),F=Object(c.a)(T,2),E=F[0],M=F[1],R=Object(b.useState)(a.noteType||""),I=Object(c.a)(R,2),P=I[0],A=I[1],D=Object(b.useState)(),_=Object(c.a)(D,2),N=_[0],B=_[1],L=Object(b.useState)(a.sentenceField||""),U=Object(c.a)(L,2),W=U[0],H=U[1],q=Object(b.useState)(a.definitionField||""),z=Object(c.a)(q,2),V=z[0],X=z[1],K=Object(b.useState)(a.audioField||""),G=Object(c.a)(K,2),J=G[0],Q=G[1],Y=Object(b.useState)(a.imageField||""),Z=Object(c.a)(Y,2),$=Z[0],te=Z[1],ne=Object(b.useState)(a.wordField||""),ae=Object(c.a)(ne,2),ie=ae[0],ce=ae[1],se=Object(b.useState)(a.sourceField||""),ue=Object(c.a)(se,2),de=ue[0],be=ue[1],ve=Object(b.useState)(a.urlField||""),pe=Object(c.a)(ve,2),ke=pe[0],xe=pe[1],ye=Object(b.useState)(a.customAnkiFields),Ce=Object(c.a)(ye,2),we=Ce[0],Se=Ce[1],Te=Object(b.useState)(a.tags),Fe=Object(c.a)(Te,2),Ee=Fe[0],Me=Fe[1],Re=Object(b.useState)(a.preferMp3),Ie=Object(c.a)(Re,2),Pe=Ie[0],Ae=Ie[1],De=Object(b.useState)(),_e=Object(c.a)(De,2),Ne=_e[0],Be=_e[1],Le=Object(b.useState)(!1),Ue=Object(c.a)(Le,2),We=Ue[0],He=Ue[1],ze=Object(b.useState)(a.audioPaddingStart),Ve=Object(c.a)(ze,2),Xe=Ve[0],Ke=Ve[1],Ge=Object(b.useState)(a.audioPaddingEnd),Je=Object(c.a)(Ge,2),Qe=Je[0],Ye=Je[1],Ze=Object(b.useState)(a.maxImageWidth),$e=Object(c.a)(Ze,2),et=$e[0],tt=$e[1],nt=Object(b.useState)(a.maxImageHeight),at=Object(c.a)(nt,2),rt=at[0],it=at[1],ot=Object(b.useState)(a.subtitleColor),ct=Object(c.a)(ot,2),st=ct[0],ut=ct[1],lt=Object(b.useState)(a.subtitleSize),dt=Object(c.a)(lt,2),bt=dt[0],ft=dt[1],ht=Object(b.useState)(a.subtitleOutlineColor),jt=Object(c.a)(ht,2),vt=jt[0],pt=jt[1],gt=Object(b.useState)(a.subtitleOutlineThickness),Ot=Object(c.a)(gt,2),mt=Ot[0],kt=Ot[1],xt=Object(b.useState)(a.subtitleBackgroundColor),yt=Object(c.a)(xt,2),Ct=yt[0],wt=yt[1],Tt=Object(b.useState)(a.subtitleBackgroundOpacity),Ft=Object(c.a)(Tt,2),Et=Ft[0],Mt=Ft[1],Rt=Object(b.useState)(a.subtitleFontFamily),It=Object(c.a)(Rt,2),Pt=It[0],At=It[1],Dt=Object(b.useState)(a.subtitlePreview),_t=Object(c.a)(Dt,2),Nt=_t[0],Bt=_t[1],Lt=Object(b.useState)(a.themeType),Ut=Object(c.a)(Lt,2),Wt=Ut[0],Ht=Ut[1],qt=Object(b.useCallback)((function(e){h(e.target.value),x(Date.now())}),[]),zt=Object(b.useCallback)((function(e){return x(Date.now())}),[]),Vt=Object(b.useCallback)((function(e){return S(e.target.value)}),[]),Xt=Object(b.useCallback)((function(e){return A(e.target.value)}),[]),Kt=Object(b.useCallback)((function(e){return H(e.target.value)}),[]),Gt=Object(b.useCallback)((function(e){return X(e.target.value)}),[]),Jt=Object(b.useCallback)((function(e){return Q(e.target.value)}),[]),Qt=Object(b.useCallback)((function(e){return te(e.target.value)}),[]),Yt=Object(b.useCallback)((function(e){return ce(e.target.value)}),[]),Zt=Object(b.useCallback)((function(e){return be(e.target.value)}),[]),$t=Object(b.useCallback)((function(e){return xe(e.target.value)}),[]),en=Object(b.useCallback)((function(e){return Ke(e.target.value)}),[]),tn=Object(b.useCallback)((function(e){return Ye(e.target.value)}),[]),nn=Object(b.useCallback)((function(e){return tt(e.target.value)}),[]),an=Object(b.useCallback)((function(e){return it(e.target.value)}),[]),rn=Object(b.useCallback)((function(e){return ut(e.target.value)}),[]),on=Object(b.useCallback)((function(e){return ft(e.target.value)}),[]),cn=Object(b.useCallback)((function(e){return pt(e.target.value)}),[]),sn=Object(b.useCallback)((function(e){return kt(e.target.value)}),[]),un=Object(b.useCallback)((function(e){return wt(e.target.value)}),[]),ln=Object(b.useCallback)((function(e){return Mt(e.target.value)}),[]),dn=Object(b.useCallback)((function(e){return At(e.target.value)}),[]),bn=Object(b.useCallback)((function(e){return Bt(e.target.value)}),[]),fn=Object(b.useCallback)((function(e){Se((function(t){var n={};return Object.assign(n,t),n[e]="",n})),He(!1)}),[]),hn=Object(b.useCallback)((function(e,t){Se((function(n){var a={};return Object.assign(a,n),a[e]=t,a}))}),[]),jn=Object(b.useCallback)((function(e){return Se((function(t){var n={};return Object.assign(n,t),delete n[e],n}))}),[]),vn=Object(b.useCallback)((function(e){Me(e)}),[]),pn=Object(b.useCallback)((function(e){return Ae(e.target.checked)}),[]),gn=Object(b.useCallback)((function(e){return Ht(e.target.value)}),[]),On=Object(b.useMemo)((function(){return St({subtitleColor:st,subtitleSize:bt,subtitleOutlineThickness:mt,subtitleOutlineColor:vt,subtitleBackgroundOpacity:Et,subtitleBackgroundColor:Ct,subtitleFontFamily:Pt})}),[st,bt,mt,vt,Et,Ct,Pt]);Object(b.useEffect)((function(){var e=!1,n=setTimeout(Object(i.a)(d.a.mark((function n(){return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e){n.next=3;break}return n.abrupt("return");case 3:return n.next=5,t.requestPermission(l);case 5:return n.t0=M,n.next=8,t.deckNames(l);case 8:return n.t1=n.sent,(0,n.t0)(n.t1),n.t2=B,n.next=13,t.modelNames(l);case 13:n.t3=n.sent,(0,n.t2)(n.t3),g(void 0),n.next=26;break;case 18:if(n.prev=18,n.t4=n.catch(0),!e){n.next=22;break}return n.abrupt("return");case 22:console.error(n.t4),M(void 0),B(void 0),n.t4 instanceof Error?g(n.t4.message):"string"===typeof n.t4?g(n.t4):g(String(n.t4));case 26:case"end":return n.stop()}}),n,null,[[0,18]])}))),1e3);return function(){e=!0,clearTimeout(n)}}),[t,l,k]),Object(b.useEffect)((function(){if(P&&!p){var e=!1;return function(){n.apply(this,arguments)}(),function(){e=!0}}function n(){return(n=Object(i.a)(d.a.mark((function n(){return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e){n.next=3;break}return n.abrupt("return");case 3:return n.t0=Be,n.t1=[""],n.t2=Wn.a,n.next=8,t.modelFieldNames(P,l);case 8:n.t3=n.sent,n.t4=(0,n.t2)(n.t3),n.t5=n.t1.concat.call(n.t1,n.t4),(0,n.t0)(n.t5),g(void 0),n.next=22;break;case 15:if(n.prev=15,n.t6=n.catch(0),!e){n.next=19;break}return n.abrupt("return");case 19:console.error(n.t6),Be(void 0),n.t6 instanceof Error?g(n.t6.message):"string"===typeof n.t6?g(n.t6):g(String(n.t6));case 22:case"end":return n.stop()}}),n,null,[[0,15]])})))).apply(this,arguments)}}),[t,P,l,p,k]);var mn=Object(b.useCallback)((function(){r({ankiConnectUrl:l,deck:w,noteType:P,sentenceField:W,definitionField:V,audioField:J,imageField:$,wordField:ie,sourceField:de,urlField:ke,tags:Ee.filter((function(e){return""!==e})),subtitleSize:Number(bt),subtitleColor:st,subtitleOutlineThickness:Number(mt),subtitleOutlineColor:vt,subtitleBackgroundColor:Ct,subtitleBackgroundOpacity:Number(Et),subtitleFontFamily:Pt,subtitlePreview:Nt,customAnkiFields:we,preferMp3:Pe,themeType:Wt,audioPaddingStart:Xe,audioPaddingEnd:Qe,maxImageWidth:et,maxImageHeight:rt,surroundingSubtitlesCountRadius:a.surroundingSubtitlesCountRadius,surroundingSubtitlesTimeRadius:a.surroundingSubtitlesTimeRadius,volume:a.volume,theaterMode:a.theaterMode})}),[r,l,w,P,W,V,J,$,ie,de,ke,we,Ee,Pe,bt,st,mt,vt,Ct,Et,Pt,Nt,Wt,Xe,Qe,et,rt,a.surroundingSubtitlesCountRadius,a.surroundingSubtitlesTimeRadius,a.volume,a.theaterMode]),kn=Object.keys(we).map((function(e){return Object(ee.jsx)(ga,{label:"".concat(e," Field"),value:we[e],selections:Ne,onChange:function(t){return hn(e,t.target.value)},onSelectionChange:function(t){return hn(e,t.target.value)},onRemoval:function(){return jn(e)},removable:!0},e)}));return Object(ee.jsxs)(f.a.Fragment,{children:[Object(ee.jsx)(na,{open:We,existingCustomFieldNames:Object.keys(we),onProceed:fn,onCancel:function(){return He(!1)}}),Object(ee.jsxs)(le.a,{open:n,maxWidth:"xs",fullWidth:!0,onClose:mn,children:[Object(ee.jsx)(ta.a,{children:"Settings"}),Object(ee.jsx)(je.a,{children:Object(ee.jsxs)(ge.a,{container:!0,direction:"column",spacing:3,children:[Object(ee.jsxs)(ge.a,{item:!0,children:[Object(ee.jsx)(ca.a,{children:"Anki"}),Object(ee.jsxs)(ia.a,{className:o.root,children:[Object(ee.jsx)(re.a,{label:"Anki Connect URL",value:l,error:Boolean(p),helperText:p,color:"secondary",onChange:qt,InputProps:{endAdornment:Object(ee.jsx)(me.a,{position:"end",children:Object(ee.jsx)(Oe.a,{onClick:zt,children:Object(ee.jsx)(ha.a,{})})})}}),Object(ee.jsxs)(oa.a,{children:["Ensure that ",window.location.protocol+"//"+window.location.hostname," is in the webCorsOriginList in your AnkiConnect settings as in this"," ",Object(ee.jsx)(qe.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://youtu.be/Mv7fEVb6PHo?t=44",children:"video"}),"."]}),Object(ee.jsx)(ga,{label:"Deck",value:w,selections:E,onChange:Vt,onSelectionChange:Vt}),Object(ee.jsx)(ga,{label:"Note Type",value:P,selections:N,onChange:Xt,onSelectionChange:Xt}),Object(ee.jsx)(ga,{label:"Sentence Field",value:W,selections:Ne,onChange:Kt,onSelectionChange:Kt}),Object(ee.jsx)(ga,{label:"Definition Field",value:V,selections:Ne,onChange:Gt,onSelectionChange:Gt}),Object(ee.jsx)(ga,{label:"Word Field",value:ie,selections:Ne,onChange:Yt,onSelectionChange:Yt}),Object(ee.jsx)(ga,{label:"Audio Field",value:J,selections:Ne,onChange:Jt,onSelectionChange:Jt}),Object(ee.jsx)(ga,{label:"Image Field",value:$,selections:Ne,onChange:Qt,onSelectionChange:Qt}),Object(ee.jsx)(ga,{label:"Source Field",value:de,selections:Ne,onChange:Zt,onSelectionChange:Zt}),Object(ee.jsx)(ga,{label:"URL Field",value:ke,selections:Ne,onChange:$t,onSelectionChange:$t}),kn,Object(ee.jsx)(fe.a,{className:o.addFieldButton,onClick:function(e){return He(!0)},children:"Add Custom Field"}),Object(ee.jsx)(oe,{label:"Tags",helperText:"Comma-separated list of strings",fullWidth:!0,color:"secondary",tags:Ee,onTagsChange:vn}),Object(ee.jsx)(ra.a,{control:Object(ee.jsx)(ea.a,{checked:Pe,onChange:pn}),label:"Re-encode audio as mp3 (slower)"}),Object(ee.jsx)(re.a,{type:"number",label:"Audio Padding Start",fullWidth:!0,value:Xe,color:"secondary",onChange:en,inputProps:{min:0,step:1},InputProps:{endAdornment:Object(ee.jsx)(me.a,{position:"end",children:"ms"})}}),Object(ee.jsx)(re.a,{type:"number",label:"Audio Padding End",fullWidth:!0,value:Qe,color:"secondary",onChange:tn,inputProps:{min:0,step:1},InputProps:{endAdornment:Object(ee.jsx)(me.a,{position:"end",children:"ms"})}}),Object(ee.jsx)(re.a,{type:"number",label:"Max Image Width",fullWidth:!0,value:et,color:"secondary",onChange:nn,inputProps:{min:0,step:1}}),Object(ee.jsx)(re.a,{type:"number",label:"Max Image Height",fullWidth:!0,value:rt,color:"secondary",onChange:an,inputProps:{min:0,step:1}})]})]}),Object(ee.jsxs)(ge.a,{item:!0,children:[Object(ee.jsx)(ca.a,{children:"Video Subtitle Appearance"}),Object(ee.jsxs)(ia.a,{children:[Object(ee.jsx)("div",{className:o.subtitleSetting,children:Object(ee.jsx)(re.a,{type:"color",label:"Subtitle Color",fullWidth:!0,value:st,color:"secondary",onChange:rn})}),Object(ee.jsx)("div",{className:o.subtitleSetting,children:Object(ee.jsx)(re.a,{type:"number",label:"Subtitle Size",fullWidth:!0,value:bt,color:"secondary",onChange:on,inputProps:{min:1,step:1}})}),Object(ee.jsx)("div",{className:o.subtitleSetting,children:Object(ee.jsx)(re.a,{type:"color",label:"Subtitle Outline Color",fullWidth:!0,value:vt,color:"secondary",onChange:cn})}),Object(ee.jsx)("div",{className:o.subtitleSetting,children:Object(ee.jsx)(re.a,{type:"number",label:"Subtitle Outline Thickness",fullWidth:!0,value:mt,onChange:sn,inputProps:{min:0,step:1},color:"secondary"})}),Object(ee.jsx)("div",{className:o.subtitleSetting,children:Object(ee.jsx)(re.a,{type:"color",label:"Subtitle Background Color",fullWidth:!0,value:Ct,color:"secondary",onChange:un})}),Object(ee.jsx)("div",{className:o.subtitleSetting,children:Object(ee.jsx)(re.a,{type:"number",label:"Subtitle Background Opacity",fullWidth:!0,inputProps:{min:0,max:1,step:.1},value:Et,color:"secondary",onChange:ln})}),Object(ee.jsx)("div",{className:o.subtitleSetting,children:Object(ee.jsx)(re.a,{type:"text",label:"Subtitle Font Family",placeholder:"Inherited",fullWidth:!0,value:Pt,color:"secondary",onChange:dn})}),Object(ee.jsx)("div",{className:o.subtitlePreview,children:Object(ee.jsx)("input",{value:Nt,className:o.subtitlePreviewInput,onChange:bn,style:On})})]})]}),Object(ee.jsxs)(ge.a,{item:!0,children:[Object(ee.jsx)(ca.a,{children:"Theme"}),Object(ee.jsxs)("div",{children:[Object(ee.jsx)(ra.a,{control:Object(ee.jsx)(ba.a,{checked:"light"===Wt,value:"light",onChange:gn}),label:"Light"}),Object(ee.jsx)(ra.a,{control:Object(ee.jsx)(ba.a,{checked:"dark"===Wt,value:"dark",onChange:gn}),label:"Dark"})]})]})]})}),Object(ee.jsx)(he.a,{children:Object(ee.jsx)(fe.a,{onClick:mn,children:"OK"})})]})]})}var ma="ankiConnectUrl",ka="deck",xa="noteType",ya="sentenceField",Ca="definitionField",wa="audioField",Sa="imageField",Ta="wordField",Fa="sourceField",Ea="urlField",Ma="customAnkiFields",Ra="tags",Ia="subtitleSize",Pa="subtitleColor",Aa="subtitleOutlineThickness",Da="subtitleOutlineColor",_a="subtitleBackgroundColor",Na="subtitleBackgroundOpacity",Ba="subtitleFontFamily",La="subtitlePreview",Ua="audioPaddingStart",Wa="audioPaddingEnd",Ha="maxImageWidth",qa="maxImageHeight",za="volume",Va="theaterMode",Xa="preferMp3",Ka="themeType",Ga=function(){function e(){Object(k.a)(this,e),this._tags=void 0,this._tags=this.tags}return Object(x.a)(e,[{key:"settings",get:function(){return{ankiConnectUrl:this.ankiConnectUrl,deck:this.deck,noteType:this.noteType,sentenceField:this.sentenceField,definitionField:this.definitionField,audioField:this.audioField,imageField:this.imageField,wordField:this.wordField,urlField:this.urlField,customAnkiFields:this.customAnkiFields,tags:this.tags,sourceField:this.sourceField,subtitleSize:this.subtitleSize,subtitleColor:this.subtitleColor,subtitleOutlineThickness:this.subtitleOutlineThickness,subtitleOutlineColor:this.subtitleOutlineColor,subtitleBackgroundColor:this.subtitleBackgroundColor,subtitleBackgroundOpacity:this.subtitleBackgroundOpacity,subtitleFontFamily:this.subtitleFontFamily,subtitlePreview:this.subtitlePreview,preferMp3:this.preferMp3,themeType:this.themeType,audioPaddingStart:this.audioPaddingStart,audioPaddingEnd:this.audioPaddingEnd,maxImageWidth:this.maxImageWidth,maxImageHeight:this.maxImageHeight,surroundingSubtitlesCountRadius:this.surroundingSubtitlesCountRadius,surroundingSubtitlesTimeRadius:this.surroundingSubtitlesTimeRadius,volume:this.volume,theaterMode:this.theaterMode}},set:function(e){this.ankiConnectUrl=e.ankiConnectUrl,this.deck=e.deck,this.noteType=e.noteType,this.sentenceField=e.sentenceField,this.definitionField=e.definitionField,this.audioField=e.audioField,this.imageField=e.imageField,this.wordField=e.wordField,this.sourceField=e.sourceField,this.urlField=e.urlField,this.tags=e.tags,this.subtitleSize=e.subtitleSize,this.subtitleColor=e.subtitleColor,this.subtitleOutlineThickness=e.subtitleOutlineThickness,this.subtitleOutlineColor=e.subtitleOutlineColor,this.subtitleBackgroundColor=e.subtitleBackgroundColor,this.subtitleBackgroundOpacity=e.subtitleBackgroundOpacity,this.subtitleFontFamily=e.subtitleFontFamily,this.subtitlePreview=e.subtitlePreview,this.customAnkiFields=e.customAnkiFields,this.preferMp3=e.preferMp3,this.themeType=e.themeType,this.audioPaddingStart=e.audioPaddingStart,this.audioPaddingEnd=e.audioPaddingEnd,this.maxImageWidth=e.maxImageWidth,this.maxImageHeight=e.maxImageHeight,this.volume=e.volume,this.theaterMode=e.theaterMode}},{key:"subtitleSettings",get:function(){return{subtitleSize:this.subtitleSize,subtitleColor:this.subtitleColor,subtitleOutlineThickness:this.subtitleOutlineThickness,subtitleOutlineColor:this.subtitleOutlineColor,subtitleBackgroundColor:this.subtitleBackgroundColor,subtitleBackgroundOpacity:this.subtitleBackgroundOpacity,subtitleFontFamily:this.subtitleFontFamily}}},{key:"ankiSettings",get:function(){return{ankiConnectUrl:this.ankiConnectUrl,deck:this.deck,noteType:this.noteType,sentenceField:this.sentenceField,definitionField:this.definitionField,audioField:this.audioField,imageField:this.imageField,wordField:this.wordField,sourceField:this.sourceField,urlField:this.urlField,customAnkiFields:this.customAnkiFields,tags:this.tags,preferMp3:this.preferMp3,audioPaddingStart:this.audioPaddingStart,audioPaddingEnd:this.audioPaddingEnd,maxImageWidth:this.maxImageWidth,maxImageHeight:this.maxImageHeight,surroundingSubtitlesCountRadius:this.surroundingSubtitlesCountRadius,surroundingSubtitlesTimeRadius:this.surroundingSubtitlesTimeRadius}}},{key:"miscSettings",get:function(){return{themeType:this.themeType}}},{key:"_getNumberItem",value:function(e,t){var n=localStorage.getItem(e);return null===n?t:Number(n)}},{key:"_setOptionalItem",value:function(e,t){"undefined"===typeof t?localStorage.removeItem(e):localStorage.setItem(e,t)}},{key:"ankiConnectUrl",get:function(){return localStorage.getItem(ma)||"http://127.0.0.1:8765"},set:function(e){localStorage.setItem(ma,e)}},{key:"deck",get:function(){var e;return null!==(e=localStorage.getItem(ka))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(ka,e)}},{key:"noteType",get:function(){var e;return null!==(e=localStorage.getItem(xa))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(xa,e)}},{key:"sentenceField",get:function(){var e;return null!==(e=localStorage.getItem(ya))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(ya,e)}},{key:"definitionField",get:function(){var e;return null!==(e=localStorage.getItem(Ca))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Ca,e)}},{key:"audioField",get:function(){var e;return null!==(e=localStorage.getItem(wa))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(wa,e)}},{key:"imageField",get:function(){var e;return null!==(e=localStorage.getItem(Sa))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Sa,e)}},{key:"wordField",get:function(){var e;return null!==(e=localStorage.getItem(Ta))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Ta,e)}},{key:"sourceField",get:function(){var e;return null!==(e=localStorage.getItem(Fa))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Fa,e)}},{key:"urlField",get:function(){var e;return null!==(e=localStorage.getItem(Ea))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Ea,e)}},{key:"customAnkiFields",get:function(){var e=localStorage.getItem(Ma);return e?JSON.parse(e):{}},set:function(e){localStorage.setItem(Ma,JSON.stringify(e))}},{key:"tags",get:function(){if("undefined"!==typeof this._tags)return this._tags;var e=localStorage.getItem(Ra);return e?(this._tags=JSON.parse(e),this._tags):[]},set:function(e){localStorage.setItem(Ra,JSON.stringify(e)),this._tags=void 0}},{key:"subtitleColor",get:function(){return localStorage.getItem(Pa)||"#ffffff"},set:function(e){localStorage.setItem(Pa,e)}},{key:"subtitleSize",get:function(){return this._getNumberItem(Ia,36)},set:function(e){localStorage.setItem(Ia,String(e))}},{key:"subtitleOutlineColor",get:function(){return localStorage.getItem(Da)||"#000000"},set:function(e){localStorage.setItem(Da,e)}},{key:"subtitleOutlineThickness",get:function(){return this._getNumberItem(Aa,0)},set:function(e){localStorage.setItem(Aa,String(e))}},{key:"subtitleBackgroundColor",get:function(){return localStorage.getItem(_a)||"#000000"},set:function(e){localStorage.setItem(_a,e)}},{key:"subtitleBackgroundOpacity",get:function(){return this._getNumberItem(Na,.5)},set:function(e){localStorage.setItem(Na,String(e))}},{key:"subtitleFontFamily",get:function(){return localStorage.getItem(Ba)||""},set:function(e){localStorage.setItem(Ba,e)}},{key:"subtitlePreview",get:function(){return localStorage.getItem(La)||"\u30a2\u3042\u5b89"},set:function(e){localStorage.setItem(La,e)}},{key:"volume",get:function(){return this._getNumberItem(za,100)},set:function(e){localStorage.setItem(za,String(e))}},{key:"theaterMode",get:function(){return"true"===localStorage.getItem(Va)||!1},set:function(e){localStorage.setItem(Va,String(e))}},{key:"preferMp3",get:function(){return"true"===localStorage.getItem(Xa)||!1},set:function(e){localStorage.setItem(Xa,String(e))}},{key:"themeType",get:function(){var e=localStorage.getItem(Ka);return null===e?"dark":e},set:function(e){localStorage.setItem(Ka,e)}},{key:"audioPaddingStart",get:function(){var e=localStorage.getItem(Ua);return e?Number(e):0},set:function(e){localStorage.setItem(Ua,String(e))}},{key:"audioPaddingEnd",get:function(){return this._getNumberItem(Wa,500)},set:function(e){localStorage.setItem(Wa,String(e))}},{key:"maxImageWidth",get:function(){var e=localStorage.getItem(Ha);return e?Number(e):0},set:function(e){localStorage.setItem(Ha,String(e))}},{key:"maxImageHeight",get:function(){return this._getNumberItem(qa,0)},set:function(e){localStorage.setItem(qa,String(e))}},{key:"surroundingSubtitlesCountRadius",get:function(){return 1}},{key:"surroundingSubtitlesTimeRadius",get:function(){return 5e3}}]),e}(),Ja=n(183),Qa=function(){function e(t){Object(k.a)(this,e),this.channel=void 0,this.time=void 0,this.duration=void 0,this.readyCallbacks=void 0,this.playCallbacks=void 0,this.pauseCallbacks=void 0,this.currentTimeCallbacks=void 0,this.audioTrackSelectedCallbacks=void 0,this.closeCallbacks=void 0,this.subtitlesCallbacks=void 0,this.condensedModeToggleCallbacks=void 0,this.hideSubtitlePlayerToggleCallbacks=void 0,this.appBarToggleCallbacks=void 0,this.ankiDialogRequestCallbacks=void 0,this.finishedAnkiDialogRequestCallbacks=void 0,this.channel=new BroadcastChannel(t),this.time=0,this.duration=0,this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.closeCallbacks=[],this.readyCallbacks=[],this.subtitlesCallbacks=[],this.condensedModeToggleCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.finishedAnkiDialogRequestCallbacks=[];var n=this;this.channel.onmessage=function(e){switch(e.data.command){case"init":case"subtitleSettings":case"ankiSettings":case"miscSettings":break;case"ready":var t,a=e.data,r=Object(u.a)(n.readyCallbacks);try{for(r.s();!(t=r.n()).done;){(0,t.value)(a.duration)}}catch(D){r.e(D)}finally{r.f()}break;case"play":var i,o=Object(u.a)(n.playCallbacks);try{for(o.s();!(i=o.n()).done;){(0,i.value)()}}catch(D){o.e(D)}finally{o.f()}break;case"pause":var c,s=Object(u.a)(n.pauseCallbacks);try{for(s.s();!(c=s.n()).done;){(0,c.value)()}}catch(D){s.e(D)}finally{s.f()}break;case"currentTime":var l,d=e.data,b=Object(u.a)(n.currentTimeCallbacks);try{for(b.s();!(l=b.n()).done;){(0,l.value)(d.value)}}catch(D){b.e(D)}finally{b.f()}break;case"audioTrackSelected":var f,h=e.data,j=Object(u.a)(n.audioTrackSelectedCallbacks);try{for(j.s();!(f=j.n()).done;){(0,f.value)(h.id)}}catch(D){j.e(D)}finally{j.f()}break;case"close":var v,p=Object(u.a)(n.closeCallbacks);try{for(p.s();!(v=p.n()).done;){(0,v.value)()}}catch(D){p.e(D)}finally{p.f()}break;case"subtitles":var g,O=e.data,m=Object(u.a)(n.subtitlesCallbacks);try{for(m.s();!(g=m.n()).done;){(0,g.value)(O.value)}}catch(D){m.e(D)}finally{m.f()}break;case"condensedModeToggle":var k,x=e.data,y=Object(u.a)(n.condensedModeToggleCallbacks);try{for(y.s();!(k=y.n()).done;){(0,k.value)(x.value)}}catch(D){y.e(D)}finally{y.f()}break;case"hideSubtitlePlayerToggle":var C,w=e.data,S=Object(u.a)(n.hideSubtitlePlayerToggleCallbacks);try{for(S.s();!(C=S.n()).done;){(0,C.value)(w.value)}}catch(D){S.e(D)}finally{S.f()}break;case"appBarToggle":var T,F=e.data,E=Object(u.a)(n.appBarToggleCallbacks);try{for(E.s();!(T=E.n()).done;){(0,T.value)(F.value)}}catch(D){E.e(D)}finally{E.f()}break;case"ankiDialogRequest":var M,R=Object(u.a)(n.ankiDialogRequestCallbacks);try{for(R.s();!(M=R.n()).done;){(0,M.value)()}}catch(D){R.e(D)}finally{R.f()}break;case"finishedAnkiDialogRequest":var I,P=e.data,A=Object(u.a)(n.finishedAnkiDialogRequestCallbacks);try{for(A.s();!(I=A.n()).done;){(0,I.value)(P.resume)}}catch(D){A.e(D)}finally{A.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(x.a)(e,[{key:"currentTime",get:function(){return this.time},set:function(e){var t;this.time=e,null===(t=this.channel)||void 0===t||t.postMessage({command:"currentTime",value:this.time,echo:!0})}},{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onClose",value:function(e){this.closeCallbacks.push(e)}},{key:"onReady",value:function(e){this.readyCallbacks.push(e)}},{key:"onSubtitles",value:function(e){this.subtitlesCallbacks.push(e)}},{key:"onCondensedModeToggle",value:function(e){this.condensedModeToggleCallbacks.push(e)}},{key:"onHideSubtitlePlayerToggle",value:function(e){this.hideSubtitlePlayerToggleCallbacks.push(e)}},{key:"onAppBarToggle",value:function(e){this.appBarToggleCallbacks.push(e)}},{key:"onAnkiDialogRequest",value:function(e){this.ankiDialogRequestCallbacks.push(e)}},{key:"onFinishedAnkiDialogRequest",value:function(e){this.finishedAnkiDialogRequestCallbacks.push(e)}},{key:"ready",value:function(e,t,n,a){var r,i={command:"ready",duration:e,paused:t,currentTime:0,audioTracks:n,selectedAudioTrack:a,playbackRate:1};null===(r=this.channel)||void 0===r||r.postMessage(i)}},{key:"readyState",value:function(e){var t,n={command:"readyState",value:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"play",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"play",echo:!0})}},{key:"pause",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"pause",echo:!0})}},{key:"audioTrackSelected",value:function(e){var t,n={command:"audioTrackSelected",id:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"offset",value:function(e){var t,n={command:"offset",value:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"popOutToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"popOutToggle"})}},{key:"copy",value:function(e,t,n){var a,r={command:"copy",subtitle:e,surroundingSubtitles:t,preventDuplicate:n};null===(a=this.channel)||void 0===a||a.postMessage(r)}},{key:"condensedModeToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"condensedModeToggle"})}},{key:"hideSubtitlePlayerToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"hideSubtitlePlayerToggle"})}},{key:"appBarToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"appBarToggle"})}},{key:"ankiDialogRequest",value:function(e){var t,n={command:"ankiDialogRequest",forwardToVideo:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"toggleSubtitleTrackInList",value:function(e){var t,n={command:"toggleSubtitleTrackInList",track:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"close",value:function(){this.channel&&(this.channel.postMessage({command:"exit"}),this.channel.close(),this.channel=void 0,this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.closeCallbacks=[],this.readyCallbacks=[],this.subtitlesCallbacks=[],this.condensedModeToggleCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.finishedAnkiDialogRequestCallbacks=[])}}]),e}(),Ya=Object(j.a)({root:{position:"relative",backgroundColor:"black",height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},video:{margin:"auto"},cursorHidden:{cursor:"none"}});function Za(e,t,n,a){if(window.outerWidth&&e.videoWidth>0&&e.videoHeight>0){var r=window.screen.availWidth-(window.outerWidth-window.innerWidth),i=window.screen.availHeight-(window.outerHeight-window.innerHeight),o=Math.min(1,Math.min(r/e.videoWidth,i/e.videoHeight));window.resizeTo(o*e.videoWidth+(window.outerWidth-window.innerWidth),o*e.videoHeight+(window.outerHeight-window.innerHeight))}var c,s;if(e.audioTracks){c=[];var l,d=Object(u.a)(e.audioTracks);try{for(d.s();!(l=d.n()).done;){var b=l.value;c.push({id:b.id,label:b.label,language:b.language}),b.enabled&&(s=b.id)}}catch(f){d.e(f)}finally{d.f()}}else c=void 0,s=void 0;n(c),a(s),t.ready(e.duration,e.paused,c,s)}function $a(e){var t=Ya(),n=e.settingsProvider,a=e.videoFile,r=e.channel,s=e.popOut,l=e.onError,h=Object(b.useRef)(),j=Object(b.useRef)(),v=g(!0),p=Object(c.a)(v,2),O=p[0],m=p[1];j.current&&(j.current.width=O,j.current.height=m);var k=Object(b.useMemo)((function(){return new Qa(r)}),[r]),x=Object(b.useState)(!1),y=Object(c.a)(x,2),C=y[0],w=y[1],T=function(){var e=Object(b.useState)(Boolean(document.fullscreenElement)),t=Object(c.a)(e,2),n=t[0],a=t[1];return Object(b.useEffect)((function(){var e=function(){return a(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",e),function(){return document.removeEventListener("fullscreenchange",e)}}),[]),n}(),F=Object(b.useRef)();F.current=T;var E=Object(b.useRef)();E.current=C;var M=Object(b.useState)(0),R=Object(c.a)(M,2),I=R[0],P=R[1],A=Object(b.useState)(0),D=Object(c.a)(A,2),_=D[0],N=D[1],B=Object(b.useState)(),L=Object(c.a)(B,2),U=L[0],W=L[1],H=Object(b.useState)(),q=Object(c.a)(H,2),z=q[0],V=q[1],J=Object(b.useState)([]),Q=Object(c.a)(J,2),Y=Q[0],Z=Q[1],$=Object(b.useState)([]),te=Object(c.a)($,2),ae=te[0],re=te[1],ie=Object(b.useState)(!0),oe=Object(c.a)(ie,2),ce=oe[0],se=oe[1],ue=Object(b.useState)({}),le=Object(c.a)(ue,2),de=le[0],be=le[1],fe=Object(b.useState)(!1),he=Object(c.a)(fe,2),je=he[0],ve=he[1],pe=Object(b.useState)(!1),ge=Object(c.a)(pe,2),Oe=ge[0],me=ge[1],ke=Object(b.useState)(n.theaterMode),xe=Object(c.a)(ke,2),ye=xe[0],Ce=xe[1],we=Object(b.useRef)([]);we.current=ae;var Se=Object(b.useMemo)((function(){return new Yt}),[]),Te=Object(b.useRef)({x:0,y:0}),Fe=Object(b.useState)(!1),Ee=Object(c.a)(Fe,2),Me=Ee[0],Re=Ee[1],Ie=Object(b.useRef)(0),Pe=Object(b.useRef)(null),Ae=Object(b.useState)(),De=Object(c.a)(Ae,2),_e=De[0],Ne=De[1],Be=Object(b.useState)(!1),Le=Object(c.a)(Be,2),Ue=Le[0],We=Le[1],He=Object(b.useState)(!1),qe=Object(c.a)(He,2),ze=qe[0],Ve=qe[1],Xe=Object(b.useRef)();Xe.current=ze;var Ke=Object(b.useCallback)((function(e){if(e){var t=e;j.current=t,4===t.readyState?Za(e,k,W,V):t.onloadeddata=function(t){Za(e,k,W,V)},t.oncanplay=function(e){k.readyState(4),E.current&&Se.start()},t.ontimeupdate=function(t){return Se.setTime(1e3*e.currentTime)},t.onerror=function(t){return l(function(e){var t,n,a;switch(null===(t=e.error)||void 0===t?void 0:t.code){case 1:a="Aborted";break;case 2:a="Network error";break;case 3:a="Decoding error";break;case 4:a="Source not supported";break;default:a="Unknown error"}return a+": "+((null===(n=e.error)||void 0===n?void 0:n.message)||"<details missing>")}(e))}}}),[Se,k,l]);function Ge(e){var t,n=null===(t=j.current)||void 0===t?void 0:t.audioTracks;if(n){var a,r=Object(u.a)(n);try{for(r.s();!(a=r.n()).done;){var i=a.value;i.id===e?i.enabled=!0:i.enabled=!1}}catch(o){r.e(o)}finally{r.f()}}}Object(b.useEffect)((function(){return k.onReady((function(e){return P(e)})),k.onPlay(Object(i.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=j.current)||void 0===t?void 0:t.play();case 2:Se.start(),w(!0);case 4:case"end":return e.stop()}}),e)})))),k.onPause((function(){var e;null===(e=j.current)||void 0===e||e.pause(),Se.stop(),w(!1)})),k.onCurrentTime((function(e){var t;j.current&&(j.current.currentTime=e),4===(null===(t=j.current)||void 0===t?void 0:t.readyState)&&k.readyState(4),Se.stop(),Se.setTime(1e3*e)})),k.onAudioTrackSelected((function(e){Ge(e),V(e),k.audioTrackSelected(e)})),k.onClose((function(){k.close(),window.close()})),k.onSubtitles((function(e){if(Z(e),e&&e.length>0){var t=e[0],n=t.start-t.originalStart;N(n)}})),k.onCondensedModeToggle((function(e){return ve(e)})),k.onHideSubtitlePlayerToggle((function(e){return me(e)})),k.onAppBarToggle((function(e){return Ce(e)})),k.onAnkiDialogRequest((function(){F.current&&!s&&(document.exitFullscreen(),Ve(!0))})),k.onFinishedAnkiDialogRequest(function(){var e=Object(i.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Xe.current){e.next=11;break}if(!t){e.next=10;break}return e.prev=2,e.next=5,null===(n=Pe.current)||void 0===n?void 0:n.requestFullscreen();case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.error(e.t0);case 10:Ve(!1);case 11:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}()),window.onbeforeunload=function(e){h.current||k.close()},function(){return k.close()}}),[Se,k,s]);var Je=Object(b.useCallback)((function(){j.current&&k.play()}),[k]),Qe=Object(b.useCallback)((function(){return k.pause()}),[k]),Ye=Object(b.useCallback)((function(e){E.current&&Se.stop();var t=e*I;k.currentTime=t/1e3}),[I,Se,k]);var Ze=Object(b.useCallback)((function(e){E.current&&(Se.stop(),k.pause()),Ge(e),V(e),k.currentTime=0,k.audioTrackSelected(e)}),[k,Se]);Object(b.useEffect)((function(){if(Y&&0!==Y.length){var e=setInterval((function(){for(var e=Se.time(I),t=[],n=0;n<Y.length;++n){var a=Y[n];if(e>=a.start&&e<a.end&&!de[a.track]&&t.push(Object(o.a)(Object(o.a)({},a),{},{index:n})),e<a.start)break}(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};if(e.length!==t.length)return!1;for(var a=0;a<e.length;++a)if(!n(e[a],t[a]))return!1;return!0})(t=t.sort((function(e,t){return e.track-t.track})),we.current,(function(e,t){return e.index===t.index}))||re(t)}),50);return function(){return clearTimeout(e)}}}),[Y,de,Se,I]);var $e=Object(b.useCallback)((function(e){N(e),Z((function(t){return t.map((function(t){return{text:t.text,start:t.originalStart+e,originalStart:t.originalStart,end:t.originalEnd+e,originalEnd:t.originalEnd,track:t.track}}))})),k.offset(e)}),[k]);Object(b.useEffect)((function(){var e=S.bindSeekToSubtitle((function(e,t){e.stopPropagation(),e.preventDefault(),k.currentTime=t.start/1e3}),(function(){return!j.current}),(function(){return Se.time(I)}),(function(){return Y}));return function(){return e()}}),[k,Y,I,Se]);var et=Object(b.useCallback)((function(e){return K(Y,e,n.surroundingSubtitlesCountRadius,n.surroundingSubtitlesTimeRadius)}),[Y,n.surroundingSubtitlesCountRadius,n.surroundingSubtitlesTimeRadius]);Object(b.useEffect)((function(){var e=S.bindCopy((function(e,t){e.stopPropagation(),e.preventDefault();var n=!Y||0===Y.length;k.copy(t,n?G(t,I,5e3):et(t.index)),T&&(Ne(""===t.text?"Saved ".concat(X(t.start)):'Copied: "'.concat(t.text,'"')),We(!0))}),(function(){return!1}),(function(){if(!Y||0===Y.length){var e=Se.time(I),t=Math.min(e+5e3,I);return{text:"",start:e,originalStart:e,end:t,originalEnd:t,track:0,index:0}}if(we.current&&0!==we.current.length)return we.current[0]}));return function(){return e()}}),[k,Se,I,Y,et,T]),Object(b.useEffect)((function(){var e=S.bindAdjustOffset((function(e,t){e.preventDefault(),e.stopPropagation(),$e(t)}),(function(){return!1}),(function(){return Y}));return function(){return e()}}),[$e,Y]),Object(b.useEffect)((function(){var e=S.bindToggleSubtitles((function(e){e.preventDefault(),e.stopPropagation(),se((function(e){return!e}))}),(function(){}),(function(){return!1}));return function(){return e()}}),[]),Object(b.useEffect)((function(){var e=S.bindToggleSubtitleTrackInVideo((function(e,t){e.preventDefault(),e.stopPropagation(),be((function(e){var n=Object(o.a)({},e);return n[t]=!e[t],n}))}),(function(){}),(function(){return!1}));return function(){return e()}}),[]),Object(b.useEffect)((function(){var e=S.bindToggleSubtitleTrackInList((function(e,t){e.preventDefault(),e.stopPropagation(),k.toggleSubtitleTrackInList(t)}),(function(){}),(function(){return!1}));return function(){return e()}}),[k]),Object(b.useEffect)((function(){var e=S.bindOffsetToSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),$e(t)}),(function(){return!1}),(function(){return Se.time(I)}),(function(){return Y}));return function(){return e()}}),[$e,Y,Se,I]),Object(b.useEffect)((function(){var e=S.bindAnkiExport((function(e){if(e.preventDefault(),e.stopPropagation(),Y&&0!==Y.length){if(we.current&&we.current.length>0){var t=we.current[0];k.copy(t,et(t.index),!0)}}else{var n=Se.time(I),a=Math.min(n+5e3,I),r={text:"",start:n,originalStart:n,end:a,originalEnd:a,track:0};k.copy(r,G(r,I,5e3),!1)}k.ankiDialogRequest(T)}),(function(){return!1}));return function(){return e()}}),[k,Y,Se,I,et,T]),Object(b.useEffect)((function(){var e=S.bindPlay((function(e){e.preventDefault(),C?k.pause():k.play()}),(function(){return!1}));return function(){return e()}}),[C,k]);var tt=Object(b.useCallback)((function(){return se((function(e){return!e}))}),[]),nt=Object(b.useCallback)((function(){var e;T?document.exitFullscreen():null===(e=Pe.current)||void 0===e||e.requestFullscreen()}),[T]),at=Object(b.useCallback)((function(e){j.current&&(j.current.volume=e)}),[]),rt=Object(b.useCallback)((function(){k.popOutToggle(),s&&(h.current=!0,window.close())}),[k,s]),it=Object(b.useCallback)((function(){k.condensedModeToggle()}),[k]),ot=Object(b.useCallback)((function(){k.close(),window.close()}),[k]),ct=Object(b.useCallback)((function(){k.hideSubtitlePlayerToggle()}),[k]),st=Object(b.useCallback)((function(){k.appBarToggle()}),[k]),ut=Object(b.useCallback)((function(){C?k.pause():k.play()}),[k,C]),lt=Object(b.useCallback)((function(){return nt()}),[nt]),dt=Object(b.useCallback)((function(){return We(!1)}),[]),bt=n.subtitleSettings,ft=bt.subtitleSize,ht=bt.subtitleColor,jt=bt.subtitleOutlineThickness,vt=bt.subtitleOutlineColor,pt=bt.subtitleBackgroundColor,gt=bt.subtitleBackgroundOpacity,Ot=bt.subtitleFontFamily,mt=Object(b.useMemo)((function(){return e={subtitleSize:ft,subtitleColor:ht,subtitleOutlineThickness:jt,subtitleOutlineColor:vt,subtitleBackgroundColor:pt,subtitleBackgroundOpacity:gt,subtitleFontFamily:Ot},Object(o.a)({position:"absolute",paddingLeft:20,paddingRight:20,bottom:100,textAlign:"center"},St(e));var e}),[ft,ht,jt,vt,pt,gt,Ot]);return Object(b.useEffect)((function(){var e=setInterval((function(){Date.now()-Ie.current>300?Me&&Re(!1):Me||Re(!0)}),100);return function(){return clearInterval(e)}}),[Me]),Object(ee.jsxs)("div",{ref:Pe,onMouseMove:function(e){if(Ie.current=Date.now(),Pe.current){var t=Pe.current.getBoundingClientRect();Te.current.x=e.clientX-t.left,Te.current.y=e.clientY-t.top}},className:t.root,children:[Object(ee.jsx)("video",{preload:"auto",controls:!1,onClick:ut,onDoubleClick:lt,className:Me?t.video:"".concat(t.cursorHidden," ").concat(t.video),ref:Ke,src:a}),ce&&Object(ee.jsx)("div",{style:mt,children:ae.map((function(e){return Object(ee.jsxs)(f.a.Fragment,{children:[e.text,Object(ee.jsx)("br",{})]},e.index)}))}),T&&Object(ee.jsx)(ne,{open:Ue,onClose:dt,autoHideDuration:3e3,severity:"success",children:_e}),Object(ee.jsx)(Ln,{mousePositionRef:Te,playing:C,clock:Se,length:I,audioTracks:U,selectedAudioTrack:z,subtitlesToggle:Y&&Y.length>0,subtitlesEnabled:ce,offsetEnabled:!0,offset:_,fullscreenEnabled:!0,fullscreen:T,closeEnabled:!s,popOut:s,volumeEnabled:!0,popOutEnabled:!Ja.isMobile,condensedModeToggleEnabled:!0,condensedModeEnabled:je,hideSubtitlePlayerToggleEnabled:(null===Y||void 0===Y?void 0:Y.length)>0&&!s&&!T,subtitlePlayerHidden:Oe,onPlay:Je,onPause:Qe,onSeek:Ye,onAudioTrackSelected:Ze,onSubtitlesToggle:tt,onFullscreenToggle:nt,onVolumeChange:at,onOffsetChange:$e,onPopOutToggle:rt,onCondensedModeToggle:it,onClose:ot,onHideSubtitlePlayerToggle:ct,settingsProvider:n,showOnMouseMovement:!1,theaterModeToggleEnabled:!0,theaterModeEnabled:ye,onTheaterModeToggle:st})]})}var er="https://github.com/killergerbah/asbplayer/releases/latest",tr=Object(j.a)((function(e){return{content:{flexGrow:1,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginRight:0},contentShift:function(t){var n=t.drawerWidth;return{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:n}}}}));function nr(e,t,n,a){if(e.audio){var r,i,o,c,s=null!==(r=e.audio.start)&&void 0!==r?r:e.start,u=null!==(i=e.audio.end)&&void 0!==i?i:e.end;return N.fromBase64(e.subtitleFile.name,Math.max(0,s-(null!==(o=e.audio.paddingStart)&&void 0!==o?o:0)),u+(null!==(c=e.audio.paddingEnd)&&void 0!==c?c:0),e.audio.base64,e.audio.extension)}var l,d;if(e.audioFile||e.videoFile)return t?(l=t.subtitleStart,d=t.subtitleEnd):(l=e.start,d=e.end),N.fromFile(e.audioFile||e.videoFile,Math.max(0,l-n),d+a,e.audioTrack)}function ar(e,t,n){return e.image?W.fromBase64(e.subtitleFile.name,e.start,e.image.base64,e.image.extension):e.videoFile?W.fromFile(e.videoFile,e.start,t,n):void 0}function rr(e){var t,n,a,r,i;if(e){var o=null!==(t=null!==(n=null===(a=e.subtitleFile)||void 0===a?void 0:a.name)&&void 0!==n?n:null===(r=e.audioFile)||void 0===r?void 0:r.name)&&void 0!==t?t:null===(i=e.videoFile)||void 0===i?void 0:i.name;if(o)return"".concat(o," (").concat(X(e.start),")")}}function ir(e){var t=tr(e);return Object(ee.jsx)("main",{className:Object(Y.a)(t.content,Object(s.a)({},t.contentShift,e.drawerOpen)),children:e.children})}var or=function(){var e=Object(b.useMemo)((function(){return new st}),[]),t=Object(b.useMemo)((function(){return new Ga}),[]),n=Object(b.useMemo)((function(){return Object(v.a)({palette:{primary:{main:"#49007a"},secondary:{main:"#ff1f62"},error:{main:m.a.A400},type:t.themeType}})}),[t.themeType]),a=Object(b.useMemo)((function(){return new V(t)}),[t]),r="/video"===Object(h.g)().pathname,s=Object(b.useMemo)((function(){return new wt(!r)}),[r]),l=Object(b.useRef)(null),f=g(!r),j=Object(c.a)(f,1)[0],O=l.current?.2:.3,k=l.current?150:300,x=Math.max(k,j*O),y=Object(b.useState)([]),C=Object(c.a)(y,2),w=C[0],S=C[1],T=Object(b.useRef)([]);T.current=w;var F=Object(b.useState)(!1),E=Object(c.a)(F,2),M=E[0],R=E[1],I=Object(b.useState)(t.theaterMode),P=Object(c.a)(I,2),A=P[0],D=P[1],_=Object(b.useState)(),N=Object(c.a)(_,2),B=N[0],L=N[1],U=Object(b.useState)(!1),W=Object(c.a)(U,2),H=W[0],q=W[1],z=Object(b.useState)(),K=Object(c.a)(z,2),G=K[0],J=K[1],Y=Object(b.useState)(),Z=Object(c.a)(Y,2),$=Z[0],te=Z[1],ae=Object(b.useState)({subtitleFiles:[]}),re=Object(c.a)(ae,2),ie=re[0],oe=re[1],ce=Object(b.useState)(!1),se=Object(c.a)(ce,2),ue=se[0],le=se[1],de=Object(b.useState)(!1),fe=Object(c.a)(de,2),he=fe[0],je=fe[1],ve=Object(b.useRef)(null),pe=Object(b.useState)(),ge=Object(c.a)(pe,2),Oe=ge[0],me=ge[1],ke=Object(b.useState)(!1),xe=Object(c.a)(ke,2),ye=xe[0],Ce=xe[1],we=Object(b.useState)(!1),Se=Object(c.a)(we,2),Te=Se[0],Fe=Se[1],Ee=Object(b.useState)(),Me=Object(c.a)(Ee,2),Re=Me[0],Ie=Me[1],Pe=Object(b.useMemo)((function(){return Re&&function(e){if(e)return{subtitleStart:e.start,subtitleEnd:e.end,subtitles:e.surroundingSubtitles||[{start:e.start,end:e.end,text:e.text,track:e.track}]}}(Re)}),[Re]),Ae=Object(b.useMemo)((function(){return Re&&nr(Re,Pe,t.audioPaddingStart,t.audioPaddingEnd)}),[Re,Pe,t.audioPaddingStart,t.audioPaddingEnd]),De=Object(b.useMemo)((function(){return Re&&ar(Re,t.maxImageWidth,t.maxImageHeight)}),[Re,t.maxImageWidth,t.maxImageHeight]),_e=Object(b.useState)(),Le=Object(c.a)(_e,2),Ue=Le[0],We=Le[1],qe=Object(b.useState)(!1),ze=Object(c.a)(qe,2),Ve=ze[0],Xe=ze[1],Ke=Object(b.useState)({timestamp:0,resume:!1}),Ge=Object(c.a)(Ke,2),Je=Ge[0],Qe=Ge[1],Ye=Object(b.useState)(!1),Ze=Object(c.a)(Ye,2),$e=Ze[0],tt=Ze[1],nt=Object(b.useState)(!1),at=Object(c.a)(nt,2),rt=at[0],it=at[1],ot=Object(b.useState)(!1),ct=Object(c.a)(ot,2),ut=ct[0],lt=ct[1],dt=Object(b.useState)(!1),bt=Object(c.a)(dt,2),ft=bt[0],ht=bt[1],jt=Object(b.useState)(),vt=Object(c.a)(jt,2),pt=vt[0],gt=vt[1],Ot=Object(b.useState)(),mt=Object(c.a)(Ot,2),kt=mt[0],xt=mt[1],yt=Object(b.useState)([]),St=Object(c.a)(yt,2),Tt=St[0],Ft=St[1],Et=Object(b.useRef)(null),Mt=ie.subtitleFiles,Rt=Object(b.useCallback)((function(e,t,n,a,r,i,c,s,l,d,b){e&&navigator.clipboard.writeText(e.text),S((function(f){if(d&&f.length>0){var h,j=f[f.length-1];if(e.start===j.start&&e.end===j.end&&e.text===j.text&&(null===r||void 0===r?void 0:r.name)===(null===(h=j.subtitleFile)||void 0===h?void 0:h.name))return f}var v,p=[],g=!1,O=Object(u.a)(f);try{for(O.s();!(v=O.n()).done;){var m=v.value;if(b&&m.id===b){var k=Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)({},m),e),t&&{surroundingSubtitles:t}),r&&{subtitleFile:r}),n&&{audioFile:n}),a&&{videoFile:a}),i&&{audioTrack:i}),c&&{audio:c}),s&&{image:s}),l&&{url:l});p.push(k),g=!0}else p.push(m)}}catch(x){O.e(x)}finally{O.f()}return g||p.push(Object(o.a)(Object(o.a)({},e),{},{surroundingSubtitles:t,timestamp:Date.now(),id:b||Object(Q.a)(),name:Oe,subtitleFile:r,audioFile:n,videoFile:a,audioTrack:i,audio:c,image:s,url:l})),p})),e&&(J("success"),L(""===e.text?"Saved ".concat(X(e.start)):'Copied: "'.concat(e.text,'"')),q(!0))}),[Oe]),It=Object(b.useCallback)((function(){return R((function(e){return!e}))}),[]),Pt=Object(b.useCallback)((function(){return R(!1)}),[]),At=Object(b.useCallback)((function(){t.theaterMode=!t.theaterMode,D(t.theaterMode)}),[t]),Dt=Object(b.useCallback)((function(){ht(!0),tt(!0)}),[]),_t=Object(b.useCallback)((function(){return it(!0)}),[]),Nt=Object(b.useCallback)((function(){return it(!1)}),[]),Bt=Object(b.useCallback)((function(){return q(!1)}),[]),Lt=Object(b.useCallback)((function(){return lt(!1)}),[]),Ut=Object(b.useCallback)((function(e){t.settings=e,tt(!1),ht(!1);var n={command:"subtitleSettings",value:t.subtitleSettings},a={command:"ankiSettings",value:t.ankiSettings},r={command:"miscSettings",value:t.miscSettings};s.publishMessage(n),s.publishMessage(a),s.publishMessage(r)}),[s,t]),Wt=Object(b.useCallback)((function(e){var t,n=[],a=Object(u.a)(w);try{for(a.s();!(t=a.n()).done;){var r=t.value;e.id!==r.id&&n.push(r)}}catch(i){a.e(i)}finally{a.f()}S(n)}),[w]),Ht=Object(b.useCallback)((function(e){J("error"),L(e),q(!0)}),[]),qt=Object(b.useCallback)((function(e){e===ie.audioFileUrl&&oe((function(t){return URL.revokeObjectURL(e),{subtitleFiles:t.subtitleFiles,audioFile:void 0,audioFileUrl:void 0,videoFile:t.videoFile,videoFileUrl:t.videoFileUrl}}))}),[ie]),Vt=Object(b.useCallback)((function(e){e===ie.videoFileUrl&&oe((function(t){return URL.revokeObjectURL(e),{subtitleFiles:t.subtitleFiles,audioFile:t.audioFile,audioFileUrl:t.audioFileUrl,videoFile:void 0,videoFileUrl:void 0}}))}),[ie]),Xt=Object(b.useCallback)(function(){var e=Object(i.a)(d.a.mark((function e(n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,nr(n,void 0,t.audioPaddingStart,t.audioPaddingEnd);case 3:a=e.sent,t.preferMp3?a.toMp3().download():a.download(),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0),e.t0 instanceof Error?Ht(e.t0.message):Ht(String(e.t0));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),[Ht,t]),Kt=Object(b.useCallback)(function(){var e=Object(i.a)(d.a.mark((function e(n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ar(n,t.maxImageWidth,t.maxImageHeight);case 3:e.sent.download(),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),console.error(e.t0),e.t0 instanceof Error?Ht(e.t0.message):Ht(String(e.t0));case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),[Ht,t]),Jt=Object(b.useCallback)((function(e){0!==Mt.filter((function(t){return t.name===e.subtitleFile.name})).length?te(e):Ht("Subtitle file "+e.subtitleFile.name+" is not open.")}),[Mt,Ht]),Qt=Object(b.useCallback)((function(e){Ie(e),Ce(!0),Fe(!1),ht(!0)}),[]),Yt=Object(b.useCallback)((function(){Ce(!1),Fe(!1),ht(!1),Ve&&(Qe({timestamp:Date.now(),resume:!0}),Xe(!1))}),[Ve]),Zt=Object(b.useCallback)(function(){var e=Object(i.a)(d.a.mark((function e(t,n,r,i,o,c,s,u,l,b){var f;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Fe(!0),e.prev=1,e.next=4,a.export(t,n,r,i,o,c,s,u,l,b);case 4:f=e.sent,"gui"!==b&&("default"===b?(J("success"),L("Export succeeded: "+f),q(!0)):"updateLast"===b&&(J("success"),L("Update succeeded: "+f),q(!0)),Ce(!1),Ve&&(Qe({timestamp:Date.now(),resume:!0}),Xe(!1))),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.t0 instanceof Error?Ht(e.t0.message):Ht(String(e.t0));case 12:return e.prev=12,Fe(!1),ht(!1),e.finish(12);case 16:case"end":return e.stop()}}),e,null,[[1,8,12,16]])})));return function(t,n,a,r,i,o,c,s,u,l){return e.apply(this,arguments)}}(),[a,Ht,Ve]),$t=Object(b.useCallback)((function(e){if(0!==T.current.length){var t=T.current[T.current.length-1];Ie(t),Ce(!0),Fe(!1),ht(!0),Xe(!0),e&&We(Date.now())}}),[]),en=Object(b.useCallback)((function(e){gt(e),lt(!0)}),[]);Object(b.useEffect)((function(){function e(e){if(e.length!==Tt.length)Ft(e);else{for(var t=!1,n=0;n<Tt.length;++n){var a=Tt[n],r=e[n];if(a.id!==r.id||a.title!==r.title||a.src!==r.src){t=!0;break}}t&&Ft(e)}kt&&0===e.filter((function(e){return e.id===kt.id&&e.src===kt.src})).length&&(xt(void 0),Ht("Lost connection with tab "+kt.id+" "+kt.title))}return s.subscribeTabs(e),function(){return s.unsubscribeTabs(e)}}),[Tt,kt,s,Ht]);var tn=Object(b.useCallback)((function(e){return xt(e)}),[]),nn=Object(b.useCallback)((function(e){try{var t=function(e){var t,n=[],a=void 0,r=void 0,i=Object(u.a)(e);try{for(i.s();!(t=i.n()).done;){var o=t.value,c=o.name.lastIndexOf(".");if(-1===c)throw new Error("Unable to determine extension of "+o.name);var s=o.name.substring(c+1,o.name.length);switch(s){case"ass":case"srt":case"vtt":n.push(o);break;case"mkv":case"mp4":case"avi":if(r)throw new Error("Cannot open two video files simultaneously");r=o;break;case"mp3":case"m4a":case"aac":case"flac":case"ogg":case"wav":case"opus":if(a)throw new Error("Cannot open two audio files simultaneously");a=o;break;default:throw new Error("Unsupported extension "+s)}}}catch(l){i.e(l)}finally{i.f()}if(r&&a)throw new Error("Cannot load both an audio and video file simultaneously");return{subtitleFiles:n,audioFile:a,videoFile:r}}(e),n=t.subtitleFiles,a=t.audioFile,r=t.videoFile;if(oe((function(e){le(!0);var t=void 0,i=void 0;return r||a?(!function(e){e.audioFileUrl&&URL.revokeObjectURL(e.audioFileUrl),e.videoFileUrl&&URL.revokeObjectURL(e.videoFileUrl)}(e),r?t=URL.createObjectURL(r):a&&(i=URL.createObjectURL(a)),xt(void 0)):(r=e.videoFile,t=e.videoFileUrl,a=e.audioFile,i=e.audioFileUrl),{subtitleFiles:0===n.length?e.subtitleFiles:n,audioFile:a,audioFileUrl:i,videoFile:r,videoFileUrl:t}})),n.length>0){var i=n[0].name;me(i.substring(0,i.lastIndexOf(".")))}}catch(o){console.error(o),o instanceof Error?Ht(o.message):Ht(String(o))}}),[Ht]);Object(b.useEffect)((function(){function e(e){return t.apply(this,arguments)}function t(){return t=Object(i.a)(d.a.mark((function e(t){var n,a,r,o,c,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("sync"!==t.data.command&&"syncv2"!==t.data.command){e.next=33;break}if(0!==(n=Tt.filter((function(e){return e.id===t.tabId&&(!t.src||e.src===t.src)}))).length){e.next=5;break}return t.src?console.error("Received sync request but the requesting tab ID "+t.tabId+" with src "+t.src+" was not found"):console.error("Received sync request but the requesting tab ID "+t.tabId+" was not found"),e.abrupt("return");case 5:if(a=n[0],"sync"!==t.data.command){e.next=20;break}return o=t.data,e.t0=File,e.next=11,fetch("data:text/plain;base64,"+o.subtitles.base64);case 11:return e.next=13,e.sent.blob();case 13:e.t1=e.sent,e.t2=[e.t1],e.t3=o.subtitles.name,e.t4=new e.t0(e.t2,e.t3),r=[e.t4],e.next=29;break;case 20:if("syncv2"!==t.data.command){e.next=27;break}return c=t.data,e.next=24,Promise.all(c.subtitles.map(function(){var e=Object(i.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=File,e.next=3,fetch("data:text/plain;base64,"+t.base64);case 3:return e.next=5,e.sent.blob();case 5:return e.t1=e.sent,e.t2=[e.t1],e.t3=t.name,e.abrupt("return",new e.t0(e.t2,e.t3));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 24:r=e.sent,e.next=29;break;case 27:return console.error("Unknown message "+t.data.command),e.abrupt("return");case 29:s=r[0].name,me(s.substring(0,s.lastIndexOf("."))),oe({subtitleFiles:r,audioFile:void 0,audioFileUrl:void 0,videoFile:void 0,videoFileUrl:void 0}),xt(a);case 33:case"end":return e.stop()}}),e)}))),t.apply(this,arguments)}return s.subscribe(e),function(){return s.unsubscribe(e)}}),[s,Tt]);var an=Object(b.useCallback)((function(e){e.preventDefault(),r?Ht("Video player cannot receive dropped files. Drop outside of the video frame instead."):(je(!1),ve.current=null,e.dataTransfer.files&&0!==e.dataTransfer.files.length&&nn(e.dataTransfer.files))}),[r,Ht,nn]),rn=Object(b.useCallback)((function(){var e,t=null===(e=Et.current)||void 0===e?void 0:e.files;t&&t.length>0&&nn(t)}),[nn]),on=Object(b.useCallback)((function(){var e;return null===(e=Et.current)||void 0===e?void 0:e.click()}),[]),cn=Object(b.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),r||(ve.current=e.target,je(!0))}),[r]),sn=Object(b.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),r||ve.current!==e.target||je(!1)}),[r]),un=Object(b.useCallback)((function(){return le(!1)}),[]),ln=ue&&!l.current||0===ie.subtitleFiles.length&&!ie.audioFile&&!ie.videoFile,dn=void 0!==ie.videoFile&&A;return Object(ee.jsxs)(p.a,{theme:n,children:[Object(ee.jsx)(Be.a,{}),Object(ee.jsxs)("div",{onDrop:an,onDragOver:function(e){return e.preventDefault()},onDragEnter:cn,onDragLeave:sn,children:[Object(ee.jsx)(ne,{open:H,onClose:Bt,autoHideDuration:3e3,severity:G,children:B}),Object(ee.jsxs)(h.d,{children:[Object(ee.jsx)(h.b,{exact:!0,path:"/",render:function(){var n=new URLSearchParams(window.location.search),r=n.get("video"),i=n.get("channel"),o=n.get("popout");return r&&i?Object(ee.jsx)(h.a,{to:"/video?video="+encodeURIComponent(r)+"&channel="+i+"&popout="+o}):Object(ee.jsxs)("div",{children:[Object(ee.jsx)(zt,{items:w,open:M,drawerWidth:x,onClose:Pt,onDelete:Wt,onClipAudio:Xt,onDownloadImage:Kt,onSelect:Jt,onAnki:Qt}),Object(ee.jsx)(Ne,{open:ye,disabled:Te,text:null===Re||void 0===Re?void 0:Re.text,audioClip:Ae,image:De,source:rr(Re),url:null===Re||void 0===Re?void 0:Re.url,sliderContext:Pe,customFields:t.customAnkiFields,anki:a,settingsProvider:t,onCancel:Yt,onProceed:Zt,onViewImage:en,onOpenSettings:Dt}),Object(ee.jsx)(be,{open:ut,image:pt,onClose:Lt}),Object(ee.jsx)(Oa,{anki:a,open:$e,onClose:Ut,settings:t.settings}),Object(ee.jsx)(et,{open:rt,extensionUrl:er,onClose:Nt}),Object(ee.jsx)(Ct,{title:Oe||"asbplayer",drawerWidth:x,drawerOpen:M,hidden:dn,onOpenCopyHistory:It,onOpenSettings:Dt,onOpenHelp:_t,onFileSelector:on}),Object(ee.jsx)("input",{ref:Et,onChange:rn,type:"file",accept:".srt,.ass,.vtt,.mp3,.m4a,.aac,.flac,.ogg,.wav,.opus,.mkv,.mp4,.avi",multiple:!0,hidden:!0}),Object(ee.jsxs)(ir,{drawerWidth:x,drawerOpen:M,children:[ln&&Object(ee.jsx)(Gt,{latestExtensionVersion:"0.17.0",extensionUrl:er,extension:s,loading:ue,dragging:he,appBarHidden:dn,onFileSelector:on}),Object(ee.jsx)(He,{dragging:he,appBarHidden:dn,loading:ue}),Object(ee.jsx)($n,{subtitleReader:e,settingsProvider:t,onCopy:Rt,onError:Ht,onUnloadAudio:qt,onUnloadVideo:Vt,onLoaded:un,onTabSelected:tn,onAnkiDialogRequest:$t,onAppBarToggle:At,tab:kt,availableTabs:Tt,sources:ie,jumpToSubtitle:$,videoFrameRef:l,extension:s,drawerOpen:M,appBarHidden:dn,disableKeyEvents:ft,ankiDialogRequested:Ve,ankiDialogRequestToVideo:Ue,ankiDialogFinishedRequest:Je})]})]})}}),Object(ee.jsx)(h.b,{exact:!0,path:"/video",render:function(){var e=new URLSearchParams(window.location.search),n=e.get("video"),a=e.get("channel"),r="true"===e.get("popout");return Object(ee.jsx)($a,{settingsProvider:t,videoFile:n,popOut:r,channel:a,onError:Ht})}})]})]})]})},cr=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,363)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),a(e),r(e),i(e),o(e)}))},sr=n(108);r.a.render(Object(ee.jsx)(sr.a,{basename:"/asbplayer",forceRefresh:!1,children:Object(ee.jsx)(or,{})}),document.querySelector("#root")),cr()}},[[273,1,2]]]);
//# sourceMappingURL=main.780545fe.chunk.js.map