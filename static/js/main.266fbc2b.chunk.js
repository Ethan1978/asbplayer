(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{218:function(e,t){},220:function(e,t){},239:function(e,t){},241:function(e,t){},249:function(e,t){},251:function(e,t){},264:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n(0),i=n.n(r),c=n(17),o=n.n(c),s=n(344),u=n(343),l=n(4),d=n.n(l),b=n(9),f=n(35),h=n(34),j=n(6),p=n(52),O=n(12),v=n(24),g=n(310);function m(e){var t=Object(r.useState)([0,0]),n=Object(j.a)(t,2),a=n[0],i=n[1];return Object(r.useLayoutEffect)((function(){function t(){e&&i([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",t),t(),function(){return window.removeEventListener("resize",t)}}),[e]),a}var k=n(5),x=n(346),y=n(265),w=Object(g.a)({root:{display:"flex",justifyContent:"center",position:"fixed",top:80,width:"100%",pointerEvents:"none",zIndex:2e3}});function C(e){var t=w();return Object(r.useEffect)((function(){if(e.open){var t=setTimeout(e.onClose,e.autoHideDuration);return function(){return clearTimeout(t)}}return null}),[e.open,e.autoHideDuration,e.onClose]),Object(a.jsx)("div",{className:t.root,children:Object(a.jsx)(y.a,{in:e.open,children:Object(a.jsx)(x.a,{severity:e.severity,children:e.children})})})}var S=n(15),T=n(16),F=['"',"*","_","\\",":"],E=function(){function e(t){Object(S.a)(this,e),this.settingsProvider=t}return Object(T.a)(e,[{key:"deckNames",value:function(){var e=Object(b.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("deckNames",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelNames",value:function(){var e=Object(b.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("modelNames",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelFieldNames",value:function(){var e=Object(b.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("modelFieldNames",{modelName:t},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findNotesWithWord",value:function(){var e=Object(b.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("findNotes",{query:this.settingsProvider.wordField+":"+this._escapeQuery(t)},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findNotesWithWordGui",value:function(){var e=Object(b.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("guiBrowse",{query:this.settingsProvider.wordField+":"+this._escapeQuery(t)},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_escapeQuery",value:function(e){for(var t="",n=0;n<e.length;++n){var a=e[n];F.includes(a)?t+="\\".concat(a):t+=a}return'"'.concat(t,'"')}},{key:"export",value:function(){var e=Object(b.a)(d.a.mark((function e(t,n,a,r,i,c,o,s,u){var l,b,f,h,j,p,O,v;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l={},this._appendField(l,this.settingsProvider.sentenceField,t,!0),this._appendField(l,this.settingsProvider.definitionField,n,!0),this._appendField(l,this.settingsProvider.wordField,i,!1),this._appendField(l,this.settingsProvider.sourceField,c,!1),o)for(b=0,f=Object.keys(o);b<f.length;b++)h=f[b],this._appendField(l,this.settingsProvider.customAnkiFields[h],o[h],!1);if(j={note:{deckName:this.settingsProvider.deck,modelName:this.settingsProvider.noteType,options:{allowDuplicate:!1,duplicateScope:"deck",duplicateScopeOptions:{deckName:this.settingsProvider.deck,checkChildren:!1}}}},!this.settingsProvider.audioField||!a){e.next=27;break}if(!s){e.next=21;break}return e.t0=this,e.t1=a.name,e.next=13,a.base64();case 13:return e.t2=e.sent,e.t3=u,e.next=17,e.t0._storeMediaFile.call(e.t0,e.t1,e.t2,e.t3);case 17:p=e.sent.result,this._appendField(l,this.settingsProvider.audioField,"[sound:".concat(p,"]"),!1),e.next=27;break;case 21:return e.t4=a.name,e.next=24,a.base64();case 24:e.t5=e.sent,e.t6=[this.settingsProvider.audioField],j.note.audio={filename:e.t4,data:e.t5,fields:e.t6};case 27:if(!this.settingsProvider.imageField||!r){e.next=47;break}if(!s){e.next=41;break}return e.t7=this,e.t8=r.name,e.next=33,r.base64();case 33:return e.t9=e.sent,e.t10=u,e.next=37,e.t7._storeMediaFile.call(e.t7,e.t8,e.t9,e.t10);case 37:O=e.sent.result,this._appendField(l,this.settingsProvider.imageField,'<div><img src="'.concat(O,'"></div>'),!1),e.next=47;break;case 41:return e.t11=r.name,e.next=44,r.base64();case 44:e.t12=e.sent,e.t13=[this.settingsProvider.imageField],j.note.picture={filename:e.t11,data:e.t12,fields:e.t13};case 47:return j.note.fields=l,e.next=50,this._executeAction(s?"guiAddCards":"addNote",j,u);case 50:return v=e.sent,e.abrupt("return",v.result);case 52:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r,i,c,o,s,u){return e.apply(this,arguments)}}()},{key:"_appendField",value:function(e,t,n,a){if(t&&n){var r=a?n.split("\n").join("<br>"):n,i=e[t];i&&(r=i+"<br>"+r),e[t]=r}}},{key:"_storeMediaFile",value:function(){var e=Object(b.a)(d.a.mark((function e(t,n,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAction("storeMediaFile",{filename:t,data:n},a));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"_executeAction",value:function(){var e=Object(b.a)(d.a.mark((function e(t,n,a){var r,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={action:t,version:6},n&&(r.params=n),e.next=4,fetch(a||this.settingsProvider.ankiConnectUrl,{method:"POST",body:JSON.stringify(r)});case 4:return i=e.sent,e.next=7,i.json();case 7:if(!(c=e.sent).error){e.next=10;break}throw new Error(c.error);case 10:return e.abrupt("return",c);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()}]),e}(),M=n(274),R=n(324),I=n(319),P=n(315),N=n(323),A=n(318),U=n(314),_=n(322),B=n(154),L=n.n(B),D=n(95),W=n.n(D),z=n(317),H=n(348),V=n(55),G=Object(M.a)((function(e){return{root:{"& .MuiTextField-root":{marginBottom:e.spacing(1)}},title:{flexGrow:1},mediaField:{cursor:"pointer","& input":{cursor:"pointer"}}}}));function X(e){var t=e.open,n=e.disabled,i=e.text,c=e.onProceed,o=e.onCancel,s=e.onViewImage,u=e.onOpenSettings,l=e.audioClip,f=e.image,h=e.source,p=e.customFields,O=e.settingsProvider,v=e.anki,g=G(),m=Object(r.useState)(""),k=Object(j.a)(m,2),x=k[0],y=k[1],w=Object(r.useState)(),C=Object(j.a)(w,2),S=C[0],T=C[1],F=Object(r.useState)(),E=Object(j.a)(F,2),M=E[0],B=E[1],D=Object(r.useState)(),X=Object(j.a)(D,2),K=X[0],J=X[1],q=Object(r.useState)([]),Q=Object(j.a)(q,2),Y=Q[0],$=Q[1],Z=Object(r.useState)(0),ee=Object(j.a)(Z,2),te=ee[0],ne=ee[1],ae=Object(r.useState)({}),re=Object(j.a)(ae,2),ie=re[0],ce=re[1],oe=Object(r.useMemo)((function(){return l&&O.preferMp3?l.toMp3():l}),[l,O.preferMp3]);Object(r.useEffect)((function(){T(i)}),[i]),Object(r.useEffect)((function(){t&&(y(""),B(""),$([]),ce({}))}),[t]),Object(r.useEffect)((function(){ne(Date.now())}),[M]),Object(r.useEffect)((function(){if(M&&O.wordField){var e=M.trim();if(""!==e&&e!==K){var t=setTimeout(Object(b.a)(d.a.mark((function t(){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=$,t.next=4,v.findNotesWithWord(e);case 4:t.t1=t.sent,(0,t.t0)(t.t1),J(e),t.next=12;break;case 9:t.prev=9,t.t2=t.catch(0),console.error(t.t2);case 12:case"end":return t.stop()}}),t,null,[[0,9]])}))),500);return function(){return clearTimeout(t)}}}}),[M,te,K,v,O.wordField]);var se,ue=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),oe.play()}),[oe]),le=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),s(f)}),[f,s]),de=Object(r.useCallback)((function(e,t){var n={};Object.assign(n,ie),n[e]=t,ce(n)}),[ie]);return se=M&&M.trim()===K&&O.wordField?Y.length>0?"Found ".concat(Y.length,' notes with word "').concat(M,'" in field "').concat(O.wordField,'"'):'No notes found with word "'.concat(M.trim(),'" in field "').concat(O.wordField,'"'):"",Object(a.jsxs)(P.a,{open:t,disableEnforceFocus:!0,fullWidth:!0,maxWidth:"sm",onBackdropClick:function(){return o()},children:[Object(a.jsxs)(z.a,{children:[Object(a.jsx)(V.a,{variant:"h6",className:g.title,children:"Anki Export"}),Object(a.jsx)(U.a,{edge:"end",onClick:function(){return u()},children:Object(a.jsx)(W.a,{})})]}),Object(a.jsx)(A.a,{children:Object(a.jsxs)("form",{className:g.root,children:[Object(a.jsx)(I.a,{variant:"filled",multiline:!0,fullWidth:!0,rowsMax:8,label:"Sentence",value:S,onChange:function(e){return T(e.target.value)}}),Object(a.jsx)(I.a,{variant:"filled",multiline:!0,fullWidth:!0,rows:8,label:"Definition",value:x,onChange:function(e){return y(e.target.value)}}),Object(a.jsx)(I.a,{variant:"filled",fullWidth:!0,label:"Word",value:M,onChange:function(e){return B(e.target.value)},helperText:se,InputProps:{endAdornment:Object(a.jsx)(_.a,{position:"end",children:Object(a.jsx)(H.a,{title:"Search in Anki",children:Object(a.jsx)("span",{children:Object(a.jsx)(U.a,{disabled:n||!O.wordField||!M||""===M.trim(),onClick:function(){return v.findNotesWithWordGui(M.trim())},edge:"end",children:Object(a.jsx)(L.a,{})})})})})}}),Object.keys(p).map((function(e){return Object(a.jsx)(I.a,{variant:"filled",fullWidth:!0,label:e,value:ie[e]||"",onChange:function(t){return de(e,t.target.value)}},e)})),oe&&Object(a.jsx)("div",{className:g.mediaField,onClick:ue,children:Object(a.jsx)(I.a,{variant:"filled",fullWidth:!0,value:oe.name,label:"Audio"})}),f&&Object(a.jsx)("div",{className:g.mediaField,onClick:le,children:Object(a.jsx)(I.a,{variant:"filled",fullWidth:!0,value:f.name,label:"Image"})}),Object(a.jsx)(I.a,{variant:"filled",fullWidth:!0,label:"Source",value:h})]})}),Object(a.jsxs)(N.a,{children:[Object(a.jsx)(R.a,{disabled:n,onClick:function(){return o()},children:"Cancel"}),Object(a.jsx)(R.a,{disabled:n,onClick:function(){return c(S,x,oe,f,M,h,ie,!0)},children:"Open in Anki"}),Object(a.jsx)(R.a,{disabled:n,onClick:function(){return c(S,x,oe,f,M,h,ie,!1)},children:"Export"})]})]})}function K(){return new Worker(n.p+"static/js/mp3-encoder-worker.b940f60b.worker.js")}var J=new AudioContext,q=function(){function e(){Object(S.a)(this,e)}return Object(T.a)(e,null,[{key:"encode",value:function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(b.a)(d.a.mark((function e(n,a){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(r=new FileReader).onload=function(){var e=Object(b.a)(d.a.mark((function e(t){var r,i,c,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,J.decodeAudioData(t.target.result);case 3:for(r=e.sent,i=[],c=0;c<r.numberOfChannels;++c)i.push(r.getChannelData(c));(o=new K).postMessage({command:"encode",audioBuffer:{channels:i,numberOfChannels:r.numberOfChannels,length:r.length,sampleRate:r.sampleRate}}),o.onmessage=function(e){n(new Blob(e.data.buffer,{type:"audio/mp3"})),o.terminate()},o.onerror=function(){a("MP3 encoding failed"),o.terminate()},e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),a(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}(),r.readAsArrayBuffer(t);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Q={"audio/ogg;codecs=opus":"ogg","audio/webm;codecs=opus":"webm"},Y=Object(j.a)(Object.keys(Q).filter(MediaRecorder.isTypeSupported).map((function(e){return[e,Q[e]]}))[0],2),$=Y[0],Z=Y[1],ee=function(){function e(t,n,a,r,i){Object(S.a)(this,e),this.name=t,this.start=n,this.end=a,this._base64=r,this.extension=i}return Object(T.a)(e,[{key:"base64",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._base64);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t,n,a=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return t=e.sent,(n=new Audio).src=URL.createObjectURL(t),n.preload="none",n.load(),e.next=9,n.play();case 9:return e.abrupt("return",new Promise((function(e,t){setTimeout((function(){n.pause();var t=n.src;n.src=null,URL.revokeObjectURL(t),e()}),a.end-a.start+1e3)})));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_blob",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cachedBlob){e.next=6;break}return e.next=3,fetch("data:audio/"+this.extension+";base64,"+this._base64);case 3:return e.next=5,e.sent.blob();case 5:this.cachedBlob=e.sent;case 6:return e.abrupt("return",this.cachedBlob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),te=function(){function e(t,n,a,r){Object(S.a)(this,e),this.file=t,this.name=t.name+"_"+n+"_"+a,this.start=n,this.end=a,this.trackId=r,this.extension=Z}return Object(T.a)(e,[{key:"base64",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(b.a)(d.a.mark((function e(n,a){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new FileReader,e.t0=r,e.next=4,t.blob();case 4:e.t1=e.sent,e.t0.readAsDataURL.call(e.t0,e.t1),r.onloadend=function(){var e=r.result,t=e.substr(e.indexOf(",")+1);n(t)};case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=5;break}return e.next=3,this._clipAudio();case 3:return this._blob=e.sent,e.abrupt("return");case 5:return t=this._audioElement(this._blob),e.next=8,t.play();case 8:return e.next=10,this._stopAudio(t);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=4;break}return e.next=3,this._clipAudio();case 3:this._blob=e.sent;case 4:return e.abrupt("return",this._blob);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_clipAudio",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var a=t._audioElement(t.file);a.oncanplay=function(){var n=Object(b.a)(d.a.mark((function n(r){var i,c,o,s,u;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a.play(),i=t._captureStream(a),c=Object(O.a)(i.getVideoTracks());try{for(c.s();!(o=c.n()).done;)o.value.stop()}catch(r){c.e(r)}finally{c.f()}return s=new MediaRecorder(i,{mimeType:$}),u=[],s.ondataavailable=function(e){u.push(e.data)},s.onstop=function(t){e(new Blob(u))},s.start(),n.next=11,t._stopAudio(a);case 11:s.stop();case 12:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_audioElement",value:function(e){var t=new Audio;if(t.src=URL.createObjectURL(e),t.preload="none",this.trackId&&t.audioTracks&&t.audioTracks.length>0){var n,a=Object(O.a)(t.audioTracks);try{for(a.s();!(n=a.n()).done;){var r=n.value;r.enabled=this.trackId===r.id}}catch(i){a.e(i)}finally{a.f()}}return t.currentTime=this.start/1e3,t.load(),t}},{key:"_captureStream",value:function(e){if("function"===typeof e.captureStream)return e.captureStream();if("function"===typeof e.mozCaptureStream)return e.mozCaptureStream();throw new Error("Unable to capture stream from audio")}},{key:"_stopAudio",value:function(){var e=Object(b.a)(d.a.mark((function e(t){var n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){setTimeout((function(){t.pause();var n=t.src;t.src=null,URL.revokeObjectURL(n),e()}),n.end-n.start+100)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ne=function(){function e(t){Object(S.a)(this,e),this.data=t}return Object(T.a)(e,[{key:"base64",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(b.a)(d.a.mark((function e(n,a){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new FileReader,e.t0=r,e.next=4,t.blob();case 4:e.t1=e.sent,e.t0.readAsDataURL.call(e.t0,e.t1),r.onloadend=function(){var e=r.result,t=e.substr(e.indexOf(",")+1);n(t)};case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.play();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=8;break}return e.t0=q,e.next=4,this.data.blob();case 4:return e.t1=e.sent,e.next=7,e.t0.encode.call(e.t0,e.t1);case 7:this._blob=e.sent;case 8:return e.abrupt("return",this._blob);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"name",get:function(){return this.data.name}},{key:"extension",get:function(){return"mp3"}}]),e}(),ae=function(){function e(t){Object(S.a)(this,e),this.data=t}return Object(T.a)(e,[{key:"play",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.play();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"base64",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.base64();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t,n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:t=e.sent,n=window.URL.createObjectURL(t),a=document.createElement("a"),document.body.appendChild(a),a.style="display: none",a.href=n,a.download=this.name,a.click(),URL.revokeObjectURL(n),a.remove();case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toMp3",value:function(){return new e(new ne(this.data))}},{key:"name",get:function(){return this.data.name+"."+this.data.extension}}],[{key:"fromBase64",value:function(t,n,a,r,i){var c=t.name.substring(0,t.name.lastIndexOf("."))+"_"+n+"_"+a;return new e(new ee(c,n,a,r,i))}},{key:"fromFile",value:function(t,n,a,r){return new e(new te(t,n,a,r))}}]),e}(),re=n(185),ie=n.p+"static/media/background-colored.8c5dbfe0.png",ce=Object(M.a)((function(e){return{root:function(e){return{position:"absolute",height:"calc(100% - 64px)",width:"100%",zIndex:101,pointerEvents:e.dragging?"auto":"none"}},transparentBackground:{"&::before":{content:"' '",position:"absolute",height:"calc(100vh - 64px)",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",backgroundSize:"500px 500px",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundImage:"url(".concat(ie,")"),backgroundBlendMode:"overlay",background:"rgba(0, 0, 0, .3)",filter:"drop-shadow(10px 10px 10px rgb(0, 0, 0, .4))"},width:"100%",height:"100%"}}}));function oe(e){var t=e.dragging,n=e.loading,r=ce({dragging:t});return Object(a.jsx)("div",{className:r.root,children:Object(a.jsx)(re.a,{in:t||n,children:Object(a.jsx)("div",{className:r.transparentBackground})})})}var se=n(325),ue=n(97),le=n.n(ue),de=n(96),be=n.n(de),fe=n(327),he=n(328),je=n(326),pe=n(330),Oe=n(329),ve=n(82),ge=n.n(ve),me=Object(M.a)((function(e){return{inlineIcon:{maxWidth:"80%",height:20,display:"inline-flex",flexDirection:"column",flexWrap:"wrap",alignItems:"start",textAlign:"left"}}}));function ke(e){var t=me(),n=e.open,r=e.extensionUrl,i=e.onClose;return Object(a.jsxs)(P.a,{open:n,onBackdropClick:function(){return i()},children:[Object(a.jsxs)(A.a,{children:[Object(a.jsx)(V.a,{variant:"h6",children:"Loading files"}),Object(a.jsxs)(V.a,{component:"ul",children:[Object(a.jsx)("li",{children:"Drag and drop mkv, srt, ass, or mp3 files into the player."}),Object(a.jsx)("li",{children:"Multiple files can be dragged and dropped simultaneously e.g. mkv+srt, mp3+ass, etc."})]}),Object(a.jsx)("br",{}),Object(a.jsx)(V.a,{variant:"h6",children:"Syncing with streaming video in another tab"}),Object(a.jsxs)(V.a,{component:"ol",children:[Object(a.jsxs)("li",{children:["Install the Chrome ",Object(a.jsx)(se.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:r,children:"extension"}),"."]}),Object(a.jsx)("li",{children:"Load a subtitle file."}),Object(a.jsx)("li",{children:Object(a.jsxs)("div",{className:t.inlineIcon,children:["Use the \xa0",Object(a.jsx)(ge.a,{fontSize:"small"}),"\xa0 button in the bottom right."]})}),Object(a.jsx)("li",{children:"If the icon does not appear try refreshing the video in the other tab."})]}),Object(a.jsx)("br",{}),Object(a.jsx)(V.a,{variant:"h6",children:"Anki"}),Object(a.jsxs)(V.a,{component:"ul",children:[Object(a.jsx)("li",{children:Object(a.jsxs)("div",{className:t.inlineIcon,children:["Use the \xa0",Object(a.jsx)(be.a,{fontSize:"small"}),"\xa0 button in the copy history."]})}),Object(a.jsx)("li",{children:"Audio/image will be exported only if an audio/image source was available when the subtitle was copied."}),Object(a.jsx)("li",{children:"Configure Anki settings with the settings button in the top right."})]}),Object(a.jsx)("br",{}),Object(a.jsx)(V.a,{variant:"h6",children:"Changing subtitle offset"}),Object(a.jsxs)(V.a,{component:"ol",children:[Object(a.jsx)("li",{children:"Click on the subtitle offset input field in the controls."}),Object(a.jsx)("li",{children:"Type in a number and hit enter."})]}),Object(a.jsx)("br",{}),Object(a.jsx)(V.a,{variant:"h6",children:"Condensed playback of local media files"}),Object(a.jsxs)(V.a,{component:"ol",children:[Object(a.jsx)("li",{children:"Load an audio/video file with a subtitle file."}),Object(a.jsx)("li",{children:Object(a.jsxs)("div",{className:t.inlineIcon,children:["Use the \xa0",Object(a.jsx)(le.a,{fontSize:"small"}),"\xa0 button in the bottom right."]})})]}),Object(a.jsx)("br",{}),Object(a.jsx)(V.a,{variant:"h6",children:"Keyboard shortcuts"}),Object(a.jsx)(je.a,{children:Object(a.jsx)(fe.a,{size:"small",children:Object(a.jsxs)(he.a,{children:[Object(a.jsxs)(Oe.a,{children:[Object(a.jsx)(pe.a,{children:Object(a.jsx)(V.a,{children:"Left/Right"})}),Object(a.jsx)(pe.a,{children:Object(a.jsx)(V.a,{children:"Previous/next subtitle"})})]}),Object(a.jsxs)(Oe.a,{children:[Object(a.jsx)(pe.a,{children:Object(a.jsx)(V.a,{children:"Space"})}),Object(a.jsx)(pe.a,{children:Object(a.jsx)(V.a,{children:"Play/pause"})})]}),Object(a.jsxs)(Oe.a,{children:[Object(a.jsx)(pe.a,{children:Object(a.jsx)(V.a,{children:"Ctrl+Shift+A"})}),Object(a.jsx)(pe.a,{children:Object(a.jsx)(V.a,{children:"Copy current subtitle"})})]}),Object(a.jsxs)(Oe.a,{children:[Object(a.jsx)(pe.a,{children:Object(a.jsx)(V.a,{children:"Ctrl+Shift+Z"})}),Object(a.jsx)(pe.a,{children:Object(a.jsx)(V.a,{children:"Copy current subtitle (streaming video in another tab)"})})]})]})})}),Object(a.jsx)("br",{}),Object(a.jsx)(V.a,{variant:"h6",children:"Demos"}),Object(a.jsxs)(V.a,{component:"ul",children:[Object(a.jsx)("li",{children:Object(a.jsx)(se.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://www.youtube.com/watch?v=7v0Hly_Q_Bs",children:"Sentence mining video files"})}),Object(a.jsx)("li",{children:Object(a.jsx)(se.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://www.youtube.com/watch?v=m55HbFJMilk",children:"Sentence mining streaming video"})})]}),Object(a.jsx)("br",{}),Object(a.jsx)(V.a,{variant:"h6",children:"Guides"}),Object(a.jsx)(V.a,{component:"ul",children:Object(a.jsx)("li",{children:Object(a.jsx)(se.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://learnjapanese.moe/streamworkflow/",children:"Sentence mining streaming workflow"})})})]}),Object(a.jsx)(N.a,{children:Object(a.jsx)(R.a,{onClick:function(){return i()},children:"OK"})})]})}var xe=n(331),ye=n(332),we=Object(M.a)((function(e){return{image:function(e){return{width:e.width,height:e.height,backgroundSize:"contain"}}}}));function Ce(e){var t,n=e.open,i=e.image,c=e.onClose,o=Object(r.useState)(),s=Object(j.a)(o,2),u=s[0],l=s[1],f=Object(r.useState)(),h=Object(j.a)(f,2),p=h[0],O=h[1],v=Object(r.useState)(),g=Object(j.a)(v,2),k=g[0],x=g[1],y=m(!0),w=Object(j.a)(y,2),C=w[0],S=w[1];t=p>0&&k>0?Math.min(1,Math.min(C/(2*p),S/(2*k))):1;var T=we({width:p*t,height:k*t});return Object(r.useEffect)((function(){function e(){return(e=Object(b.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.dataUrl();case 2:t=e.sent,(n=new Image).onload=function(){O(n.width),x(n.height),l(t)},n.src=t;case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}i&&function(){e.apply(this,arguments)}()}),[i]),Object(r.useEffect)((function(){n||(O(0),x(0),l(null))}),[n]),i&&u?Object(a.jsx)(P.a,{open:n,onBackdropClick:function(){return c()},maxWidth:"lg",children:Object(a.jsx)(xe.a,{children:Object(a.jsx)(ye.a,{className:T.image,image:u,title:i.name,style:{width:p*t,height:k*t}})})}):null}var Se=n(155),Te=n(345),Fe=n(117),Ee=function(){function e(){Object(S.a)(this,e)}return Object(T.a)(e,[{key:"subtitles",value:function(){var e=Object(b.a)(d.a.mark((function e(t){var n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.name.endsWith(".srt")){e.next=7;break}return e.t0=Se.a,e.next=4,t.text();case 4:return e.t1=e.sent,n=(0,e.t0)(e.t1),e.abrupt("return",n.map((function(e){return e.data})).sort((function(e,t){return e.start-t.start})));case 7:if(!t.name.endsWith(".vtt")){e.next=9;break}return e.abrupt("return",new Promise(function(){var e=Object(b.a)(d.a.mark((function e(n,a){var r,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Fe.WebVTT.Parser(window,Fe.WebVTT.StringDecoder()),i=[],r.oncue=function(e){return i.push(e)},r.onflush=function(){return n(i.map((function(e){return{start:Math.floor(1e3*e.startTime),end:Math.floor(1e3*e.endTime),text:e.text}})).sort((function(e,t){return e.start-t.start})))},e.t0=r,e.next=7,t.text();case 7:e.t1=e.sent,e.t0.parse.call(e.t0,e.t1),r.flush();case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 9:if(!t.name.endsWith(".ass")){e.next=16;break}return e.t2=Te.a,e.next=13,t.text();case 13:return e.t3=e.sent,a=(0,e.t2)(e.t3),e.abrupt("return",a.events.dialogue.map((function(e){return{start:Math.round(1e3*e.Start),end:Math.round(1e3*e.End),text:e.Text.combined}})).sort((function(e,t){return e.start-t.start})));case 16:throw new Error("Unsupported subtitle file format");case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Me=n(333),Re=n(160),Ie=n.n(Re),Pe=n(161),Ne=n.n(Pe),Ae=n(159),Ue=n.n(Ae),_e=n(162),Be=n.n(_e),Le=Object(g.a)((function(e){return{title:{flexGrow:1},appBar:{transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{width:function(e){var t=e.drawerWidth;return"calc(100% - ".concat(t,"px)")},transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:function(e){return e.drawerWidth}},copyHistoryButton:{transform:"scaleX(1)",width:48,padding:12,transition:e.transitions.create(["transform","padding","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},copyHistoryButtonShift:{transform:"scaleX(0)",width:0,padding:5,transition:e.transitions.create(["transform","padding","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},hide:{display:"none"}}}));function De(e){var t=Le(e);return Object(a.jsx)(Me.a,{position:"static",className:Object(k.a)(t.appBar,Object(p.a)({},t.appBarShift,e.drawerOpen)),children:Object(a.jsxs)(z.a,{children:[Object(a.jsx)(H.a,{title:"Open Files",children:Object(a.jsx)(U.a,{edge:"start",onClick:e.onFileSelector,children:Object(a.jsx)(Ue.a,{})})}),Object(a.jsx)(V.a,{variant:"h6",className:t.title,children:e.title}),Object(a.jsx)(H.a,{title:"Submit Issue",children:Object(a.jsx)(U.a,{edge:"end",component:"a",href:"https://github.com/killergerbah/asbplayer/issues",target:"_blank",rel:"noreferrer",children:Object(a.jsx)(Ie.a,{})})}),Object(a.jsx)(H.a,{title:"Help",children:Object(a.jsx)(U.a,{edge:"end",onClick:e.onOpenHelp,children:Object(a.jsx)(Ne.a,{})})}),Object(a.jsx)(H.a,{title:"Settings",children:Object(a.jsx)(U.a,{edge:"end",onClick:e.onOpenSettings,children:Object(a.jsx)(W.a,{})})}),Object(a.jsx)(H.a,{title:"Copy History",children:Object(a.jsx)(U.a,{edge:"end",color:"inherit","aria-label":"menu",onClick:e.onOpenCopyHistory,className:Object(k.a)(t.copyHistoryButton,Object(p.a)({},t.copyHistoryButtonShift,e.drawerOpen)),children:Object(a.jsx)(Be.a,{})})})]})})}var We=function(){function e(){var t=this;Object(S.a)(this,e),this.onMessageCallbacks=[],this.tabs=[],this.versionPromise=new Promise((function(e,n){t.versionResolve=e})),window.addEventListener("message",(function(e){if(e.source===window&&"asbplayer-extension-to-player"===e.data.sender&&e.data.message){if("tabs"===e.data.message.command)return void(t.tabs=e.data.message.tabs);if("version"===e.data.message.command)return void t.versionResolve(e.data.message.version);var n,a=Object(O.a)(t.onMessageCallbacks);try{for(a.s();!(n=a.n()).done;){(0,n.value)({data:e.data.message,tabId:e.data.tabId})}}catch(r){a.e(r)}finally{a.f()}}}))}return Object(T.a)(e,[{key:"installedVersion",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.versionPromise;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(e,t){window.postMessage({sender:"asbplayer",message:e,tabId:t},"*")}},{key:"publishMessage",value:function(e){var t,n=Object(O.a)(this.tabs);try{for(n.s();!(t=n.n()).done;){var a=t.value;window.postMessage({sender:"asbplayer",message:e,tabId:a.id},"*")}}catch(r){n.e(r)}finally{n.f()}}},{key:"subscribe",value:function(e){this.onMessageCallbacks.push(e)}},{key:"unsubscribe",value:function(e){for(var t=this.onMessageCallbacks.length-1;t>=0;--t)if(e===this.onMessageCallbacks[t]){this.onMessageCallbacks.splice(t,1);break}}}]),e}(),ze=n(337),He=n(349),Ve=n(164),Ge=n.n(Ve),Xe=n(100),Ke=n.n(Xe),Je=n(321),qe=n(273),Qe=n(336),Ye=n(334),$e=n(335),Ze=n(320),et=n(163),tt=n.n(et),nt=Object(g.a)((function(e){return{drawer:{width:function(e){return e.drawerWidth},flexShrink:0},drawerPaper:{width:function(e){return e.drawerWidth}},drawerHeader:Object(f.a)(Object(f.a)({display:"flex",alignItems:"center",position:"static",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-start"}),listContainer:{position:"relative",height:"100%",overflowY:"auto",overflowX:"hidden"},listItem:{"&:hover":{backgroundColor:e.palette.action.hover}},listItemGutters:{paddingLeft:5,paddingRight:5},listItemIconRoot:{minWidth:20}}}));function at(e){var t=e.open,n=e.anchorEl,i=e.onClose,c=e.onSelect,o=e.onClipAudio,s=e.onDownloadImage,u=e.item,l=Object(r.useCallback)((function(){navigator.clipboard.writeText(u.text),i()}),[u,i]),d=Object(r.useCallback)((function(){c(u),i()}),[u,c,i]),b=Object(r.useCallback)((function(){o(u),i()}),[u,o,i]),f=Object(r.useCallback)((function(){s(u),i()}),[u,s,i]);return u?Object(a.jsx)(Ze.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:i,anchorOrigin:{vertical:"center",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"right"},children:Object(a.jsxs)(Je.a,{children:[Object(a.jsx)(qe.a,{button:!0,onClick:l,children:Object(a.jsx)(Ye.a,{primaryTypographyProps:{variant:"body2"},primary:"Copy"})}),Object(a.jsx)(qe.a,{button:!0,onClick:d,children:Object(a.jsx)(Ye.a,{primaryTypographyProps:{variant:"body2"},primary:"Jump To"})}),(u.videoFile||u.audioFile||u.audio)&&Object(a.jsx)(qe.a,{button:!0,onClick:b,children:Object(a.jsx)(Ye.a,{primaryTypographyProps:{variant:"body2"},primary:"Download Audio"})}),(u.videoFile||u.image)&&Object(a.jsx)(qe.a,{button:!0,onClick:f,children:Object(a.jsx)(Ye.a,{primaryTypographyProps:{variant:"body2"},primary:"Download Image"})})]})}):null}function rt(e){var t=nt(e),n=Object(r.useCallback)((function(e){e&&e.scrollIntoView()}),[]),c=Object(r.useState)(),o=Object(j.a)(c,2),s=o[0],u=o[1],l=Object(r.useState)(!1),d=Object(j.a)(l,2),b=d[0],f=d[1],h=Object(r.useState)(),p=Object(j.a)(h,2),v=p[0],g=p[1],m=Object(r.useCallback)((function(e,t){u(t),f(!0),g(e.currentTarget)}),[]),k=Object(r.useCallback)((function(e,t){u(null),f(!1),g(null)}),[]),x=Object(r.useCallback)((function(t){e.onDelete(t)}),[e]),y=null;if(e.items.length>0){y=[];var w,C=null,S=0,T=Object(O.a)(e.items);try{var F=function(){var r=w.value;null!==C&&C===r.name||(C=r.name,y.push(Object(a.jsx)($e.a,{disableSticky:!0,children:r.name},r.name)));var i=S===e.items.length-1?n:null;y.push(Object(a.jsxs)(qe.a,{ref:i,className:t.listItem,classes:{gutters:t.listItemGutters},children:[Object(a.jsx)(Qe.a,{classes:{root:t.listItemIconRoot},children:Object(a.jsx)(H.a,{title:"Export to Anki",children:Object(a.jsx)(U.a,{onClick:function(){return e.onAnki(r)},children:Object(a.jsx)(be.a,{fontSize:"small"})})})}),Object(a.jsx)(Qe.a,{classes:{root:t.listItemIconRoot},children:Object(a.jsx)(U.a,{onClick:function(e){return m(e,r)},children:Object(a.jsx)(tt.a,{fontSize:"small"})})}),Object(a.jsx)(Ye.a,{children:r.text}),Object(a.jsx)(Qe.a,{classes:{root:t.listItemIconRoot},children:Object(a.jsx)(U.a,{onClick:function(){return x(r)},children:Object(a.jsx)(Ke.a,{fontSize:"small"})})})]},r.timestamp)),++S};for(T.s();!(w=T.n()).done;)F()}catch(M){T.e(M)}finally{T.f()}}else y=Object(a.jsx)(qe.a,{children:"Copy history is empty."});var E=Object(a.jsx)(Je.a,{children:y});return Object(a.jsxs)(i.a.Fragment,{children:[Object(a.jsxs)(He.a,{variant:"persistent",anchor:"right",open:e.open,className:t.drawer,classes:{paper:t.drawerPaper},children:[Object(a.jsx)("div",{className:t.drawerHeader,children:Object(a.jsx)(U.a,{onClick:e.onClose,children:Object(a.jsx)(Ge.a,{})})}),Object(a.jsx)(ze.a,{}),Object(a.jsx)("div",{className:t.listContainer,children:E})]}),Object(a.jsx)(at,{open:e.open&&b,anchorEl:v,item:s,onClose:k,onSelect:e.onSelect,onClipAudio:e.onClipAudio,onDownloadImage:e.onDownloadImage})]})}var it=function(){function e(t,n,a){Object(S.a)(this,e),this.name=t,this._base64=n,this.extension=a}return Object(T.a)(e,[{key:"base64",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._base64);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_blob",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cachedBlob){e.next=6;break}return e.next=3,fetch(this._dataUrl());case 3:return e.next=5,e.sent.blob();case 5:this.cachedBlob=e.sent;case 6:return e.abrupt("return",this.cachedBlob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._dataUrl());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_dataUrl",value:function(){return"data:image/"+this.extension+";base64,"+this._base64}}]),e}(),ct=function(){function e(t,n){Object(S.a)(this,e),this.file=t,this.name=t.name+"_"+n+".jpeg",this.timestamp=n}return Object(T.a)(e,[{key:"base64",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(b.a)(d.a.mark((function e(n,a){var r,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._canvas();case 2:r=e.sent,i=r.toDataURL("image/jpeg"),n(i.substr(i.indexOf(",")+1));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(b.a)(d.a.mark((function e(n,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._canvas();case 2:e.sent.toBlob((function(e){t._blob=e,n(e)}),"image/jpeg");case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canvas();case 2:return t=e.sent,e.abrupt("return",t.toDataURL());case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_canvas",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var a=t._videoElement(t.file);a.oncanplay=function(){var t=Object(b.a)(d.a.mark((function t(n){var r;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(r=document.createElement("canvas")).width=a.videoWidth,r.height=a.videoHeight,r.getContext("2d").drawImage(a,0,0,r.width,r.height),e(r),URL.revokeObjectURL(a.src);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_videoElement",value:function(e){var t=document.createElement("video");return t.src=URL.createObjectURL(e),t.preload="none",t.currentTime=this.timestamp/1e3,t.load(),t}}]),e}(),ot=function(){function e(t){Object(S.a)(this,e),this.data=t}return Object(T.a)(e,[{key:"base64",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.base64();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.dataUrl();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t,n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:t=e.sent,n=window.URL.createObjectURL(t),a=document.createElement("a"),document.body.appendChild(a),a.style="display: none",a.href=n,a.download=this.data.name,a.click(),URL.revokeObjectURL(n),a.remove();case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"name",get:function(){return this.data.name}}],[{key:"fromBase64",value:function(t,n,a,r){var i=t.name.substring(0,t.name.lastIndexOf("."))+"_"+n+"."+r;return new e(new it(i,a,r))}},{key:"fromFile",value:function(t,n){return new e(new ct(t,n))}}]),e}(),st=n.p+"static/media/background.aa598bb3.png",ut=Object(M.a)((function(e){return{background:{position:"absolute",height:"calc(100vh - 64px)",width:"100%",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center",backgroundSize:"500px 500px",backgroundRepeat:"no-repeat",backgroundPosition:"center"},defaultBackground:{backgroundImage:"url(".concat(st,")")},coloredBackground:{backgroundImage:"url(".concat(ie,")")},browseLink:{cursor:"pointer"}}}));function lt(e){var t=e.extension,n=e.latestExtensionVersion,c=e.extensionUrl,o=e.loading,s=e.dragging,u=e.onFileSelector,l=ut(),f=Object(r.useState)(),h=Object(j.a)(f,2),p=h[0],O=h[1];Object(r.useEffect)((function(){function e(){return(e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=O,e.next=3,t.installedVersion();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t]);var v=n>p,g=!p;return Object(a.jsx)(i.a.Fragment,{children:Object(a.jsx)(re.a,{in:!o&&!s,timeout:500,children:Object(a.jsx)("div",{className:"".concat(l.background," ").concat(l.defaultBackground),children:Object(a.jsxs)(V.a,{children:["Drag and drop srt, ass, vtt, mp3, m4a, and mkv files or ",Object(a.jsx)(se.a,{target:"#",className:l.browseLink,onClick:u,color:"secondary",component:"label",children:"browse"}),".",Object(a.jsx)("br",{}),g&&Object(a.jsxs)("span",{children:["Install the ",Object(a.jsx)(se.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:c,children:"extension"})," to sync subtitles with videos in other tabs."]}),v&&Object(a.jsxs)("span",{children:["An extension ",Object(a.jsx)(se.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:c,children:"update"})," is available."]})]})})})})}var dt=function(){function e(t){Object(S.a)(this,e),this.channel=new BroadcastChannel(t);var n=this;this.channel.onmessage=function(e){var t;null===(t=n.onMessage)||void 0===t||t.call(n,e)}}return Object(T.a)(e,[{key:"postMessage",value:function(e){this.channel.postMessage(e)}},{key:"close",value:function(){this.channel.close()}}]),e}(),bt=function(){function e(t,n){var a=this;Object(S.a)(this,e),this.tabId=t,this.listener=function(e){var n;e.tabId===t&&(null===(n=a.onMessage)||void 0===n||n.call(a,{data:e.data}))},n.subscribe(this.listener),this.extension=n}return Object(T.a)(e,[{key:"postMessage",value:function(e){this.extension.sendMessage(e,this.tabId)}},{key:"close",value:function(){this.extension.unsubscribe(this.listener)}}]),e}(),ft=function(){function e(){Object(S.a)(this,e),this.accumulated=0,this.started=!1}return Object(T.a)(e,[{key:"time",value:function(e){return this.started?Math.min(e,this.accumulated+Date.now()-this.startTime):Math.min(e,this.accumulated)}},{key:"stop",value:function(){this.started&&(this.started=!1,this.accumulated+=Date.now()-this.startTime)}},{key:"start",value:function(){this.startTime=Date.now(),this.started=!0}},{key:"setTime",value:function(e){this.started?(this.startTime=Date.now(),this.accumulated=e):this.accumulated=e}},{key:"progress",value:function(e){return 0===e?0:Math.min(1,this.time(e)/e)}}]),e}(),ht=n(7),jt=n(166),pt=n.n(jt),Ot=n(167),vt=n.n(Ot),gt=n(173),mt=n.n(gt),kt=n(165),xt=n.n(kt),yt=n(338),wt=n(267),Ct=n(175),St=n.n(Ct),Tt=n(177),Ft=n.n(Tt),Et=n(176),Mt=n.n(Et),Rt=n(168),It=n.n(Rt),Pt=n(169),Nt=n.n(Pt),At=n(174),Ut=n.n(At),_t=n(350),Bt=n(172),Lt=n.n(Bt),Dt=n(170),Wt=n.n(Dt),zt=n(171),Ht=n.n(zt),Vt=Object(g.a)((function(e){return{container:{position:"absolute",left:"50%",width:"50%",bottom:0,pointerEvents:"none"},buttonContainer:{flexDirection:"row"},timeDisplay:{color:e.palette.action.active,display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",cursor:"default",fontSize:20,marginLeft:10},offsetInput:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",fontSize:20,marginLeft:10,width:100,color:e.palette.text.secondary,pointerEvents:"auto"},volumeInputContainerShown:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:5,pointerEvents:"auto"},volumeInputContainerHidden:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:0,pointerEvents:"auto"},volumeInputHidden:{transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),width:0,pointerEvents:"auto"},volumeInputShown:{transition:e.transitions.create("width",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),width:100,pointerEvents:"auto"},volumeInputThumbHidden:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),opacity:0,pointerEvents:"auto"},volumeInputThumbShown:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),opacity:1,pointerEvents:"auto"},subContainer:{background:"linear-gradient(to bottom, rgba(0,0,0,0), rgba(0,0,0,0.7))",position:"relative",left:"-100%",width:"200%",zIndex:10,padding:10},button:{color:e.palette.action.active,pointerEvents:"auto"},inactiveButton:{color:e.palette.action.disabled,pointerEvents:"auto"},progress:{margin:5},closeButton:{position:"absolute",top:0,left:0,pointerEvents:"auto"},hideSubtitlePlayerToggleButton:{position:"absolute",top:0,right:0,pointerEvents:"auto"},gridContainer:{pointerEvents:"auto"}}})),Gt=Object(g.a)((function(e){return{container:{background:"rgba(30,30,30,0.7)",height:5,margin:"0 10px 5px 10px",cursor:"pointer",pointerEvents:"auto"},fillContainer:{width:"100%"},fill:{background:"linear-gradient(to left, #e21e4a, #a92fff)",height:"100%"},handleContainer:{position:"relative",width:0,height:0},handle:{borderRadius:"50%",width:15,height:15,background:"white",position:"absolute",top:5,left:12,filter:"drop-shadow(3px 3px 3px rgba(0,0,0,0.3))"}}})),Xt=Object(ht.a)((function(e){return{root:{color:e.palette.text.secondary,verticalAlign:"middle"},thumb:{backgroundColor:"white",color:e.palette.text.secondary,"&:focus":{boxShadow:"inherit"},"&:hover, &$active":{boxShadow:"0px 0px 0px 8px rgba(255, 255, 255, 0.1)"}},active:{color:e.palette.text.secondary}}}))(_t.a);function Kt(e){var t=Math.floor(e/1e3),n=Math.floor(t/60),a=t%60;return String(n)+":"+String(a).padStart(2,"0")}function Jt(e){var t=e.getBoundingClientRect();return t.right-t.left}function qt(e){var t=Gt(),n=Object(r.useRef)(null);var i={width:e.value+"%"},c={marginLeft:n.current?Jt(n.current)*e.value/100:0};return Object(a.jsxs)("div",{ref:n,onClick:function(t){var n=t.currentTarget.getBoundingClientRect(),a=n.right-n.left,r=Math.min(1,Math.max(0,(t.pageX-n.left)/a));e.onSeek(r)},className:t.container,children:[Object(a.jsx)("div",{className:t.fill,style:i}),Object(a.jsx)("div",{className:t.handleAnchor,children:Object(a.jsx)("div",{className:t.handle,style:c})})]})}function Qt(e){if(!e.audioTracks||0===e.audioTracks.length)return null;var t=e.audioTracks.map((function(t){return Object(a.jsxs)(qe.a,{selected:t.id===e.selectedAudioTrack,button:!0,onClick:function(){return e.onAudioTrackSelected(t.id)},children:[t.language," ",t.label]},t.id)}));return Object(a.jsx)("div",{children:Object(a.jsx)(Ze.a,{disableEnforceFocus:!0,open:e.open,anchorEl:e.anchorEl,onClose:e.onClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(a.jsx)(Je.a,{children:t})})})}function Yt(e){if(!e.tabs||0===e.tabs.length)return null;var t=e.tabs.map((function(t){return Object(a.jsxs)(qe.a,{selected:t.id===e.selectedTab,button:!0,onClick:function(){return e.onTabSelected(t.id)},children:[t.id," ",t.title," ",t.src]},t.id)}));return Object(a.jsx)("div",{children:Object(a.jsx)(Ze.a,{disableEnforceFocus:!0,open:e.open,anchorEl:e.anchorEl,onClose:e.onClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(a.jsx)(Je.a,{children:t})})})}function $t(e){return Object(a.jsx)("div",{children:Object(a.jsx)(Ze.a,{disableEnforceFocus:!0,open:e.open,anchorEl:e.anchorEl,onClose:e.onClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(a.jsx)(Je.a,{children:Object(a.jsxs)(qe.a,{button:!0,onClick:function(t){return e.onUnload()},children:["Unload ",e.file]})})})})}function Zt(e){var t=e.clock,n=e.playing,c=e.length,o=e.offsetEnabled,s=e.displayLength,u=e.offset,l=e.onAudioTrackSelected,d=e.onSeek,b=e.mousePositionRef,f=e.onShow,h=e.onPause,p=e.onPlay,O=e.onTabSelected,v=e.onUnloadAudio,g=e.onUnloadVideo,m=e.onOffsetChange,k=e.onVolumeChange,x=e.disableKeyEvents,y=e.settingsProvider,w=e.closeEnabled,C=e.onClose,S=e.volumeEnabled,T=e.condensedModeEnabled,F=e.condensedModeToggleEnabled,E=e.onCondensedModeToggle,M=e.subtitlesEnabled,R=e.subtitlesToggle,I=e.onSubtitlesToggle,P=e.videoFile,N=e.audioFile,A=e.audioTracks,_=e.selectedAudioTrack,B=e.tabs,L=e.selectedTab,D=e.popOutEnabled,W=e.popOut,z=e.onPopOutToggle,V=e.fullscreenEnabled,G=e.fullscreen,X=e.onFullscreenToggle,K=e.hideSubtitlePlayerToggleEnabled,J=e.subtitlePlayerHidden,q=e.onHideSubtitlePlayerToggle,Q=Vt(),Y=Object(r.useState)(!0),$=Object(j.a)(Y,2),Z=$[0],ee=$[1],te=Object(r.useState)(!1),ne=Object(j.a)(te,2),ae=ne[0],ie=ne[1],ce=Object(r.useState)(),oe=Object(j.a)(ce,2),se=oe[0],ue=oe[1],de=Object(r.useState)(!1),be=Object(j.a)(de,2),fe=be[0],he=be[1],je=Object(r.useState)(),pe=Object(j.a)(je,2),Oe=pe[0],ve=pe[1],me=Object(r.useState)(!1),ke=Object(j.a)(me,2),xe=ke[0],ye=ke[1],we=Object(r.useState)(),Ce=Object(j.a)(we,2),Se=Ce[0],Te=Ce[1],Fe=Object(r.useState)(!1),Ee=Object(j.a)(Fe,2),Me=Ee[0],Re=Ee[1],Ie=Object(r.useState)(),Pe=Object(j.a)(Ie,2),Ne=Pe[0],Ae=Pe[1],Ue=Object(r.useState)(!1),_e=Object(j.a)(Ue,2),Be=_e[0],Le=_e[1],De=Object(r.useState)(100),We=Object(j.a)(De,2),ze=We[0],He=We[1],Ve=Object(r.useState)(100),Ge=Object(j.a)(Ve,2),Xe=Ge[0],Ke=Ge[1],Je=Object(r.useRef)({x:0,y:0}),qe=Object(r.useRef)(Date.now()),Qe=Object(r.useRef)(!0),Ye=Object(r.useRef)(!1),$e=Object(r.useRef)(),Ze=Object(r.useState)(),et=Object(j.a)(Ze,2)[1],tt=Object(r.useCallback)((function(){return et({})}),[]),nt=Object(r.useCallback)((function(e){d(e)}),[d]);function at(e){Ye.current=!0}function rt(e){Ye.current=!1}Object(r.useEffect)((function(){var e=Number(y.volume);He(e),k(e/100),e>0&&Ke(e)}),[y,k]),Object(r.useEffect)((function(){var e=setInterval((function(){var e=Date.now()-qe.current<2e3||Math.pow(b.current.x-Je.current.x,2)+Math.pow(b.current.y-Je.current.y,2)>100||Ye.current||$e.current===document.activeElement;e&&!Qe.current?(qe.current=Date.now(),ee(e)):!e&&Qe.current&&ee(e),Qe.current=e,Je.current.x=b.current.x,Je.current.y=b.current.y}),100);return function(){return clearInterval(e)}}),[b,ee,Z]),Object(r.useEffect)((function(){return null===f||void 0===f?void 0:f(Z)}),[f,Z]),Object(r.useEffect)((function(){if(!x)return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)};function e(e){if(32===e.keyCode)e.preventDefault(),n?h():p();else if(13===e.keyCode&&$e.current===document.activeElement){var t=Number($e.current.value);if(Number.isNaN(t))return;m(1e3*t),$e.current.blur()}}}),[n,h,p,m,x]);var it=Object(r.useCallback)((function(e){var t;return e.target.setSelectionRange(0,(null===(t=e.target.value)||void 0===t?void 0:t.length)||0)}),[]);Object(r.useEffect)((function(){var e=setInterval((function(){tt()}),100);return function(){return clearInterval(e)}}),[tt]),Object(r.useEffect)((function(){if($e.current)if(0===u)$e.current.value=null;else{var e=u/1e3,t=e>=0?"+"+e.toFixed(2):String(e.toFixed(2));$e.current.value=t}}),[u]);var ct=Object(r.useCallback)((function(){ue(null),ie(!1)}),[]),ot=Object(r.useCallback)((function(e){ue(e.currentTarget),ie(!0)}),[]),st=Object(r.useCallback)((function(e){l(e),ue(null),ie(!1)}),[l]),ut=Object(r.useCallback)((function(){ve(null),he(!1)}),[]),lt=Object(r.useCallback)((function(e){ve(e.currentTarget),he(!0)}),[]),dt=Object(r.useCallback)((function(e){O(e),ve(null),he(!1)}),[O]),bt=Object(r.useCallback)((function(){Te(null),ye(!1)}),[]),ft=Object(r.useCallback)((function(e){Te(e.currentTarget),ye(!0)}),[]),ht=Object(r.useCallback)((function(){v(),ye(!1)}),[v]),jt=Object(r.useCallback)((function(e){Ae(null),Re(!1)}),[]),Ot=Object(r.useCallback)((function(e){Ae(e.currentTarget),Re(!0)}),[]),gt=Object(r.useCallback)((function(){g(),Re(!1)}),[g]),kt=Object(r.useCallback)((function(){return Le(!1)}),[]),Ct=Object(r.useCallback)((function(){return Le(!0)}),[]),Tt=Object(r.useCallback)((function(e,t){He(t),k(t/100)}),[k]),Et=Object(r.useCallback)((function(e,t){t>0&&Ke(t),y.volume=t}),[y]),Rt=Object(r.useCallback)((function(e,t){He((function(e){var t=e>0?0:Xe;return k(t/100),t}))}),[k,Xe]),Pt=t.progress(c);return Object(a.jsxs)(i.a.Fragment,{children:[w&&Object(a.jsx)(re.a,{in:Z,timeout:200,children:Object(a.jsx)(U.a,{className:Q.closeButton,onClick:C,onMouseOver:at,onMouseOut:rt,children:Object(a.jsx)(xt.a,{})})}),K&&Object(a.jsx)(re.a,{in:Z,timeout:200,children:Object(a.jsx)(U.a,{className:Q.hideSubtitlePlayerToggleButton,onClick:q,onMouseOver:at,onMouseOut:rt,children:J?Object(a.jsx)(pt.a,{}):Object(a.jsx)(vt.a,{})})}),Object(a.jsxs)("div",{className:Q.container,onMouseOver:at,onMouseOut:rt,children:[Object(a.jsx)(re.a,{in:Z,timeout:200,children:Object(a.jsxs)("div",{className:Q.subContainer,children:[Object(a.jsx)(qt,{onSeek:nt,value:100*Pt}),Object(a.jsxs)(yt.a,{container:!0,className:Q.gridContainer,direction:"row",children:[Object(a.jsx)(yt.a,{item:!0,children:Object(a.jsx)(U.a,{onClick:function(){return n?h():p()},children:n?Object(a.jsx)(It.a,{className:Q.button}):Object(a.jsx)(Nt.a,{className:Q.button})})}),S&&Object(a.jsxs)(yt.a,{item:!0,onMouseOver:Ct,onMouseOut:kt,className:Be?Q.volumeInputContainerShown:Q.volumeInputContainerHidden,children:[Object(a.jsx)(U.a,{onClick:Rt,children:0===ze?Object(a.jsx)(Wt.a,{}):Object(a.jsx)(Ht.a,{})}),Object(a.jsx)(Xt,{onChange:Tt,onChangeCommitted:Et,value:ze,defaultValue:100,classes:{root:Be?Q.volumeInputShown:Q.volumeInputHidden,thumb:Be?Q.volumeInputThumbShown:Q.volumeInputThumbHidden}})]}),Object(a.jsx)(yt.a,{item:!0,children:Object(a.jsxs)("div",{className:Q.timeDisplay,children:[Kt(Pt*c)," / ",Kt(s||c)]})}),o&&Object(a.jsx)(yt.a,{item:!0,children:Object(a.jsx)(wt.a,{inputRef:$e,disableUnderline:!0,className:Q.offsetInput,placeholder:"\xb1"+Number(0).toFixed(2),onClick:it})}),Object(a.jsx)(yt.a,{item:!0,style:{flexGrow:1}}),F&&Object(a.jsx)(yt.a,{item:!0,children:Object(a.jsx)(H.a,{title:"Condensed Mode",children:Object(a.jsx)(U.a,{onClick:E,children:Object(a.jsx)(le.a,{className:T?Q.button:Q.inactiveButton})})})}),R&&Object(a.jsx)(yt.a,{item:!0,children:Object(a.jsx)(U.a,{onClick:I,children:Object(a.jsx)(Lt.a,{className:M?Q.button:Q.inactiveButton})})}),P&&Object(a.jsx)(yt.a,{item:!0,children:Object(a.jsx)(U.a,{onClick:Ot,children:Object(a.jsx)(ge.a,{className:Q.button})})}),N&&Object(a.jsx)(yt.a,{item:!0,children:Object(a.jsx)(U.a,{onClick:ft,children:Object(a.jsx)(mt.a,{className:Q.button})})}),A&&A.length>1&&Object(a.jsx)(yt.a,{item:!0,children:Object(a.jsx)(U.a,{onClick:ot,children:Object(a.jsx)(Ut.a,{className:Q.button})})}),B&&B.length>0&&Object(a.jsx)(yt.a,{item:!0,children:Object(a.jsx)(U.a,{onClick:lt,children:Object(a.jsx)(ge.a,{className:L?Q.button:Q.inactiveButton})})}),D&&Object(a.jsx)(yt.a,{item:!0,children:Object(a.jsx)(U.a,{onClick:z,children:Object(a.jsx)(St.a,{className:Q.button,style:W?{transform:"rotateX(180deg)"}:{}})})}),V&&Object(a.jsx)(yt.a,{item:!0,children:Object(a.jsx)(U.a,{onClick:X,children:G?Object(a.jsx)(Mt.a,{className:Q.button}):Object(a.jsx)(Ft.a,{className:Q.button})})})]})]})}),Object(a.jsx)(Yt,{open:fe&&Z,anchorEl:Oe,tabs:B,selectedTab:L,onClose:ut,onTabSelected:dt}),Object(a.jsx)(Qt,{open:ae&&Z,anchorEl:se,audioTracks:A,selectedAudioTrack:_,onClose:ct,onAudioTrackSelected:st}),Object(a.jsx)($t,{open:xe,anchorEl:Se,file:N,onClose:bt,onUnload:ht}),Object(a.jsx)($t,{open:Me,anchorEl:Ne,file:P,onClose:jt,onUnload:gt})]})]})}var en=function(){function e(t){Object(S.a)(this,e),this.ref=t,this.readyResolves=[]}return Object(T.a)(e,[{key:"seek",value:function(){var e=Object(b.a)(d.a.mark((function e(t){var n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){n.ref.current?(n.ref.current.currentTime=t,n._onMediaCanPlay((function(){return e()}))):e()})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onReady",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.ref.current?t._onMediaCanPlay((function(){return e()})):e()})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_onMediaCanPlay",value:function(e){var t=this;4!==this.ref.readyState?(this.ref.current&&!this.ref.current.oncanplay&&(this.ref.current.oncanplay=function(e){var n,a=Object(O.a)(t.readyResolves);try{for(a.s();!(n=a.n()).done;){(0,n.value)()}}catch(r){a.e(r)}finally{a.f()}t.readyResolves.length=0,t.ref.current.oncanplay=null}),this.readyResolves.push(e)):e()}},{key:"play",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.play()}},{key:"pause",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.pause()}}]),e}(),tn=n(182);function nn(e){return e.ctrlKey&&e.shiftKey&&65===e.keyCode}var an=n(178),rn=n.n(an),cn=n(102),on=Object(g.a)((function(e){return{container:{height:"calc(100vh - 64px)",position:"relative",overflowX:"hidden",backgroundColor:e.palette.background.default,width:function(e){var t=e.compressed,n=e.windowWidth;return t?Math.max(350,.25*n):"100%"}},table:{backgroundColor:e.palette.background.default,marginBottom:75},noSubtitles:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center"}}})),sn=Object(g.a)((function(e){return{subtitleRow:{"&:hover":{backgroundColor:e.palette.action.hover}},subtitle:{fontSize:20,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere"},compressedSubtitle:{fontSize:16,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere"},timestamp:{fontSize:14,color:"#aaaaaa",textAlign:"right",paddingRight:15,paddingLeft:5},copyButton:{textAlign:"right",padding:0}}})),un=i.a.memo((function(e){var t=e.index,n=e.compressed,r=e.selected,i=e.subtitle,c=e.subtitleRef,o=e.onClick,s=e.onCopy,u=Object(tn.a)(e,["index","compressed","selected","subtitle","subtitleRef","onClick","onCopy"]),l=sn(),d=n?l.compressedSubtitle:l.subtitle;return i.start<0&&i.end<0?null:Object(a.jsxs)(Oe.a,Object(f.a)(Object(f.a)({onClick:function(e){return o(t)},ref:c,className:l.subtitleRow,selected:r},u),{},{children:[Object(a.jsx)(pe.a,{className:d,children:Object(a.jsx)("span",{onClick:function(e){return e.stopPropagation()},children:i.text})}),Object(a.jsx)(pe.a,{className:l.copyButton,children:Object(a.jsx)(U.a,{onClick:function(e){return s(e,t)},children:Object(a.jsx)(rn.a,{fontSize:n?"small":"default"})})}),Object(a.jsx)(pe.a,{className:l.timestamp,children:i.displayTime})]}))}));function ln(e){var t=e.clock,n=e.onSeek,i=e.onCopy,c=e.playing,o=e.subtitles,s=e.length,u=e.jumpToSubtitle,l=e.compressed,d=e.loading,b=e.drawerOpen,f=e.displayHelp,p=e.disableKeyEvents,v=e.lastJumpToTopTimestamp,g=e.hidden,k=Object(r.useRef)();k.current=c;var x=Object(r.useRef)();x.current=t;var y=Object(r.useRef)();y.current=o;var w=Object(r.useMemo)((function(){return o?Array(o.length).fill().map((function(e,t){return Object(r.createRef)()})):[]}),[o]),C=Object(r.useRef)();C.current=w;var S=Object(r.useState)({}),T=Object(j.a)(S,2),F=T[0],E=T[1],M=Object(r.useRef)({}),R=Object(r.useRef)();R.current=s;var I=Object(r.useRef)();I.current=g;var P=Object(r.useRef)(0),N=Object(r.useRef)(),A=Object(r.useRef)();Object(r.useRef)().current=b;var U=m(!0),_=Object(j.a)(U,1)[0],B=on({compressed:l,windowWidth:_});Object(r.useEffect)((function(){return N.current=requestAnimationFrame((function e(t){for(var n=y.current||[],a=C.current,r=R.current,i=x.current.progress(R.current),c=Number.MAX_SAFE_INTEGER,o=-1,s={},u=n.length-1;u>=0;--u){var l=n[u],d=l.start/r,b=l.end/r;if(i>=d)i<b&&(c=u<c?u:c,s[u]=!0),-1===o&&(o=u);else if(c!==Number.MAX_SAFE_INTEGER)break}if(c===Number.MAX_SAFE_INTEGER&&-1!==o&&(s[o]=!0),!function(e,t){for(var n in e)if(!(n in t))return!1;for(var a in t)if(!(a in e))return!1;return!0}(s,M.current)&&(M.current=s,E(s),c!==Number.MAX_SAFE_INTEGER)){var f=a[c],h=!I.current&&Date.now()-P.current>5e3;(null===f||void 0===f?void 0:f.current)&&h&&f.current.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}N.current=requestAnimationFrame(e)})),function(){return cancelAnimationFrame(N.current)}}),[]);var L=Object(r.useCallback)((function(){var e,t=M.current;if(t){var n=Object.keys(t);if(0!==n.length)null===(e=w[n[0]].current)||void 0===e||e.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}),[w]);function D(e,t,n,a){e.stopPropagation();var r=t[n],i=r.text;navigator.clipboard.writeText(i),a(r)}Object(r.useEffect)((function(){if(!g)return document.addEventListener("visibilitychange",e),function(){return document.removeEventListener("visibilitychange",e)};function e(){"visible"===document.visibilityState&&L()}}),[g,F,w,L]),Object(r.useEffect)((function(){g||L()}),[g,L]),Object(r.useEffect)((function(){var e;if(!I.current){var t=C.current;if(t&&0!==t.length)null===(e=t[0].current)||void 0===e||e.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}),[v]),Object(r.useEffect)((function(){function e(e){if(!p&&o&&0!==o.length){var t;if(37===e.keyCode){var a=Object.keys(F);t=a.length>0?Math.max(0,Math.min.apply(Math,Object(h.a)(a))-1):-1}else{if(39!==e.keyCode)return;var r=Object.keys(F);t=r.length>0?Math.min(o.length-1,Math.max.apply(Math,Object(h.a)(r))+1):-1}if(-1!==t){e.preventDefault();var i=o[t].start/s;n(i,!1)}}}return window.addEventListener("keydown",e),function(){return window.removeEventListener("keydown",e)}}),[n,F,o,s,p]),Object(r.useEffect)((function(){function e(e){P.current=Date.now()}var t=A.current;return null===t||void 0===t||t.addEventListener("wheel",e),function(){return null===t||void 0===t?void 0:t.removeEventListener("wheel",e)}}),[A,P]),Object(r.useEffect)((function(){if(!g&&u&&o){var e,t,n=-1,a=0,r=Object(O.a)(o);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(i.originalStart===u.originalStart&&i.text===u.text){n=a;break}++a}}catch(c){r.e(c)}finally{r.f()}if(-1!==n)null===(t=w[n].current)||void 0===t||t.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}),[g,u,o,w]),Object(r.useEffect)((function(){function e(e){var t=Object.keys(M.current);if(0!==t.length&&nn(e)){var n=Math.min.apply(Math,Object(h.a)(t));D(e,o,n,i)}}return window.addEventListener("keydown",e),function(){return window.removeEventListener("keydown",e)}}),[o,i]);var W,z=Object(r.useCallback)((function(e){var t=o[e].start/s;n(t,!k.current&&e in F)}),[o,s,n,F]),H=Object(r.useCallback)((function(e,t){return D(e,o,t,i)}),[o,i]);return W=o&&0!==o.length?Object(a.jsx)(je.a,{className:B.table,children:Object(a.jsx)(fe.a,{children:Object(a.jsx)(he.a,{children:o.map((function(e,t){var n=t in F;return Object(a.jsx)(un,{index:t,compressed:l,selected:n,subtitle:o[t],subtitleRef:w[t],onClick:z,onCopy:H},t)}))})})}):!d&&f&&Object(a.jsx)("div",{className:B.noSubtitles,children:Object(a.jsx)(V.a,{children:f})}),Object(a.jsx)(cn.a,{square:!0,elevation:0,ref:A,className:B.container,children:W})}var dn=function(){function e(t){Object(S.a)(this,e),this.protocol=t,this.time=0,this.duration=0,this.isReady=!1,this.readyState=0,this.selectedAudioTrack=null,this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[],this.condensedModeToggleCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[];var n=this;this.protocol.onMessage=function(e){switch(e.data.command){case"ready":n.duration=e.data.duration,n.isReady=!0,n.audioTracks=e.data.audioTracks,n.selectedAudioTrack=e.data.selectedAudioTrack,n.readyState=4,n.time=e.data.currentTime;var t,a=Object(O.a)(n.readyCallbacks);try{for(a.s();!(t=a.n()).done;){(0,t.value)(e.data.paused)}}catch(T){a.e(T)}finally{a.f()}break;case"readyState":var r;if(n.readyState=e.data.value,4===n.readyState)null===(r=n.oncanplay)||void 0===r||r.call(n);break;case"play":var i,c=Object(O.a)(n.playCallbacks);try{for(c.s();!(i=c.n()).done;){(0,i.value)(e.data.echo)}}catch(T){c.e(T)}finally{c.f()}break;case"pause":var o,s=Object(O.a)(n.pauseCallbacks);try{for(s.s();!(o=s.n()).done;){(0,o.value)(e.data.echo)}}catch(T){s.e(T)}finally{s.f()}break;case"audioTrackSelected":var u,l=Object(O.a)(n.audioTrackSelectedCallbacks);try{for(l.s();!(u=l.n()).done;){var d=u.value;n.selectedAudioTrack=e.data.id,d(e.data.id)}}catch(T){l.e(T)}finally{l.f()}break;case"currentTime":var b,f=Object(O.a)(n.currentTimeCallbacks);try{for(f.s();!(b=f.n()).done;){(0,b.value)(e.data.value,e.data.echo)}}catch(T){f.e(T)}finally{f.f()}break;case"exit":var h,j=Object(O.a)(n.exitCallbacks);try{for(j.s();!(h=j.n()).done;){(0,h.value)()}}catch(T){j.e(T)}finally{j.f()}break;case"offset":var p,v=Object(O.a)(n.offsetCallbacks);try{for(v.s();!(p=v.n()).done;){(0,p.value)(e.data.value)}}catch(T){v.e(T)}finally{v.f()}break;case"popOutToggle":var g,m=Object(O.a)(n.popOutToggleCallbacks);try{for(m.s();!(g=m.n()).done;){(0,g.value)()}}catch(T){m.e(T)}finally{m.f()}break;case"copy":var k,x=Object(O.a)(n.copyCallbacks);try{for(x.s();!(k=x.n()).done;){(0,k.value)(e.data.subtitle,e.data.audio,e.data.image)}}catch(T){x.e(T)}finally{x.f()}break;case"condensedModeToggle":var y,w=Object(O.a)(n.condensedModeToggleCallbacks);try{for(w.s();!(y=w.n()).done;){(0,y.value)()}}catch(T){w.e(T)}finally{w.f()}break;case"hideSubtitlePlayerToggle":var C,S=Object(O.a)(n.hideSubtitlePlayerToggleCallbacks);try{for(S.s();!(C=S.n()).done;){(0,C.value)()}}catch(T){S.e(T)}finally{S.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(T.a)(e,[{key:"onReady",value:function(e){this.isReady&&e(),this.readyCallbacks.push(e)}},{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onExit",value:function(e){this.exitCallbacks.push(e)}},{key:"onOffset",value:function(e){this.offsetCallbacks.push(e)}},{key:"onPopOutToggle",value:function(e){this.popOutToggleCallbacks.push(e)}},{key:"onCopy",value:function(e){this.copyCallbacks.push(e)}},{key:"onCondensedModeToggle",value:function(e){this.condensedModeToggleCallbacks.push(e)}},{key:"onHideSubtitlePlayerToggle",value:function(e){this.hideSubtitlePlayerToggleCallbacks.push(e)}},{key:"ready",value:function(e){this.protocol.postMessage({command:"ready",duration:e})}},{key:"init",value:function(){this.protocol.postMessage({command:"init"})}},{key:"play",value:function(){this.protocol.postMessage({command:"play"})}},{key:"pause",value:function(){this.protocol.postMessage({command:"pause"})}},{key:"audioTrackSelected",value:function(e){this.protocol.postMessage({command:"audioTrackSelected",id:e})}},{key:"subtitles",value:function(e){this.protocol.postMessage({command:"subtitles",value:e})}},{key:"subtitleSettings",value:function(e){this.protocol.postMessage({command:"subtitleSettings",value:e})}},{key:"condensedModeToggle",value:function(e){this.protocol.postMessage({command:"condensedModeToggle",value:e})}},{key:"hideSubtitlePlayerToggle",value:function(e){this.protocol.postMessage({command:"hideSubtitlePlayerToggle",value:e})}},{key:"close",value:function(){this.protocol.postMessage({command:"close"}),this.protocol.close()}},{key:"currentTime",get:function(){return this.time},set:function(e){this.time=e,this.readyState=3,this.protocol.postMessage({command:"currentTime",value:this.time})}}]),e}(),bn=Object(g.a)({root:{height:"calc(100vh - 64px)",position:"relative",overflowX:"hidden"},container:{width:"100%",height:"100%"},videoFrame:{width:"100%",height:"100%",border:0}});function fn(e,t){if(e<0)return fn(0,t);var n=e%1e3,a=(e=(e-n)/1e3)%60,r=(e=(e-a)/60)%60;return t>=36e5?hn((e-r)/60)+":"+hn(r)+":"+hn(a)+"."+jn(n):hn(r)+":"+hn(a)+"."+jn(n)}function hn(e){return String(e).padStart(2,"0")}function jn(e){return String(e).padEnd(3,"0")}function pn(e,t,n,a){var r;r=n&&n.length>0?a?n[n.length-1].end:n[n.length-1].originalEnd:0;var i=e.current&&e.current.duration?1e3*e.current.duration:0,c=t.current&&t.current.duration?1e3*t.current.duration:0;return Math.max(c,Math.max(r,i))}function On(e){var t,n,i=e.subtitleReader,c=e.settingsProvider,o=e.extension,s=e.offsetRef,u=e.videoFrameRef,l=e.drawerOpen,f=e.onError,h=e.onUnloadVideo,p=e.onCopy,O=e.onLoaded,v=e.disableKeyEvents,g=e.sources,m=g.subtitleFile,k=g.audioFile,x=g.audioFileUrl,y=g.videoFile,w=g.videoFileUrl,C=Object(r.useState)(),S=Object(j.a)(C,2),T=S[0],F=S[1],E=Object(r.useState)(),M=Object(j.a)(E,2),R=M[0],I=M[1],P=Object(r.useRef)();P.current=R;var N=Object(r.useState)(!1),A=Object(j.a)(N,2),U=A[0],_=A[1],B=Object(r.useState)(!1),L=Object(j.a)(B,2),D=L[0],W=L[1],z=Object(r.useState)(0),H=Object(j.a)(z,2),V=H[0],G=H[1],X=Object(r.useRef)();X.current=D;var K=Object(r.useState)(),J=Object(j.a)(K,2)[1],q=Object(r.useState)(),Q=Object(j.a)(q,2),Y=Q[0],$=Q[1],Z=Object(r.useState)(),ee=Object(j.a)(Z,2),te=ee[0],ne=ee[1],ae=Object(r.useState)(0),re=Object(j.a)(ae,2),ie=re[0],ce=re[1],oe=Object(r.useState)(),se=Object(j.a)(oe,2),ue=se[0],le=se[1],de=Object(r.useState)(!1),be=Object(j.a)(de,2),fe=be[0],he=be[1],je=Object(r.useState)(!1),pe=Object(j.a)(je,2),Oe=pe[0],ve=pe[1],ge=Object(r.useRef)();ge.current=Oe;var me=Object(r.useState)(!1),ke=Object(j.a)(me,2),xe=ke[0],ye=ke[1],we=Object(r.useRef)();we.current=xe;var Ce=Object(r.useCallback)((function(){return J({})}),[]),Se=Object(r.useRef)({x:0,y:0}),Te=Object(r.useRef)(),Fe=Object(r.useRef)(),Ee=Object(r.useMemo)((function(){return new en(x?Te:w||T?Fe:{})}),[x,w,T]),Me=Object(r.useMemo)((function(){return new ft}),[]),Re=bn(),Ie=Object(r.useState)([]),Pe=Object(j.a)(Ie,2),Ne=Pe[0],Ae=Pe[1],Ue=Object(r.useRef)(0);Ue.current=pn(Te,Fe,R,!0);var _e=Object(r.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(t,n,a){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t*Ue.current,n.setTime(r),Ce(),!a){e.next=6;break}return e.next=6,Ee.seek(r/1e3);case 6:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),[Ce,Ee]);function Be(e,t,n){W(!0),e.start(),n&&t.play()}function Le(e,t,n){W(!1),e.stop(),n&&t.pause()}Object(r.useEffect)((function(){function e(){return(e=Object(b.a)(d.a.mark((function e(){var t,n,a,r,s,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=Fe.current)||void 0===t||t.close(),Fe.current=null,Me.setTime(0),Me.stop(),W(!1),$(null),ne(null),ce(0),ye(!1),Te.current.currentTime=0,Te.current.pause(),!m){e.next=31;break}return _(!0),e.prev=13,e.next=16,i.subtitles(m);case 16:a=e.sent,r=a.length>0?a[a.length-1].end:0,n=a.map((function(e){return{text:e.text,start:e.start,originalStart:e.start,end:e.end,originalEnd:e.end,displayTime:fn(e.start,r)}})),I(n),G(Date.now()),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(13),f(e.t0.message);case 26:return e.prev=26,_(!1),e.finish(26);case 29:e.next=32;break;case 31:n=null;case 32:if(!x){e.next=38;break}return e.next=35,Ee.onReady();case 35:Ce(),e.next=39;break;case 38:(w||T)&&(w?(u=String(Date.now()),s=new dn(new dt(u)),le(u)):T&&(s=new dn(new bt(T.id,o))).init(),Fe.current=s,l=!1,s.onExit((function(){return h(w)})),s.onPopOutToggle((function(){return he((function(e){return!e}))})),s.onHideSubtitlePlayerToggle((function(){ve((function(e){return s.hideSubtitlePlayerToggle(!e),!e}))})),s.onReady((function(e){Ue.current=pn(Te,Fe,P.current),s.ready(Ue.current),P.current&&(s.subtitleSettings(c.subtitleSettings),s.subtitles(P.current)),s.condensedModeToggle(we.current),s.hideSubtitlePlayerToggle(ge.current),s.audioTracks&&s.audioTracks.length>1?($(Fe.current.audioTracks),ne(Fe.current.selectedAudioTrack)):($(null),ne(null)),Me.setTime(1e3*Fe.current.currentTime),e?Me.stop():Me.start(),W(!e),l||(s.onPlay((function(e){return Be(Me,Ee,e)})),s.onPause((function(e){return Le(Me,Ee,e)})),s.onOffset((function(e){var t;return ce(Math.max(null!==(t=-Ue.current)&&void 0!==t?t:0,e))})),s.onCopy((function(e,t,n){return p(e,k,y,m,s.selectedAudioTrack,t,n)})),s.onCondensedModeToggle((function(){return ye((function(e){var t=!e;return s.condensedModeToggle(t),t}))})),s.onCurrentTime(function(){var e=Object(b.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=1e3*t/Ue.current,X.current&&Me.stop(),e.next=4,_e(a,Me,n);case 4:X.current&&Me.start();case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),s.onAudioTrackSelected(function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return X.current&&Me.stop(),e.next=3,Ee.onReady();case 3:X.current&&Me.start(),ne(t);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),l=!0)})));case 39:case"end":return e.stop()}}),e,null,[[13,23,26,29]])})))).apply(this,arguments)}(function(){return e.apply(this,arguments)})().then((function(){return O()}))}),[i,o,c,Me,Ee,_e,O,f,h,p,m,k,x,y,w,T,Ce,u]),Object(r.useEffect)((function(){if(xe&&R&&0!==R.length){var e=!1,t=1e3,n=setInterval(Object(b.a)(d.a.mark((function n(){var a,r,i,c,o,s,u,l,b,f;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=Ue.current){n.next=3;break}return n.abrupt("return");case 3:r=Me.progress(a),i=0,c=-1,o=R.length-1;case 7:if(!(o>=0)){n.next=17;break}if(s=R[o],u=s.start/a,l=s.end/a,!(r>=u)){n.next=14;break}return r<l?(c=o,i=o):i=Math.min(R.length-1,o+1),n.abrupt("break",17);case 14:--o,n.next=7;break;case 17:if(c===i){n.next=30;break}if(!((b=R[i]).start-r*a<t+500)){n.next=21;break}return n.abrupt("return");case 21:if(X.current&&Me.stop(),e){n.next=29;break}return e=!0,f=Date.now(),n.next=27,_e(b.start/a,Me,!0);case 27:t=Date.now()-f,e=!1;case 29:X.current&&Me.start();case 30:case"end":return n.stop()}}),n)}))),100);return function(){return clearInterval(n)}}}),[R,xe,Me,_e]),Object(r.useEffect)((function(){fe&&ue&&w&&window.open("/asbplayer/?video="+encodeURIComponent(w)+"&channel="+ue+"&popout=true","asbplayer-video-"+w,"resizable,width=800,height=450"),G(Date.now())}),[fe,ue,w,u]);var De=Object(r.useCallback)((function(){return Be(Me,Ee,!0)}),[Me,Ee]),We=Object(r.useCallback)((function(){return Le(Me,Ee,!0)}),[Me,Ee]),ze=Object(r.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return X.current&&Me.stop(),e.next=3,_e(t,Me,!0);case 3:X.current&&Me.start();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Me,_e]),He=Object(r.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n||Le(Me,Ee,!0),X.current&&Me.stop(),e.next=4,_e(t,Me,!0);case 4:n&&!X.current&&Be(Me,Ee,!0);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[Me,_e,Ee]),Ve=Object(r.useCallback)((function(e,t){p(e,k,y,m,te)}),[p,k,y,m,te]),Ge=Object(r.useCallback)((function(e){Se.current.x=e.screenX,Se.current.y=e.screenY}),[]),Xe=Object(r.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Fe.current&&Fe.current.audioTrackSelected(t),Le(Me,Ee,!0),e.next=4,_e(0,Me,!0);case 4:X.current&&Be(Me,Ee,!0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Me,Ee,_e]),Ke=Object(r.useCallback)((function(e){var t=Ne.filter((function(t){return t.id===e}))[0];F(t)}),[Ne]),Je=Object(r.useCallback)((function(e){var t;ce(Math.max(null!==(t=-Ue.current)&&void 0!==t?t:0,e))}),[]);Object(r.useEffect)((function(){s&&(s.current=ie),I((function(e){var t;if(e){var n=e.length>0?e[e.length-1].end+ie:0,a=e.map((function(e){return{text:e.text,start:e.originalStart+ie,originalStart:e.originalStart,end:e.originalEnd+ie,originalEnd:e.originalEnd,displayTime:fn(e.originalStart+ie,n)}}));return null===(t=Fe.current)||void 0===t||t.subtitles(a),a}}))}),[ie,s]);var qe=Object(r.useCallback)((function(e){Te.current&&(Te.current.volume=e)}),[]),Qe=Object(r.useCallback)((function(){return ye((function(e){return!e}))}),[]);Object(r.useEffect)((function(){var e=setInterval((function(){var e=Ue.current;Me.progress(e)>=1&&(Me.setTime(0),Me.stop(),Ee.pause(),W(!1),G(Date.now()))}),1e3);return function(){return clearInterval(e)}}),[Me,R,Ee]),Object(r.useEffect)((function(){var t=setInterval((function(){if(e.extension.tabs.length!==Ne.length)Ae(e.extension.tabs);else{for(var t=!1,n=0;n<Ne.length;++n){var a=Ne[n],r=e.extension.tabs[n];if(a.id!==r.id||a.title!==r.title||a.src!==r.src){t=!0;break}}t&&Ae(e.extension.tabs)}T&&0===e.extension.tabs.filter((function(e){return e.id===T.id&&e.src===T.src})).length&&(F(null),e.onError("Lost connection with tab "+T.id+" "+T.title))}),1e3);return function(){return clearInterval(t)}}),[Ne,T,e]),Object(r.useEffect)((function(){F(null)}),[k,y]);var Ye=Ue.current,$e=x||w||R,Ze=$e&&w&&ue&&!fe;return Object(a.jsxs)("div",{onMouseMove:Ge,className:Re.root,children:[Object(a.jsxs)(yt.a,{container:!0,direction:"row",wrap:"nowrap",className:Re.container,children:[Ze&&Object(a.jsx)(yt.a,{item:!0,style:{flexGrow:1,minWidth:600},children:Object(a.jsx)("iframe",{ref:u,className:Re.videoFrame,src:"/asbplayer/?video="+encodeURIComponent(w)+"&channel="+ue+"&popout=false",title:"asbplayer"})}),(!Ze||(null===(t=R)||void 0===t?void 0:t.length)>0)&&Object(a.jsxs)(yt.a,{item:!0,style:{flexGrow:Ze?0:1,width:Ze&&Oe?0:"auto"},children:[$e&&!(w&&!fe)&&Object(a.jsx)(Zt,{mousePositionRef:Se,playing:D,clock:Me,length:Ye,displayLength:pn(Te,Fe,R,!1),audioTracks:Y,selectedAudioTrack:te,tabs:!w&&!x&&Ne,selectedTab:T&&T.id,audioFile:null===k||void 0===k?void 0:k.name,videoFile:null===y||void 0===y?void 0:y.name,offsetEnabled:!0,offset:ie,volumeEnabled:Boolean(x),condensedModeToggleEnabled:Boolean(x)&&(null===(n=R)||void 0===n?void 0:n.length)>0,condensedModeEnabled:xe,onPlay:De,onPause:We,onSeek:ze,onAudioTrackSelected:Xe,onTabSelected:Ke,onUnloadAudio:function(){return e.onUnloadAudio(x)},onUnloadVideo:function(){return e.onUnloadVideo(w)},onOffsetChange:Je,onVolumeChange:qe,onCondensedModeToggle:Qe,disableKeyEvents:v,settingsProvider:c}),Object(a.jsx)(ln,{playing:D,subtitles:R,clock:Me,length:Ye,jumpToSubtitle:e.jumpToSubtitle,drawerOpen:l,compressed:w&&!fe,loading:U,displayHelp:(null===k||void 0===k?void 0:k.name)||fe&&(null===y||void 0===y?void 0:y.name),disableKeyEvents:v,lastJumpToTopTimestamp:V,hidden:Ze&&Oe,onSeek:He,onCopy:Ve})]})]}),Object(a.jsx)("audio",{ref:Te,src:x})]})}var vn=n(347),gn=n(339);function mn(e){var t=e.open,n=e.onProceed,i=e.onCancel,c=e.existingCustomFieldNames,o=Object(r.useState)(""),s=Object(j.a)(o,2),u=s[0],l=s[1];Object(r.useEffect)((function(){l("")}),[t]);var d=[].concat(Object(h.a)(c),["Sentence","Word","Definition","Source","Image","Audio"]).includes(u);return Object(a.jsxs)(P.a,{open:t,disableEnforceFocus:!0,fullWidth:!0,maxWidth:"xs",onBackdropClick:function(){return i()},children:[Object(a.jsx)(gn.a,{children:"New Custom Field"}),Object(a.jsx)(A.a,{children:Object(a.jsx)("form",{children:Object(a.jsx)(I.a,{error:d,helperText:d&&"Field ".concat(u," already exists"),variant:"filled",fullWidth:!0,label:"Field Name",value:u,color:"secondary",onChange:function(e){return l(e.target.value)}})})}),Object(a.jsxs)(N.a,{children:[Object(a.jsx)(R.a,{onClick:function(){return i()},children:"Cancel"}),Object(a.jsx)(R.a,{disabled:d||""===u.trim(),onClick:function(){return n(u.trim())},children:"Create"})]})]})}var kn=n(269),xn=n(342),yn=n(341),wn=n(272),Cn=n(271),Sn=n(270),Tn=n(340),Fn=n(179),En=n.n(Fn),Mn=n(275),Rn=Object(M.a)((function(e){return{root:{"& .MuiTextField-root":{marginTop:e.spacing(1),marginBottom:e.spacing(1)}},subtitleSetting:{"& .MuiTextField-root":{marginTop:e.spacing(1),marginBottom:e.spacing(1)}},addFieldButton:{width:"100%"}}})),In=Object(M.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120},root:{display:"flex",flexDirection:"row",justifyContent:"end",alignItems:"flex-end"}}}));function Pn(e){var t=e.label,n=e.value,r=e.selections,i=e.removable,c=e.onChange,o=e.onSelectionChange,s=e.onRemoval,u=In();return Object(a.jsxs)("div",{className:u.root,children:[Object(a.jsx)(I.a,{label:t,value:n,onChange:c,fullWidth:!0,color:"secondary",InputProps:{endAdornment:i&&Object(a.jsx)(_.a,{position:"end",children:Object(a.jsx)(U.a,{onClick:function(e){return null===s||void 0===s?void 0:s()},children:Object(a.jsx)(Ke.a,{})})})}}),Object(a.jsxs)(kn.a,{className:u.formControl,children:[Object(a.jsx)(Sn.a,{}),Object(a.jsx)(Mn.a,{value:n,disabled:!r,color:"secondary",onChange:o,children:r&&r.map((function(e){return Object(a.jsx)(Tn.a,{value:e,children:e},e)}))})]})]})}function Nn(e){var t=e.anki,n=e.open,c=e.settings,o=e.onClose,s=Rn(),u=Object(r.useState)(c.ankiConnectUrl),l=Object(j.a)(u,2),f=l[0],p=l[1],O=Object(r.useState)(),v=Object(j.a)(O,2),g=v[0],m=v[1],k=Object(r.useState)(0),x=Object(j.a)(k,2),y=x[0],w=x[1],C=Object(r.useState)(c.deck||""),S=Object(j.a)(C,2),T=S[0],F=S[1],E=Object(r.useState)(),M=Object(j.a)(E,2),B=M[0],L=M[1],D=Object(r.useState)(c.noteType||""),W=Object(j.a)(D,2),z=W[0],H=W[1],V=Object(r.useState)(),G=Object(j.a)(V,2),X=G[0],K=G[1],J=Object(r.useState)(c.sentenceField||""),q=Object(j.a)(J,2),Q=q[0],Y=q[1],$=Object(r.useState)(c.definitionField||""),Z=Object(j.a)($,2),ee=Z[0],te=Z[1],ne=Object(r.useState)(c.audioField||""),ae=Object(j.a)(ne,2),re=ae[0],ie=ae[1],ce=Object(r.useState)(c.imageField||""),oe=Object(j.a)(ce,2),se=oe[0],ue=oe[1],le=Object(r.useState)(c.wordField||""),de=Object(j.a)(le,2),be=de[0],fe=de[1],he=Object(r.useState)(c.sourceField||""),je=Object(j.a)(he,2),pe=je[0],Oe=je[1],ve=Object(r.useState)(c.customAnkiFields),ge=Object(j.a)(ve,2),me=ge[0],ke=ge[1],xe=Object(r.useState)(c.preferMp3),ye=Object(j.a)(xe,2),we=ye[0],Ce=ye[1],Se=Object(r.useState)(),Te=Object(j.a)(Se,2),Fe=Te[0],Ee=Te[1],Me=Object(r.useState)(!1),Re=Object(j.a)(Me,2),Ie=Re[0],Pe=Re[1],Ne=Object(r.useState)(c.subtitleColor),Ae=Object(j.a)(Ne,2),Ue=Ae[0],_e=Ae[1],Be=Object(r.useState)(c.subtitleSize),Le=Object(j.a)(Be,2),De=Le[0],We=Le[1],ze=Object(r.useState)(c.subtitleOutlineColor),He=Object(j.a)(ze,2),Ve=He[0],Ge=He[1],Xe=Object(r.useState)(c.subtitleOutlineThickness),Ke=Object(j.a)(Xe,2),Je=Ke[0],qe=Ke[1],Qe=Object(r.useState)(c.subtitleBackgroundColor),Ye=Object(j.a)(Qe,2),$e=Ye[0],Ze=Ye[1],et=Object(r.useState)(c.subtitleBackgroundOpacity),tt=Object(j.a)(et,2),nt=tt[0],at=tt[1],rt=Object(r.useCallback)((function(e){p(e.target.value),w(Date.now())}),[]),it=Object(r.useCallback)((function(e){return w(Date.now())}),[]),ct=Object(r.useCallback)((function(e){return F(e.target.value)}),[]),ot=Object(r.useCallback)((function(e){return H(e.target.value)}),[]),st=Object(r.useCallback)((function(e){return Y(e.target.value)}),[]),ut=Object(r.useCallback)((function(e){return te(e.target.value)}),[]),lt=Object(r.useCallback)((function(e){return ie(e.target.value)}),[]),dt=Object(r.useCallback)((function(e){return ue(e.target.value)}),[]),bt=Object(r.useCallback)((function(e){return fe(e.target.value)}),[]),ft=Object(r.useCallback)((function(e){return Oe(e.target.value)}),[]),ht=Object(r.useCallback)((function(e){return _e(e.target.value)}),[]),jt=Object(r.useCallback)((function(e){return We(e.target.value)}),[]),pt=Object(r.useCallback)((function(e){return Ge(e.target.value)}),[]),Ot=Object(r.useCallback)((function(e){return qe(e.target.value)}),[]),vt=Object(r.useCallback)((function(e){return Ze(e.target.value)}),[]),gt=Object(r.useCallback)((function(e){return at(e.target.value)}),[]),mt=Object(r.useCallback)((function(e){ke((function(t){var n={};return Object.assign(n,t),n[e]="",n})),Pe(!1)}),[]),kt=Object(r.useCallback)((function(e,t){ke((function(n){var a={};return Object.assign(a,n),a[e]=t,a}))}),[]),xt=Object(r.useCallback)((function(e){return ke((function(t){var n={};return Object.assign(n,t),delete n[e],n}))}),[]),wt=Object(r.useCallback)((function(e){return Ce(e.target.checked)}),[]);Object(r.useEffect)((function(){var e=!1,n=setTimeout(Object(b.a)(d.a.mark((function n(){return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e){n.next=3;break}return n.abrupt("return");case 3:return n.t0=L,n.next=6,t.deckNames(f);case 6:return n.t1=n.sent,(0,n.t0)(n.t1),n.t2=K,n.next=11,t.modelNames(f);case 11:n.t3=n.sent,(0,n.t2)(n.t3),m(null),n.next=24;break;case 16:if(n.prev=16,n.t4=n.catch(0),!e){n.next=20;break}return n.abrupt("return");case 20:console.error(n.t4),L(null),K(null),m(n.t4.message);case 24:case"end":return n.stop()}}),n,null,[[0,16]])}))),1e3);return function(){e=!0,clearTimeout(n)}}),[t,f,y]),Object(r.useEffect)((function(){if(z&&!g){var e=!1;return function(){n.apply(this,arguments)}(),function(){return e=!0}}function n(){return(n=Object(b.a)(d.a.mark((function n(){return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e){n.next=3;break}return n.abrupt("return");case 3:return n.t0=Ee,n.t1=[""],n.t2=h.a,n.next=8,t.modelFieldNames(z,f);case 8:n.t3=n.sent,n.t4=(0,n.t2)(n.t3),n.t5=n.t1.concat.call(n.t1,n.t4),(0,n.t0)(n.t5),m(null),n.next=22;break;case 15:if(n.prev=15,n.t6=n.catch(0),!e){n.next=19;break}return n.abrupt("return");case 19:console.error(n.t6),Ee(null),m(n.t6.message);case 22:case"end":return n.stop()}}),n,null,[[0,15]])})))).apply(this,arguments)}}),[t,z,f,g,y]);var Ct=Object(r.useCallback)((function(){o({ankiConnectUrl:f,deck:T,noteType:z,sentenceField:Q,definitionField:ee,audioField:re,imageField:se,wordField:be,sourceField:pe,subtitleSize:Number(De),subtitleColor:Ue,subtitleOutlineThickness:Number(Je),subtitleOutlineColor:Ve,subtitleBackgroundColor:$e,subtitleBackgroundOpacity:Number(nt),customAnkiFields:me,preferMp3:we})}),[o,f,T,z,Q,ee,re,se,be,pe,me,we,De,Ue,Je,Ve,$e,nt]),St=Object.keys(me).map((function(e){return Object(a.jsx)(Pn,{label:"".concat(e," Field"),value:me[e],selections:Fe,onChange:function(t){return kt(e,t.target.value)},onSelectionChange:function(t){return kt(e,t.target.value)},onRemoval:function(){return xt(e)},removable:!0},e)}));return Object(a.jsxs)(i.a.Fragment,{children:[Object(a.jsx)(mn,{open:Ie,existingCustomFieldNames:Object.keys(me),onProceed:mt,onCancel:function(){return Pe(!1)}}),Object(a.jsxs)(P.a,{open:n,maxWidth:"xs",fullWidth:!0,onBackdropClick:Ct,children:[Object(a.jsx)(gn.a,{children:"Settings"}),Object(a.jsx)(A.a,{children:Object(a.jsxs)(yt.a,{container:!0,direction:"column",spacing:3,children:[Object(a.jsxs)(yt.a,{item:!0,children:[Object(a.jsx)(Cn.a,{children:"Anki"}),Object(a.jsxs)(yn.a,{className:s.root,children:[Object(a.jsx)(I.a,{label:"Anki Connect URL",value:f,error:Boolean(g),helperText:g,color:"secondary",onChange:rt,InputProps:{endAdornment:Object(a.jsx)(_.a,{position:"end",children:Object(a.jsx)(U.a,{onClick:it,children:Object(a.jsx)(En.a,{})})})}}),Object(a.jsxs)(wn.a,{children:["Ensure that ",window.location.protocol+"//"+window.location.hostname," is in the webCorsOriginList in your AnkiConnect settings. Leaving a field blank is fine."]}),Object(a.jsx)(Pn,{label:"Deck",value:T,selections:B,onChange:ct,onSelectionChange:ct}),Object(a.jsx)(Pn,{label:"Note Type",value:z,selections:X,onChange:ot,onSelectionChange:ot}),Object(a.jsx)(Pn,{label:"Sentence Field",value:Q,selections:Fe,onChange:st,onSelectionChange:st}),Object(a.jsx)(Pn,{label:"Definition Field",value:ee,selections:Fe,onChange:ut,onSelectionChange:ut}),Object(a.jsx)(Pn,{label:"Word Field",value:be,selections:Fe,onChange:bt,onSelectionChange:bt}),Object(a.jsx)(Pn,{label:"Audio Field",value:re,selections:Fe,onChange:lt,onSelectionChange:lt}),Object(a.jsx)(Pn,{label:"Image Field",value:se,selections:Fe,onChange:dt,onSelectionChange:dt}),Object(a.jsx)(Pn,{label:"Source Field",value:pe,selections:Fe,onChange:ft,onSelectionChange:ft}),St,Object(a.jsx)(R.a,{className:s.addFieldButton,onClick:function(e){return Pe(!0)},children:"Add Custom Field"}),Object(a.jsx)(xn.a,{control:Object(a.jsx)(vn.a,{checked:we,onChange:wt}),label:"Re-encode audio as mp3 (slower)"})]})]}),Object(a.jsxs)(yt.a,{item:!0,children:[Object(a.jsx)(Cn.a,{children:"Video Subtitle Appearance"}),Object(a.jsxs)(yn.a,{children:[Object(a.jsx)("div",{className:s.subtitleSetting,children:Object(a.jsx)(I.a,{type:"color",label:"Subtitle Color",fullWidth:!0,value:Ue,color:"secondary",onChange:ht})}),Object(a.jsx)("div",{className:s.subtitleSetting,children:Object(a.jsx)(I.a,{type:"number",label:"Subtitle Size",fullWidth:!0,value:De,color:"secondary",onChange:jt,inputProps:{min:1,step:1}})}),Object(a.jsx)("div",{className:s.subtitleSetting,children:Object(a.jsx)(I.a,{type:"color",label:"Subtitle Outline Color",fullWidth:!0,value:Ve,color:"secondary",onChange:pt})}),Object(a.jsx)("div",{className:s.subtitleSetting,children:Object(a.jsx)(I.a,{type:"number",label:"Subtitle Outline Thickness",fullWidth:!0,value:Je,onChange:Ot,inputProps:{min:0,step:1},color:"secondary"})}),Object(a.jsx)("div",{className:s.subtitleSetting,children:Object(a.jsx)(I.a,{type:"color",label:"Subtitle Background Color",fullWidth:!0,value:$e,color:"secondary",onChange:vt})}),Object(a.jsx)("div",{className:s.subtitleSetting,children:Object(a.jsx)(I.a,{type:"number",label:"Subtitle Background Opacity",fullWidth:!0,inputProps:{min:0,max:1,step:.1},value:nt,color:"secondary",onChange:gt})})]})]})]})}),Object(a.jsx)(N.a,{children:Object(a.jsx)(R.a,{onClick:Ct,children:"OK"})})]})]})}var An="ankiConnectUrl",Un="deck",_n="noteType",Bn="sentenceField",Ln="definitionField",Dn="audioField",Wn="imageField",zn="wordField",Hn="sourceField",Vn="customAnkiFields",Gn="subtitleSize",Xn="subtitleColor",Kn="subtitleOutlineThickness",Jn="subtitleOutlineColor",qn="subtitleBackgroundColor",Qn="subtitleBackgroundOpacity",Yn="volume",$n="preferMp3",Zn=function(){function e(){Object(S.a)(this,e)}return Object(T.a)(e,[{key:"settings",get:function(){return{ankiConnectUrl:this.ankiConnectUrl,deck:this.deck,noteType:this.noteType,sentenceField:this.sentenceField,definitionField:this.definitionField,audioField:this.audioField,imageField:this.imageField,wordField:this.wordField,customAnkiFields:this.customAnkiFields,sourceField:this.sourceField,subtitleSize:this.subtitleSize,subtitleColor:this.subtitleColor,subtitleOutlineThickness:this.subtitleOutlineThickness,subtitleOutlineColor:this.subtitleOutlineColor,subtitleBackgroundColor:this.subtitleBackgroundColor,subtitleBackgroundOpacity:this.subtitleBackgroundOpacity,preferMp3:this.preferMp3}}},{key:"subtitleSettings",get:function(){return{subtitleSize:this.subtitleSize,subtitleColor:this.subtitleColor,subtitleOutlineThickness:this.subtitleOutlineThickness,subtitleOutlineColor:this.subtitleOutlineColor,subtitleBackgroundColor:this.subtitleBackgroundColor,subtitleBackgroundOpacity:this.subtitleBackgroundOpacity}}},{key:"ankiConnectUrl",get:function(){return localStorage.getItem(An)||"http://127.0.0.1:8765"},set:function(e){localStorage.setItem(An,e)}},{key:"deck",get:function(){return localStorage.getItem(Un)},set:function(e){localStorage.setItem(Un,e)}},{key:"noteType",get:function(){return localStorage.getItem(_n)},set:function(e){localStorage.setItem(_n,e)}},{key:"sentenceField",get:function(){return localStorage.getItem(Bn)},set:function(e){localStorage.setItem(Bn,e)}},{key:"definitionField",get:function(){return localStorage.getItem(Ln)},set:function(e){localStorage.setItem(Ln,e)}},{key:"audioField",get:function(){return localStorage.getItem(Dn)},set:function(e){localStorage.setItem(Dn,e)}},{key:"imageField",get:function(){return localStorage.getItem(Wn)},set:function(e){localStorage.setItem(Wn,e)}},{key:"wordField",get:function(){return localStorage.getItem(zn)},set:function(e){localStorage.setItem(zn,e)}},{key:"sourceField",get:function(){return localStorage.getItem(Hn)},set:function(e){localStorage.setItem(Hn,e)}},{key:"customAnkiFields",get:function(){var e=localStorage.getItem(Vn);return e?JSON.parse(e):{}},set:function(e){localStorage.setItem(Vn,JSON.stringify(e))}},{key:"subtitleColor",get:function(){return localStorage.getItem(Xn)||"#ffffff"},set:function(e){localStorage.setItem(Xn,e)}},{key:"subtitleSize",get:function(){return localStorage.getItem(Gn)||36},set:function(e){localStorage.setItem(Gn,e)}},{key:"subtitleOutlineColor",get:function(){return localStorage.getItem(Jn)||"#000000"},set:function(e){localStorage.setItem(Jn,e)}},{key:"subtitleOutlineThickness",get:function(){return localStorage.getItem(Kn)||0},set:function(e){localStorage.setItem(Kn,e)}},{key:"subtitleBackgroundColor",get:function(){return localStorage.getItem(qn)||"#000000"},set:function(e){localStorage.setItem(qn,e)}},{key:"subtitleBackgroundOpacity",get:function(){return localStorage.getItem(Qn)||.5},set:function(e){localStorage.setItem(Qn,e)}},{key:"volume",get:function(){return localStorage.getItem(Yn)||100},set:function(e){localStorage.setItem(Yn,e)}},{key:"preferMp3",get:function(){return"true"===localStorage.getItem($n)||!1},set:function(e){localStorage.setItem($n,e)}}]),e}(),ea=n(180),ta=function(){function e(t){Object(S.a)(this,e),this.channel=new BroadcastChannel(t),this.time=0,this.duration=0,this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.closeCallbacks=[],this.readyCallbacks=[],this.subtitlesCallbacks=[],this.condensedModeToggleCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[];var n=this;this.channel.onmessage=function(e){switch(e.data.command){case"init":break;case"ready":var t,a=Object(O.a)(n.readyCallbacks);try{for(a.s();!(t=a.n()).done;){(0,t.value)(e.data.duration)}}catch(k){a.e(k)}finally{a.f()}break;case"play":var r,i=Object(O.a)(n.playCallbacks);try{for(i.s();!(r=i.n()).done;){(0,r.value)()}}catch(k){i.e(k)}finally{i.f()}break;case"pause":var c,o=Object(O.a)(n.pauseCallbacks);try{for(o.s();!(c=o.n()).done;){(0,c.value)()}}catch(k){o.e(k)}finally{o.f()}break;case"currentTime":var s,u=Object(O.a)(n.currentTimeCallbacks);try{for(u.s();!(s=u.n()).done;){(0,s.value)(e.data.value)}}catch(k){u.e(k)}finally{u.f()}break;case"audioTrackSelected":var l,d=Object(O.a)(n.audioTrackSelectedCallbacks);try{for(d.s();!(l=d.n()).done;){(0,l.value)(e.data.id)}}catch(k){d.e(k)}finally{d.f()}break;case"close":var b,f=Object(O.a)(n.closeCallbacks);try{for(f.s();!(b=f.n()).done;){(0,b.value)()}}catch(k){f.e(k)}finally{f.f()}break;case"subtitles":var h,j=Object(O.a)(n.subtitlesCallbacks);try{for(j.s();!(h=j.n()).done;){(0,h.value)(e.data.value)}}catch(k){j.e(k)}finally{j.f()}break;case"subtitleSettings":break;case"condensedModeToggle":var p,v=Object(O.a)(n.condensedModeToggleCallbacks);try{for(v.s();!(p=v.n()).done;){(0,p.value)(e.data.value)}}catch(k){v.e(k)}finally{v.f()}break;case"hideSubtitlePlayerToggle":var g,m=Object(O.a)(n.hideSubtitlePlayerToggleCallbacks);try{for(m.s();!(g=m.n()).done;){(0,g.value)(e.data.value)}}catch(k){m.e(k)}finally{m.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(T.a)(e,[{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onClose",value:function(e){this.closeCallbacks.push(e)}},{key:"onReady",value:function(e){this.readyCallbacks.push(e)}},{key:"onSubtitles",value:function(e){this.subtitlesCallbacks.push(e)}},{key:"onCondensedModeToggle",value:function(e){this.condensedModeToggleCallbacks.push(e)}},{key:"onHideSubtitlePlayerToggle",value:function(e){this.hideSubtitlePlayerToggleCallbacks.push(e)}},{key:"ready",value:function(e,t,n,a){var r;null===(r=this.channel)||void 0===r||r.postMessage({command:"ready",duration:e,paused:t,currentTime:0,audioTracks:n,selectedAudioTrack:a})}},{key:"readyState",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"readyState",value:e})}},{key:"play",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"play",echo:!0})}},{key:"pause",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"pause",echo:!0})}},{key:"audioTrackSelected",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"audioTrackSelected",id:e})}},{key:"offset",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"offset",value:e})}},{key:"popOutToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"popOutToggle"})}},{key:"copy",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"copy",subtitle:e})}},{key:"condensedModeToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"condensedModeToggle"})}},{key:"hideSubtitlePlayerToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"hideSubtitlePlayerToggle"})}},{key:"close",value:function(){this.channel&&(this.channel.postMessage({command:"exit"}),this.channel.close(),this.channel=null)}},{key:"currentTime",get:function(){return this.time},set:function(e){var t;this.time=e,null===(t=this.channel)||void 0===t||t.postMessage({command:"currentTime",value:this.time,echo:!0})}}]),e}(),na=Object(g.a)({root:{position:"relative",backgroundColor:"black",height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},video:{margin:"auto"},cursorHidden:{cursor:"none"}});function aa(e,t,n,a,r,i){var c={position:"absolute",paddingLeft:20,paddingRight:20,bottom:100,textAlign:"center",color:t,fontSize:Number(e)};if(n>0){var o=n,s=a;c.textShadow="0 0 ".concat(o,"px ").concat(s,", 0 0 ").concat(o,"px ").concat(s,", 0 0 ").concat(o,"px ").concat(s,", 0 0 ").concat(o,"px ").concat(s)}if(i>0){var u=i,l=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}}(r),d=l.r,b=l.g,f=l.b;c.backgroundColor="rgba(".concat(d,", ").concat(b,", ").concat(f,", ").concat(u,")")}return c}function ra(e,t,n,a){if(window.outerWidth&&e.videoWidth>0&&e.videoHeight>0){var r=window.screen.availWidth-(window.outerWidth-window.innerWidth),i=window.screen.availHeight-(window.outerHeight-window.innerHeight),c=Math.min(1,Math.min(r/e.videoWidth,i/e.videoHeight));window.resizeTo(c*e.videoWidth+(window.outerWidth-window.innerWidth),c*e.videoHeight+(window.outerHeight-window.innerHeight))}var o,s;if(e.audioTracks){o=[];var u,l=Object(O.a)(e.audioTracks);try{for(l.s();!(u=l.n()).done;){var d=u.value;o.push({id:d.id,label:d.label,language:d.language}),d.enabled&&(s=d.id)}}catch(b){l.e(b)}finally{l.f()}}else o=null,s=null;n(o),a(s),t.ready(e.duration,e.paused,o,s)}function ia(e){var t=na(),n=e.settingsProvider,c=e.videoFile,o=e.channel,s=e.popOut,u=e.onError,l=Object(r.useRef)(),d=Object(r.useRef)(),b=m(!0),h=Object(j.a)(b,2),p=h[0],v=h[1];d.current&&(d.current.width=p,d.current.height=v);var g=Object(r.useMemo)((function(){return new ta(o)}),[o]),k=Object(r.useState)(!1),x=Object(j.a)(k,2),y=x[0],w=x[1],S=function(){var e=Object(r.useState)(Boolean(document.fullscreenElement)),t=Object(j.a)(e,2),n=t[0],a=t[1];return Object(r.useEffect)((function(){var e=function(){return a(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",e),function(){return document.removeEventListener("fullscreenchange",e)}}),[]),n}(),T=Object(r.useRef)();T.current=y;var F=Object(r.useState)(0),E=Object(j.a)(F,2),M=E[0],R=E[1],I=Object(r.useState)(0),P=Object(j.a)(I,2),N=P[0],A=P[1],U=Object(r.useState)(),_=Object(j.a)(U,2),B=_[0],L=_[1],D=Object(r.useState)(),W=Object(j.a)(D,2),z=W[0],H=W[1],V=Object(r.useState)([]),G=Object(j.a)(V,2),X=G[0],K=G[1],J=Object(r.useState)([]),q=Object(j.a)(J,2),Q=q[0],Y=q[1],$=Object(r.useState)(!0),Z=Object(j.a)($,2),ee=Z[0],te=Z[1],ne=Object(r.useState)(!1),ae=Object(j.a)(ne,2),re=ae[0],ie=ae[1],ce=Object(r.useState)(!1),oe=Object(j.a)(ce,2),se=oe[0],ue=oe[1],le=Object(r.useRef)([]);le.current=Q;var de=Object(r.useMemo)((function(){return new ft}),[]),be=Object(r.useRef)({x:0,y:0}),fe=Object(r.useRef)(),he=Object(r.useState)(),je=Object(j.a)(he,2),pe=je[0],Oe=je[1],ve=Object(r.useState)(!1),ge=Object(j.a)(ve,2),me=ge[0],ke=ge[1],xe=Object(r.useState)(!0),ye=Object(j.a)(xe,2),we=ye[0],Ce=ye[1],Se=Object(r.useCallback)((function(e){e&&(d.current=e,4===e.readyState?ra(e,g,L,H):e.onloadeddata=function(t){ra(e,g,L,H)},e.oncanplay=function(e){g.readyState(4),T.current&&de.start()},e.onerror=function(t){return u(function(e){var t;switch(e.error.code){case 1:t="Aborted";break;case 2:t="Network error";break;case 3:t="Decoding error";break;case 4:t="Source not supported";break;default:t="Unknown error"}return t+": "+(e.error.message||"<details missing>")}(e))})}),[de,g,u]);function Te(e){var t,n=Object(O.a)(d.current.audioTracks);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.id===e?a.enabled=!0:a.enabled=!1}}catch(r){n.e(r)}finally{n.f()}}Object(r.useEffect)((function(){return g.onReady((function(e){return R(e)})),g.onPlay((function(){d.current.play(),de.start(),w(!0)})),g.onPause((function(){d.current.pause(),de.stop(),w(!1)})),g.onCurrentTime((function(e){var t;d.current&&(d.current.currentTime=e),4===(null===(t=d.current)||void 0===t?void 0:t.readyState)&&g.readyState(4),de.stop(),de.setTime(1e3*e)})),g.onAudioTrackSelected((function(e){Te(e),g.audioTrackSelected(e)})),g.onClose((function(){g.close(),window.close()})),g.onSubtitles((function(e){if(K(e),e&&e.length>0){var t=e[0],n=t.start-t.originalStart;A(n)}})),g.onCondensedModeToggle((function(e){return ie(e)})),g.onHideSubtitlePlayerToggle((function(e){return ue(e)})),window.onbeforeunload=function(e){l.current||g.close()},function(){return g.close()}}),[de,g]);var Fe=Object(r.useCallback)((function(){d.current&&g.play()}),[g]),Ee=Object(r.useCallback)((function(){return g.pause()}),[g]),Me=Object(r.useCallback)((function(e){T.current&&de.stop();var t=e*M;g.currentTime=t/1e3}),[M,de,g]);var Re=Object(r.useCallback)((function(e){T.current&&(de.stop(),g.pause()),Te(e),H(e),g.currentTime=0,g.audioTrackSelected(e)}),[g,de]);Object(r.useEffect)((function(){if(X&&0!==X.length){var e=setInterval((function(){for(var e=1e3*d.current.currentTime,t=[],n=0;n<X.length;++n){var a=X[n];if(e>=a.start&&e<a.end&&t.push(Object(f.a)(Object(f.a)({},a),{},{index:n})),e<a.start)break}(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};if(e.length!==t.length)return!1;for(var a=0;a<e.length;++a)if(!n(e[a],t[a]))return!1;return!0})(t,le.current,(function(e,t){return e.index===t.index}))||Y(t)}),10);return function(){return clearTimeout(e)}}}),[X]),Object(r.useEffect)((function(){function e(e){if(d.current&&X&&0!==X.length){var t;if(37===e.keyCode)t=!1;else{if(39!==e.keyCode)return;t=!0}var n=Math.round(1e3*d.current.currentTime),a=-1;if(t)for(var r=Number.MAX_SAFE_INTEGER,i=0;i<X.length;++i){var c=X[i],o=c.start-n;r<=o||n<c.start&&(r=o,a=i)}else for(var s=Number.MAX_SAFE_INTEGER,u=0;u<X.length;++u){var l=X[u],b=n-l.start;s<=b||n>l.start&&(s=b,a=n<l.end?Math.max(0,u-1):u)}-1!==a&&(e.preventDefault(),g.currentTime=X[a].start/1e3)}}return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[g,de,X,M]),Object(r.useEffect)((function(){function e(e){if(le.current&&0!==le.current.length&&nn(e)){e.stopPropagation(),e.preventDefault();var t=le.current[0];g.copy(t),S&&(Oe("Copied "+t.text),ke(!0))}}return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[g,S]);var Ie=Object(r.useCallback)((function(e){return Ce(e)}),[]),Pe=Object(r.useCallback)((function(){return te((function(e){return!e}))}),[]),Ne=Object(r.useCallback)((function(){var e;S?document.exitFullscreen():null===(e=fe.current)||void 0===e||e.requestFullscreen()}),[S]),Ae=Object(r.useCallback)((function(e){d.current&&(d.current.volume=e)}),[]),Ue=Object(r.useCallback)((function(e){return g.offset(e)}),[g]),_e=Object(r.useCallback)((function(){g.popOutToggle(),s&&(l.current=!0,window.close())}),[g,s]),Be=Object(r.useCallback)((function(){g.condensedModeToggle()}),[g]),Le=Object(r.useCallback)((function(){g.close(),window.close()}),[g]),De=Object(r.useCallback)((function(){g.hideSubtitlePlayerToggle()}),[g]),We=Object(r.useCallback)((function(){y?g.pause():g.play()}),[g,y]),ze=Object(r.useCallback)((function(){return ke(!1)}),[]),He=n.subtitleSettings,Ve=He.subtitleSize,Ge=He.subtitleColor,Xe=He.subtitleOutlineThickness,Ke=He.subtitleOutlineColor,Je=He.subtitleBackgroundColor,qe=He.subtitleBackgroundOpacity,Qe=Object(r.useMemo)((function(){return aa(Ve,Ge,Xe,Ke,Je,qe)}),[Ve,Ge,Xe,Ke,Je,qe]);return Object(a.jsxs)("div",{ref:fe,onMouseMove:function(e){be.current.x=e.screenX,be.current.y=e.screenY},className:t.root,children:[Object(a.jsx)("video",{preload:"auto",nocontrols:1,onClick:We,className:we?t.video:"".concat(t.cursorHidden," ").concat(t.video),ref:Se,src:c}),ee&&Object(a.jsx)("div",{style:Qe,children:Q.map((function(e){return Object(a.jsxs)(i.a.Fragment,{children:[e.text,Object(a.jsx)("br",{})]},e.index)}))}),S&&Object(a.jsx)(C,{open:me,onClose:ze,autoHideDuration:3e3,severity:"success",children:pe}),Object(a.jsx)(Zt,{mousePositionRef:be,playing:y,clock:de,length:M,audioTracks:B,selectedAudioTrack:z,subtitlesToggle:X&&X.length>0,subtitlesEnabled:ee,offsetEnabled:!0,offset:N,fullscreenEnabled:!0,fullscreen:S,closeEnabled:!s,popOut:s,volumeEnabled:!0,popOutEnabled:!ea.isMobile,condensedModeToggleEnabled:!0,condensedModeEnabled:re,hideSubtitlePlayerToggleEnabled:(null===X||void 0===X?void 0:X.length)>0&&!s,subtitlePlayerHidden:se,onShow:Ie,onPlay:Fe,onPause:Ee,onSeek:Me,onAudioTrackSelected:Re,onSubtitlesToggle:Pe,onFullscreenToggle:Ne,onVolumeChange:Ae,onOffsetChange:Ue,onPopOutToggle:_e,onCondensedModeToggle:Be,onClose:Le,onHideSubtitlePlayerToggle:De,settingsProvider:n})]})}var ca="https://github.com/killergerbah/asbplayer/releases/latest",oa=Object(g.a)((function(e){return{content:{flexGrow:1,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginRight:0},contentShift:function(t){var n=t.drawerWidth;return{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:n}}}}));function sa(e,t){return e.audio?ae.fromBase64(e.subtitleFile,e.start,e.end,e.audio.base64,e.audio.extension):e.audioFile||e.videoFile?ae.fromFile(e.audioFile||e.videoFile,e.originalStart+t,e.originalEnd+t,e.audioTrack):null}function ua(e,t){return e.image?ot.fromBase64(e.subtitleFile,e.start,e.image.base64,e.image.extension):e.videoFile?ot.fromFile(e.videoFile,e.originalStart+t):null}function la(e){var t=oa(e);return Object(a.jsx)("main",{className:Object(k.a)(t.content,Object(p.a)({},t.contentShift,e.drawerOpen)),children:e.children})}var da=function(){var e=Object(r.useMemo)((function(){return new Ee}),[]),t=Object(r.useMemo)((function(){return new Zn}),[]),n=Object(r.useMemo)((function(){return new E(t)}),[t]),i=Object(r.useMemo)((function(){return new We}),[]),c=Object(v.g)(),o=Object(r.useRef)(),s="/video"===c.pathname,u=m(!s),l=Object(j.a)(u,1)[0],p=o.current?.2:.3,g=o.current?150:300,k=Math.max(g,l*p),x=Object(r.useState)([]),y=Object(j.a)(x,2),w=y[0],S=y[1],T=Object(r.useState)(!1),F=Object(j.a)(T,2),M=F[0],R=F[1],I=Object(r.useState)(),P=Object(j.a)(I,2),N=P[0],A=P[1],U=Object(r.useState)(!1),_=Object(j.a)(U,2),B=_[0],L=_[1],D=Object(r.useState)(),W=Object(j.a)(D,2),z=W[0],H=W[1],V=Object(r.useState)(),G=Object(j.a)(V,2),K=G[0],J=G[1],q=Object(r.useState)({}),Q=Object(j.a)(q,2),Y=Q[0],$=Q[1],Z=Object(r.useState)(!1),ee=Object(j.a)(Z,2),te=ee[0],ne=ee[1],ae=Object(r.useState)(!1),re=Object(j.a)(ae,2),ie=re[0],ce=re[1],se=Object(r.useRef)(),ue=Object(r.useState)(),le=Object(j.a)(ue,2),de=le[0],be=le[1],fe=Object(r.useState)(!1),he=Object(j.a)(fe,2),je=he[0],pe=he[1],Oe=Object(r.useState)(!1),ve=Object(j.a)(Oe,2),ge=ve[0],me=ve[1],xe=Object(r.useState)(),ye=Object(j.a)(xe,2),we=ye[0],Se=ye[1],Te=Object(r.useState)(!1),Fe=Object(j.a)(Te,2),Me=Fe[0],Re=Fe[1],Ie=Object(r.useState)(!1),Pe=Object(j.a)(Ie,2),Ne=Pe[0],Ae=Pe[1],Ue=Object(r.useState)(!1),_e=Object(j.a)(Ue,2),Be=_e[0],Le=_e[1],ze=Object(r.useState)(!1),He=Object(j.a)(ze,2),Ve=He[0],Ge=He[1],Xe=Object(r.useState)(),Ke=Object(j.a)(Xe,2),Je=Ke[0],qe=Ke[1],Qe=Object(r.useRef)(),Ye=Object(r.useRef)(),$e=Y.subtitleFile,Ze=Object(r.useCallback)((function(e,t,n,a,r,i,c){S((function(o){return[].concat(Object(h.a)(o),[Object(f.a)(Object(f.a)({},e),{},{timestamp:Date.now(),name:de,subtitleFile:a,audioFile:t,videoFile:n,audioTrack:r,audio:i,image:c})])})),H("success"),A("Copied "+e.text),L(!0)}),[de]),et=Object(r.useCallback)((function(){return R((function(e){return!e}))}),[]),tt=Object(r.useCallback)((function(){return R(!1)}),[]),nt=Object(r.useCallback)((function(){return Re(!0)}),[]),at=Object(r.useCallback)((function(){return Ae(!0)}),[]),it=Object(r.useCallback)((function(){return Ae(!1)}),[]),ct=Object(r.useCallback)((function(){return L(!1)}),[]),ot=Object(r.useCallback)((function(){return Le(!1)}),[]),st=Object(r.useCallback)((function(e){t.ankiConnectUrl=e.ankiConnectUrl,t.deck=e.deck,t.noteType=e.noteType,t.modelNames=e.modelNames,t.sentenceField=e.sentenceField,t.definitionField=e.definitionField,t.audioField=e.audioField,t.imageField=e.imageField,t.wordField=e.wordField,t.sourceField=e.sourceField,t.subtitleSize=e.subtitleSize,t.subtitleColor=e.subtitleColor,t.subtitleOutlineThickness=e.subtitleOutlineThickness,t.subtitleOutlineColor=e.subtitleOutlineColor,t.subtitleBackgroundColor=e.subtitleBackgroundColor,t.subtitleBackgroundOpacity=e.subtitleBackgroundOpacity,t.customAnkiFields=e.customAnkiFields,t.preferMp3=e.preferMp3,Re(!1),i.publishMessage({command:"subtitleSettings",value:t.subtitleSettings})}),[i,t]),ut=Object(r.useCallback)((function(e){var t,n=[],a=Object(O.a)(w);try{for(a.s();!(t=a.n()).done;){var r=t.value;e.timestamp!==r.timestamp&&n.push(r)}}catch(i){a.e(i)}finally{a.f()}S(n)}),[w]),dt=Object(r.useCallback)((function(e){H("error"),A(e),L(!0)}),[]),bt=Object(r.useCallback)((function(e){e===Y.audioFileUrl&&$((function(t){return URL.revokeObjectURL(e),{subtitleFile:t.subtitleFile,audioFile:null,audioFileUrl:null,videoFile:t.videoFile,videoFileUrl:t.videoFileUrl}}))}),[Y]),ft=Object(r.useCallback)((function(e){e===Y.videoFileUrl&&$((function(t){return URL.revokeObjectURL(e),{subtitleFile:t.subtitleFile,audioFile:t.audioFile,audioFileUrl:t.audioFileUrl,videoFile:null,videoFileUrl:null}}))}),[Y]),ht=Object(r.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,sa(n,Qe.current||0);case 3:a=e.sent,t.preferMp3?a.toMp3().download():a.download(),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0),dt(e.t0.message);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),[dt,t]),jt=Object(r.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ua(t,Qe.current||0).download();case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0),dt(e.t0.message);case 9:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),[dt]),pt=Object(r.useCallback)((function(e){$e.name===e.subtitleFile.name?J({text:e.text,originalStart:e.originalStart}):dt("Subtitle file "+e.subtitleFile.name+" is not open.")}),[$e,dt]),Ot=Object(r.useCallback)((function(e){Se(e),pe(!0),me(!1),Ge(!0)}),[]),vt=Object(r.useCallback)((function(){pe(!1),me(!1),Ge(!1)}),[]),gt=Object(r.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(t,a,r,i,c,o,s,u){var l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return me(!0),e.prev=1,e.next=4,n.export(t,a,r,i,c,o,s,u);case 4:l=e.sent,u||(H("success"),A("Export succeeded: "+l),L(!0)),pe(!1),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),console.error(e.t0),dt(e.t0.message);case 13:return e.prev=13,me(!1),Ge(!1),e.finish(13);case 17:case"end":return e.stop()}}),e,null,[[1,9,13,17]])})));return function(t,n,a,r,i,c,o,s){return e.apply(this,arguments)}}(),[n,dt]),mt=Object(r.useCallback)((function(e){qe(e),Le(!0)}),[]),kt=Object(r.useCallback)((function(e){try{var t=function(e){var t,n=null,a=null,r=null,i=Object(O.a)(e);try{for(i.s();!(t=i.n()).done;){var c=t.value,o=c.name.lastIndexOf(".");if(-1===o)throw new Error("Unable to determine extension of "+c.name);var s=c.name.substring(o+1,c.name.length);switch(s){case"ass":case"srt":case"vtt":if(n)throw new Error("Cannot open two subtitle files simultaneously");n=c;break;case"mkv":if(r)throw new Error("Cannot open two video files simultaneously");r=c;break;case"mp3":case"m4a":if(a)throw new Error("Cannot open two audio files simultaneously");a=c;break;default:throw new Error("Unsupported extension "+s)}}}catch(u){i.e(u)}finally{i.f()}if(r&&a)throw new Error("Cannot load both an audio and video file simultaneously");return{subtitleFile:n,audioFile:a,videoFile:r}}(e),n=t.subtitleFile,a=t.audioFile,r=t.videoFile;$((function(e){ne(!0);var t=null,i=null;return r||a?(!function(e){e.audioFileUrl&&URL.revokeObjectURL(e.audioFileUrl),e.videoFileUrl&&URL.revokeObjectURL(e.videoFileUrl)}(e),r?t=URL.createObjectURL(r):a&&(i=URL.createObjectURL(a))):(r=e.videoFile,t=e.videoFileUrl,a=e.audioFile,i=e.audioFileUrl),{subtitleFile:n||e.subtitleFile,audioFile:a,audioFileUrl:i,videoFile:r,videoFileUrl:t}})),n&&be(n.name)}catch(i){console.error(i),dt(i.message)}}),[dt]),xt=Object(r.useCallback)((function(e){e.preventDefault(),s?dt("Video player cannot receive dropped files. Drop outside of the video frame instead."):(ce(!1),se.current=null,e.dataTransfer.files&&0!==e.dataTransfer.files.length&&kt(e.dataTransfer.files))}),[s,dt,kt]),yt=Object(r.useCallback)((function(){var e,t=null===(e=Ye.current)||void 0===e?void 0:e.files;t&&t.length>0&&kt(t)}),[kt]),wt=Object(r.useCallback)((function(){var e;return null===(e=Ye.current)||void 0===e?void 0:e.click()}),[]),Ct=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),s||(se.current=e.target,ce(!0))}),[s]),St=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),s||se.current!==e.target||ce(!1)}),[s]),Tt=Object(r.useCallback)((function(){return ne(!1)}),[]),Ft=te&&!o.current||!Y.subtitleFile&&!Y.audioFile&&!Y.videoFile;return Object(a.jsxs)("div",{onDrop:xt,onDragOver:function(e){return e.preventDefault()},onDragEnter:Ct,onDragLeave:St,children:[Object(a.jsx)(C,{open:B,onClose:ct,autoHideDuration:3e3,severity:z,children:N}),Object(a.jsxs)(v.d,{children:[Object(a.jsx)(v.b,{exact:!0,path:"/",render:function(){var r,c=new URLSearchParams(window.location.search),s=c.get("video"),u=c.get("channel"),l=c.get("popout");return s&&u?Object(a.jsx)(v.a,{to:"/video?video="+encodeURIComponent(s)+"&channel="+u+"&popout="+l}):Object(a.jsxs)("div",{children:[Object(a.jsx)(rt,{items:w,open:M,drawerWidth:k,onClose:tt,onDelete:ut,onClipAudio:ht,onDownloadImage:jt,onSelect:pt,onAnki:Ot}),Object(a.jsx)(X,{open:je,disabled:ge,text:null===we||void 0===we?void 0:we.text,audioClip:we&&sa(we,Qe.current||0),image:we&&ua(we,Qe.current||0),source:null===we||void 0===we||null===(r=we.subtitleFile)||void 0===r?void 0:r.name,customFields:t.customAnkiFields,anki:n,settingsProvider:t,onCancel:vt,onProceed:gt,onViewImage:mt,onOpenSettings:nt}),Object(a.jsx)(Ce,{open:Be,image:Je,onClose:ot}),Object(a.jsx)(Nn,{anki:n,open:Me,onClose:st,settings:t.settings}),Object(a.jsx)(ke,{open:Ne,extensionUrl:ca,onClose:it}),Object(a.jsx)(De,{title:de||"asbplayer",drawerWidth:k,drawerOpen:M,onOpenCopyHistory:et,onOpenSettings:nt,onOpenHelp:at,onFileSelector:wt}),Object(a.jsx)("input",{ref:Ye,onChange:yt,type:"file",accept:".srt,.ass,.vtt,.mp3,.m4a,.mkv",multiple:!0,hidden:!0}),Object(a.jsxs)(la,{drawerWidth:k,drawerOpen:M,children:[Ft&&Object(a.jsx)(lt,{latestExtensionVersion:"0.7.0",extensionUrl:ca,extension:i,loading:te,dragging:ie,onFileSelector:wt}),Object(a.jsx)(oe,{dragging:ie,loading:te}),Object(a.jsx)(On,{subtitleReader:e,settingsProvider:t,onCopy:Ze,onError:dt,onUnloadAudio:bt,onUnloadVideo:ft,onLoaded:Tt,offsetRef:Qe,sources:Y,jumpToSubtitle:K,videoFrameRef:o,extension:i,drawerOpen:M,disableKeyEvents:Ve})]})]})}}),Object(a.jsx)(v.b,{exact:!0,path:"/video",render:function(){var e=new URLSearchParams(window.location.search),n=e.get("video"),r=e.get("channel"),i="true"===e.get("popout");return Object(a.jsx)(ia,{settingsProvider:t,videoFile:n,popOut:i,channel:r,onError:dt})}})]})]})},ba=n(101),fa=n(181),ha=Object(fa.a)({palette:{primary:{main:"#49007a"},secondary:{main:"#ff1f62"},error:{main:ba.a.A400},type:"dark"}}),ja=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,351)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),i(e),c(e)}))},pa=n(116);n(263);o.a.render(Object(a.jsx)(pa.a,{basename:"/asbplayer",forceRefresh:!1,children:Object(a.jsxs)(u.a,{theme:ha,children:[Object(a.jsx)(s.a,{}),Object(a.jsx)(da,{})]})}),document.querySelector("#root")),ja()}},[[264,1,2]]]);
//# sourceMappingURL=main.266fbc2b.chunk.js.map